!function($){"use strict";function getWindowSize(dimension,config){var ddeClientHeight,visualSize,zoomFactor,snapToKnownHeight,lBound,uBound,_window=config.window,scrollbarsConsumeSpace=0!==browserScrollbarWidth(),getLayoutViewportWidth=config.useLayoutViewport&&"Width"===dimension,useClientSize=scrollbarsConsumeSpace||!supportsWindowInnerWidth()||getLayoutViewportWidth,size=useClientSize?_window.document.documentElement["client"+dimension]:getWindowInnerSize(dimension,_window);return config.useLayoutViewport&&!useClientSize&&(visualSize=size,zoomFactor=getPinchZoomFactor(_window,{asRange:!0}),size=Math.round(visualSize*zoomFactor.calculated),supportsSubpixelAccuracy()||(ddeClientHeight=_window.document.documentElement.clientHeight,lBound=(visualSize-1)*zoomFactor.min,uBound=(visualSize+1)*zoomFactor.max,snapToKnownHeight=ddeClientHeight+3>=size&&size>=ddeClientHeight-3||ddeClientHeight>=lBound&&uBound>=ddeClientHeight&&ddeClientHeight+30>uBound,snapToKnownHeight&&(size=ddeClientHeight))),size}function getPinchZoomFactor(_window,options){var ddeClientWidth,windowInnerWidth,asRange=options&&options.asRange,factors={calculated:1,min:1,max:1},skip=0!==browserScrollbarWidth()||!supportsWindowInnerWidth();return skip||(_window||(_window=window),ddeClientWidth=_window.document.documentElement.clientWidth,windowInnerWidth=getWindowInnerWidth(_window),factors.calculated=ddeClientWidth/windowInnerWidth,asRange&&(supportsSubpixelAccuracy()?factors.min=factors.max=factors.calculated:(factors.min=ddeClientWidth/(windowInnerWidth+1),factors.max=ddeClientWidth/(windowInnerWidth-1)))),asRange?factors:factors.calculated}function getWindowQueryConfig(args){var isWindowArg0,isOptionArg0,isOptionArg1,_window=window,_useVisualViewport=!0;return args&&args.length&&(args=Array.prototype.slice.call(args),isWindowArg0=isWindow(args[0]),isWindowArg0||(args[0]=castStringToViewportOption(args[0])),isOptionArg0=!isWindowArg0&&args[0],isOptionArg0||(args[1]=castStringToViewportOption(args[1])),isOptionArg1=!isOptionArg0&&args[1],isWindowArg0?(_window=args[0],isOptionArg1&&args[1].viewport&&(_useVisualViewport=isVisualViewport(args[1].viewport))):isOptionArg0?(args[0].viewport&&(_useVisualViewport=isVisualViewport(args[0].viewport)),isWindow(args[1])&&(_window=args[1])):!args[0]&&args[1]&&(isOptionArg1&&args[1].viewport?_useVisualViewport=isVisualViewport(args[1].viewport):isWindow(args[1])&&(_window=args[1]))),{window:_window,useVisualViewport:_useVisualViewport,useLayoutViewport:!_useVisualViewport}}function isVisualViewport(name){var viewport=isString(name)&&name.toLowerCase();if(name&&!viewport)throw new Error("Invalid viewport option: "+name);if(viewport&&"visual"!==viewport&&"layout"!==viewport)throw new Error("Invalid viewport name: "+name);return"visual"===viewport}function castStringToViewportOption(arg){return isString(arg)&&""!==arg?{viewport:arg}:arg}function supportsWindowInnerWidth(){return void 0===_supportsWindowInnerWidth&&(_supportsWindowInnerWidth=getWindowInnerWidth()>10),_supportsWindowInnerWidth}function browserScrollbarWidth(){var testEl;return void 0===_scrollbarWidth&&(testEl=document.createElement("div"),testEl.style.cssText="width: 100px; height: 100px; overflow: scroll; position: absolute; top: -500px; left: -500px; margin: 0px; padding: 0px; border: none;",document.body.appendChild(testEl),_scrollbarWidth=testEl.offsetWidth-testEl.clientWidth,document.body.removeChild(testEl)),_scrollbarWidth}function testDocumentScroll(){var initialDocumentState,_testEl,initialScrollWidth,responds,iframe=createTestIframe(),_document=iframe&&iframe.contentDocument||document,_body=_document.body,inIframe=_document!==document;_testEl=_document.createElement("div"),_testEl.style.cssText="width: 1px; height: 1px; position: relative; top: 0px; left: 32000px;",inIframe||(initialDocumentState=prepareGlobalDocument()),initialScrollWidth=_body.scrollWidth,_body.appendChild(_testEl),responds=initialScrollWidth!==_body.scrollWidth,_body.removeChild(_testEl),inIframe||restoreGlobalDocument(initialDocumentState),elementNameForDocSizeQuery=responds?"documentElement":"body",document.body.removeChild(iframe)}function createTestIframe(){var iframe=document.createElement("iframe"),body=document.body;return iframe.style.cssText="position: absolute; top: -600px; left: -600px; width: 500px; height: 500px; margin: 0px; padding: 0px; border: none; display: block;",iframe.frameborder="0",body.appendChild(iframe),iframe.src="about:blank",iframe.contentDocument?(iframe.contentDocument.write('<!DOCTYPE html><html><head><meta charset="UTF-8"><title></title><style type="text/css">html, body { overflow: hidden; }</style></head><body></body></html>'),iframe):void 0}function prepareGlobalDocument(){var ddEStyle,bodyStyle,ddE=document.documentElement,body=document.body,ddEComputedStyles=useGetComputedStyle?window.getComputedStyle(ddE,null):ddE.currentStyle,bodyComputedStyles=useGetComputedStyle?window.getComputedStyle(body,null):body.currentStyle,ddEOverflowX=(ddEComputedStyles.overflowX||ddEComputedStyles.overflow||"visible").toLowerCase(),bodyOverflowX=(bodyComputedStyles.overflowX||bodyComputedStyles.overflow||"visible").toLowerCase(),modifyBody="hidden"!==bodyOverflowX,modifyDocumentElement="visible"===ddEOverflowX,initialState={documentElement:{modified:modifyDocumentElement},body:{modified:modifyBody}};return modifyDocumentElement&&(ddEStyle=ddE.style,initialState.documentElement.styleOverflowX=ddEStyle.overflowX,ddEStyle.overflowX="auto"),modifyBody&&(bodyStyle=body.style,initialState.body.styleOverflowX=bodyStyle.overflowX,bodyStyle.overflowX="hidden"),initialState}function restoreGlobalDocument(previousState){previousState.documentElement.modified&&(document.documentElement.style.overflowX=previousState.documentElement.styleOverflowX),previousState.body.modified&&(document.body.style.overflowX=previousState.body.styleOverflowX)}function getWindowInnerWidth(_window){return getWindowInnerSize("Width",_window)}function getWindowInnerSize(dimension,_window){var size=(_window||window)["inner"+dimension];return size&&checkForFractions(size),size}function checkForFractions(sizeMeasurement){!_supportsSubpixelAccuracy&&isFloat(sizeMeasurement)&&(_supportsSubpixelAccuracy=!0)}function supportsSubpixelAccuracy(){return!!_supportsSubpixelAccuracy}function isWindow(value){return null!=value&&value.window==value}function isString(value){return"string"==typeof value||value&&"object"==typeof value&&"[object String]"===Object.prototype.toString.call(value)||!1}function isFloat(num){return num===+num&&num!==(0|num)}var _scrollbarWidth,_supportsWindowInnerWidth,_supportsSubpixelAccuracy,elementNameForDocSizeQuery,useGetComputedStyle=!!window.getComputedStyle;$.documentWidth=function(_document){return _document||(_document=document),void 0===elementNameForDocSizeQuery&&testDocumentScroll(),_document[elementNameForDocSizeQuery].scrollWidth},$.documentHeight=function(_document){return _document||(_document=document),void 0===elementNameForDocSizeQuery&&testDocumentScroll(),_document[elementNameForDocSizeQuery].scrollHeight},$.windowWidth=function(options,_window){var config=getWindowQueryConfig(arguments);return getWindowSize("Width",config)},$.windowHeight=function(options,_window){var config=getWindowQueryConfig(arguments);return getWindowSize("Height",config)},$.pinchZoomFactor=function(_window){return getPinchZoomFactor(_window)},$.scrollbarWidth=browserScrollbarWidth,"function"==typeof $&&$(function(){void 0===elementNameForDocSizeQuery&&testDocumentScroll(),browserScrollbarWidth()})}("undefined"!=typeof jQuery?jQuery:"undefined"!=typeof Zepto?Zepto:$),function(factory){"function"==typeof define&&define.amd?define(["jquery"],factory):"object"==typeof exports?module.exports=factory:factory(jQuery)}(function($){function handler(event){var orgEvent=event||window.event,args=slice.call(arguments,1),delta=0,deltaX=0,deltaY=0,absDelta=0,offsetX=0,offsetY=0;if(event=$.event.fix(orgEvent),event.type="mousewheel","detail"in orgEvent&&(deltaY=-1*orgEvent.detail),"wheelDelta"in orgEvent&&(deltaY=orgEvent.wheelDelta),"wheelDeltaY"in orgEvent&&(deltaY=orgEvent.wheelDeltaY),"wheelDeltaX"in orgEvent&&(deltaX=-1*orgEvent.wheelDeltaX),"axis"in orgEvent&&orgEvent.axis===orgEvent.HORIZONTAL_AXIS&&(deltaX=-1*deltaY,deltaY=0),delta=0===deltaY?deltaX:deltaY,"deltaY"in orgEvent&&(deltaY=-1*orgEvent.deltaY,delta=deltaY),"deltaX"in orgEvent&&(deltaX=orgEvent.deltaX,0===deltaY&&(delta=-1*deltaX)),0!==deltaY||0!==deltaX){if(1===orgEvent.deltaMode){var lineHeight=$.data(this,"mousewheel-line-height");delta*=lineHeight,deltaY*=lineHeight,deltaX*=lineHeight}else if(2===orgEvent.deltaMode){var pageHeight=$.data(this,"mousewheel-page-height");delta*=pageHeight,deltaY*=pageHeight,deltaX*=pageHeight}if(absDelta=Math.max(Math.abs(deltaY),Math.abs(deltaX)),(!lowestDelta||lowestDelta>absDelta)&&(lowestDelta=absDelta,shouldAdjustOldDeltas(orgEvent,absDelta)&&(lowestDelta/=40)),shouldAdjustOldDeltas(orgEvent,absDelta)&&(delta/=40,deltaX/=40,deltaY/=40),delta=Math[delta>=1?"floor":"ceil"](delta/lowestDelta),deltaX=Math[deltaX>=1?"floor":"ceil"](deltaX/lowestDelta),deltaY=Math[deltaY>=1?"floor":"ceil"](deltaY/lowestDelta),special.settings.normalizeOffset&&this.getBoundingClientRect){var boundingRect=this.getBoundingClientRect();offsetX=event.clientX-boundingRect.left,offsetY=event.clientY-boundingRect.top}return event.deltaX=deltaX,event.deltaY=deltaY,event.deltaFactor=lowestDelta,event.offsetX=offsetX,event.offsetY=offsetY,event.deltaMode=0,args.unshift(event,delta,deltaX,deltaY),nullLowestDeltaTimeout&&clearTimeout(nullLowestDeltaTimeout),nullLowestDeltaTimeout=setTimeout(nullLowestDelta,200),($.event.dispatch||$.event.handle).apply(this,args)}}function nullLowestDelta(){lowestDelta=null}function shouldAdjustOldDeltas(orgEvent,absDelta){return special.settings.adjustOldDeltas&&"mousewheel"===orgEvent.type&&absDelta%120===0}var nullLowestDeltaTimeout,lowestDelta,toFix=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],toBind="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],slice=Array.prototype.slice;if($.event.fixHooks)for(var i=toFix.length;i;)$.event.fixHooks[toFix[--i]]=$.event.mouseHooks;var special=$.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener)for(var i=toBind.length;i;)this.addEventListener(toBind[--i],handler,!1);else this.onmousewheel=handler;$.data(this,"mousewheel-line-height",special.getLineHeight(this)),$.data(this,"mousewheel-page-height",special.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var i=toBind.length;i;)this.removeEventListener(toBind[--i],handler,!1);else this.onmousewheel=null;$.removeData(this,"mousewheel-line-height"),$.removeData(this,"mousewheel-page-height")},getLineHeight:function(elem){var $elem=$(elem),$parent=$elem["offsetParent"in $.fn?"offsetParent":"parent"]();return $parent.length||($parent=$("body")),parseInt($parent.css("fontSize"),10)||parseInt($elem.css("fontSize"),10)||16},getPageHeight:function(elem){return $(elem).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};$.fn.extend({mousewheel:function(fn){return fn?this.bind("mousewheel",fn):this.trigger("mousewheel")},unmousewheel:function(fn){return this.unbind("mousewheel",fn)}})}),function(window,document,undefined){var oldL=window.L,L={};L.version="0.7.5","object"==typeof module&&"object"==typeof module.exports?module.exports=L:"function"==typeof define&&define.amd&&define(L),L.noConflict=function(){return window.L=oldL,this},window.L=L,L.Util={extend:function(dest){var i,j,len,src,sources=Array.prototype.slice.call(arguments,1);for(j=0,len=sources.length;len>j;j++){src=sources[j]||{};for(i in src)src.hasOwnProperty(i)&&(dest[i]=src[i])}return dest},bind:function(fn,obj){var args=arguments.length>2?Array.prototype.slice.call(arguments,2):null;return function(){return fn.apply(obj,args||arguments)}},stamp:function(){var lastId=0,key="_leaflet_id";return function(obj){return obj[key]=obj[key]||++lastId,obj[key]}}(),invokeEach:function(obj,method,context){var i,args;if("object"==typeof obj){args=Array.prototype.slice.call(arguments,3);for(i in obj)method.apply(context,[i,obj[i]].concat(args));return!0}return!1},limitExecByInterval:function(fn,time,context){var lock,execOnUnlock;return function wrapperFn(){var args=arguments;return lock?void(execOnUnlock=!0):(lock=!0,setTimeout(function(){lock=!1,execOnUnlock&&(wrapperFn.apply(context,args),execOnUnlock=!1)},time),void fn.apply(context,args))}},falseFn:function(){return!1},formatNum:function(num,digits){var pow=Math.pow(10,digits||5);return Math.round(num*pow)/pow},trim:function(str){return str.trim?str.trim():str.replace(/^\s+|\s+$/g,"")},splitWords:function(str){return L.Util.trim(str).split(/\s+/)},setOptions:function(obj,options){return obj.options=L.extend({},obj.options,options),obj.options},getParamString:function(obj,existingUrl,uppercase){var params=[];for(var i in obj)params.push(encodeURIComponent(uppercase?i.toUpperCase():i)+"="+encodeURIComponent(obj[i]));return(existingUrl&&-1!==existingUrl.indexOf("?")?"&":"?")+params.join("&")},template:function(str,data){return str.replace(/\{ *([\w_]+) *\}/g,function(str,key){var value=data[key];if(value===undefined)throw new Error("No value provided for variable "+str);return"function"==typeof value&&(value=value(data)),value})},isArray:Array.isArray||function(obj){return"[object Array]"===Object.prototype.toString.call(obj)},emptyImageUrl:"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="},function(){function getPrefixed(name){var i,fn,prefixes=["webkit","moz","o","ms"];for(i=0;i<prefixes.length&&!fn;i++)fn=window[prefixes[i]+name];return fn}function timeoutDefer(fn){var time=+new Date,timeToCall=Math.max(0,16-(time-lastTime));return lastTime=time+timeToCall,window.setTimeout(fn,timeToCall)}var lastTime=0,requestFn=window.requestAnimationFrame||getPrefixed("RequestAnimationFrame")||timeoutDefer,cancelFn=window.cancelAnimationFrame||getPrefixed("CancelAnimationFrame")||getPrefixed("CancelRequestAnimationFrame")||function(id){window.clearTimeout(id)};L.Util.requestAnimFrame=function(fn,context,immediate,element){return fn=L.bind(fn,context),immediate&&requestFn===timeoutDefer?void fn():requestFn.call(window,fn,element)},L.Util.cancelAnimFrame=function(id){id&&cancelFn.call(window,id)}}(),L.extend=L.Util.extend,L.bind=L.Util.bind,L.stamp=L.Util.stamp,L.setOptions=L.Util.setOptions,L.Class=function(){},L.Class.extend=function(props){var NewClass=function(){this.initialize&&this.initialize.apply(this,arguments),this._initHooks&&this.callInitHooks()},F=function(){};F.prototype=this.prototype;var proto=new F;proto.constructor=NewClass,NewClass.prototype=proto;for(var i in this)this.hasOwnProperty(i)&&"prototype"!==i&&(NewClass[i]=this[i]);props.statics&&(L.extend(NewClass,props.statics),delete props.statics),props.includes&&(L.Util.extend.apply(null,[proto].concat(props.includes)),delete props.includes),props.options&&proto.options&&(props.options=L.extend({},proto.options,props.options)),L.extend(proto,props),proto._initHooks=[];var parent=this;return NewClass.__super__=parent.prototype,proto.callInitHooks=function(){if(!this._initHooksCalled){parent.prototype.callInitHooks&&parent.prototype.callInitHooks.call(this),this._initHooksCalled=!0;for(var i=0,len=proto._initHooks.length;len>i;i++)proto._initHooks[i].call(this)}},NewClass},L.Class.include=function(props){L.extend(this.prototype,props)},L.Class.mergeOptions=function(options){L.extend(this.prototype.options,options)},L.Class.addInitHook=function(fn){var args=Array.prototype.slice.call(arguments,1),init="function"==typeof fn?fn:function(){this[fn].apply(this,args)};this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(init)};var eventsKey="_leaflet_events";L.Mixin={},L.Mixin.Events={addEventListener:function(types,fn,context){if(L.Util.invokeEach(types,this.addEventListener,this,fn,context))return this;var i,len,event,type,indexKey,indexLenKey,typeIndex,events=this[eventsKey]=this[eventsKey]||{},contextId=context&&context!==this&&L.stamp(context);for(types=L.Util.splitWords(types),i=0,len=types.length;len>i;i++)event={action:fn,context:context||this},type=types[i],contextId?(indexKey=type+"_idx",indexLenKey=indexKey+"_len",typeIndex=events[indexKey]=events[indexKey]||{},typeIndex[contextId]||(typeIndex[contextId]=[],events[indexLenKey]=(events[indexLenKey]||0)+1),typeIndex[contextId].push(event)):(events[type]=events[type]||[],events[type].push(event));return this},hasEventListeners:function(type){var events=this[eventsKey];return!!events&&(type in events&&events[type].length>0||type+"_idx"in events&&events[type+"_idx_len"]>0)},removeEventListener:function(types,fn,context){if(!this[eventsKey])return this;if(!types)return this.clearAllEventListeners();if(L.Util.invokeEach(types,this.removeEventListener,this,fn,context))return this;var i,len,type,listeners,j,indexKey,indexLenKey,typeIndex,removed,events=this[eventsKey],contextId=context&&context!==this&&L.stamp(context);for(types=L.Util.splitWords(types),i=0,len=types.length;len>i;i++)if(type=types[i],indexKey=type+"_idx",indexLenKey=indexKey+"_len",typeIndex=events[indexKey],fn){if(listeners=contextId&&typeIndex?typeIndex[contextId]:events[type]){for(j=listeners.length-1;j>=0;j--)listeners[j].action!==fn||context&&listeners[j].context!==context||(removed=listeners.splice(j,1),removed[0].action=L.Util.falseFn);context&&typeIndex&&0===listeners.length&&(delete typeIndex[contextId],events[indexLenKey]--)}}else delete events[type],delete events[indexKey],delete events[indexLenKey];return this},clearAllEventListeners:function(){return delete this[eventsKey],this},fireEvent:function(type,data){if(!this.hasEventListeners(type))return this;var listeners,i,len,typeIndex,contextId,event=L.Util.extend({},data,{type:type,target:this}),events=this[eventsKey];if(events[type])for(listeners=events[type].slice(),i=0,len=listeners.length;len>i;i++)listeners[i].action.call(listeners[i].context,event);typeIndex=events[type+"_idx"];for(contextId in typeIndex)if(listeners=typeIndex[contextId].slice())for(i=0,len=listeners.length;len>i;i++)listeners[i].action.call(listeners[i].context,event);return this},addOneTimeEventListener:function(types,fn,context){if(L.Util.invokeEach(types,this.addOneTimeEventListener,this,fn,context))return this;var handler=L.bind(function(){this.removeEventListener(types,fn,context).removeEventListener(types,handler,context)},this);return this.addEventListener(types,fn,context).addEventListener(types,handler,context)}},L.Mixin.Events.on=L.Mixin.Events.addEventListener,L.Mixin.Events.off=L.Mixin.Events.removeEventListener,L.Mixin.Events.once=L.Mixin.Events.addOneTimeEventListener,L.Mixin.Events.fire=L.Mixin.Events.fireEvent,function(){var ie="ActiveXObject"in window,ielt9=ie&&!document.addEventListener,ua=navigator.userAgent.toLowerCase(),webkit=-1!==ua.indexOf("webkit"),chrome=-1!==ua.indexOf("chrome"),phantomjs=-1!==ua.indexOf("phantom"),android=-1!==ua.indexOf("android"),android23=-1!==ua.search("android [23]"),gecko=-1!==ua.indexOf("gecko"),mobile=typeof orientation!=undefined+"",msPointer=!window.PointerEvent&&window.MSPointerEvent,pointer=window.PointerEvent&&window.navigator.pointerEnabled&&window.navigator.maxTouchPoints||msPointer,retina="devicePixelRatio"in window&&window.devicePixelRatio>1||"matchMedia"in window&&window.matchMedia("(min-resolution:144dpi)")&&window.matchMedia("(min-resolution:144dpi)").matches,doc=document.documentElement,ie3d=ie&&"transition"in doc.style,webkit3d="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!android23,gecko3d="MozPerspective"in doc.style,opera3d="OTransition"in doc.style,any3d=!window.L_DISABLE_3D&&(ie3d||webkit3d||gecko3d||opera3d)&&!phantomjs,touch=!window.L_NO_TOUCH&&!phantomjs&&(pointer||"ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch);L.Browser={ie:ie,ielt9:ielt9,webkit:webkit,gecko:gecko&&!webkit&&!window.opera&&!ie,android:android,android23:android23,chrome:chrome,ie3d:ie3d,webkit3d:webkit3d,gecko3d:gecko3d,opera3d:opera3d,any3d:any3d,mobile:mobile,mobileWebkit:mobile&&webkit,mobileWebkit3d:mobile&&webkit3d,mobileOpera:mobile&&window.opera,touch:touch,msPointer:msPointer,pointer:pointer,retina:retina}}(),L.Point=function(x,y,round){this.x=round?Math.round(x):x,this.y=round?Math.round(y):y},L.Point.prototype={clone:function(){return new L.Point(this.x,this.y)},add:function(point){return this.clone()._add(L.point(point))},_add:function(point){return this.x+=point.x,this.y+=point.y,this},subtract:function(point){return this.clone()._subtract(L.point(point))},_subtract:function(point){return this.x-=point.x,this.y-=point.y,this},divideBy:function(num){return this.clone()._divideBy(num)},_divideBy:function(num){return this.x/=num,this.y/=num,this},multiplyBy:function(num){return this.clone()._multiplyBy(num)},_multiplyBy:function(num){return this.x*=num,this.y*=num,this},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},distanceTo:function(point){point=L.point(point);var x=point.x-this.x,y=point.y-this.y;return Math.sqrt(x*x+y*y)},equals:function(point){return point=L.point(point),point.x===this.x&&point.y===this.y},contains:function(point){return point=L.point(point),Math.abs(point.x)<=Math.abs(this.x)&&Math.abs(point.y)<=Math.abs(this.y)},toString:function(){return"Point("+L.Util.formatNum(this.x)+", "+L.Util.formatNum(this.y)+")"}},L.point=function(x,y,round){return x instanceof L.Point?x:L.Util.isArray(x)?new L.Point(x[0],x[1]):x===undefined||null===x?x:new L.Point(x,y,round)},L.Bounds=function(a,b){if(a)for(var points=b?[a,b]:a,i=0,len=points.length;len>i;i++)this.extend(points[i])},L.Bounds.prototype={extend:function(point){return point=L.point(point),this.min||this.max?(this.min.x=Math.min(point.x,this.min.x),this.max.x=Math.max(point.x,this.max.x),this.min.y=Math.min(point.y,this.min.y),this.max.y=Math.max(point.y,this.max.y)):(this.min=point.clone(),this.max=point.clone()),this},getCenter:function(round){return new L.Point((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,round)},getBottomLeft:function(){return new L.Point(this.min.x,this.max.y)},getTopRight:function(){return new L.Point(this.max.x,this.min.y)},getSize:function(){return this.max.subtract(this.min)},contains:function(obj){var min,max;return obj="number"==typeof obj[0]||obj instanceof L.Point?L.point(obj):L.bounds(obj),obj instanceof L.Bounds?(min=obj.min,max=obj.max):min=max=obj,min.x>=this.min.x&&max.x<=this.max.x&&min.y>=this.min.y&&max.y<=this.max.y},intersects:function(bounds){bounds=L.bounds(bounds);var min=this.min,max=this.max,min2=bounds.min,max2=bounds.max,xIntersects=max2.x>=min.x&&min2.x<=max.x,yIntersects=max2.y>=min.y&&min2.y<=max.y;return xIntersects&&yIntersects},isValid:function(){return!(!this.min||!this.max)}},L.bounds=function(a,b){return!a||a instanceof L.Bounds?a:new L.Bounds(a,b)},L.Transformation=function(a,b,c,d){this._a=a,this._b=b,this._c=c,this._d=d},L.Transformation.prototype={transform:function(point,scale){return this._transform(point.clone(),scale)},_transform:function(point,scale){return scale=scale||1,point.x=scale*(this._a*point.x+this._b),point.y=scale*(this._c*point.y+this._d),point},untransform:function(point,scale){return scale=scale||1,new L.Point((point.x/scale-this._b)/this._a,(point.y/scale-this._d)/this._c)}},L.DomUtil={get:function(id){return"string"==typeof id?document.getElementById(id):id},getStyle:function(el,style){var value=el.style[style];if(!value&&el.currentStyle&&(value=el.currentStyle[style]),(!value||"auto"===value)&&document.defaultView){var css=document.defaultView.getComputedStyle(el,null);value=css?css[style]:null}return"auto"===value?null:value},getViewportOffset:function(element){var pos,top=0,left=0,el=element,docBody=document.body,docEl=document.documentElement;do{if(top+=el.offsetTop||0,left+=el.offsetLeft||0,top+=parseInt(L.DomUtil.getStyle(el,"borderTopWidth"),10)||0,left+=parseInt(L.DomUtil.getStyle(el,"borderLeftWidth"),10)||0,pos=L.DomUtil.getStyle(el,"position"),el.offsetParent===docBody&&"absolute"===pos)break;if("fixed"===pos){top+=docBody.scrollTop||docEl.scrollTop||0,left+=docBody.scrollLeft||docEl.scrollLeft||0;break}if("relative"===pos&&!el.offsetLeft){var width=L.DomUtil.getStyle(el,"width"),maxWidth=L.DomUtil.getStyle(el,"max-width"),r=el.getBoundingClientRect();("none"!==width||"none"!==maxWidth)&&(left+=r.left+el.clientLeft),top+=r.top+(docBody.scrollTop||docEl.scrollTop||0);break}el=el.offsetParent}while(el);el=element;do{if(el===docBody)break;top-=el.scrollTop||0,left-=el.scrollLeft||0,el=el.parentNode}while(el);return new L.Point(left,top)},documentIsLtr:function(){return L.DomUtil._docIsLtrCached||(L.DomUtil._docIsLtrCached=!0,L.DomUtil._docIsLtr="ltr"===L.DomUtil.getStyle(document.body,"direction")),L.DomUtil._docIsLtr},create:function(tagName,className,container){var el=document.createElement(tagName);return el.className=className,container&&container.appendChild(el),el},hasClass:function(el,name){if(el.classList!==undefined)return el.classList.contains(name);var className=L.DomUtil._getClass(el);return className.length>0&&new RegExp("(^|\\s)"+name+"(\\s|$)").test(className)},addClass:function(el,name){if(el.classList!==undefined)for(var classes=L.Util.splitWords(name),i=0,len=classes.length;len>i;i++)el.classList.add(classes[i]);else if(!L.DomUtil.hasClass(el,name)){var className=L.DomUtil._getClass(el);L.DomUtil._setClass(el,(className?className+" ":"")+name)}},removeClass:function(el,name){el.classList!==undefined?el.classList.remove(name):L.DomUtil._setClass(el,L.Util.trim((" "+L.DomUtil._getClass(el)+" ").replace(" "+name+" "," ")))},_setClass:function(el,name){el.className.baseVal===undefined?el.className=name:el.className.baseVal=name},_getClass:function(el){return el.className.baseVal===undefined?el.className:el.className.baseVal},setOpacity:function(el,value){if("opacity"in el.style)el.style.opacity=value;else if("filter"in el.style){var filter=!1,filterName="DXImageTransform.Microsoft.Alpha";try{filter=el.filters.item(filterName)}catch(e){if(1===value)return}value=Math.round(100*value),filter?(filter.Enabled=100!==value,filter.Opacity=value):el.style.filter+=" progid:"+filterName+"(opacity="+value+")"}},testProp:function(props){for(var style=document.documentElement.style,i=0;i<props.length;i++)if(props[i]in style)return props[i];return!1},getTranslateString:function(point){var is3d=L.Browser.webkit3d,open="translate"+(is3d?"3d":"")+"(",close=(is3d?",0":"")+")";return open+point.x+"px,"+point.y+"px"+close},getScaleString:function(scale,origin){var preTranslateStr=L.DomUtil.getTranslateString(origin.add(origin.multiplyBy(-1*scale))),scaleStr=" scale("+scale+") ";return preTranslateStr+scaleStr},setPosition:function(el,point,disable3D){el._leaflet_pos=point,!disable3D&&L.Browser.any3d?el.style[L.DomUtil.TRANSFORM]=L.DomUtil.getTranslateString(point):(el.style.left=point.x+"px",el.style.top=point.y+"px")},getPosition:function(el){return el._leaflet_pos}},L.DomUtil.TRANSFORM=L.DomUtil.testProp(["transform","WebkitTransform","OTransform","MozTransform","msTransform"]),L.DomUtil.TRANSITION=L.DomUtil.testProp(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),L.DomUtil.TRANSITION_END="webkitTransition"===L.DomUtil.TRANSITION||"OTransition"===L.DomUtil.TRANSITION?L.DomUtil.TRANSITION+"End":"transitionend",function(){if("onselectstart"in document)L.extend(L.DomUtil,{disableTextSelection:function(){L.DomEvent.on(window,"selectstart",L.DomEvent.preventDefault)},enableTextSelection:function(){L.DomEvent.off(window,"selectstart",L.DomEvent.preventDefault)}});else{var userSelectProperty=L.DomUtil.testProp(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);L.extend(L.DomUtil,{disableTextSelection:function(){if(userSelectProperty){var style=document.documentElement.style;this._userSelect=style[userSelectProperty],style[userSelectProperty]="none"}},enableTextSelection:function(){userSelectProperty&&(document.documentElement.style[userSelectProperty]=this._userSelect,delete this._userSelect)}})}L.extend(L.DomUtil,{disableImageDrag:function(){L.DomEvent.on(window,"dragstart",L.DomEvent.preventDefault)},enableImageDrag:function(){L.DomEvent.off(window,"dragstart",L.DomEvent.preventDefault)}})}(),L.LatLng=function(lat,lng,alt){if(lat=parseFloat(lat),lng=parseFloat(lng),isNaN(lat)||isNaN(lng))throw new Error("Invalid LatLng object: ("+lat+", "+lng+")");this.lat=lat,this.lng=lng,alt!==undefined&&(this.alt=parseFloat(alt))},L.extend(L.LatLng,{DEG_TO_RAD:Math.PI/180,RAD_TO_DEG:180/Math.PI,MAX_MARGIN:1e-9}),L.LatLng.prototype={equals:function(obj){if(!obj)return!1;obj=L.latLng(obj);var margin=Math.max(Math.abs(this.lat-obj.lat),Math.abs(this.lng-obj.lng));return margin<=L.LatLng.MAX_MARGIN},toString:function(precision){return"LatLng("+L.Util.formatNum(this.lat,precision)+", "+L.Util.formatNum(this.lng,precision)+")"},distanceTo:function(other){other=L.latLng(other);var R=6378137,d2r=L.LatLng.DEG_TO_RAD,dLat=(other.lat-this.lat)*d2r,dLon=(other.lng-this.lng)*d2r,lat1=this.lat*d2r,lat2=other.lat*d2r,sin1=Math.sin(dLat/2),sin2=Math.sin(dLon/2),a=sin1*sin1+sin2*sin2*Math.cos(lat1)*Math.cos(lat2);return 2*R*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))},wrap:function(a,b){var lng=this.lng;return a=a||-180,b=b||180,lng=(lng+b)%(b-a)+(a>lng||lng===b?b:a),new L.LatLng(this.lat,lng)}},L.latLng=function(a,b){return a instanceof L.LatLng?a:L.Util.isArray(a)?"number"==typeof a[0]||"string"==typeof a[0]?new L.LatLng(a[0],a[1],a[2]):null:a===undefined||null===a?a:"object"==typeof a&&"lat"in a?new L.LatLng(a.lat,"lng"in a?a.lng:a.lon):b===undefined?null:new L.LatLng(a,b)},L.LatLngBounds=function(southWest,northEast){if(southWest)for(var latlngs=northEast?[southWest,northEast]:southWest,i=0,len=latlngs.length;len>i;i++)this.extend(latlngs[i])},L.LatLngBounds.prototype={extend:function(obj){if(!obj)return this;var latLng=L.latLng(obj);return obj=null!==latLng?latLng:L.latLngBounds(obj),obj instanceof L.LatLng?this._southWest||this._northEast?(this._southWest.lat=Math.min(obj.lat,this._southWest.lat),this._southWest.lng=Math.min(obj.lng,this._southWest.lng),this._northEast.lat=Math.max(obj.lat,this._northEast.lat),this._northEast.lng=Math.max(obj.lng,this._northEast.lng)):(this._southWest=new L.LatLng(obj.lat,obj.lng),this._northEast=new L.LatLng(obj.lat,obj.lng)):obj instanceof L.LatLngBounds&&(this.extend(obj._southWest),this.extend(obj._northEast)),this},pad:function(bufferRatio){var sw=this._southWest,ne=this._northEast,heightBuffer=Math.abs(sw.lat-ne.lat)*bufferRatio,widthBuffer=Math.abs(sw.lng-ne.lng)*bufferRatio;return new L.LatLngBounds(new L.LatLng(sw.lat-heightBuffer,sw.lng-widthBuffer),new L.LatLng(ne.lat+heightBuffer,ne.lng+widthBuffer))},getCenter:function(){return new L.LatLng((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new L.LatLng(this.getNorth(),this.getWest())},getSouthEast:function(){return new L.LatLng(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(obj){obj="number"==typeof obj[0]||obj instanceof L.LatLng?L.latLng(obj):L.latLngBounds(obj);var sw2,ne2,sw=this._southWest,ne=this._northEast;return obj instanceof L.LatLngBounds?(sw2=obj.getSouthWest(),ne2=obj.getNorthEast()):sw2=ne2=obj,sw2.lat>=sw.lat&&ne2.lat<=ne.lat&&sw2.lng>=sw.lng&&ne2.lng<=ne.lng;
},intersects:function(bounds){bounds=L.latLngBounds(bounds);var sw=this._southWest,ne=this._northEast,sw2=bounds.getSouthWest(),ne2=bounds.getNorthEast(),latIntersects=ne2.lat>=sw.lat&&sw2.lat<=ne.lat,lngIntersects=ne2.lng>=sw.lng&&sw2.lng<=ne.lng;return latIntersects&&lngIntersects},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(bounds){return bounds?(bounds=L.latLngBounds(bounds),this._southWest.equals(bounds.getSouthWest())&&this._northEast.equals(bounds.getNorthEast())):!1},isValid:function(){return!(!this._southWest||!this._northEast)}},L.latLngBounds=function(a,b){return!a||a instanceof L.LatLngBounds?a:new L.LatLngBounds(a,b)},L.Projection={},L.Projection.SphericalMercator={MAX_LATITUDE:85.0511287798,project:function(latlng){var d=L.LatLng.DEG_TO_RAD,max=this.MAX_LATITUDE,lat=Math.max(Math.min(max,latlng.lat),-max),x=latlng.lng*d,y=lat*d;return y=Math.log(Math.tan(Math.PI/4+y/2)),new L.Point(x,y)},unproject:function(point){var d=L.LatLng.RAD_TO_DEG,lng=point.x*d,lat=(2*Math.atan(Math.exp(point.y))-Math.PI/2)*d;return new L.LatLng(lat,lng)}},L.Projection.LonLat={project:function(latlng){return new L.Point(latlng.lng,latlng.lat)},unproject:function(point){return new L.LatLng(point.y,point.x)}},L.CRS={latLngToPoint:function(latlng,zoom){var projectedPoint=this.projection.project(latlng),scale=this.scale(zoom);return this.transformation._transform(projectedPoint,scale)},pointToLatLng:function(point,zoom){var scale=this.scale(zoom),untransformedPoint=this.transformation.untransform(point,scale);return this.projection.unproject(untransformedPoint)},project:function(latlng){return this.projection.project(latlng)},scale:function(zoom){return 256*Math.pow(2,zoom)},getSize:function(zoom){var s=this.scale(zoom);return L.point(s,s)}},L.CRS.Simple=L.extend({},L.CRS,{projection:L.Projection.LonLat,transformation:new L.Transformation(1,0,-1,0),scale:function(zoom){return Math.pow(2,zoom)}}),L.CRS.EPSG3857=L.extend({},L.CRS,{code:"EPSG:3857",projection:L.Projection.SphericalMercator,transformation:new L.Transformation(.5/Math.PI,.5,-.5/Math.PI,.5),project:function(latlng){var projectedPoint=this.projection.project(latlng),earthRadius=6378137;return projectedPoint.multiplyBy(earthRadius)}}),L.CRS.EPSG900913=L.extend({},L.CRS.EPSG3857,{code:"EPSG:900913"}),L.CRS.EPSG4326=L.extend({},L.CRS,{code:"EPSG:4326",projection:L.Projection.LonLat,transformation:new L.Transformation(1/360,.5,-1/360,.5)}),L.Map=L.Class.extend({includes:L.Mixin.Events,options:{crs:L.CRS.EPSG3857,fadeAnimation:L.DomUtil.TRANSITION&&!L.Browser.android23,trackResize:!0,markerZoomAnimation:L.DomUtil.TRANSITION&&L.Browser.any3d},initialize:function(id,options){options=L.setOptions(this,options),this._initContainer(id),this._initLayout(),this._onResize=L.bind(this._onResize,this),this._initEvents(),options.maxBounds&&this.setMaxBounds(options.maxBounds),options.center&&options.zoom!==undefined&&this.setView(L.latLng(options.center),options.zoom,{reset:!0}),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._tileLayersNum=0,this.callInitHooks(),this._addLayers(options.layers)},setView:function(center,zoom){return zoom=zoom===undefined?this.getZoom():zoom,this._resetView(L.latLng(center),this._limitZoom(zoom)),this},setZoom:function(zoom,options){return this._loaded?this.setView(this.getCenter(),zoom,{zoom:options}):(this._zoom=this._limitZoom(zoom),this)},zoomIn:function(delta,options){return this.setZoom(this._zoom+(delta||1),options)},zoomOut:function(delta,options){return this.setZoom(this._zoom-(delta||1),options)},setZoomAround:function(latlng,zoom,options){var scale=this.getZoomScale(zoom),viewHalf=this.getSize().divideBy(2),containerPoint=latlng instanceof L.Point?latlng:this.latLngToContainerPoint(latlng),centerOffset=containerPoint.subtract(viewHalf).multiplyBy(1-1/scale),newCenter=this.containerPointToLatLng(viewHalf.add(centerOffset));return this.setView(newCenter,zoom,{zoom:options})},fitBounds:function(bounds,options){options=options||{},bounds=bounds.getBounds?bounds.getBounds():L.latLngBounds(bounds);var paddingTL=L.point(options.paddingTopLeft||options.padding||[0,0]),paddingBR=L.point(options.paddingBottomRight||options.padding||[0,0]),zoom=this.getBoundsZoom(bounds,!1,paddingTL.add(paddingBR));zoom=options.maxZoom?Math.min(options.maxZoom,zoom):zoom;var paddingOffset=paddingBR.subtract(paddingTL).divideBy(2),swPoint=this.project(bounds.getSouthWest(),zoom),nePoint=this.project(bounds.getNorthEast(),zoom),center=this.unproject(swPoint.add(nePoint).divideBy(2).add(paddingOffset),zoom);return this.setView(center,zoom,options)},fitWorld:function(options){return this.fitBounds([[-90,-180],[90,180]],options)},panTo:function(center,options){return this.setView(center,this._zoom,{pan:options})},panBy:function(offset){return this.fire("movestart"),this._rawPanBy(L.point(offset)),this.fire("move"),this.fire("moveend")},setMaxBounds:function(bounds){return bounds=L.latLngBounds(bounds),this.options.maxBounds=bounds,bounds?(this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds,this)):this.off("moveend",this._panInsideMaxBounds,this)},panInsideBounds:function(bounds,options){var center=this.getCenter(),newCenter=this._limitCenter(center,this._zoom,bounds);return center.equals(newCenter)?this:this.panTo(newCenter,options)},addLayer:function(layer){var id=L.stamp(layer);return this._layers[id]?this:(this._layers[id]=layer,!layer.options||isNaN(layer.options.maxZoom)&&isNaN(layer.options.minZoom)||(this._zoomBoundLayers[id]=layer,this._updateZoomLevels()),this.options.zoomAnimation&&L.TileLayer&&layer instanceof L.TileLayer&&(this._tileLayersNum++,this._tileLayersToLoad++,layer.on("load",this._onTileLayerLoad,this)),this._loaded&&this._layerAdd(layer),this)},removeLayer:function(layer){var id=L.stamp(layer);return this._layers[id]?(this._loaded&&layer.onRemove(this),delete this._layers[id],this._loaded&&this.fire("layerremove",{layer:layer}),this._zoomBoundLayers[id]&&(delete this._zoomBoundLayers[id],this._updateZoomLevels()),this.options.zoomAnimation&&L.TileLayer&&layer instanceof L.TileLayer&&(this._tileLayersNum--,this._tileLayersToLoad--,layer.off("load",this._onTileLayerLoad,this)),this):this},hasLayer:function(layer){return layer?L.stamp(layer)in this._layers:!1},eachLayer:function(method,context){for(var i in this._layers)method.call(context,this._layers[i]);return this},invalidateSize:function(options){if(!this._loaded)return this;options=L.extend({animate:!1,pan:!0},options===!0?{animate:!0}:options);var oldSize=this.getSize();this._sizeChanged=!0,this._initialCenter=null;var newSize=this.getSize(),oldCenter=oldSize.divideBy(2).round(),newCenter=newSize.divideBy(2).round(),offset=oldCenter.subtract(newCenter);return offset.x||offset.y?(options.animate&&options.pan?this.panBy(offset):(options.pan&&this._rawPanBy(offset),this.fire("move"),options.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(L.bind(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:oldSize,newSize:newSize})):this},addHandler:function(name,HandlerClass){if(!HandlerClass)return this;var handler=this[name]=new HandlerClass(this);return this._handlers.push(handler),this.options[name]&&handler.enable(),this},remove:function(){this._loaded&&this.fire("unload"),this._initEvents("off");try{delete this._container._leaflet}catch(e){this._container._leaflet=undefined}return this._clearPanes(),this._clearControlPos&&this._clearControlPos(),this._clearHandlers(),this},getCenter:function(){return this._checkIfLoaded(),this._initialCenter&&!this._moved()?this._initialCenter:this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var bounds=this.getPixelBounds(),sw=this.unproject(bounds.getBottomLeft()),ne=this.unproject(bounds.getTopRight());return new L.LatLngBounds(sw,ne)},getMinZoom:function(){return this.options.minZoom===undefined?this._layersMinZoom===undefined?0:this._layersMinZoom:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===undefined?this._layersMaxZoom===undefined?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(bounds,inside,padding){bounds=L.latLngBounds(bounds);var boundsSize,zoom=this.getMinZoom()-(inside?1:0),maxZoom=this.getMaxZoom(),size=this.getSize(),nw=bounds.getNorthWest(),se=bounds.getSouthEast(),zoomNotFound=!0;padding=L.point(padding||[0,0]);do zoom++,boundsSize=this.project(se,zoom).subtract(this.project(nw,zoom)).add(padding),zoomNotFound=inside?boundsSize.x<size.x||boundsSize.y<size.y:size.contains(boundsSize);while(zoomNotFound&&maxZoom>=zoom);return zoomNotFound&&inside?null:inside?zoom:zoom-1},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new L.Point(this._container.clientWidth,this._container.clientHeight),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(){var topLeftPoint=this._getTopLeftPoint();return new L.Bounds(topLeftPoint,topLeftPoint.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._initialTopLeftPoint},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(toZoom){var crs=this.options.crs;return crs.scale(toZoom)/crs.scale(this._zoom)},getScaleZoom:function(scale){return this._zoom+Math.log(scale)/Math.LN2},project:function(latlng,zoom){return zoom=zoom===undefined?this._zoom:zoom,this.options.crs.latLngToPoint(L.latLng(latlng),zoom)},unproject:function(point,zoom){return zoom=zoom===undefined?this._zoom:zoom,this.options.crs.pointToLatLng(L.point(point),zoom)},layerPointToLatLng:function(point){var projectedPoint=L.point(point).add(this.getPixelOrigin());return this.unproject(projectedPoint)},latLngToLayerPoint:function(latlng){var projectedPoint=this.project(L.latLng(latlng))._round();return projectedPoint._subtract(this.getPixelOrigin())},containerPointToLayerPoint:function(point){return L.point(point).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(point){return L.point(point).add(this._getMapPanePos())},containerPointToLatLng:function(point){var layerPoint=this.containerPointToLayerPoint(L.point(point));return this.layerPointToLatLng(layerPoint)},latLngToContainerPoint:function(latlng){return this.layerPointToContainerPoint(this.latLngToLayerPoint(L.latLng(latlng)))},mouseEventToContainerPoint:function(e){return L.DomEvent.getMousePosition(e,this._container)},mouseEventToLayerPoint:function(e){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(e))},mouseEventToLatLng:function(e){return this.layerPointToLatLng(this.mouseEventToLayerPoint(e))},_initContainer:function(id){var container=this._container=L.DomUtil.get(id);if(!container)throw new Error("Map container not found.");if(container._leaflet)throw new Error("Map container is already initialized.");container._leaflet=!0},_initLayout:function(){var container=this._container;L.DomUtil.addClass(container,"leaflet-container"+(L.Browser.touch?" leaflet-touch":"")+(L.Browser.retina?" leaflet-retina":"")+(L.Browser.ielt9?" leaflet-oldie":"")+(this.options.fadeAnimation?" leaflet-fade-anim":""));var position=L.DomUtil.getStyle(container,"position");"absolute"!==position&&"relative"!==position&&"fixed"!==position&&(container.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var panes=this._panes={};this._mapPane=panes.mapPane=this._createPane("leaflet-map-pane",this._container),this._tilePane=panes.tilePane=this._createPane("leaflet-tile-pane",this._mapPane),panes.objectsPane=this._createPane("leaflet-objects-pane",this._mapPane),panes.shadowPane=this._createPane("leaflet-shadow-pane"),panes.overlayPane=this._createPane("leaflet-overlay-pane"),panes.markerPane=this._createPane("leaflet-marker-pane"),panes.popupPane=this._createPane("leaflet-popup-pane");var zoomHide=" leaflet-zoom-hide";this.options.markerZoomAnimation||(L.DomUtil.addClass(panes.markerPane,zoomHide),L.DomUtil.addClass(panes.shadowPane,zoomHide),L.DomUtil.addClass(panes.popupPane,zoomHide))},_createPane:function(className,container){return L.DomUtil.create("div",className,container||this._panes.objectsPane)},_clearPanes:function(){this._container.removeChild(this._mapPane)},_addLayers:function(layers){layers=layers?L.Util.isArray(layers)?layers:[layers]:[];for(var i=0,len=layers.length;len>i;i++)this.addLayer(layers[i])},_resetView:function(center,zoom,preserveMapOffset,afterZoomAnim){var zoomChanged=this._zoom!==zoom;afterZoomAnim||(this.fire("movestart"),zoomChanged&&this.fire("zoomstart")),this._zoom=zoom,this._initialCenter=center,this._initialTopLeftPoint=this._getNewTopLeftPoint(center),preserveMapOffset?this._initialTopLeftPoint._add(this._getMapPanePos()):L.DomUtil.setPosition(this._mapPane,new L.Point(0,0)),this._tileLayersToLoad=this._tileLayersNum;var loading=!this._loaded;this._loaded=!0,this.fire("viewreset",{hard:!preserveMapOffset}),loading&&(this.fire("load"),this.eachLayer(this._layerAdd,this)),this.fire("move"),(zoomChanged||afterZoomAnim)&&this.fire("zoomend"),this.fire("moveend",{hard:!preserveMapOffset})},_rawPanBy:function(offset){L.DomUtil.setPosition(this._mapPane,this._getMapPanePos().subtract(offset))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_updateZoomLevels:function(){var i,minZoom=1/0,maxZoom=-(1/0),oldZoomSpan=this._getZoomSpan();for(i in this._zoomBoundLayers){var layer=this._zoomBoundLayers[i];isNaN(layer.options.minZoom)||(minZoom=Math.min(minZoom,layer.options.minZoom)),isNaN(layer.options.maxZoom)||(maxZoom=Math.max(maxZoom,layer.options.maxZoom))}i===undefined?this._layersMaxZoom=this._layersMinZoom=undefined:(this._layersMaxZoom=maxZoom,this._layersMinZoom=minZoom),oldZoomSpan!==this._getZoomSpan()&&this.fire("zoomlevelschange")},_panInsideMaxBounds:function(){this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(onOff){if(L.DomEvent){onOff=onOff||"on",L.DomEvent[onOff](this._container,"click",this._onMouseClick,this);var i,len,events=["dblclick","mousedown","mouseup","mouseenter","mouseleave","mousemove","contextmenu"];for(i=0,len=events.length;len>i;i++)L.DomEvent[onOff](this._container,events[i],this._fireMouseEvent,this);this.options.trackResize&&L.DomEvent[onOff](window,"resize",this._onResize,this)}},_onResize:function(){L.Util.cancelAnimFrame(this._resizeRequest),this._resizeRequest=L.Util.requestAnimFrame(function(){this.invalidateSize({debounceMoveend:!0})},this,!1,this._container)},_onMouseClick:function(e){!this._loaded||!e._simulated&&(this.dragging&&this.dragging.moved()||this.boxZoom&&this.boxZoom.moved())||L.DomEvent._skipped(e)||(this.fire("preclick"),this._fireMouseEvent(e))},_fireMouseEvent:function(e){if(this._loaded&&!L.DomEvent._skipped(e)){var type=e.type;if(type="mouseenter"===type?"mouseover":"mouseleave"===type?"mouseout":type,this.hasEventListeners(type)){"contextmenu"===type&&L.DomEvent.preventDefault(e);var containerPoint=this.mouseEventToContainerPoint(e),layerPoint=this.containerPointToLayerPoint(containerPoint),latlng=this.layerPointToLatLng(layerPoint);this.fire(type,{latlng:latlng,layerPoint:layerPoint,containerPoint:containerPoint,originalEvent:e})}}},_onTileLayerLoad:function(){this._tileLayersToLoad--,this._tileLayersNum&&!this._tileLayersToLoad&&this.fire("tilelayersload")},_clearHandlers:function(){for(var i=0,len=this._handlers.length;len>i;i++)this._handlers[i].disable()},whenReady:function(callback,context){return this._loaded?callback.call(context||this,this):this.on("load",callback,context),this},_layerAdd:function(layer){layer.onAdd(this),this.fire("layeradd",{layer:layer})},_getMapPanePos:function(){return L.DomUtil.getPosition(this._mapPane)},_moved:function(){var pos=this._getMapPanePos();return pos&&!pos.equals([0,0])},_getTopLeftPoint:function(){return this.getPixelOrigin().subtract(this._getMapPanePos())},_getNewTopLeftPoint:function(center,zoom){var viewHalf=this.getSize()._divideBy(2);return this.project(center,zoom)._subtract(viewHalf)._round()},_latLngToNewLayerPoint:function(latlng,newZoom,newCenter){var topLeft=this._getNewTopLeftPoint(newCenter,newZoom).add(this._getMapPanePos());return this.project(latlng,newZoom)._subtract(topLeft)},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(latlng){return this.latLngToLayerPoint(latlng).subtract(this._getCenterLayerPoint())},_limitCenter:function(center,zoom,bounds){if(!bounds)return center;var centerPoint=this.project(center,zoom),viewHalf=this.getSize().divideBy(2),viewBounds=new L.Bounds(centerPoint.subtract(viewHalf),centerPoint.add(viewHalf)),offset=this._getBoundsOffset(viewBounds,bounds,zoom);return this.unproject(centerPoint.add(offset),zoom)},_limitOffset:function(offset,bounds){if(!bounds)return offset;var viewBounds=this.getPixelBounds(),newBounds=new L.Bounds(viewBounds.min.add(offset),viewBounds.max.add(offset));return offset.add(this._getBoundsOffset(newBounds,bounds))},_getBoundsOffset:function(pxBounds,maxBounds,zoom){var nwOffset=this.project(maxBounds.getNorthWest(),zoom).subtract(pxBounds.min),seOffset=this.project(maxBounds.getSouthEast(),zoom).subtract(pxBounds.max),dx=this._rebound(nwOffset.x,-seOffset.x),dy=this._rebound(nwOffset.y,-seOffset.y);return new L.Point(dx,dy)},_rebound:function(left,right){return left+right>0?Math.round(left-right)/2:Math.max(0,Math.ceil(left))-Math.max(0,Math.floor(right))},_limitZoom:function(zoom){var min=this.getMinZoom(),max=this.getMaxZoom();return Math.max(min,Math.min(max,zoom))}}),L.map=function(id,options){return new L.Map(id,options)},L.Projection.Mercator={MAX_LATITUDE:85.0840591556,R_MINOR:6356752.314245179,R_MAJOR:6378137,project:function(latlng){var d=L.LatLng.DEG_TO_RAD,max=this.MAX_LATITUDE,lat=Math.max(Math.min(max,latlng.lat),-max),r=this.R_MAJOR,r2=this.R_MINOR,x=latlng.lng*d*r,y=lat*d,tmp=r2/r,eccent=Math.sqrt(1-tmp*tmp),con=eccent*Math.sin(y);con=Math.pow((1-con)/(1+con),.5*eccent);var ts=Math.tan(.5*(.5*Math.PI-y))/con;return y=-r*Math.log(ts),new L.Point(x,y)},unproject:function(point){for(var con,d=L.LatLng.RAD_TO_DEG,r=this.R_MAJOR,r2=this.R_MINOR,lng=point.x*d/r,tmp=r2/r,eccent=Math.sqrt(1-tmp*tmp),ts=Math.exp(-point.y/r),phi=Math.PI/2-2*Math.atan(ts),numIter=15,tol=1e-7,i=numIter,dphi=.1;Math.abs(dphi)>tol&&--i>0;)con=eccent*Math.sin(phi),dphi=Math.PI/2-2*Math.atan(ts*Math.pow((1-con)/(1+con),.5*eccent))-phi,phi+=dphi;return new L.LatLng(phi*d,lng)}},L.CRS.EPSG3395=L.extend({},L.CRS,{code:"EPSG:3395",projection:L.Projection.Mercator,transformation:function(){var m=L.Projection.Mercator,r=m.R_MAJOR,scale=.5/(Math.PI*r);return new L.Transformation(scale,.5,-scale,.5)}()}),L.TileLayer=L.Class.extend({includes:L.Mixin.Events,options:{minZoom:0,maxZoom:18,tileSize:256,subdomains:"abc",errorTileUrl:"",attribution:"",zoomOffset:0,opacity:1,unloadInvisibleTiles:L.Browser.mobile,updateWhenIdle:L.Browser.mobile},initialize:function(url,options){options=L.setOptions(this,options),options.detectRetina&&L.Browser.retina&&options.maxZoom>0&&(options.tileSize=Math.floor(options.tileSize/2),options.zoomOffset++,options.minZoom>0&&options.minZoom--,this.options.maxZoom--),options.bounds&&(options.bounds=L.latLngBounds(options.bounds)),this._url=url;var subdomains=this.options.subdomains;"string"==typeof subdomains&&(this.options.subdomains=subdomains.split(""))},onAdd:function(map){this._map=map,this._animated=map._zoomAnimated,this._initContainer(),map.on({viewreset:this._reset,moveend:this._update},this),this._animated&&map.on({zoomanim:this._animateZoom,zoomend:this._endZoomAnim},this),this.options.updateWhenIdle||(this._limitedUpdate=L.Util.limitExecByInterval(this._update,150,this),map.on("move",this._limitedUpdate,this)),this._reset(),this._update()},addTo:function(map){return map.addLayer(this),this},onRemove:function(map){this._container.parentNode.removeChild(this._container),map.off({viewreset:this._reset,moveend:this._update},this),this._animated&&map.off({zoomanim:this._animateZoom,zoomend:this._endZoomAnim},this),this.options.updateWhenIdle||map.off("move",this._limitedUpdate,this),this._container=null,this._map=null},bringToFront:function(){var pane=this._map._panes.tilePane;return this._container&&(pane.appendChild(this._container),this._setAutoZIndex(pane,Math.max)),this},bringToBack:function(){var pane=this._map._panes.tilePane;return this._container&&(pane.insertBefore(this._container,pane.firstChild),this._setAutoZIndex(pane,Math.min)),this},getAttribution:function(){return this.options.attribution},getContainer:function(){return this._container},setOpacity:function(opacity){return this.options.opacity=opacity,this._map&&this._updateOpacity(),this},setZIndex:function(zIndex){return this.options.zIndex=zIndex,this._updateZIndex(),this},setUrl:function(url,noRedraw){return this._url=url,noRedraw||this.redraw(),this},redraw:function(){return this._map&&(this._reset({hard:!0}),this._update()),this},_updateZIndex:function(){this._container&&this.options.zIndex!==undefined&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(pane,compare){var zIndex,i,len,layers=pane.children,edgeZIndex=-compare(1/0,-(1/0));for(i=0,len=layers.length;len>i;i++)layers[i]!==this._container&&(zIndex=parseInt(layers[i].style.zIndex,10),isNaN(zIndex)||(edgeZIndex=compare(edgeZIndex,zIndex)));this.options.zIndex=this._container.style.zIndex=(isFinite(edgeZIndex)?edgeZIndex:0)+compare(1,-1)},_updateOpacity:function(){var i,tiles=this._tiles;if(L.Browser.ielt9)for(i in tiles)L.DomUtil.setOpacity(tiles[i],this.options.opacity);else L.DomUtil.setOpacity(this._container,this.options.opacity)},_initContainer:function(){var tilePane=this._map._panes.tilePane;if(!this._container){if(this._container=L.DomUtil.create("div","leaflet-layer"),this._updateZIndex(),this._animated){var className="leaflet-tile-container";this._bgBuffer=L.DomUtil.create("div",className,this._container),this._tileContainer=L.DomUtil.create("div",className,this._container)}else this._tileContainer=this._container;tilePane.appendChild(this._container),this.options.opacity<1&&this._updateOpacity()}},_reset:function(e){for(var key in this._tiles)this.fire("tileunload",{tile:this._tiles[key]});this._tiles={},this._tilesToLoad=0,this.options.reuseTiles&&(this._unusedTiles=[]),this._tileContainer.innerHTML="",this._animated&&e&&e.hard&&this._clearBgBuffer(),this._initContainer()},_getTileSize:function(){var map=this._map,zoom=map.getZoom()+this.options.zoomOffset,zoomN=this.options.maxNativeZoom,tileSize=this.options.tileSize;return zoomN&&zoom>zoomN&&(tileSize=Math.round(map.getZoomScale(zoom)/map.getZoomScale(zoomN)*tileSize)),tileSize},_update:function(){if(this._map){var map=this._map,bounds=map.getPixelBounds(),zoom=map.getZoom(),tileSize=this._getTileSize();if(!(zoom>this.options.maxZoom||zoom<this.options.minZoom)){var tileBounds=L.bounds(bounds.min.divideBy(tileSize)._floor(),bounds.max.divideBy(tileSize)._floor());this._addTilesFromCenterOut(tileBounds),(this.options.unloadInvisibleTiles||this.options.reuseTiles)&&this._removeOtherTiles(tileBounds)}}},_addTilesFromCenterOut:function(bounds){var j,i,point,queue=[],center=bounds.getCenter();for(j=bounds.min.y;j<=bounds.max.y;j++)for(i=bounds.min.x;i<=bounds.max.x;i++)point=new L.Point(i,j),this._tileShouldBeLoaded(point)&&queue.push(point);var tilesToLoad=queue.length;if(0!==tilesToLoad){queue.sort(function(a,b){return a.distanceTo(center)-b.distanceTo(center)});var fragment=document.createDocumentFragment();for(this._tilesToLoad||this.fire("loading"),this._tilesToLoad+=tilesToLoad,i=0;tilesToLoad>i;i++)this._addTile(queue[i],fragment);this._tileContainer.appendChild(fragment)}},_tileShouldBeLoaded:function(tilePoint){if(tilePoint.x+":"+tilePoint.y in this._tiles)return!1;var options=this.options;if(!options.continuousWorld){var limit=this._getWrapTileNum();if(options.noWrap&&(tilePoint.x<0||tilePoint.x>=limit.x)||tilePoint.y<0||tilePoint.y>=limit.y)return!1}if(options.bounds){var tileSize=this._getTileSize(),nwPoint=tilePoint.multiplyBy(tileSize),sePoint=nwPoint.add([tileSize,tileSize]),nw=this._map.unproject(nwPoint),se=this._map.unproject(sePoint);if(options.continuousWorld||options.noWrap||(nw=nw.wrap(),se=se.wrap()),!options.bounds.intersects([nw,se]))return!1}return!0},_removeOtherTiles:function(bounds){var kArr,x,y,key;for(key in this._tiles)kArr=key.split(":"),x=parseInt(kArr[0],10),y=parseInt(kArr[1],10),(x<bounds.min.x||x>bounds.max.x||y<bounds.min.y||y>bounds.max.y)&&this._removeTile(key)},_removeTile:function(key){var tile=this._tiles[key];this.fire("tileunload",{tile:tile,url:tile.src}),this.options.reuseTiles?(L.DomUtil.removeClass(tile,"leaflet-tile-loaded"),this._unusedTiles.push(tile)):tile.parentNode===this._tileContainer&&this._tileContainer.removeChild(tile),L.Browser.android||(tile.onload=null,tile.src=L.Util.emptyImageUrl),delete this._tiles[key]},_addTile:function(tilePoint,container){var tilePos=this._getTilePos(tilePoint),tile=this._getTile();L.DomUtil.setPosition(tile,tilePos,L.Browser.chrome),this._tiles[tilePoint.x+":"+tilePoint.y]=tile,this._loadTile(tile,tilePoint),tile.parentNode!==this._tileContainer&&container.appendChild(tile)},_getZoomForUrl:function(){var options=this.options,zoom=this._map.getZoom();return options.zoomReverse&&(zoom=options.maxZoom-zoom),zoom+=options.zoomOffset,options.maxNativeZoom?Math.min(zoom,options.maxNativeZoom):zoom},_getTilePos:function(tilePoint){var origin=this._map.getPixelOrigin(),tileSize=this._getTileSize();return tilePoint.multiplyBy(tileSize).subtract(origin)},getTileUrl:function(tilePoint){return L.Util.template(this._url,L.extend({s:this._getSubdomain(tilePoint),z:tilePoint.z,x:tilePoint.x,y:tilePoint.y},this.options))},_getWrapTileNum:function(){var crs=this._map.options.crs,size=crs.getSize(this._map.getZoom());return size.divideBy(this._getTileSize())._floor()},_adjustTilePoint:function(tilePoint){var limit=this._getWrapTileNum();this.options.continuousWorld||this.options.noWrap||(tilePoint.x=(tilePoint.x%limit.x+limit.x)%limit.x),this.options.tms&&(tilePoint.y=limit.y-tilePoint.y-1),tilePoint.z=this._getZoomForUrl()},_getSubdomain:function(tilePoint){var index=Math.abs(tilePoint.x+tilePoint.y)%this.options.subdomains.length;return this.options.subdomains[index]},_getTile:function(){if(this.options.reuseTiles&&this._unusedTiles.length>0){var tile=this._unusedTiles.pop();return this._resetTile(tile),tile}return this._createTile()},_resetTile:function(){},_createTile:function(){var tile=L.DomUtil.create("img","leaflet-tile");return tile.style.width=tile.style.height=this._getTileSize()+"px",tile.galleryimg="no",tile.onselectstart=tile.onmousemove=L.Util.falseFn,L.Browser.ielt9&&this.options.opacity!==undefined&&L.DomUtil.setOpacity(tile,this.options.opacity),L.Browser.mobileWebkit3d&&(tile.style.WebkitBackfaceVisibility="hidden"),tile},_loadTile:function(tile,tilePoint){tile._layer=this,tile.onload=this._tileOnLoad,tile.onerror=this._tileOnError,this._adjustTilePoint(tilePoint),tile.src=this.getTileUrl(tilePoint),this.fire("tileloadstart",{tile:tile,url:tile.src})},_tileLoaded:function(){this._tilesToLoad--,this._animated&&L.DomUtil.addClass(this._tileContainer,"leaflet-zoom-animated"),this._tilesToLoad||(this.fire("load"),this._animated&&(clearTimeout(this._clearBgBufferTimer),this._clearBgBufferTimer=setTimeout(L.bind(this._clearBgBuffer,this),500)))},_tileOnLoad:function(){var layer=this._layer;this.src!==L.Util.emptyImageUrl&&(L.DomUtil.addClass(this,"leaflet-tile-loaded"),layer.fire("tileload",{tile:this,url:this.src})),layer._tileLoaded()},_tileOnError:function(){var layer=this._layer;layer.fire("tileerror",{tile:this,url:this.src});var newUrl=layer.options.errorTileUrl;newUrl&&(this.src=newUrl),layer._tileLoaded()}}),L.tileLayer=function(url,options){return new L.TileLayer(url,options)},L.TileLayer.WMS=L.TileLayer.extend({defaultWmsParams:{service:"WMS",request:"GetMap",version:"1.1.1",layers:"",styles:"",format:"image/jpeg",transparent:!1},initialize:function(url,options){this._url=url;var wmsParams=L.extend({},this.defaultWmsParams),tileSize=options.tileSize||this.options.tileSize;options.detectRetina&&L.Browser.retina?wmsParams.width=wmsParams.height=2*tileSize:wmsParams.width=wmsParams.height=tileSize;for(var i in options)this.options.hasOwnProperty(i)||"crs"===i||(wmsParams[i]=options[i]);this.wmsParams=wmsParams,L.setOptions(this,options)},onAdd:function(map){this._crs=this.options.crs||map.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var projectionKey=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[projectionKey]=this._crs.code,L.TileLayer.prototype.onAdd.call(this,map)},getTileUrl:function(tilePoint){var map=this._map,tileSize=this.options.tileSize,nwPoint=tilePoint.multiplyBy(tileSize),sePoint=nwPoint.add([tileSize,tileSize]),nw=this._crs.project(map.unproject(nwPoint,tilePoint.z)),se=this._crs.project(map.unproject(sePoint,tilePoint.z)),bbox=this._wmsVersion>=1.3&&this._crs===L.CRS.EPSG4326?[se.y,nw.x,nw.y,se.x].join(","):[nw.x,se.y,se.x,nw.y].join(","),url=L.Util.template(this._url,{s:this._getSubdomain(tilePoint)});return url+L.Util.getParamString(this.wmsParams,url,!0)+"&BBOX="+bbox},setParams:function(params,noRedraw){return L.extend(this.wmsParams,params),noRedraw||this.redraw(),this}}),L.tileLayer.wms=function(url,options){return new L.TileLayer.WMS(url,options)},L.TileLayer.Canvas=L.TileLayer.extend({options:{async:!1},initialize:function(options){L.setOptions(this,options)},redraw:function(){this._map&&(this._reset({hard:!0}),this._update());for(var i in this._tiles)this._redrawTile(this._tiles[i]);return this},_redrawTile:function(tile){this.drawTile(tile,tile._tilePoint,this._map._zoom)},_createTile:function(){var tile=L.DomUtil.create("canvas","leaflet-tile");return tile.width=tile.height=this.options.tileSize,tile.onselectstart=tile.onmousemove=L.Util.falseFn,tile},_loadTile:function(tile,tilePoint){tile._layer=this,tile._tilePoint=tilePoint,this._redrawTile(tile),this.options.async||this.tileDrawn(tile)},drawTile:function(){},tileDrawn:function(tile){this._tileOnLoad.call(tile)}}),L.tileLayer.canvas=function(options){return new L.TileLayer.Canvas(options)},L.ImageOverlay=L.Class.extend({includes:L.Mixin.Events,options:{opacity:1},initialize:function(url,bounds,options){this._url=url,this._bounds=L.latLngBounds(bounds),L.setOptions(this,options)},onAdd:function(map){this._map=map,this._image||this._initImage(),map._panes.overlayPane.appendChild(this._image),map.on("viewreset",this._reset,this),map.options.zoomAnimation&&L.Browser.any3d&&map.on("zoomanim",this._animateZoom,this),this._reset()},onRemove:function(map){map.getPanes().overlayPane.removeChild(this._image),map.off("viewreset",this._reset,this),map.options.zoomAnimation&&map.off("zoomanim",this._animateZoom,this)},addTo:function(map){return map.addLayer(this),this},setOpacity:function(opacity){return this.options.opacity=opacity,this._updateOpacity(),this},bringToFront:function(){return this._image&&this._map._panes.overlayPane.appendChild(this._image),this},bringToBack:function(){var pane=this._map._panes.overlayPane;return this._image&&pane.insertBefore(this._image,pane.firstChild),this},setUrl:function(url){this._url=url,this._image.src=this._url},getAttribution:function(){return this.options.attribution},_initImage:function(){this._image=L.DomUtil.create("img","leaflet-image-layer"),this._map.options.zoomAnimation&&L.Browser.any3d?L.DomUtil.addClass(this._image,"leaflet-zoom-animated"):L.DomUtil.addClass(this._image,"leaflet-zoom-hide"),this._updateOpacity(),L.extend(this._image,{galleryimg:"no",onselectstart:L.Util.falseFn,onmousemove:L.Util.falseFn,onload:L.bind(this._onImageLoad,this),
src:this._url})},_animateZoom:function(e){var map=this._map,image=this._image,scale=map.getZoomScale(e.zoom),nw=this._bounds.getNorthWest(),se=this._bounds.getSouthEast(),topLeft=map._latLngToNewLayerPoint(nw,e.zoom,e.center),size=map._latLngToNewLayerPoint(se,e.zoom,e.center)._subtract(topLeft),origin=topLeft._add(size._multiplyBy(.5*(1-1/scale)));image.style[L.DomUtil.TRANSFORM]=L.DomUtil.getTranslateString(origin)+" scale("+scale+") "},_reset:function(){var image=this._image,topLeft=this._map.latLngToLayerPoint(this._bounds.getNorthWest()),size=this._map.latLngToLayerPoint(this._bounds.getSouthEast())._subtract(topLeft);L.DomUtil.setPosition(image,topLeft),image.style.width=size.x+"px",image.style.height=size.y+"px"},_onImageLoad:function(){this.fire("load")},_updateOpacity:function(){L.DomUtil.setOpacity(this._image,this.options.opacity)}}),L.imageOverlay=function(url,bounds,options){return new L.ImageOverlay(url,bounds,options)},L.Icon=L.Class.extend({options:{className:""},initialize:function(options){L.setOptions(this,options)},createIcon:function(oldIcon){return this._createIcon("icon",oldIcon)},createShadow:function(oldIcon){return this._createIcon("shadow",oldIcon)},_createIcon:function(name,oldIcon){var src=this._getIconUrl(name);if(!src){if("icon"===name)throw new Error("iconUrl not set in Icon options (see the docs).");return null}var img;return img=oldIcon&&"IMG"===oldIcon.tagName?this._createImg(src,oldIcon):this._createImg(src),this._setIconStyles(img,name),img},_setIconStyles:function(img,name){var anchor,options=this.options,size=L.point(options[name+"Size"]);anchor="shadow"===name?L.point(options.shadowAnchor||options.iconAnchor):L.point(options.iconAnchor),!anchor&&size&&(anchor=size.divideBy(2,!0)),img.className="leaflet-marker-"+name+" "+options.className,anchor&&(img.style.marginLeft=-anchor.x+"px",img.style.marginTop=-anchor.y+"px"),size&&(img.style.width=size.x+"px",img.style.height=size.y+"px")},_createImg:function(src,el){return el=el||document.createElement("img"),el.src=src,el},_getIconUrl:function(name){return L.Browser.retina&&this.options[name+"RetinaUrl"]?this.options[name+"RetinaUrl"]:this.options[name+"Url"]}}),L.icon=function(options){return new L.Icon(options)},L.Icon.Default=L.Icon.extend({options:{iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]},_getIconUrl:function(name){var key=name+"Url";if(this.options[key])return this.options[key];L.Browser.retina&&"icon"===name&&(name+="-2x");var path=L.Icon.Default.imagePath;if(!path)throw new Error("Couldn't autodetect L.Icon.Default.imagePath, set it manually.");return path+"/marker-"+name+".png"}}),L.Icon.Default.imagePath=function(){var i,len,src,matches,path,scripts=document.getElementsByTagName("script"),leafletRe=/[\/^]leaflet[\-\._]?([\w\-\._]*)\.js\??/;for(i=0,len=scripts.length;len>i;i++)if(src=scripts[i].src,matches=src.match(leafletRe))return path=src.split(leafletRe)[0],(path?path+"/":"")+"images"}(),L.Marker=L.Class.extend({includes:L.Mixin.Events,options:{icon:new L.Icon.Default,title:"",alt:"",clickable:!0,draggable:!1,keyboard:!0,zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250},initialize:function(latlng,options){L.setOptions(this,options),this._latlng=L.latLng(latlng)},onAdd:function(map){this._map=map,map.on("viewreset",this.update,this),this._initIcon(),this.update(),this.fire("add"),map.options.zoomAnimation&&map.options.markerZoomAnimation&&map.on("zoomanim",this._animateZoom,this)},addTo:function(map){return map.addLayer(this),this},onRemove:function(map){this.dragging&&this.dragging.disable(),this._removeIcon(),this._removeShadow(),this.fire("remove"),map.off({viewreset:this.update,zoomanim:this._animateZoom},this),this._map=null},getLatLng:function(){return this._latlng},setLatLng:function(latlng){return this._latlng=L.latLng(latlng),this.update(),this.fire("move",{latlng:this._latlng})},setZIndexOffset:function(offset){return this.options.zIndexOffset=offset,this.update(),this},setIcon:function(icon){return this.options.icon=icon,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup),this},update:function(){return this._icon&&this._setPos(this._map.latLngToLayerPoint(this._latlng).round()),this},_initIcon:function(){var options=this.options,map=this._map,animation=map.options.zoomAnimation&&map.options.markerZoomAnimation,classToAdd=animation?"leaflet-zoom-animated":"leaflet-zoom-hide",icon=options.icon.createIcon(this._icon),addIcon=!1;icon!==this._icon&&(this._icon&&this._removeIcon(),addIcon=!0,options.title&&(icon.title=options.title),options.alt&&(icon.alt=options.alt)),L.DomUtil.addClass(icon,classToAdd),options.keyboard&&(icon.tabIndex="0"),this._icon=icon,this._initInteraction(),options.riseOnHover&&L.DomEvent.on(icon,"mouseover",this._bringToFront,this).on(icon,"mouseout",this._resetZIndex,this);var newShadow=options.icon.createShadow(this._shadow),addShadow=!1;newShadow!==this._shadow&&(this._removeShadow(),addShadow=!0),newShadow&&L.DomUtil.addClass(newShadow,classToAdd),this._shadow=newShadow,options.opacity<1&&this._updateOpacity();var panes=this._map._panes;addIcon&&panes.markerPane.appendChild(this._icon),newShadow&&addShadow&&panes.shadowPane.appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&L.DomEvent.off(this._icon,"mouseover",this._bringToFront).off(this._icon,"mouseout",this._resetZIndex),this._map._panes.markerPane.removeChild(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&this._map._panes.shadowPane.removeChild(this._shadow),this._shadow=null},_setPos:function(pos){L.DomUtil.setPosition(this._icon,pos),this._shadow&&L.DomUtil.setPosition(this._shadow,pos),this._zIndex=pos.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(offset){this._icon.style.zIndex=this._zIndex+offset},_animateZoom:function(opt){var pos=this._map._latLngToNewLayerPoint(this._latlng,opt.zoom,opt.center).round();this._setPos(pos)},_initInteraction:function(){if(this.options.clickable){var icon=this._icon,events=["dblclick","mousedown","mouseover","mouseout","contextmenu"];L.DomUtil.addClass(icon,"leaflet-clickable"),L.DomEvent.on(icon,"click",this._onMouseClick,this),L.DomEvent.on(icon,"keypress",this._onKeyPress,this);for(var i=0;i<events.length;i++)L.DomEvent.on(icon,events[i],this._fireMouseEvent,this);L.Handler.MarkerDrag&&(this.dragging=new L.Handler.MarkerDrag(this),this.options.draggable&&this.dragging.enable())}},_onMouseClick:function(e){var wasDragged=this.dragging&&this.dragging.moved();(this.hasEventListeners(e.type)||wasDragged)&&L.DomEvent.stopPropagation(e),wasDragged||(this.dragging&&this.dragging._enabled||!this._map.dragging||!this._map.dragging.moved())&&this.fire(e.type,{originalEvent:e,latlng:this._latlng})},_onKeyPress:function(e){13===e.keyCode&&this.fire("click",{originalEvent:e,latlng:this._latlng})},_fireMouseEvent:function(e){this.fire(e.type,{originalEvent:e,latlng:this._latlng}),"contextmenu"===e.type&&this.hasEventListeners(e.type)&&L.DomEvent.preventDefault(e),"mousedown"!==e.type?L.DomEvent.stopPropagation(e):L.DomEvent.preventDefault(e)},setOpacity:function(opacity){return this.options.opacity=opacity,this._map&&this._updateOpacity(),this},_updateOpacity:function(){L.DomUtil.setOpacity(this._icon,this.options.opacity),this._shadow&&L.DomUtil.setOpacity(this._shadow,this.options.opacity)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)}}),L.marker=function(latlng,options){return new L.Marker(latlng,options)},L.DivIcon=L.Icon.extend({options:{iconSize:[12,12],className:"leaflet-div-icon",html:!1},createIcon:function(oldIcon){var div=oldIcon&&"DIV"===oldIcon.tagName?oldIcon:document.createElement("div"),options=this.options;return options.html!==!1?div.innerHTML=options.html:div.innerHTML="",options.bgPos&&(div.style.backgroundPosition=-options.bgPos.x+"px "+-options.bgPos.y+"px"),this._setIconStyles(div,"icon"),div},createShadow:function(){return null}}),L.divIcon=function(options){return new L.DivIcon(options)},L.Map.mergeOptions({closePopupOnClick:!0}),L.Popup=L.Class.extend({includes:L.Mixin.Events,options:{minWidth:50,maxWidth:300,autoPan:!0,closeButton:!0,offset:[0,7],autoPanPadding:[5,5],keepInView:!1,className:"",zoomAnimation:!0},initialize:function(options,source){L.setOptions(this,options),this._source=source,this._animated=L.Browser.any3d&&this.options.zoomAnimation,this._isOpen=!1},onAdd:function(map){this._map=map,this._container||this._initLayout();var animFade=map.options.fadeAnimation;animFade&&L.DomUtil.setOpacity(this._container,0),map._panes.popupPane.appendChild(this._container),map.on(this._getEvents(),this),this.update(),animFade&&L.DomUtil.setOpacity(this._container,1),this.fire("open"),map.fire("popupopen",{popup:this}),this._source&&this._source.fire("popupopen",{popup:this})},addTo:function(map){return map.addLayer(this),this},openOn:function(map){return map.openPopup(this),this},onRemove:function(map){map._panes.popupPane.removeChild(this._container),L.Util.falseFn(this._container.offsetWidth),map.off(this._getEvents(),this),map.options.fadeAnimation&&L.DomUtil.setOpacity(this._container,0),this._map=null,this.fire("close"),map.fire("popupclose",{popup:this}),this._source&&this._source.fire("popupclose",{popup:this})},getLatLng:function(){return this._latlng},setLatLng:function(latlng){return this._latlng=L.latLng(latlng),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(content){return this._content=content,this.update(),this},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},_getEvents:function(){var events={viewreset:this._updatePosition};return this._animated&&(events.zoomanim=this._zoomAnimation),("closeOnClick"in this.options?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(events.preclick=this._close),this.options.keepInView&&(events.moveend=this._adjustPan),events},_close:function(){this._map&&this._map.closePopup(this)},_initLayout:function(){var closeButton,prefix="leaflet-popup",containerClass=prefix+" "+this.options.className+" leaflet-zoom-"+(this._animated?"animated":"hide"),container=this._container=L.DomUtil.create("div",containerClass);this.options.closeButton&&(closeButton=this._closeButton=L.DomUtil.create("a",prefix+"-close-button",container),closeButton.href="#close",closeButton.innerHTML="&#215;",L.DomEvent.disableClickPropagation(closeButton),L.DomEvent.on(closeButton,"click",this._onCloseButtonClick,this));var wrapper=this._wrapper=L.DomUtil.create("div",prefix+"-content-wrapper",container);L.DomEvent.disableClickPropagation(wrapper),this._contentNode=L.DomUtil.create("div",prefix+"-content",wrapper),L.DomEvent.disableScrollPropagation(this._contentNode),L.DomEvent.on(wrapper,"contextmenu",L.DomEvent.stopPropagation),this._tipContainer=L.DomUtil.create("div",prefix+"-tip-container",container),this._tip=L.DomUtil.create("div",prefix+"-tip",this._tipContainer)},_updateContent:function(){if(this._content){if("string"==typeof this._content)this._contentNode.innerHTML=this._content;else{for(;this._contentNode.hasChildNodes();)this._contentNode.removeChild(this._contentNode.firstChild);this._contentNode.appendChild(this._content)}this.fire("contentupdate")}},_updateLayout:function(){var container=this._contentNode,style=container.style;style.width="",style.whiteSpace="nowrap";var width=container.offsetWidth;width=Math.min(width,this.options.maxWidth),width=Math.max(width,this.options.minWidth),style.width=width+1+"px",style.whiteSpace="",style.height="";var height=container.offsetHeight,maxHeight=this.options.maxHeight,scrolledClass="leaflet-popup-scrolled";maxHeight&&height>maxHeight?(style.height=maxHeight+"px",L.DomUtil.addClass(container,scrolledClass)):L.DomUtil.removeClass(container,scrolledClass),this._containerWidth=this._container.offsetWidth},_updatePosition:function(){if(this._map){var pos=this._map.latLngToLayerPoint(this._latlng),animated=this._animated,offset=L.point(this.options.offset);animated&&L.DomUtil.setPosition(this._container,pos),this._containerBottom=-offset.y-(animated?0:pos.y),this._containerLeft=-Math.round(this._containerWidth/2)+offset.x+(animated?0:pos.x),this._container.style.bottom=this._containerBottom+"px",this._container.style.left=this._containerLeft+"px"}},_zoomAnimation:function(opt){var pos=this._map._latLngToNewLayerPoint(this._latlng,opt.zoom,opt.center);L.DomUtil.setPosition(this._container,pos)},_adjustPan:function(){if(this.options.autoPan){var map=this._map,containerHeight=this._container.offsetHeight,containerWidth=this._containerWidth,layerPos=new L.Point(this._containerLeft,-containerHeight-this._containerBottom);this._animated&&layerPos._add(L.DomUtil.getPosition(this._container));var containerPos=map.layerPointToContainerPoint(layerPos),padding=L.point(this.options.autoPanPadding),paddingTL=L.point(this.options.autoPanPaddingTopLeft||padding),paddingBR=L.point(this.options.autoPanPaddingBottomRight||padding),size=map.getSize(),dx=0,dy=0;containerPos.x+containerWidth+paddingBR.x>size.x&&(dx=containerPos.x+containerWidth-size.x+paddingBR.x),containerPos.x-dx-paddingTL.x<0&&(dx=containerPos.x-paddingTL.x),containerPos.y+containerHeight+paddingBR.y>size.y&&(dy=containerPos.y+containerHeight-size.y+paddingBR.y),containerPos.y-dy-paddingTL.y<0&&(dy=containerPos.y-paddingTL.y),(dx||dy)&&map.fire("autopanstart").panBy([dx,dy])}},_onCloseButtonClick:function(e){this._close(),L.DomEvent.stop(e)}}),L.popup=function(options,source){return new L.Popup(options,source)},L.Map.include({openPopup:function(popup,latlng,options){if(this.closePopup(),!(popup instanceof L.Popup)){var content=popup;popup=new L.Popup(options).setLatLng(latlng).setContent(content)}return popup._isOpen=!0,this._popup=popup,this.addLayer(popup)},closePopup:function(popup){return popup&&popup!==this._popup||(popup=this._popup,this._popup=null),popup&&(this.removeLayer(popup),popup._isOpen=!1),this}}),L.Marker.include({openPopup:function(){return this._popup&&this._map&&!this._map.hasLayer(this._popup)&&(this._popup.setLatLng(this._latlng),this._map.openPopup(this._popup)),this},closePopup:function(){return this._popup&&this._popup._close(),this},togglePopup:function(){return this._popup&&(this._popup._isOpen?this.closePopup():this.openPopup()),this},bindPopup:function(content,options){var anchor=L.point(this.options.icon.options.popupAnchor||[0,0]);return anchor=anchor.add(L.Popup.prototype.options.offset),options&&options.offset&&(anchor=anchor.add(options.offset)),options=L.extend({offset:anchor},options),this._popupHandlersAdded||(this.on("click",this.togglePopup,this).on("remove",this.closePopup,this).on("move",this._movePopup,this),this._popupHandlersAdded=!0),content instanceof L.Popup?(L.setOptions(content,options),this._popup=content,content._source=this):this._popup=new L.Popup(options,this).setContent(content),this},setPopupContent:function(content){return this._popup&&this._popup.setContent(content),this},unbindPopup:function(){return this._popup&&(this._popup=null,this.off("click",this.togglePopup,this).off("remove",this.closePopup,this).off("move",this._movePopup,this),this._popupHandlersAdded=!1),this},getPopup:function(){return this._popup},_movePopup:function(e){this._popup.setLatLng(e.latlng)}}),L.LayerGroup=L.Class.extend({initialize:function(layers){this._layers={};var i,len;if(layers)for(i=0,len=layers.length;len>i;i++)this.addLayer(layers[i])},addLayer:function(layer){var id=this.getLayerId(layer);return this._layers[id]=layer,this._map&&this._map.addLayer(layer),this},removeLayer:function(layer){var id=layer in this._layers?layer:this.getLayerId(layer);return this._map&&this._layers[id]&&this._map.removeLayer(this._layers[id]),delete this._layers[id],this},hasLayer:function(layer){return layer?layer in this._layers||this.getLayerId(layer)in this._layers:!1},clearLayers:function(){return this.eachLayer(this.removeLayer,this),this},invoke:function(methodName){var i,layer,args=Array.prototype.slice.call(arguments,1);for(i in this._layers)layer=this._layers[i],layer[methodName]&&layer[methodName].apply(layer,args);return this},onAdd:function(map){this._map=map,this.eachLayer(map.addLayer,map)},onRemove:function(map){this.eachLayer(map.removeLayer,map),this._map=null},addTo:function(map){return map.addLayer(this),this},eachLayer:function(method,context){for(var i in this._layers)method.call(context,this._layers[i]);return this},getLayer:function(id){return this._layers[id]},getLayers:function(){var layers=[];for(var i in this._layers)layers.push(this._layers[i]);return layers},setZIndex:function(zIndex){return this.invoke("setZIndex",zIndex)},getLayerId:function(layer){return L.stamp(layer)}}),L.layerGroup=function(layers){return new L.LayerGroup(layers)},L.FeatureGroup=L.LayerGroup.extend({includes:L.Mixin.Events,statics:{EVENTS:"click dblclick mouseover mouseout mousemove contextmenu popupopen popupclose"},addLayer:function(layer){return this.hasLayer(layer)?this:("on"in layer&&layer.on(L.FeatureGroup.EVENTS,this._propagateEvent,this),L.LayerGroup.prototype.addLayer.call(this,layer),this._popupContent&&layer.bindPopup&&layer.bindPopup(this._popupContent,this._popupOptions),this.fire("layeradd",{layer:layer}))},removeLayer:function(layer){return this.hasLayer(layer)?(layer in this._layers&&(layer=this._layers[layer]),layer.off(L.FeatureGroup.EVENTS,this._propagateEvent,this),L.LayerGroup.prototype.removeLayer.call(this,layer),this._popupContent&&this.invoke("unbindPopup"),this.fire("layerremove",{layer:layer})):this},bindPopup:function(content,options){return this._popupContent=content,this._popupOptions=options,this.invoke("bindPopup",content,options)},openPopup:function(latlng){for(var id in this._layers){this._layers[id].openPopup(latlng);break}return this},setStyle:function(style){return this.invoke("setStyle",style)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var bounds=new L.LatLngBounds;return this.eachLayer(function(layer){bounds.extend(layer instanceof L.Marker?layer.getLatLng():layer.getBounds())}),bounds},_propagateEvent:function(e){e=L.extend({layer:e.target,target:this},e),this.fire(e.type,e)}}),L.featureGroup=function(layers){return new L.FeatureGroup(layers)},L.Path=L.Class.extend({includes:[L.Mixin.Events],statics:{CLIP_PADDING:function(){var max=L.Browser.mobile?1280:2e3,target=(max/Math.max(window.outerWidth,window.outerHeight)-1)/2;return Math.max(0,Math.min(.5,target))}()},options:{stroke:!0,color:"#0033ff",dashArray:null,lineCap:null,lineJoin:null,weight:5,opacity:.5,fill:!1,fillColor:null,fillOpacity:.2,clickable:!0},initialize:function(options){L.setOptions(this,options)},onAdd:function(map){this._map=map,this._container||(this._initElements(),this._initEvents()),this.projectLatlngs(),this._updatePath(),this._container&&this._map._pathRoot.appendChild(this._container),this.fire("add"),map.on({viewreset:this.projectLatlngs,moveend:this._updatePath},this)},addTo:function(map){return map.addLayer(this),this},onRemove:function(map){map._pathRoot.removeChild(this._container),this.fire("remove"),this._map=null,L.Browser.vml&&(this._container=null,this._stroke=null,this._fill=null),map.off({viewreset:this.projectLatlngs,moveend:this._updatePath},this)},projectLatlngs:function(){},setStyle:function(style){return L.setOptions(this,style),this._container&&this._updateStyle(),this},redraw:function(){return this._map&&(this.projectLatlngs(),this._updatePath()),this}}),L.Map.include({_updatePathViewport:function(){var p=L.Path.CLIP_PADDING,size=this.getSize(),panePos=L.DomUtil.getPosition(this._mapPane),min=panePos.multiplyBy(-1)._subtract(size.multiplyBy(p)._round()),max=min.add(size.multiplyBy(1+2*p)._round());this._pathViewport=new L.Bounds(min,max)}}),L.Path.SVG_NS="http://www.w3.org/2000/svg",L.Browser.svg=!(!document.createElementNS||!document.createElementNS(L.Path.SVG_NS,"svg").createSVGRect),L.Path=L.Path.extend({statics:{SVG:L.Browser.svg},bringToFront:function(){var root=this._map._pathRoot,path=this._container;return path&&root.lastChild!==path&&root.appendChild(path),this},bringToBack:function(){var root=this._map._pathRoot,path=this._container,first=root.firstChild;return path&&first!==path&&root.insertBefore(path,first),this},getPathString:function(){},_createElement:function(name){return document.createElementNS(L.Path.SVG_NS,name)},_initElements:function(){this._map._initPathRoot(),this._initPath(),this._initStyle()},_initPath:function(){this._container=this._createElement("g"),this._path=this._createElement("path"),this.options.className&&L.DomUtil.addClass(this._path,this.options.className),this._container.appendChild(this._path)},_initStyle:function(){this.options.stroke&&(this._path.setAttribute("stroke-linejoin","round"),this._path.setAttribute("stroke-linecap","round")),this.options.fill&&this._path.setAttribute("fill-rule","evenodd"),this.options.pointerEvents&&this._path.setAttribute("pointer-events",this.options.pointerEvents),this.options.clickable||this.options.pointerEvents||this._path.setAttribute("pointer-events","none"),this._updateStyle()},_updateStyle:function(){this.options.stroke?(this._path.setAttribute("stroke",this.options.color),this._path.setAttribute("stroke-opacity",this.options.opacity),this._path.setAttribute("stroke-width",this.options.weight),this.options.dashArray?this._path.setAttribute("stroke-dasharray",this.options.dashArray):this._path.removeAttribute("stroke-dasharray"),this.options.lineCap&&this._path.setAttribute("stroke-linecap",this.options.lineCap),this.options.lineJoin&&this._path.setAttribute("stroke-linejoin",this.options.lineJoin)):this._path.setAttribute("stroke","none"),this.options.fill?(this._path.setAttribute("fill",this.options.fillColor||this.options.color),this._path.setAttribute("fill-opacity",this.options.fillOpacity)):this._path.setAttribute("fill","none")},_updatePath:function(){var str=this.getPathString();str||(str="M0 0"),this._path.setAttribute("d",str)},_initEvents:function(){if(this.options.clickable){(L.Browser.svg||!L.Browser.vml)&&L.DomUtil.addClass(this._path,"leaflet-clickable"),L.DomEvent.on(this._container,"click",this._onMouseClick,this);for(var events=["dblclick","mousedown","mouseover","mouseout","mousemove","contextmenu"],i=0;i<events.length;i++)L.DomEvent.on(this._container,events[i],this._fireMouseEvent,this)}},_onMouseClick:function(e){this._map.dragging&&this._map.dragging.moved()||this._fireMouseEvent(e)},_fireMouseEvent:function(e){if(this.hasEventListeners(e.type)){var map=this._map,containerPoint=map.mouseEventToContainerPoint(e),layerPoint=map.containerPointToLayerPoint(containerPoint),latlng=map.layerPointToLatLng(layerPoint);this.fire(e.type,{latlng:latlng,layerPoint:layerPoint,containerPoint:containerPoint,originalEvent:e}),"contextmenu"===e.type&&L.DomEvent.preventDefault(e),"mousemove"!==e.type&&L.DomEvent.stopPropagation(e)}}}),L.Map.include({_initPathRoot:function(){this._pathRoot||(this._pathRoot=L.Path.prototype._createElement("svg"),this._panes.overlayPane.appendChild(this._pathRoot),this.options.zoomAnimation&&L.Browser.any3d?(L.DomUtil.addClass(this._pathRoot,"leaflet-zoom-animated"),this.on({zoomanim:this._animatePathZoom,zoomend:this._endPathZoom})):L.DomUtil.addClass(this._pathRoot,"leaflet-zoom-hide"),this.on("moveend",this._updateSvgViewport),this._updateSvgViewport())},_animatePathZoom:function(e){var scale=this.getZoomScale(e.zoom),offset=this._getCenterOffset(e.center)._multiplyBy(-scale)._add(this._pathViewport.min);this._pathRoot.style[L.DomUtil.TRANSFORM]=L.DomUtil.getTranslateString(offset)+" scale("+scale+") ",this._pathZooming=!0},_endPathZoom:function(){this._pathZooming=!1},_updateSvgViewport:function(){if(!this._pathZooming){this._updatePathViewport();var vp=this._pathViewport,min=vp.min,max=vp.max,width=max.x-min.x,height=max.y-min.y,root=this._pathRoot,pane=this._panes.overlayPane;L.Browser.mobileWebkit&&pane.removeChild(root),L.DomUtil.setPosition(root,min),root.setAttribute("width",width),root.setAttribute("height",height),root.setAttribute("viewBox",[min.x,min.y,width,height].join(" ")),L.Browser.mobileWebkit&&pane.appendChild(root)}}}),L.Path.include({bindPopup:function(content,options){return content instanceof L.Popup?this._popup=content:((!this._popup||options)&&(this._popup=new L.Popup(options,this)),this._popup.setContent(content)),this._popupHandlersAdded||(this.on("click",this._openPopup,this).on("remove",this.closePopup,this),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this._popup=null,this.off("click",this._openPopup).off("remove",this.closePopup),this._popupHandlersAdded=!1),this},openPopup:function(latlng){return this._popup&&(latlng=latlng||this._latlng||this._latlngs[Math.floor(this._latlngs.length/2)],this._openPopup({latlng:latlng})),this},closePopup:function(){return this._popup&&this._popup._close(),this},_openPopup:function(e){this._popup.setLatLng(e.latlng),this._map.openPopup(this._popup)}}),L.Browser.vml=!L.Browser.svg&&function(){try{var div=document.createElement("div");div.innerHTML='<v:shape adj="1"/>';var shape=div.firstChild;return shape.style.behavior="url(#default#VML)",shape&&"object"==typeof shape.adj}catch(e){return!1}}(),L.Path=L.Browser.svg||!L.Browser.vml?L.Path:L.Path.extend({statics:{VML:!0,CLIP_PADDING:.02},_createElement:function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(name){return document.createElement("<lvml:"+name+' class="lvml">')}}catch(e){return function(name){return document.createElement("<"+name+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}}(),_initPath:function(){var container=this._container=this._createElement("shape");L.DomUtil.addClass(container,"leaflet-vml-shape"+(this.options.className?" "+this.options.className:"")),this.options.clickable&&L.DomUtil.addClass(container,"leaflet-clickable"),container.coordsize="1 1",this._path=this._createElement("path"),container.appendChild(this._path),this._map._pathRoot.appendChild(container)},_initStyle:function(){this._updateStyle()},_updateStyle:function(){var stroke=this._stroke,fill=this._fill,options=this.options,container=this._container;container.stroked=options.stroke,container.filled=options.fill,options.stroke?(stroke||(stroke=this._stroke=this._createElement("stroke"),stroke.endcap="round",container.appendChild(stroke)),stroke.weight=options.weight+"px",stroke.color=options.color,stroke.opacity=options.opacity,options.dashArray?stroke.dashStyle=L.Util.isArray(options.dashArray)?options.dashArray.join(" "):options.dashArray.replace(/( *, *)/g," "):stroke.dashStyle="",options.lineCap&&(stroke.endcap=options.lineCap.replace("butt","flat")),options.lineJoin&&(stroke.joinstyle=options.lineJoin)):stroke&&(container.removeChild(stroke),this._stroke=null),options.fill?(fill||(fill=this._fill=this._createElement("fill"),container.appendChild(fill)),fill.color=options.fillColor||options.color,fill.opacity=options.fillOpacity):fill&&(container.removeChild(fill),this._fill=null)},_updatePath:function(){var style=this._container.style;style.display="none",this._path.v=this.getPathString()+" ",style.display=""}}),L.Map.include(L.Browser.svg||!L.Browser.vml?{}:{_initPathRoot:function(){if(!this._pathRoot){var root=this._pathRoot=document.createElement("div");root.className="leaflet-vml-container",this._panes.overlayPane.appendChild(root),this.on("moveend",this._updatePathViewport),this._updatePathViewport()}}}),L.Browser.canvas=function(){return!!document.createElement("canvas").getContext}(),L.Path=L.Path.SVG&&!window.L_PREFER_CANVAS||!L.Browser.canvas?L.Path:L.Path.extend({statics:{CANVAS:!0,SVG:!1},redraw:function(){return this._map&&(this.projectLatlngs(),this._requestUpdate()),this},setStyle:function(style){return L.setOptions(this,style),this._map&&(this._updateStyle(),this._requestUpdate()),this},onRemove:function(map){map.off("viewreset",this.projectLatlngs,this).off("moveend",this._updatePath,this),this.options.clickable&&(this._map.off("click",this._onClick,this),this._map.off("mousemove",this._onMouseMove,this)),this._requestUpdate(),this.fire("remove"),this._map=null},_requestUpdate:function(){this._map&&!L.Path._updateRequest&&(L.Path._updateRequest=L.Util.requestAnimFrame(this._fireMapMoveEnd,this._map))},_fireMapMoveEnd:function(){L.Path._updateRequest=null,this.fire("moveend")},_initElements:function(){this._map._initPathRoot(),this._ctx=this._map._canvasCtx},_updateStyle:function(){var options=this.options;options.stroke&&(this._ctx.lineWidth=options.weight,this._ctx.strokeStyle=options.color),options.fill&&(this._ctx.fillStyle=options.fillColor||options.color),options.lineCap&&(this._ctx.lineCap=options.lineCap),options.lineJoin&&(this._ctx.lineJoin=options.lineJoin)},_drawPath:function(){var i,j,len,len2,point,drawMethod;for(this._ctx.beginPath(),i=0,len=this._parts.length;len>i;i++){for(j=0,len2=this._parts[i].length;len2>j;j++)point=this._parts[i][j],drawMethod=(0===j?"move":"line")+"To",this._ctx[drawMethod](point.x,point.y);this instanceof L.Polygon&&this._ctx.closePath()}},_checkIfEmpty:function(){return!this._parts.length},_updatePath:function(){if(!this._checkIfEmpty()){var ctx=this._ctx,options=this.options;this._drawPath(),ctx.save(),this._updateStyle(),options.fill&&(ctx.globalAlpha=options.fillOpacity,ctx.fill(options.fillRule||"evenodd")),options.stroke&&(ctx.globalAlpha=options.opacity,ctx.stroke()),ctx.restore()}},_initEvents:function(){this.options.clickable&&(this._map.on("mousemove",this._onMouseMove,this),this._map.on("click dblclick contextmenu",this._fireMouseEvent,this))},_fireMouseEvent:function(e){this._containsPoint(e.layerPoint)&&this.fire(e.type,e)},_onMouseMove:function(e){this._map&&!this._map._animatingZoom&&(this._containsPoint(e.layerPoint)?(this._ctx.canvas.style.cursor="pointer",this._mouseInside=!0,this.fire("mouseover",e)):this._mouseInside&&(this._ctx.canvas.style.cursor="",this._mouseInside=!1,this.fire("mouseout",e)))}}),L.Map.include(L.Path.SVG&&!window.L_PREFER_CANVAS||!L.Browser.canvas?{}:{_initPathRoot:function(){var ctx,root=this._pathRoot;root||(root=this._pathRoot=document.createElement("canvas"),root.style.position="absolute",ctx=this._canvasCtx=root.getContext("2d"),ctx.lineCap="round",ctx.lineJoin="round",this._panes.overlayPane.appendChild(root),this.options.zoomAnimation&&(this._pathRoot.className="leaflet-zoom-animated",this.on("zoomanim",this._animatePathZoom),this.on("zoomend",this._endPathZoom)),this.on("moveend",this._updateCanvasViewport),this._updateCanvasViewport())},_updateCanvasViewport:function(){if(!this._pathZooming){this._updatePathViewport();var vp=this._pathViewport,min=vp.min,size=vp.max.subtract(min),root=this._pathRoot;L.DomUtil.setPosition(root,min),root.width=size.x,root.height=size.y,root.getContext("2d").translate(-min.x,-min.y)}}}),L.LineUtil={simplify:function(points,tolerance){if(!tolerance||!points.length)return points.slice();var sqTolerance=tolerance*tolerance;return points=this._reducePoints(points,sqTolerance),points=this._simplifyDP(points,sqTolerance)},pointToSegmentDistance:function(p,p1,p2){return Math.sqrt(this._sqClosestPointOnSegment(p,p1,p2,!0))},closestPointOnSegment:function(p,p1,p2){return this._sqClosestPointOnSegment(p,p1,p2)},_simplifyDP:function(points,sqTolerance){var len=points.length,ArrayConstructor=typeof Uint8Array!=undefined+""?Uint8Array:Array,markers=new ArrayConstructor(len);markers[0]=markers[len-1]=1,this._simplifyDPStep(points,markers,sqTolerance,0,len-1);var i,newPoints=[];for(i=0;len>i;i++)markers[i]&&newPoints.push(points[i]);return newPoints},_simplifyDPStep:function(points,markers,sqTolerance,first,last){var index,i,sqDist,maxSqDist=0;
for(i=first+1;last-1>=i;i++)sqDist=this._sqClosestPointOnSegment(points[i],points[first],points[last],!0),sqDist>maxSqDist&&(index=i,maxSqDist=sqDist);maxSqDist>sqTolerance&&(markers[index]=1,this._simplifyDPStep(points,markers,sqTolerance,first,index),this._simplifyDPStep(points,markers,sqTolerance,index,last))},_reducePoints:function(points,sqTolerance){for(var reducedPoints=[points[0]],i=1,prev=0,len=points.length;len>i;i++)this._sqDist(points[i],points[prev])>sqTolerance&&(reducedPoints.push(points[i]),prev=i);return len-1>prev&&reducedPoints.push(points[len-1]),reducedPoints},clipSegment:function(a,b,bounds,useLastCode){var codeOut,p,newCode,codeA=useLastCode?this._lastCode:this._getBitCode(a,bounds),codeB=this._getBitCode(b,bounds);for(this._lastCode=codeB;;){if(!(codeA|codeB))return[a,b];if(codeA&codeB)return!1;codeOut=codeA||codeB,p=this._getEdgeIntersection(a,b,codeOut,bounds),newCode=this._getBitCode(p,bounds),codeOut===codeA?(a=p,codeA=newCode):(b=p,codeB=newCode)}},_getEdgeIntersection:function(a,b,code,bounds){var dx=b.x-a.x,dy=b.y-a.y,min=bounds.min,max=bounds.max;return 8&code?new L.Point(a.x+dx*(max.y-a.y)/dy,max.y):4&code?new L.Point(a.x+dx*(min.y-a.y)/dy,min.y):2&code?new L.Point(max.x,a.y+dy*(max.x-a.x)/dx):1&code?new L.Point(min.x,a.y+dy*(min.x-a.x)/dx):void 0},_getBitCode:function(p,bounds){var code=0;return p.x<bounds.min.x?code|=1:p.x>bounds.max.x&&(code|=2),p.y<bounds.min.y?code|=4:p.y>bounds.max.y&&(code|=8),code},_sqDist:function(p1,p2){var dx=p2.x-p1.x,dy=p2.y-p1.y;return dx*dx+dy*dy},_sqClosestPointOnSegment:function(p,p1,p2,sqDist){var t,x=p1.x,y=p1.y,dx=p2.x-x,dy=p2.y-y,dot=dx*dx+dy*dy;return dot>0&&(t=((p.x-x)*dx+(p.y-y)*dy)/dot,t>1?(x=p2.x,y=p2.y):t>0&&(x+=dx*t,y+=dy*t)),dx=p.x-x,dy=p.y-y,sqDist?dx*dx+dy*dy:new L.Point(x,y)}},L.Polyline=L.Path.extend({initialize:function(latlngs,options){L.Path.prototype.initialize.call(this,options),this._latlngs=this._convertLatLngs(latlngs)},options:{smoothFactor:1,noClip:!1},projectLatlngs:function(){this._originalPoints=[];for(var i=0,len=this._latlngs.length;len>i;i++)this._originalPoints[i]=this._map.latLngToLayerPoint(this._latlngs[i])},getPathString:function(){for(var i=0,len=this._parts.length,str="";len>i;i++)str+=this._getPathPartStr(this._parts[i]);return str},getLatLngs:function(){return this._latlngs},setLatLngs:function(latlngs){return this._latlngs=this._convertLatLngs(latlngs),this.redraw()},addLatLng:function(latlng){return this._latlngs.push(L.latLng(latlng)),this.redraw()},spliceLatLngs:function(){var removed=[].splice.apply(this._latlngs,arguments);return this._convertLatLngs(this._latlngs,!0),this.redraw(),removed},closestLayerPoint:function(p){for(var p1,p2,minDistance=1/0,parts=this._parts,minPoint=null,j=0,jLen=parts.length;jLen>j;j++)for(var points=parts[j],i=1,len=points.length;len>i;i++){p1=points[i-1],p2=points[i];var sqDist=L.LineUtil._sqClosestPointOnSegment(p,p1,p2,!0);minDistance>sqDist&&(minDistance=sqDist,minPoint=L.LineUtil._sqClosestPointOnSegment(p,p1,p2))}return minPoint&&(minPoint.distance=Math.sqrt(minDistance)),minPoint},getBounds:function(){return new L.LatLngBounds(this.getLatLngs())},_convertLatLngs:function(latlngs,overwrite){var i,len,target=overwrite?latlngs:[];for(i=0,len=latlngs.length;len>i;i++){if(L.Util.isArray(latlngs[i])&&"number"!=typeof latlngs[i][0])return;target[i]=L.latLng(latlngs[i])}return target},_initEvents:function(){L.Path.prototype._initEvents.call(this)},_getPathPartStr:function(points){for(var p,round=L.Path.VML,j=0,len2=points.length,str="";len2>j;j++)p=points[j],round&&p._round(),str+=(j?"L":"M")+p.x+" "+p.y;return str},_clipPoints:function(){var i,k,segment,points=this._originalPoints,len=points.length;if(this.options.noClip)return void(this._parts=[points]);this._parts=[];var parts=this._parts,vp=this._map._pathViewport,lu=L.LineUtil;for(i=0,k=0;len-1>i;i++)segment=lu.clipSegment(points[i],points[i+1],vp,i),segment&&(parts[k]=parts[k]||[],parts[k].push(segment[0]),(segment[1]!==points[i+1]||i===len-2)&&(parts[k].push(segment[1]),k++))},_simplifyPoints:function(){for(var parts=this._parts,lu=L.LineUtil,i=0,len=parts.length;len>i;i++)parts[i]=lu.simplify(parts[i],this.options.smoothFactor)},_updatePath:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),L.Path.prototype._updatePath.call(this))}}),L.polyline=function(latlngs,options){return new L.Polyline(latlngs,options)},L.PolyUtil={},L.PolyUtil.clipPolygon=function(points,bounds){var clippedPoints,i,j,k,a,b,len,edge,p,edges=[1,4,2,8],lu=L.LineUtil;for(i=0,len=points.length;len>i;i++)points[i]._code=lu._getBitCode(points[i],bounds);for(k=0;4>k;k++){for(edge=edges[k],clippedPoints=[],i=0,len=points.length,j=len-1;len>i;j=i++)a=points[i],b=points[j],a._code&edge?b._code&edge||(p=lu._getEdgeIntersection(b,a,edge,bounds),p._code=lu._getBitCode(p,bounds),clippedPoints.push(p)):(b._code&edge&&(p=lu._getEdgeIntersection(b,a,edge,bounds),p._code=lu._getBitCode(p,bounds),clippedPoints.push(p)),clippedPoints.push(a));points=clippedPoints}return points},L.Polygon=L.Polyline.extend({options:{fill:!0},initialize:function(latlngs,options){L.Polyline.prototype.initialize.call(this,latlngs,options),this._initWithHoles(latlngs)},_initWithHoles:function(latlngs){var i,len,hole;if(latlngs&&L.Util.isArray(latlngs[0])&&"number"!=typeof latlngs[0][0])for(this._latlngs=this._convertLatLngs(latlngs[0]),this._holes=latlngs.slice(1),i=0,len=this._holes.length;len>i;i++)hole=this._holes[i]=this._convertLatLngs(this._holes[i]),hole[0].equals(hole[hole.length-1])&&hole.pop();latlngs=this._latlngs,latlngs.length>=2&&latlngs[0].equals(latlngs[latlngs.length-1])&&latlngs.pop()},projectLatlngs:function(){if(L.Polyline.prototype.projectLatlngs.call(this),this._holePoints=[],this._holes){var i,j,len,len2;for(i=0,len=this._holes.length;len>i;i++)for(this._holePoints[i]=[],j=0,len2=this._holes[i].length;len2>j;j++)this._holePoints[i][j]=this._map.latLngToLayerPoint(this._holes[i][j])}},setLatLngs:function(latlngs){return latlngs&&L.Util.isArray(latlngs[0])&&"number"!=typeof latlngs[0][0]?(this._initWithHoles(latlngs),this.redraw()):L.Polyline.prototype.setLatLngs.call(this,latlngs)},_clipPoints:function(){var points=this._originalPoints,newParts=[];if(this._parts=[points].concat(this._holePoints),!this.options.noClip){for(var i=0,len=this._parts.length;len>i;i++){var clipped=L.PolyUtil.clipPolygon(this._parts[i],this._map._pathViewport);clipped.length&&newParts.push(clipped)}this._parts=newParts}},_getPathPartStr:function(points){var str=L.Polyline.prototype._getPathPartStr.call(this,points);return str+(L.Browser.svg?"z":"x")}}),L.polygon=function(latlngs,options){return new L.Polygon(latlngs,options)},function(){function createMulti(Klass){return L.FeatureGroup.extend({initialize:function(latlngs,options){this._layers={},this._options=options,this.setLatLngs(latlngs)},setLatLngs:function(latlngs){var i=0,len=latlngs.length;for(this.eachLayer(function(layer){len>i?layer.setLatLngs(latlngs[i++]):this.removeLayer(layer)},this);len>i;)this.addLayer(new Klass(latlngs[i++],this._options));return this},getLatLngs:function(){var latlngs=[];return this.eachLayer(function(layer){latlngs.push(layer.getLatLngs())}),latlngs}})}L.MultiPolyline=createMulti(L.Polyline),L.MultiPolygon=createMulti(L.Polygon),L.multiPolyline=function(latlngs,options){return new L.MultiPolyline(latlngs,options)},L.multiPolygon=function(latlngs,options){return new L.MultiPolygon(latlngs,options)}}(),L.Rectangle=L.Polygon.extend({initialize:function(latLngBounds,options){L.Polygon.prototype.initialize.call(this,this._boundsToLatLngs(latLngBounds),options)},setBounds:function(latLngBounds){this.setLatLngs(this._boundsToLatLngs(latLngBounds))},_boundsToLatLngs:function(latLngBounds){return latLngBounds=L.latLngBounds(latLngBounds),[latLngBounds.getSouthWest(),latLngBounds.getNorthWest(),latLngBounds.getNorthEast(),latLngBounds.getSouthEast()]}}),L.rectangle=function(latLngBounds,options){return new L.Rectangle(latLngBounds,options)},L.Circle=L.Path.extend({initialize:function(latlng,radius,options){L.Path.prototype.initialize.call(this,options),this._latlng=L.latLng(latlng),this._mRadius=radius},options:{fill:!0},setLatLng:function(latlng){return this._latlng=L.latLng(latlng),this.redraw()},setRadius:function(radius){return this._mRadius=radius,this.redraw()},projectLatlngs:function(){var lngRadius=this._getLngRadius(),latlng=this._latlng,pointLeft=this._map.latLngToLayerPoint([latlng.lat,latlng.lng-lngRadius]);this._point=this._map.latLngToLayerPoint(latlng),this._radius=Math.max(this._point.x-pointLeft.x,1)},getBounds:function(){var lngRadius=this._getLngRadius(),latRadius=this._mRadius/40075017*360,latlng=this._latlng;return new L.LatLngBounds([latlng.lat-latRadius,latlng.lng-lngRadius],[latlng.lat+latRadius,latlng.lng+lngRadius])},getLatLng:function(){return this._latlng},getPathString:function(){var p=this._point,r=this._radius;return this._checkIfEmpty()?"":L.Browser.svg?"M"+p.x+","+(p.y-r)+"A"+r+","+r+",0,1,1,"+(p.x-.1)+","+(p.y-r)+" z":(p._round(),r=Math.round(r),"AL "+p.x+","+p.y+" "+r+","+r+" 0,23592600")},getRadius:function(){return this._mRadius},_getLatRadius:function(){return this._mRadius/40075017*360},_getLngRadius:function(){return this._getLatRadius()/Math.cos(L.LatLng.DEG_TO_RAD*this._latlng.lat)},_checkIfEmpty:function(){if(!this._map)return!1;var vp=this._map._pathViewport,r=this._radius,p=this._point;return p.x-r>vp.max.x||p.y-r>vp.max.y||p.x+r<vp.min.x||p.y+r<vp.min.y}}),L.circle=function(latlng,radius,options){return new L.Circle(latlng,radius,options)},L.CircleMarker=L.Circle.extend({options:{radius:10,weight:2},initialize:function(latlng,options){L.Circle.prototype.initialize.call(this,latlng,null,options),this._radius=this.options.radius},projectLatlngs:function(){this._point=this._map.latLngToLayerPoint(this._latlng)},_updateStyle:function(){L.Circle.prototype._updateStyle.call(this),this.setRadius(this.options.radius)},setLatLng:function(latlng){return L.Circle.prototype.setLatLng.call(this,latlng),this._popup&&this._popup._isOpen&&this._popup.setLatLng(latlng),this},setRadius:function(radius){return this.options.radius=this._radius=radius,this.redraw()},getRadius:function(){return this._radius}}),L.circleMarker=function(latlng,options){return new L.CircleMarker(latlng,options)},L.Polyline.include(L.Path.CANVAS?{_containsPoint:function(p,closed){var i,j,k,len,len2,dist,part,w=this.options.weight/2;for(L.Browser.touch&&(w+=10),i=0,len=this._parts.length;len>i;i++)for(part=this._parts[i],j=0,len2=part.length,k=len2-1;len2>j;k=j++)if((closed||0!==j)&&(dist=L.LineUtil.pointToSegmentDistance(p,part[k],part[j]),w>=dist))return!0;return!1}}:{}),L.Polygon.include(L.Path.CANVAS?{_containsPoint:function(p){var part,p1,p2,i,j,k,len,len2,inside=!1;if(L.Polyline.prototype._containsPoint.call(this,p,!0))return!0;for(i=0,len=this._parts.length;len>i;i++)for(part=this._parts[i],j=0,len2=part.length,k=len2-1;len2>j;k=j++)p1=part[j],p2=part[k],p1.y>p.y!=p2.y>p.y&&p.x<(p2.x-p1.x)*(p.y-p1.y)/(p2.y-p1.y)+p1.x&&(inside=!inside);return inside}}:{}),L.Circle.include(L.Path.CANVAS?{_drawPath:function(){var p=this._point;this._ctx.beginPath(),this._ctx.arc(p.x,p.y,this._radius,0,2*Math.PI,!1)},_containsPoint:function(p){var center=this._point,w2=this.options.stroke?this.options.weight/2:0;return p.distanceTo(center)<=this._radius+w2}}:{}),L.CircleMarker.include(L.Path.CANVAS?{_updateStyle:function(){L.Path.prototype._updateStyle.call(this)}}:{}),L.GeoJSON=L.FeatureGroup.extend({initialize:function(geojson,options){L.setOptions(this,options),this._layers={},geojson&&this.addData(geojson)},addData:function(geojson){var i,len,feature,features=L.Util.isArray(geojson)?geojson:geojson.features;if(features){for(i=0,len=features.length;len>i;i++)feature=features[i],(feature.geometries||feature.geometry||feature.features||feature.coordinates)&&this.addData(features[i]);return this}var options=this.options;if(!options.filter||options.filter(geojson)){var layer=L.GeoJSON.geometryToLayer(geojson,options.pointToLayer,options.coordsToLatLng,options);return layer.feature=L.GeoJSON.asFeature(geojson),layer.defaultOptions=layer.options,this.resetStyle(layer),options.onEachFeature&&options.onEachFeature(geojson,layer),this.addLayer(layer)}},resetStyle:function(layer){var style=this.options.style;style&&(L.Util.extend(layer.options,layer.defaultOptions),this._setLayerStyle(layer,style))},setStyle:function(style){this.eachLayer(function(layer){this._setLayerStyle(layer,style)},this)},_setLayerStyle:function(layer,style){"function"==typeof style&&(style=style(layer.feature)),layer.setStyle&&layer.setStyle(style)}}),L.extend(L.GeoJSON,{geometryToLayer:function(geojson,pointToLayer,coordsToLatLng,vectorOptions){var latlng,latlngs,i,len,geometry="Feature"===geojson.type?geojson.geometry:geojson,coords=geometry.coordinates,layers=[];switch(coordsToLatLng=coordsToLatLng||this.coordsToLatLng,geometry.type){case"Point":return latlng=coordsToLatLng(coords),pointToLayer?pointToLayer(geojson,latlng):new L.Marker(latlng);case"MultiPoint":for(i=0,len=coords.length;len>i;i++)latlng=coordsToLatLng(coords[i]),layers.push(pointToLayer?pointToLayer(geojson,latlng):new L.Marker(latlng));return new L.FeatureGroup(layers);case"LineString":return latlngs=this.coordsToLatLngs(coords,0,coordsToLatLng),new L.Polyline(latlngs,vectorOptions);case"Polygon":if(2===coords.length&&!coords[1].length)throw new Error("Invalid GeoJSON object.");return latlngs=this.coordsToLatLngs(coords,1,coordsToLatLng),new L.Polygon(latlngs,vectorOptions);case"MultiLineString":return latlngs=this.coordsToLatLngs(coords,1,coordsToLatLng),new L.MultiPolyline(latlngs,vectorOptions);case"MultiPolygon":return latlngs=this.coordsToLatLngs(coords,2,coordsToLatLng),new L.MultiPolygon(latlngs,vectorOptions);case"GeometryCollection":for(i=0,len=geometry.geometries.length;len>i;i++)layers.push(this.geometryToLayer({geometry:geometry.geometries[i],type:"Feature",properties:geojson.properties},pointToLayer,coordsToLatLng,vectorOptions));return new L.FeatureGroup(layers);default:throw new Error("Invalid GeoJSON object.")}},coordsToLatLng:function(coords){return new L.LatLng(coords[1],coords[0],coords[2])},coordsToLatLngs:function(coords,levelsDeep,coordsToLatLng){var latlng,i,len,latlngs=[];for(i=0,len=coords.length;len>i;i++)latlng=levelsDeep?this.coordsToLatLngs(coords[i],levelsDeep-1,coordsToLatLng):(coordsToLatLng||this.coordsToLatLng)(coords[i]),latlngs.push(latlng);return latlngs},latLngToCoords:function(latlng){var coords=[latlng.lng,latlng.lat];return latlng.alt!==undefined&&coords.push(latlng.alt),coords},latLngsToCoords:function(latLngs){for(var coords=[],i=0,len=latLngs.length;len>i;i++)coords.push(L.GeoJSON.latLngToCoords(latLngs[i]));return coords},getFeature:function(layer,newGeometry){return layer.feature?L.extend({},layer.feature,{geometry:newGeometry}):L.GeoJSON.asFeature(newGeometry)},asFeature:function(geoJSON){return"Feature"===geoJSON.type?geoJSON:{type:"Feature",properties:{},geometry:geoJSON}}});var PointToGeoJSON={toGeoJSON:function(){return L.GeoJSON.getFeature(this,{type:"Point",coordinates:L.GeoJSON.latLngToCoords(this.getLatLng())})}};L.Marker.include(PointToGeoJSON),L.Circle.include(PointToGeoJSON),L.CircleMarker.include(PointToGeoJSON),L.Polyline.include({toGeoJSON:function(){return L.GeoJSON.getFeature(this,{type:"LineString",coordinates:L.GeoJSON.latLngsToCoords(this.getLatLngs())})}}),L.Polygon.include({toGeoJSON:function(){var i,len,hole,coords=[L.GeoJSON.latLngsToCoords(this.getLatLngs())];if(coords[0].push(coords[0][0]),this._holes)for(i=0,len=this._holes.length;len>i;i++)hole=L.GeoJSON.latLngsToCoords(this._holes[i]),hole.push(hole[0]),coords.push(hole);return L.GeoJSON.getFeature(this,{type:"Polygon",coordinates:coords})}}),function(){function multiToGeoJSON(type){return function(){var coords=[];return this.eachLayer(function(layer){coords.push(layer.toGeoJSON().geometry.coordinates)}),L.GeoJSON.getFeature(this,{type:type,coordinates:coords})}}L.MultiPolyline.include({toGeoJSON:multiToGeoJSON("MultiLineString")}),L.MultiPolygon.include({toGeoJSON:multiToGeoJSON("MultiPolygon")}),L.LayerGroup.include({toGeoJSON:function(){var json,geometry=this.feature&&this.feature.geometry,jsons=[];if(geometry&&"MultiPoint"===geometry.type)return multiToGeoJSON("MultiPoint").call(this);var isGeometryCollection=geometry&&"GeometryCollection"===geometry.type;return this.eachLayer(function(layer){layer.toGeoJSON&&(json=layer.toGeoJSON(),jsons.push(isGeometryCollection?json.geometry:L.GeoJSON.asFeature(json)))}),isGeometryCollection?L.GeoJSON.getFeature(this,{geometries:jsons,type:"GeometryCollection"}):{type:"FeatureCollection",features:jsons}}})}(),L.geoJson=function(geojson,options){return new L.GeoJSON(geojson,options)},L.DomEvent={addListener:function(obj,type,fn,context){var handler,originalHandler,newType,id=L.stamp(fn),key="_leaflet_"+type+id;return obj[key]?this:(handler=function(e){return fn.call(context||obj,e||L.DomEvent._getEvent())},L.Browser.pointer&&0===type.indexOf("touch")?this.addPointerListener(obj,type,handler,id):(L.Browser.touch&&"dblclick"===type&&this.addDoubleTapListener&&this.addDoubleTapListener(obj,handler,id),"addEventListener"in obj?"mousewheel"===type?(obj.addEventListener("DOMMouseScroll",handler,!1),obj.addEventListener(type,handler,!1)):"mouseenter"===type||"mouseleave"===type?(originalHandler=handler,newType="mouseenter"===type?"mouseover":"mouseout",handler=function(e){return L.DomEvent._checkMouse(obj,e)?originalHandler(e):void 0},obj.addEventListener(newType,handler,!1)):"click"===type&&L.Browser.android?(originalHandler=handler,handler=function(e){return L.DomEvent._filterClick(e,originalHandler)},obj.addEventListener(type,handler,!1)):obj.addEventListener(type,handler,!1):"attachEvent"in obj&&obj.attachEvent("on"+type,handler),obj[key]=handler,this))},removeListener:function(obj,type,fn){var id=L.stamp(fn),key="_leaflet_"+type+id,handler=obj[key];return handler?(L.Browser.pointer&&0===type.indexOf("touch")?this.removePointerListener(obj,type,id):L.Browser.touch&&"dblclick"===type&&this.removeDoubleTapListener?this.removeDoubleTapListener(obj,id):"removeEventListener"in obj?"mousewheel"===type?(obj.removeEventListener("DOMMouseScroll",handler,!1),obj.removeEventListener(type,handler,!1)):"mouseenter"===type||"mouseleave"===type?obj.removeEventListener("mouseenter"===type?"mouseover":"mouseout",handler,!1):obj.removeEventListener(type,handler,!1):"detachEvent"in obj&&obj.detachEvent("on"+type,handler),obj[key]=null,this):this},stopPropagation:function(e){return e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,L.DomEvent._skipped(e),this},disableScrollPropagation:function(el){var stop=L.DomEvent.stopPropagation;return L.DomEvent.on(el,"mousewheel",stop).on(el,"MozMousePixelScroll",stop)},disableClickPropagation:function(el){for(var stop=L.DomEvent.stopPropagation,i=L.Draggable.START.length-1;i>=0;i--)L.DomEvent.on(el,L.Draggable.START[i],stop);return L.DomEvent.on(el,"click",L.DomEvent._fakeStop).on(el,"dblclick",stop)},preventDefault:function(e){return e.preventDefault?e.preventDefault():e.returnValue=!1,this},stop:function(e){return L.DomEvent.preventDefault(e).stopPropagation(e)},getMousePosition:function(e,container){if(!container)return new L.Point(e.clientX,e.clientY);var rect=container.getBoundingClientRect();return new L.Point(e.clientX-rect.left-container.clientLeft,e.clientY-rect.top-container.clientTop)},getWheelDelta:function(e){var delta=0;return e.wheelDelta&&(delta=e.wheelDelta/120),e.detail&&(delta=-e.detail/3),delta},_skipEvents:{},_fakeStop:function(e){L.DomEvent._skipEvents[e.type]=!0},_skipped:function(e){var skipped=this._skipEvents[e.type];return this._skipEvents[e.type]=!1,skipped},_checkMouse:function(el,e){var related=e.relatedTarget;if(!related)return!0;try{for(;related&&related!==el;)related=related.parentNode}catch(err){return!1}return related!==el},_getEvent:function(){var e=window.event;if(!e)for(var caller=arguments.callee.caller;caller&&(e=caller.arguments[0],!e||window.Event!==e.constructor);)caller=caller.caller;return e},_filterClick:function(e,handler){var timeStamp=e.timeStamp||e.originalEvent.timeStamp,elapsed=L.DomEvent._lastClick&&timeStamp-L.DomEvent._lastClick;return elapsed&&elapsed>100&&500>elapsed||e.target._simulatedClick&&!e._simulated?void L.DomEvent.stop(e):(L.DomEvent._lastClick=timeStamp,handler(e))}},L.DomEvent.on=L.DomEvent.addListener,L.DomEvent.off=L.DomEvent.removeListener,L.Draggable=L.Class.extend({includes:L.Mixin.Events,statics:{START:L.Browser.touch?["touchstart","mousedown"]:["mousedown"],END:{mousedown:"mouseup",touchstart:"touchend",pointerdown:"touchend",MSPointerDown:"touchend"},MOVE:{mousedown:"mousemove",touchstart:"touchmove",pointerdown:"touchmove",MSPointerDown:"touchmove"}},initialize:function(element,dragStartTarget){this._element=element,this._dragStartTarget=dragStartTarget||element},enable:function(){if(!this._enabled){for(var i=L.Draggable.START.length-1;i>=0;i--)L.DomEvent.on(this._dragStartTarget,L.Draggable.START[i],this._onDown,this);this._enabled=!0}},disable:function(){if(this._enabled){for(var i=L.Draggable.START.length-1;i>=0;i--)L.DomEvent.off(this._dragStartTarget,L.Draggable.START[i],this._onDown,this);this._enabled=!1,this._moved=!1}},_onDown:function(e){if(this._moved=!1,!e.shiftKey&&(1===e.which||1===e.button||e.touches)&&(L.DomEvent.stopPropagation(e),!L.Draggable._disabled&&(L.DomUtil.disableImageDrag(),L.DomUtil.disableTextSelection(),!this._moving))){var first=e.touches?e.touches[0]:e;this._startPoint=new L.Point(first.clientX,first.clientY),this._startPos=this._newPos=L.DomUtil.getPosition(this._element),L.DomEvent.on(document,L.Draggable.MOVE[e.type],this._onMove,this).on(document,L.Draggable.END[e.type],this._onUp,this)}},_onMove:function(e){if(e.touches&&e.touches.length>1)return void(this._moved=!0);var first=e.touches&&1===e.touches.length?e.touches[0]:e,newPoint=new L.Point(first.clientX,first.clientY),offset=newPoint.subtract(this._startPoint);(offset.x||offset.y)&&(L.Browser.touch&&Math.abs(offset.x)+Math.abs(offset.y)<3||(L.DomEvent.preventDefault(e),this._moved||(this.fire("dragstart"),this._moved=!0,this._startPos=L.DomUtil.getPosition(this._element).subtract(offset),L.DomUtil.addClass(document.body,"leaflet-dragging"),this._lastTarget=e.target||e.srcElement,L.DomUtil.addClass(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(offset),this._moving=!0,L.Util.cancelAnimFrame(this._animRequest),this._animRequest=L.Util.requestAnimFrame(this._updatePosition,this,!0,this._dragStartTarget)))},_updatePosition:function(){this.fire("predrag"),L.DomUtil.setPosition(this._element,this._newPos),this.fire("drag")},_onUp:function(){L.DomUtil.removeClass(document.body,"leaflet-dragging"),this._lastTarget&&(L.DomUtil.removeClass(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null);for(var i in L.Draggable.MOVE)L.DomEvent.off(document,L.Draggable.MOVE[i],this._onMove).off(document,L.Draggable.END[i],this._onUp);L.DomUtil.enableImageDrag(),L.DomUtil.enableTextSelection(),this._moved&&this._moving&&(L.Util.cancelAnimFrame(this._animRequest),this.fire("dragend",{distance:this._newPos.distanceTo(this._startPos)})),this._moving=!1}}),L.Handler=L.Class.extend({initialize:function(map){this._map=map},enable:function(){this._enabled||(this._enabled=!0,this.addHooks())},disable:function(){this._enabled&&(this._enabled=!1,this.removeHooks())},enabled:function(){return!!this._enabled}}),L.Map.mergeOptions({dragging:!0,inertia:!L.Browser.android23,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,inertiaThreshold:L.Browser.touch?32:18,easeLinearity:.25,worldCopyJump:!1}),L.Map.Drag=L.Handler.extend({addHooks:function(){if(!this._draggable){var map=this._map;this._draggable=new L.Draggable(map._mapPane,map._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),map.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDrag,this),map.on("viewreset",this._onViewReset,this),map.whenReady(this._onViewReset,this))}this._draggable.enable()},removeHooks:function(){this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},_onDragStart:function(){var map=this._map;map._panAnim&&map._panAnim.stop(),map.fire("movestart").fire("dragstart"),map.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(){if(this._map.options.inertia){var time=this._lastTime=+new Date,pos=this._lastPos=this._draggable._newPos;this._positions.push(pos),this._times.push(time),time-this._times[0]>200&&(this._positions.shift(),this._times.shift())}this._map.fire("move").fire("drag")},_onViewReset:function(){var pxCenter=this._map.getSize()._divideBy(2),pxWorldCenter=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=pxWorldCenter.subtract(pxCenter).x,this._worldWidth=this._map.project([0,180]).x},_onPreDrag:function(){var worldWidth=this._worldWidth,halfWidth=Math.round(worldWidth/2),dx=this._initialWorldOffset,x=this._draggable._newPos.x,newX1=(x-halfWidth+dx)%worldWidth+halfWidth-dx,newX2=(x+halfWidth+dx)%worldWidth-halfWidth-dx,newX=Math.abs(newX1+dx)<Math.abs(newX2+dx)?newX1:newX2;this._draggable._newPos.x=newX},_onDragEnd:function(e){var map=this._map,options=map.options,delay=+new Date-this._lastTime,noInertia=!options.inertia||delay>options.inertiaThreshold||!this._positions[0];if(map.fire("dragend",e),noInertia)map.fire("moveend");else{var direction=this._lastPos.subtract(this._positions[0]),duration=(this._lastTime+delay-this._times[0])/1e3,ease=options.easeLinearity,speedVector=direction.multiplyBy(ease/duration),speed=speedVector.distanceTo([0,0]),limitedSpeed=Math.min(options.inertiaMaxSpeed,speed),limitedSpeedVector=speedVector.multiplyBy(limitedSpeed/speed),decelerationDuration=limitedSpeed/(options.inertiaDeceleration*ease),offset=limitedSpeedVector.multiplyBy(-decelerationDuration/2).round();offset.x&&offset.y?(offset=map._limitOffset(offset,map.options.maxBounds),L.Util.requestAnimFrame(function(){map.panBy(offset,{duration:decelerationDuration,easeLinearity:ease,noMoveStart:!0})})):map.fire("moveend")}}}),L.Map.addInitHook("addHandler","dragging",L.Map.Drag),L.Map.mergeOptions({doubleClickZoom:!0}),L.Map.DoubleClickZoom=L.Handler.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(e){var map=this._map,zoom=map.getZoom()+(e.originalEvent.shiftKey?-1:1);"center"===map.options.doubleClickZoom?map.setZoom(zoom):map.setZoomAround(e.containerPoint,zoom)}}),L.Map.addInitHook("addHandler","doubleClickZoom",L.Map.DoubleClickZoom),L.Map.mergeOptions({scrollWheelZoom:!0}),L.Map.ScrollWheelZoom=L.Handler.extend({addHooks:function(){L.DomEvent.on(this._map._container,"mousewheel",this._onWheelScroll,this),L.DomEvent.on(this._map._container,"MozMousePixelScroll",L.DomEvent.preventDefault),this._delta=0},removeHooks:function(){L.DomEvent.off(this._map._container,"mousewheel",this._onWheelScroll),L.DomEvent.off(this._map._container,"MozMousePixelScroll",L.DomEvent.preventDefault)},_onWheelScroll:function(e){var delta=L.DomEvent.getWheelDelta(e);this._delta+=delta,this._lastMousePos=this._map.mouseEventToContainerPoint(e),this._startTime||(this._startTime=+new Date);var left=Math.max(40-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(L.bind(this._performZoom,this),left),L.DomEvent.preventDefault(e),L.DomEvent.stopPropagation(e)},_performZoom:function(){var map=this._map,delta=this._delta,zoom=map.getZoom();delta=delta>0?Math.ceil(delta):Math.floor(delta),delta=Math.max(Math.min(delta,4),-4),delta=map._limitZoom(zoom+delta)-zoom,this._delta=0,this._startTime=null,delta&&("center"===map.options.scrollWheelZoom?map.setZoom(zoom+delta):map.setZoomAround(this._lastMousePos,zoom+delta))}}),L.Map.addInitHook("addHandler","scrollWheelZoom",L.Map.ScrollWheelZoom),L.extend(L.DomEvent,{_touchstart:L.Browser.msPointer?"MSPointerDown":L.Browser.pointer?"pointerdown":"touchstart",_touchend:L.Browser.msPointer?"MSPointerUp":L.Browser.pointer?"pointerup":"touchend",addDoubleTapListener:function(obj,handler,id){function onTouchStart(e){var count;if(L.Browser.pointer?(trackedTouches.push(e.pointerId),count=trackedTouches.length):count=e.touches.length,!(count>1)){var now=Date.now(),delta=now-(last||now);touch=e.touches?e.touches[0]:e,doubleTap=delta>0&&delay>=delta,last=now}}function onTouchEnd(e){if(L.Browser.pointer){var idx=trackedTouches.indexOf(e.pointerId);if(-1===idx)return;trackedTouches.splice(idx,1)}if(doubleTap){if(L.Browser.pointer){var prop,newTouch={};for(var i in touch)prop=touch[i],"function"==typeof prop?newTouch[i]=prop.bind(touch):newTouch[i]=prop;touch=newTouch}touch.type="dblclick",handler(touch),last=null}}var last,touch,doubleTap=!1,delay=250,pre="_leaflet_",touchstart=this._touchstart,touchend=this._touchend,trackedTouches=[];obj[pre+touchstart+id]=onTouchStart,obj[pre+touchend+id]=onTouchEnd;var endElement=L.Browser.pointer?document.documentElement:obj;return obj.addEventListener(touchstart,onTouchStart,!1),endElement.addEventListener(touchend,onTouchEnd,!1),L.Browser.pointer&&endElement.addEventListener(L.DomEvent.POINTER_CANCEL,onTouchEnd,!1),this},removeDoubleTapListener:function(obj,id){var pre="_leaflet_";return obj.removeEventListener(this._touchstart,obj[pre+this._touchstart+id],!1),(L.Browser.pointer?document.documentElement:obj).removeEventListener(this._touchend,obj[pre+this._touchend+id],!1),L.Browser.pointer&&document.documentElement.removeEventListener(L.DomEvent.POINTER_CANCEL,obj[pre+this._touchend+id],!1),this}}),L.extend(L.DomEvent,{POINTER_DOWN:L.Browser.msPointer?"MSPointerDown":"pointerdown",POINTER_MOVE:L.Browser.msPointer?"MSPointerMove":"pointermove",POINTER_UP:L.Browser.msPointer?"MSPointerUp":"pointerup",POINTER_CANCEL:L.Browser.msPointer?"MSPointerCancel":"pointercancel",_pointers:[],_pointerDocumentListener:!1,addPointerListener:function(obj,type,handler,id){switch(type){case"touchstart":return this.addPointerListenerStart(obj,type,handler,id);case"touchend":return this.addPointerListenerEnd(obj,type,handler,id);case"touchmove":return this.addPointerListenerMove(obj,type,handler,id);default:throw"Unknown touch event type"}},addPointerListenerStart:function(obj,type,handler,id){var pre="_leaflet_",pointers=this._pointers,cb=function(e){L.DomEvent.preventDefault(e);for(var alreadyInArray=!1,i=0;i<pointers.length;i++)if(pointers[i].pointerId===e.pointerId){alreadyInArray=!0;break}alreadyInArray||pointers.push(e),e.touches=pointers.slice(),e.changedTouches=[e],handler(e)};if(obj[pre+"touchstart"+id]=cb,obj.addEventListener(this.POINTER_DOWN,cb,!1),!this._pointerDocumentListener){var internalCb=function(e){for(var i=0;i<pointers.length;i++)if(pointers[i].pointerId===e.pointerId){pointers.splice(i,1);break}};document.documentElement.addEventListener(this.POINTER_UP,internalCb,!1),document.documentElement.addEventListener(this.POINTER_CANCEL,internalCb,!1),this._pointerDocumentListener=!0}return this},addPointerListenerMove:function(obj,type,handler,id){function cb(e){if(e.pointerType!==e.MSPOINTER_TYPE_MOUSE&&"mouse"!==e.pointerType||0!==e.buttons){for(var i=0;i<touches.length;i++)if(touches[i].pointerId===e.pointerId){touches[i]=e;break}e.touches=touches.slice(),e.changedTouches=[e],handler(e)}}var pre="_leaflet_",touches=this._pointers;return obj[pre+"touchmove"+id]=cb,obj.addEventListener(this.POINTER_MOVE,cb,!1),this},addPointerListenerEnd:function(obj,type,handler,id){var pre="_leaflet_",touches=this._pointers,cb=function(e){for(var i=0;i<touches.length;i++)if(touches[i].pointerId===e.pointerId){touches.splice(i,1);break}e.touches=touches.slice(),e.changedTouches=[e],handler(e)};return obj[pre+"touchend"+id]=cb,obj.addEventListener(this.POINTER_UP,cb,!1),obj.addEventListener(this.POINTER_CANCEL,cb,!1),
this},removePointerListener:function(obj,type,id){var pre="_leaflet_",cb=obj[pre+type+id];switch(type){case"touchstart":obj.removeEventListener(this.POINTER_DOWN,cb,!1);break;case"touchmove":obj.removeEventListener(this.POINTER_MOVE,cb,!1);break;case"touchend":obj.removeEventListener(this.POINTER_UP,cb,!1),obj.removeEventListener(this.POINTER_CANCEL,cb,!1)}return this}}),L.Map.mergeOptions({touchZoom:L.Browser.touch&&!L.Browser.android23,bounceAtZoomLimits:!0}),L.Map.TouchZoom=L.Handler.extend({addHooks:function(){L.DomEvent.on(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){L.DomEvent.off(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(e){var map=this._map;if(e.touches&&2===e.touches.length&&!map._animatingZoom&&!this._zooming){var p1=map.mouseEventToLayerPoint(e.touches[0]),p2=map.mouseEventToLayerPoint(e.touches[1]),viewCenter=map._getCenterLayerPoint();this._startCenter=p1.add(p2)._divideBy(2),this._startDist=p1.distanceTo(p2),this._moved=!1,this._zooming=!0,this._centerOffset=viewCenter.subtract(this._startCenter),map._panAnim&&map._panAnim.stop(),L.DomEvent.on(document,"touchmove",this._onTouchMove,this).on(document,"touchend",this._onTouchEnd,this),L.DomEvent.preventDefault(e)}},_onTouchMove:function(e){var map=this._map;if(e.touches&&2===e.touches.length&&this._zooming){var p1=map.mouseEventToLayerPoint(e.touches[0]),p2=map.mouseEventToLayerPoint(e.touches[1]);this._scale=p1.distanceTo(p2)/this._startDist,this._delta=p1._add(p2)._divideBy(2)._subtract(this._startCenter),1!==this._scale&&(map.options.bounceAtZoomLimits||!(map.getZoom()===map.getMinZoom()&&this._scale<1||map.getZoom()===map.getMaxZoom()&&this._scale>1))&&(this._moved||(L.DomUtil.addClass(map._mapPane,"leaflet-touching"),map.fire("movestart").fire("zoomstart"),this._moved=!0),L.Util.cancelAnimFrame(this._animRequest),this._animRequest=L.Util.requestAnimFrame(this._updateOnMove,this,!0,this._map._container),L.DomEvent.preventDefault(e))}},_updateOnMove:function(){var map=this._map,origin=this._getScaleOrigin(),center=map.layerPointToLatLng(origin),zoom=map.getScaleZoom(this._scale);map._animateZoom(center,zoom,this._startCenter,this._scale,this._delta,!1,!0)},_onTouchEnd:function(){if(!this._moved||!this._zooming)return void(this._zooming=!1);var map=this._map;this._zooming=!1,L.DomUtil.removeClass(map._mapPane,"leaflet-touching"),L.Util.cancelAnimFrame(this._animRequest),L.DomEvent.off(document,"touchmove",this._onTouchMove).off(document,"touchend",this._onTouchEnd);var origin=this._getScaleOrigin(),center=map.layerPointToLatLng(origin),oldZoom=map.getZoom(),floatZoomDelta=map.getScaleZoom(this._scale)-oldZoom,roundZoomDelta=floatZoomDelta>0?Math.ceil(floatZoomDelta):Math.floor(floatZoomDelta),zoom=map._limitZoom(oldZoom+roundZoomDelta),scale=map.getZoomScale(zoom)/this._scale;map._animateZoom(center,zoom,origin,scale)},_getScaleOrigin:function(){var centerOffset=this._centerOffset.subtract(this._delta).divideBy(this._scale);return this._startCenter.add(centerOffset)}}),L.Map.addInitHook("addHandler","touchZoom",L.Map.TouchZoom),L.Map.mergeOptions({tap:!0,tapTolerance:15}),L.Map.Tap=L.Handler.extend({addHooks:function(){L.DomEvent.on(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){L.DomEvent.off(this._map._container,"touchstart",this._onDown,this)},_onDown:function(e){if(e.touches){if(L.DomEvent.preventDefault(e),this._fireClick=!0,e.touches.length>1)return this._fireClick=!1,void clearTimeout(this._holdTimeout);var first=e.touches[0],el=first.target;this._startPos=this._newPos=new L.Point(first.clientX,first.clientY),el.tagName&&"a"===el.tagName.toLowerCase()&&L.DomUtil.addClass(el,"leaflet-active"),this._holdTimeout=setTimeout(L.bind(function(){this._isTapValid()&&(this._fireClick=!1,this._onUp(),this._simulateEvent("contextmenu",first))},this),1e3),L.DomEvent.on(document,"touchmove",this._onMove,this).on(document,"touchend",this._onUp,this)}},_onUp:function(e){if(clearTimeout(this._holdTimeout),L.DomEvent.off(document,"touchmove",this._onMove,this).off(document,"touchend",this._onUp,this),this._fireClick&&e&&e.changedTouches){var first=e.changedTouches[0],el=first.target;el&&el.tagName&&"a"===el.tagName.toLowerCase()&&L.DomUtil.removeClass(el,"leaflet-active"),this._isTapValid()&&this._simulateEvent("click",first)}},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_onMove:function(e){var first=e.touches[0];this._newPos=new L.Point(first.clientX,first.clientY)},_simulateEvent:function(type,e){var simulatedEvent=document.createEvent("MouseEvents");simulatedEvent._simulated=!0,e.target._simulatedClick=!0,simulatedEvent.initMouseEvent(type,!0,!0,window,1,e.screenX,e.screenY,e.clientX,e.clientY,!1,!1,!1,!1,0,null),e.target.dispatchEvent(simulatedEvent)}}),L.Browser.touch&&!L.Browser.pointer&&L.Map.addInitHook("addHandler","tap",L.Map.Tap),L.Map.mergeOptions({boxZoom:!0}),L.Map.BoxZoom=L.Handler.extend({initialize:function(map){this._map=map,this._container=map._container,this._pane=map._panes.overlayPane,this._moved=!1},addHooks:function(){L.DomEvent.on(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){L.DomEvent.off(this._container,"mousedown",this._onMouseDown),this._moved=!1},moved:function(){return this._moved},_onMouseDown:function(e){return this._moved=!1,!e.shiftKey||1!==e.which&&1!==e.button?!1:(L.DomUtil.disableTextSelection(),L.DomUtil.disableImageDrag(),this._startLayerPoint=this._map.mouseEventToLayerPoint(e),void L.DomEvent.on(document,"mousemove",this._onMouseMove,this).on(document,"mouseup",this._onMouseUp,this).on(document,"keydown",this._onKeyDown,this))},_onMouseMove:function(e){this._moved||(this._box=L.DomUtil.create("div","leaflet-zoom-box",this._pane),L.DomUtil.setPosition(this._box,this._startLayerPoint),this._container.style.cursor="crosshair",this._map.fire("boxzoomstart"));var startPoint=this._startLayerPoint,box=this._box,layerPoint=this._map.mouseEventToLayerPoint(e),offset=layerPoint.subtract(startPoint),newPos=new L.Point(Math.min(layerPoint.x,startPoint.x),Math.min(layerPoint.y,startPoint.y));L.DomUtil.setPosition(box,newPos),this._moved=!0,box.style.width=Math.max(0,Math.abs(offset.x)-4)+"px",box.style.height=Math.max(0,Math.abs(offset.y)-4)+"px"},_finish:function(){this._moved&&(this._pane.removeChild(this._box),this._container.style.cursor=""),L.DomUtil.enableTextSelection(),L.DomUtil.enableImageDrag(),L.DomEvent.off(document,"mousemove",this._onMouseMove).off(document,"mouseup",this._onMouseUp).off(document,"keydown",this._onKeyDown)},_onMouseUp:function(e){this._finish();var map=this._map,layerPoint=map.mouseEventToLayerPoint(e);if(!this._startLayerPoint.equals(layerPoint)){var bounds=new L.LatLngBounds(map.layerPointToLatLng(this._startLayerPoint),map.layerPointToLatLng(layerPoint));map.fitBounds(bounds),map.fire("boxzoomend",{boxZoomBounds:bounds})}},_onKeyDown:function(e){27===e.keyCode&&this._finish()}}),L.Map.addInitHook("addHandler","boxZoom",L.Map.BoxZoom),L.Map.mergeOptions({keyboard:!0,keyboardPanOffset:80,keyboardZoomOffset:1}),L.Map.Keyboard=L.Handler.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,173]},initialize:function(map){this._map=map,this._setPanOffset(map.options.keyboardPanOffset),this._setZoomOffset(map.options.keyboardZoomOffset)},addHooks:function(){var container=this._map._container;-1===container.tabIndex&&(container.tabIndex="0"),L.DomEvent.on(container,"focus",this._onFocus,this).on(container,"blur",this._onBlur,this).on(container,"mousedown",this._onMouseDown,this),this._map.on("focus",this._addHooks,this).on("blur",this._removeHooks,this)},removeHooks:function(){this._removeHooks();var container=this._map._container;L.DomEvent.off(container,"focus",this._onFocus,this).off(container,"blur",this._onBlur,this).off(container,"mousedown",this._onMouseDown,this),this._map.off("focus",this._addHooks,this).off("blur",this._removeHooks,this)},_onMouseDown:function(){if(!this._focused){var body=document.body,docEl=document.documentElement,top=body.scrollTop||docEl.scrollTop,left=body.scrollLeft||docEl.scrollLeft;this._map._container.focus(),window.scrollTo(left,top)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanOffset:function(pan){var i,len,keys=this._panKeys={},codes=this.keyCodes;for(i=0,len=codes.left.length;len>i;i++)keys[codes.left[i]]=[-1*pan,0];for(i=0,len=codes.right.length;len>i;i++)keys[codes.right[i]]=[pan,0];for(i=0,len=codes.down.length;len>i;i++)keys[codes.down[i]]=[0,pan];for(i=0,len=codes.up.length;len>i;i++)keys[codes.up[i]]=[0,-1*pan]},_setZoomOffset:function(zoom){var i,len,keys=this._zoomKeys={},codes=this.keyCodes;for(i=0,len=codes.zoomIn.length;len>i;i++)keys[codes.zoomIn[i]]=zoom;for(i=0,len=codes.zoomOut.length;len>i;i++)keys[codes.zoomOut[i]]=-zoom},_addHooks:function(){L.DomEvent.on(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){L.DomEvent.off(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(e){var key=e.keyCode,map=this._map;if(key in this._panKeys){if(map._panAnim&&map._panAnim._inProgress)return;map.panBy(this._panKeys[key]),map.options.maxBounds&&map.panInsideBounds(map.options.maxBounds)}else{if(!(key in this._zoomKeys))return;map.setZoom(map.getZoom()+this._zoomKeys[key])}L.DomEvent.stop(e)}}),L.Map.addInitHook("addHandler","keyboard",L.Map.Keyboard),L.Handler.MarkerDrag=L.Handler.extend({initialize:function(marker){this._marker=marker},addHooks:function(){var icon=this._marker._icon;this._draggable||(this._draggable=new L.Draggable(icon,icon)),this._draggable.on("dragstart",this._onDragStart,this).on("drag",this._onDrag,this).on("dragend",this._onDragEnd,this),this._draggable.enable(),L.DomUtil.addClass(this._marker._icon,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off("dragstart",this._onDragStart,this).off("drag",this._onDrag,this).off("dragend",this._onDragEnd,this),this._draggable.disable(),L.DomUtil.removeClass(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_onDragStart:function(){this._marker.closePopup().fire("movestart").fire("dragstart")},_onDrag:function(){var marker=this._marker,shadow=marker._shadow,iconPos=L.DomUtil.getPosition(marker._icon),latlng=marker._map.layerPointToLatLng(iconPos);shadow&&L.DomUtil.setPosition(shadow,iconPos),marker._latlng=latlng,marker.fire("move",{latlng:latlng}).fire("drag")},_onDragEnd:function(e){this._marker.fire("moveend").fire("dragend",e)}}),L.Control=L.Class.extend({options:{position:"topright"},initialize:function(options){L.setOptions(this,options)},getPosition:function(){return this.options.position},setPosition:function(position){var map=this._map;return map&&map.removeControl(this),this.options.position=position,map&&map.addControl(this),this},getContainer:function(){return this._container},addTo:function(map){this._map=map;var container=this._container=this.onAdd(map),pos=this.getPosition(),corner=map._controlCorners[pos];return L.DomUtil.addClass(container,"leaflet-control"),-1!==pos.indexOf("bottom")?corner.insertBefore(container,corner.firstChild):corner.appendChild(container),this},removeFrom:function(map){var pos=this.getPosition(),corner=map._controlCorners[pos];return corner.removeChild(this._container),this._map=null,this.onRemove&&this.onRemove(map),this},_refocusOnMap:function(){this._map&&this._map.getContainer().focus()}}),L.control=function(options){return new L.Control(options)},L.Map.include({addControl:function(control){return control.addTo(this),this},removeControl:function(control){return control.removeFrom(this),this},_initControlPos:function(){function createCorner(vSide,hSide){var className=l+vSide+" "+l+hSide;corners[vSide+hSide]=L.DomUtil.create("div",className,container)}var corners=this._controlCorners={},l="leaflet-",container=this._controlContainer=L.DomUtil.create("div",l+"control-container",this._container);createCorner("top","left"),createCorner("top","right"),createCorner("bottom","left"),createCorner("bottom","right")},_clearControlPos:function(){this._container.removeChild(this._controlContainer)}}),L.Control.Zoom=L.Control.extend({options:{position:"topleft",zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"-",zoomOutTitle:"Zoom out"},onAdd:function(map){var zoomName="leaflet-control-zoom",container=L.DomUtil.create("div",zoomName+" leaflet-bar");return this._map=map,this._zoomInButton=this._createButton(this.options.zoomInText,this.options.zoomInTitle,zoomName+"-in",container,this._zoomIn,this),this._zoomOutButton=this._createButton(this.options.zoomOutText,this.options.zoomOutTitle,zoomName+"-out",container,this._zoomOut,this),this._updateDisabled(),map.on("zoomend zoomlevelschange",this._updateDisabled,this),container},onRemove:function(map){map.off("zoomend zoomlevelschange",this._updateDisabled,this)},_zoomIn:function(e){this._map.zoomIn(e.shiftKey?3:1)},_zoomOut:function(e){this._map.zoomOut(e.shiftKey?3:1)},_createButton:function(html,title,className,container,fn,context){var link=L.DomUtil.create("a",className,container);link.innerHTML=html,link.href="#",link.title=title;var stop=L.DomEvent.stopPropagation;return L.DomEvent.on(link,"click",stop).on(link,"mousedown",stop).on(link,"dblclick",stop).on(link,"click",L.DomEvent.preventDefault).on(link,"click",fn,context).on(link,"click",this._refocusOnMap,context),link},_updateDisabled:function(){var map=this._map,className="leaflet-disabled";L.DomUtil.removeClass(this._zoomInButton,className),L.DomUtil.removeClass(this._zoomOutButton,className),map._zoom===map.getMinZoom()&&L.DomUtil.addClass(this._zoomOutButton,className),map._zoom===map.getMaxZoom()&&L.DomUtil.addClass(this._zoomInButton,className)}}),L.Map.mergeOptions({zoomControl:!0}),L.Map.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new L.Control.Zoom,this.addControl(this.zoomControl))}),L.control.zoom=function(options){return new L.Control.Zoom(options)},L.Control.Attribution=L.Control.extend({options:{position:"bottomright",prefix:'<a href="http://leafletjs.com" title="A JS library for interactive maps">Leaflet</a>'},initialize:function(options){L.setOptions(this,options),this._attributions={}},onAdd:function(map){this._container=L.DomUtil.create("div","leaflet-control-attribution"),L.DomEvent.disableClickPropagation(this._container);for(var i in map._layers)map._layers[i].getAttribution&&this.addAttribution(map._layers[i].getAttribution());return map.on("layeradd",this._onLayerAdd,this).on("layerremove",this._onLayerRemove,this),this._update(),this._container},onRemove:function(map){map.off("layeradd",this._onLayerAdd).off("layerremove",this._onLayerRemove)},setPrefix:function(prefix){return this.options.prefix=prefix,this._update(),this},addAttribution:function(text){return text?(this._attributions[text]||(this._attributions[text]=0),this._attributions[text]++,this._update(),this):void 0},removeAttribution:function(text){return text?(this._attributions[text]&&(this._attributions[text]--,this._update()),this):void 0},_update:function(){if(this._map){var attribs=[];for(var i in this._attributions)this._attributions[i]&&attribs.push(i);var prefixAndAttribs=[];this.options.prefix&&prefixAndAttribs.push(this.options.prefix),attribs.length&&prefixAndAttribs.push(attribs.join(", ")),this._container.innerHTML=prefixAndAttribs.join(" | ")}},_onLayerAdd:function(e){e.layer.getAttribution&&this.addAttribution(e.layer.getAttribution())},_onLayerRemove:function(e){e.layer.getAttribution&&this.removeAttribution(e.layer.getAttribution())}}),L.Map.mergeOptions({attributionControl:!0}),L.Map.addInitHook(function(){this.options.attributionControl&&(this.attributionControl=(new L.Control.Attribution).addTo(this))}),L.control.attribution=function(options){return new L.Control.Attribution(options)},L.Control.Scale=L.Control.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0,updateWhenIdle:!1},onAdd:function(map){this._map=map;var className="leaflet-control-scale",container=L.DomUtil.create("div",className),options=this.options;return this._addScales(options,className,container),map.on(options.updateWhenIdle?"moveend":"move",this._update,this),map.whenReady(this._update,this),container},onRemove:function(map){map.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(options,className,container){options.metric&&(this._mScale=L.DomUtil.create("div",className+"-line",container)),options.imperial&&(this._iScale=L.DomUtil.create("div",className+"-line",container))},_update:function(){var bounds=this._map.getBounds(),centerLat=bounds.getCenter().lat,halfWorldMeters=6378137*Math.PI*Math.cos(centerLat*Math.PI/180),dist=halfWorldMeters*(bounds.getNorthEast().lng-bounds.getSouthWest().lng)/180,size=this._map.getSize(),options=this.options,maxMeters=0;size.x>0&&(maxMeters=dist*(options.maxWidth/size.x)),this._updateScales(options,maxMeters)},_updateScales:function(options,maxMeters){options.metric&&maxMeters&&this._updateMetric(maxMeters),options.imperial&&maxMeters&&this._updateImperial(maxMeters)},_updateMetric:function(maxMeters){var meters=this._getRoundNum(maxMeters);this._mScale.style.width=this._getScaleWidth(meters/maxMeters)+"px",this._mScale.innerHTML=1e3>meters?meters+" m":meters/1e3+" km"},_updateImperial:function(maxMeters){var maxMiles,miles,feet,maxFeet=3.2808399*maxMeters,scale=this._iScale;maxFeet>5280?(maxMiles=maxFeet/5280,miles=this._getRoundNum(maxMiles),scale.style.width=this._getScaleWidth(miles/maxMiles)+"px",scale.innerHTML=miles+" mi"):(feet=this._getRoundNum(maxFeet),scale.style.width=this._getScaleWidth(feet/maxFeet)+"px",scale.innerHTML=feet+" ft")},_getScaleWidth:function(ratio){return Math.round(this.options.maxWidth*ratio)-10},_getRoundNum:function(num){var pow10=Math.pow(10,(Math.floor(num)+"").length-1),d=num/pow10;return d=d>=10?10:d>=5?5:d>=3?3:d>=2?2:1,pow10*d}}),L.control.scale=function(options){return new L.Control.Scale(options)},L.Control.Layers=L.Control.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0},initialize:function(baseLayers,overlays,options){L.setOptions(this,options),this._layers={},this._lastZIndex=0,this._handlingClick=!1;for(var i in baseLayers)this._addLayer(baseLayers[i],i);for(i in overlays)this._addLayer(overlays[i],i,!0)},onAdd:function(map){return this._initLayout(),this._update(),map.on("layeradd",this._onLayerChange,this).on("layerremove",this._onLayerChange,this),this._container},onRemove:function(map){map.off("layeradd",this._onLayerChange,this).off("layerremove",this._onLayerChange,this)},addBaseLayer:function(layer,name){return this._addLayer(layer,name),this._update(),this},addOverlay:function(layer,name){return this._addLayer(layer,name,!0),this._update(),this},removeLayer:function(layer){var id=L.stamp(layer);return delete this._layers[id],this._update(),this},_initLayout:function(){var className="leaflet-control-layers",container=this._container=L.DomUtil.create("div",className);container.setAttribute("aria-haspopup",!0),L.Browser.touch?L.DomEvent.on(container,"click",L.DomEvent.stopPropagation):L.DomEvent.disableClickPropagation(container).disableScrollPropagation(container);var form=this._form=L.DomUtil.create("form",className+"-list");if(this.options.collapsed){L.Browser.android||L.DomEvent.on(container,"mouseover",this._expand,this).on(container,"mouseout",this._collapse,this);var link=this._layersLink=L.DomUtil.create("a",className+"-toggle",container);link.href="#",link.title="Layers",L.Browser.touch?L.DomEvent.on(link,"click",L.DomEvent.stop).on(link,"click",this._expand,this):L.DomEvent.on(link,"focus",this._expand,this),L.DomEvent.on(form,"click",function(){setTimeout(L.bind(this._onInputClick,this),0)},this),this._map.on("click",this._collapse,this)}else this._expand();this._baseLayersList=L.DomUtil.create("div",className+"-base",form),this._separator=L.DomUtil.create("div",className+"-separator",form),this._overlaysList=L.DomUtil.create("div",className+"-overlays",form),container.appendChild(form)},_addLayer:function(layer,name,overlay){var id=L.stamp(layer);this._layers[id]={layer:layer,name:name,overlay:overlay},this.options.autoZIndex&&layer.setZIndex&&(this._lastZIndex++,layer.setZIndex(this._lastZIndex))},_update:function(){if(this._container){this._baseLayersList.innerHTML="",this._overlaysList.innerHTML="";var i,obj,baseLayersPresent=!1,overlaysPresent=!1;for(i in this._layers)obj=this._layers[i],this._addItem(obj),overlaysPresent=overlaysPresent||obj.overlay,baseLayersPresent=baseLayersPresent||!obj.overlay;this._separator.style.display=overlaysPresent&&baseLayersPresent?"":"none"}},_onLayerChange:function(e){var obj=this._layers[L.stamp(e.layer)];if(obj){this._handlingClick||this._update();var type=obj.overlay?"layeradd"===e.type?"overlayadd":"overlayremove":"layeradd"===e.type?"baselayerchange":null;type&&this._map.fire(type,obj)}},_createRadioElement:function(name,checked){var radioHtml='<input type="radio" class="leaflet-control-layers-selector" name="'+name+'"';checked&&(radioHtml+=' checked="checked"'),radioHtml+="/>";var radioFragment=document.createElement("div");return radioFragment.innerHTML=radioHtml,radioFragment.firstChild},_addItem:function(obj){var input,label=document.createElement("label"),checked=this._map.hasLayer(obj.layer);obj.overlay?(input=document.createElement("input"),input.type="checkbox",input.className="leaflet-control-layers-selector",input.defaultChecked=checked):input=this._createRadioElement("leaflet-base-layers",checked),input.layerId=L.stamp(obj.layer),L.DomEvent.on(input,"click",this._onInputClick,this);var name=document.createElement("span");name.innerHTML=" "+obj.name,label.appendChild(input),label.appendChild(name);var container=obj.overlay?this._overlaysList:this._baseLayersList;return container.appendChild(label),label},_onInputClick:function(){var i,input,obj,inputs=this._form.getElementsByTagName("input"),inputsLen=inputs.length;for(this._handlingClick=!0,i=0;inputsLen>i;i++)input=inputs[i],obj=this._layers[input.layerId],input.checked&&!this._map.hasLayer(obj.layer)?this._map.addLayer(obj.layer):!input.checked&&this._map.hasLayer(obj.layer)&&this._map.removeLayer(obj.layer);this._handlingClick=!1,this._refocusOnMap()},_expand:function(){L.DomUtil.addClass(this._container,"leaflet-control-layers-expanded")},_collapse:function(){this._container.className=this._container.className.replace(" leaflet-control-layers-expanded","")}}),L.control.layers=function(baseLayers,overlays,options){return new L.Control.Layers(baseLayers,overlays,options)},L.PosAnimation=L.Class.extend({includes:L.Mixin.Events,run:function(el,newPos,duration,easeLinearity){this.stop(),this._el=el,this._inProgress=!0,this._newPos=newPos,this.fire("start"),el.style[L.DomUtil.TRANSITION]="all "+(duration||.25)+"s cubic-bezier(0,0,"+(easeLinearity||.5)+",1)",L.DomEvent.on(el,L.DomUtil.TRANSITION_END,this._onTransitionEnd,this),L.DomUtil.setPosition(el,newPos),L.Util.falseFn(el.offsetWidth),this._stepTimer=setInterval(L.bind(this._onStep,this),50)},stop:function(){this._inProgress&&(L.DomUtil.setPosition(this._el,this._getPos()),this._onTransitionEnd(),L.Util.falseFn(this._el.offsetWidth))},_onStep:function(){var stepPos=this._getPos();return stepPos?(this._el._leaflet_pos=stepPos,void this.fire("step")):void this._onTransitionEnd()},_transformRe:/([-+]?(?:\d*\.)?\d+)\D*, ([-+]?(?:\d*\.)?\d+)\D*\)/,_getPos:function(){var left,top,matches,el=this._el,style=window.getComputedStyle(el);if(L.Browser.any3d){if(matches=style[L.DomUtil.TRANSFORM].match(this._transformRe),!matches)return;left=parseFloat(matches[1]),top=parseFloat(matches[2])}else left=parseFloat(style.left),top=parseFloat(style.top);return new L.Point(left,top,!0)},_onTransitionEnd:function(){L.DomEvent.off(this._el,L.DomUtil.TRANSITION_END,this._onTransitionEnd,this),this._inProgress&&(this._inProgress=!1,this._el.style[L.DomUtil.TRANSITION]="",this._el._leaflet_pos=this._newPos,clearInterval(this._stepTimer),this.fire("step").fire("end"))}}),L.Map.include({setView:function(center,zoom,options){if(zoom=zoom===undefined?this._zoom:this._limitZoom(zoom),center=this._limitCenter(L.latLng(center),zoom,this.options.maxBounds),options=options||{},this._panAnim&&this._panAnim.stop(),this._loaded&&!options.reset&&options!==!0){options.animate!==undefined&&(options.zoom=L.extend({animate:options.animate},options.zoom),options.pan=L.extend({animate:options.animate},options.pan));var animated=this._zoom!==zoom?this._tryAnimatedZoom&&this._tryAnimatedZoom(center,zoom,options.zoom):this._tryAnimatedPan(center,options.pan);if(animated)return clearTimeout(this._sizeTimer),this}return this._resetView(center,zoom),this},panBy:function(offset,options){if(offset=L.point(offset).round(),options=options||{},!offset.x&&!offset.y)return this;if(this._panAnim||(this._panAnim=new L.PosAnimation,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),options.noMoveStart||this.fire("movestart"),options.animate!==!1){L.DomUtil.addClass(this._mapPane,"leaflet-pan-anim");var newPos=this._getMapPanePos().subtract(offset);this._panAnim.run(this._mapPane,newPos,options.duration||.25,options.easeLinearity)}else this._rawPanBy(offset),this.fire("move").fire("moveend");return this},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){L.DomUtil.removeClass(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(center,options){var offset=this._getCenterOffset(center)._floor();return(options&&options.animate)===!0||this.getSize().contains(offset)?(this.panBy(offset,options),!0):!1}}),L.PosAnimation=L.DomUtil.TRANSITION?L.PosAnimation:L.PosAnimation.extend({run:function(el,newPos,duration,easeLinearity){this.stop(),this._el=el,this._inProgress=!0,this._duration=duration||.25,this._easeOutPower=1/Math.max(easeLinearity||.5,.2),this._startPos=L.DomUtil.getPosition(el),this._offset=newPos.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(),this._complete())},_animate:function(){this._animId=L.Util.requestAnimFrame(this._animate,this),this._step()},_step:function(){var elapsed=+new Date-this._startTime,duration=1e3*this._duration;duration>elapsed?this._runFrame(this._easeOut(elapsed/duration)):(this._runFrame(1),this._complete())},_runFrame:function(progress){var pos=this._startPos.add(this._offset.multiplyBy(progress));L.DomUtil.setPosition(this._el,pos),this.fire("step")},_complete:function(){L.Util.cancelAnimFrame(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(t){return 1-Math.pow(1-t,this._easeOutPower)}}),L.Map.mergeOptions({zoomAnimation:!0,zoomAnimationThreshold:4}),L.DomUtil.TRANSITION&&L.Map.addInitHook(function(){this._zoomAnimated=this.options.zoomAnimation&&L.DomUtil.TRANSITION&&L.Browser.any3d&&!L.Browser.android23&&!L.Browser.mobileOpera,this._zoomAnimated&&L.DomEvent.on(this._mapPane,L.DomUtil.TRANSITION_END,this._catchTransitionEnd,this)}),L.Map.include(L.DomUtil.TRANSITION?{_catchTransitionEnd:function(e){this._animatingZoom&&e.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(center,zoom,options){if(this._animatingZoom)return!0;if(options=options||{},!this._zoomAnimated||options.animate===!1||this._nothingToAnimate()||Math.abs(zoom-this._zoom)>this.options.zoomAnimationThreshold)return!1;var scale=this.getZoomScale(zoom),offset=this._getCenterOffset(center)._divideBy(1-1/scale),origin=this._getCenterLayerPoint()._add(offset);return options.animate===!0||this.getSize().contains(offset)?(this.fire("movestart").fire("zoomstart"),this._animateZoom(center,zoom,origin,scale,null,!0),!0):!1},_animateZoom:function(center,zoom,origin,scale,delta,backwards,forTouchZoom){forTouchZoom||(this._animatingZoom=!0),L.DomUtil.addClass(this._mapPane,"leaflet-zoom-anim"),this._animateToCenter=center,this._animateToZoom=zoom,L.Draggable&&(L.Draggable._disabled=!0),L.Util.requestAnimFrame(function(){this.fire("zoomanim",{center:center,zoom:zoom,origin:origin,scale:scale,delta:delta,backwards:backwards}),setTimeout(L.bind(this._onZoomTransitionEnd,this),250)},this)},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._animatingZoom=!1,L.DomUtil.removeClass(this._mapPane,"leaflet-zoom-anim"),this._resetView(this._animateToCenter,this._animateToZoom,!0,!0),L.Draggable&&(L.Draggable._disabled=!1))}}:{}),L.TileLayer.include({_animateZoom:function(e){this._animating||(this._animating=!0,this._prepareBgBuffer());var bg=this._bgBuffer,transform=L.DomUtil.TRANSFORM,initialTransform=e.delta?L.DomUtil.getTranslateString(e.delta):bg.style[transform],scaleStr=L.DomUtil.getScaleString(e.scale,e.origin);bg.style[transform]=e.backwards?scaleStr+" "+initialTransform:initialTransform+" "+scaleStr},_endZoomAnim:function(){var front=this._tileContainer,bg=this._bgBuffer;front.style.visibility="",front.parentNode.appendChild(front),L.Util.falseFn(bg.offsetWidth);var zoom=this._map.getZoom();(zoom>this.options.maxZoom||zoom<this.options.minZoom)&&this._clearBgBuffer(),this._animating=!1},_clearBgBuffer:function(){var map=this._map;!map||map._animatingZoom||map.touchZoom._zooming||(this._bgBuffer.innerHTML="",this._bgBuffer.style[L.DomUtil.TRANSFORM]="")},_prepareBgBuffer:function(){var front=this._tileContainer,bg=this._bgBuffer,bgLoaded=this._getLoadedTilesPercentage(bg),frontLoaded=this._getLoadedTilesPercentage(front);return bg&&bgLoaded>.5&&.5>frontLoaded?(front.style.visibility="hidden",void this._stopLoadingImages(front)):(bg.style.visibility="hidden",bg.style[L.DomUtil.TRANSFORM]="",this._tileContainer=bg,bg=this._bgBuffer=front,this._stopLoadingImages(bg),void clearTimeout(this._clearBgBufferTimer))},_getLoadedTilesPercentage:function(container){var i,len,tiles=container.getElementsByTagName("img"),count=0;for(i=0,len=tiles.length;len>i;i++)tiles[i].complete&&count++;return count/len},_stopLoadingImages:function(container){var i,len,tile,tiles=Array.prototype.slice.call(container.getElementsByTagName("img"));for(i=0,len=tiles.length;len>i;i++)tile=tiles[i],tile.complete||(tile.onload=L.Util.falseFn,tile.onerror=L.Util.falseFn,tile.src=L.Util.emptyImageUrl,tile.parentNode.removeChild(tile))}}),L.Map.include({_defaultLocateOptions:{watch:!1,setView:!1,maxZoom:1/0,timeout:1e4,maximumAge:0,enableHighAccuracy:!1},locate:function(options){if(options=this._locateOptions=L.extend(this._defaultLocateOptions,options),!navigator.geolocation)return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var onResponse=L.bind(this._handleGeolocationResponse,this),onError=L.bind(this._handleGeolocationError,this);return options.watch?this._locationWatchId=navigator.geolocation.watchPosition(onResponse,onError,options):navigator.geolocation.getCurrentPosition(onResponse,onError,options),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(error){var c=error.code,message=error.message||(1===c?"permission denied":2===c?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:c,message:"Geolocation error: "+message+"."})},_handleGeolocationResponse:function(pos){var lat=pos.coords.latitude,lng=pos.coords.longitude,latlng=new L.LatLng(lat,lng),latAccuracy=180*pos.coords.accuracy/40075017,lngAccuracy=latAccuracy/Math.cos(L.LatLng.DEG_TO_RAD*lat),bounds=L.latLngBounds([lat-latAccuracy,lng-lngAccuracy],[lat+latAccuracy,lng+lngAccuracy]),options=this._locateOptions;if(options.setView){
var zoom=Math.min(this.getBoundsZoom(bounds),options.maxZoom);this.setView(latlng,zoom)}var data={latlng:latlng,bounds:bounds,timestamp:pos.timestamp};for(var i in pos.coords)"number"==typeof pos.coords[i]&&(data[i]=pos.coords[i]);this.fire("locationfound",data)}})}(window,document),function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){function corslite(url,callback,cors){function isSuccessful(status){return status>=200&&300>status||304===status}function loaded(){void 0===x.status||isSuccessful(x.status)?callback.call(x,null,x):callback.call(x,x,null)}var sent=!1;if("undefined"==typeof window.XMLHttpRequest)return callback(Error("Browser not supported"));if("undefined"==typeof cors){var m=url.match(/^\s*https?:\/\/[^\/]*/);cors=m&&m[0]!==location.protocol+"//"+location.domain+(location.port?":"+location.port:"")}var x=new window.XMLHttpRequest;if(cors&&!("withCredentials"in x)){x=new window.XDomainRequest;var original=callback;callback=function(){if(sent)original.apply(this,arguments);else{var that=this,args=arguments;setTimeout(function(){original.apply(that,args)},0)}}}return"onload"in x?x.onload=loaded:x.onreadystatechange=function(){4===x.readyState&&loaded()},x.onerror=function(evt){callback.call(this,evt||!0,null),callback=function(){}},x.onprogress=function(){},x.ontimeout=function(evt){callback.call(this,evt,null),callback=function(){}},x.onabort=function(evt){callback.call(this,evt,null),callback=function(){}},x.open("GET",url,!0),x.send(null),sent=!0,x}"undefined"!=typeof module&&(module.exports=corslite)},{}],2:[function(require,module,exports){module.exports=Array.isArray||function(arr){return"[object Array]"==Object.prototype.toString.call(arr)}},{}],3:[function(require,module,exports){!function(root,factory){if("object"==typeof exports&&exports)factory(exports);else{var mustache={};factory(mustache),"function"==typeof define&&define.amd?define(mustache):root.Mustache=mustache}}(this,function(mustache){function testRegExp(re,string){return RegExp_test.call(re,string)}function isWhitespace(string){return!testRegExp(nonSpaceRe,string)}function isFunction(object){return"function"==typeof object}function escapeRegExp(string){return string.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function escapeHtml(string){return String(string).replace(/[&<>"'\/]/g,function(s){return entityMap[s]})}function Scanner(string){this.string=string,this.tail=string,this.pos=0}function Context(view,parent){this.view=null==view?{}:view,this.parent=parent,this._cache={".":this.view}}function Writer(){this.clearCache()}function renderTokens(tokens,writer,context,template){function subRender(template){return writer.render(template,context)}for(var token,tokenValue,value,buffer="",i=0,len=tokens.length;len>i;++i)switch(token=tokens[i],tokenValue=token[1],token[0]){case"#":if(value=context.lookup(tokenValue),"object"==typeof value||"string"==typeof value)if(isArray(value))for(var j=0,jlen=value.length;jlen>j;++j)buffer+=renderTokens(token[4],writer,context.push(value[j]),template);else value&&(buffer+=renderTokens(token[4],writer,context.push(value),template));else if(isFunction(value)){var text=null==template?null:template.slice(token[3],token[5]);value=value.call(context.view,text,subRender),null!=value&&(buffer+=value)}else value&&(buffer+=renderTokens(token[4],writer,context,template));break;case"^":value=context.lookup(tokenValue),(!value||isArray(value)&&0===value.length)&&(buffer+=renderTokens(token[4],writer,context,template));break;case">":value=writer.getPartial(tokenValue),isFunction(value)&&(buffer+=value(context));break;case"&":value=context.lookup(tokenValue),null!=value&&(buffer+=value);break;case"name":value=context.lookup(tokenValue),null!=value&&(buffer+=mustache.escape(value));break;case"text":buffer+=tokenValue}return buffer}function nestTokens(tokens){for(var token,tree=[],collector=tree,sections=[],i=0,len=tokens.length;len>i;++i)switch(token=tokens[i],token[0]){case"#":case"^":sections.push(token),collector.push(token),collector=token[4]=[];break;case"/":var section=sections.pop();section[5]=token[2],collector=sections.length>0?sections[sections.length-1][4]:tree;break;default:collector.push(token)}return tree}function squashTokens(tokens){for(var token,lastToken,squashedTokens=[],i=0,len=tokens.length;len>i;++i)token=tokens[i],token&&("text"===token[0]&&lastToken&&"text"===lastToken[0]?(lastToken[1]+=token[1],lastToken[3]=token[3]):(lastToken=token,squashedTokens.push(token)));return squashedTokens}function escapeTags(tags){return[new RegExp(escapeRegExp(tags[0])+"\\s*"),new RegExp("\\s*"+escapeRegExp(tags[1]))]}function parseTemplate(template,tags){function stripSpace(){if(hasTag&&!nonSpace)for(;spaces.length;)delete tokens[spaces.pop()];else spaces=[];hasTag=!1,nonSpace=!1}if(template=template||"",tags=tags||mustache.tags,"string"==typeof tags&&(tags=tags.split(spaceRe)),2!==tags.length)throw new Error("Invalid tags: "+tags.join(", "));for(var start,type,value,chr,token,openSection,tagRes=escapeTags(tags),scanner=new Scanner(template),sections=[],tokens=[],spaces=[],hasTag=!1,nonSpace=!1;!scanner.eos();){if(start=scanner.pos,value=scanner.scanUntil(tagRes[0]))for(var i=0,len=value.length;len>i;++i)chr=value.charAt(i),isWhitespace(chr)?spaces.push(tokens.length):nonSpace=!0,tokens.push(["text",chr,start,start+1]),start+=1,"\n"==chr&&stripSpace();if(!scanner.scan(tagRes[0]))break;if(hasTag=!0,type=scanner.scan(tagRe)||"name",scanner.scan(whiteRe),"="===type?(value=scanner.scanUntil(eqRe),scanner.scan(eqRe),scanner.scanUntil(tagRes[1])):"{"===type?(value=scanner.scanUntil(new RegExp("\\s*"+escapeRegExp("}"+tags[1]))),scanner.scan(curlyRe),scanner.scanUntil(tagRes[1]),type="&"):value=scanner.scanUntil(tagRes[1]),!scanner.scan(tagRes[1]))throw new Error("Unclosed tag at "+scanner.pos);if(token=[type,value,start,scanner.pos],tokens.push(token),"#"===type||"^"===type)sections.push(token);else if("/"===type){if(openSection=sections.pop(),!openSection)throw new Error('Unopened section "'+value+'" at '+start);if(openSection[1]!==value)throw new Error('Unclosed section "'+openSection[1]+'" at '+start)}else if("name"===type||"{"===type||"&"===type)nonSpace=!0;else if("="===type){if(tags=value.split(spaceRe),2!==tags.length)throw new Error("Invalid tags at "+start+": "+tags.join(", "));tagRes=escapeTags(tags)}}if(openSection=sections.pop())throw new Error('Unclosed section "'+openSection[1]+'" at '+scanner.pos);return nestTokens(squashTokens(tokens))}var whiteRe=/\s*/,spaceRe=/\s+/,nonSpaceRe=/\S/,eqRe=/\s*=/,curlyRe=/\s*\}/,tagRe=/#|\^|\/|>|\{|&|=|!/,RegExp_test=RegExp.prototype.test,Object_toString=Object.prototype.toString,isArray=Array.isArray||function(object){return"[object Array]"===Object_toString.call(object)},entityMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};Scanner.prototype.eos=function(){return""===this.tail},Scanner.prototype.scan=function(re){var match=this.tail.match(re);if(match&&0===match.index){var string=match[0];return this.tail=this.tail.substring(string.length),this.pos+=string.length,string}return""},Scanner.prototype.scanUntil=function(re){var match,index=this.tail.search(re);switch(index){case-1:match=this.tail,this.tail="";break;case 0:match="";break;default:match=this.tail.substring(0,index),this.tail=this.tail.substring(index)}return this.pos+=match.length,match},Context.make=function(view){return view instanceof Context?view:new Context(view)},Context.prototype.push=function(view){return new Context(view,this)},Context.prototype.lookup=function(name){var value;if(name in this._cache)value=this._cache[name];else{for(var context=this;context;){if(name.indexOf(".")>0){value=context.view;for(var names=name.split("."),i=0;null!=value&&i<names.length;)value=value[names[i++]]}else value=context.view[name];if(null!=value)break;context=context.parent}this._cache[name]=value}return isFunction(value)&&(value=value.call(this.view)),value},Writer.prototype.clearCache=function(){this._cache={},this._partialCache={}},Writer.prototype.compile=function(template,tags){var fn=this._cache[template];if(!fn){var tokens=mustache.parse(template,tags);fn=this._cache[template]=this.compileTokens(tokens,template)}return fn},Writer.prototype.compilePartial=function(name,template,tags){var fn=this.compile(template,tags);return this._partialCache[name]=fn,fn},Writer.prototype.getPartial=function(name){return name in this._partialCache||!this._loadPartial||this.compilePartial(name,this._loadPartial(name)),this._partialCache[name]},Writer.prototype.compileTokens=function(tokens,template){var self=this;return function(view,partials){if(partials)if(isFunction(partials))self._loadPartial=partials;else for(var name in partials)self.compilePartial(name,partials[name]);return renderTokens(tokens,self,Context.make(view),template)}},Writer.prototype.render=function(template,view,partials){return this.compile(template)(view,partials)},mustache.name="mustache.js",mustache.version="0.7.3",mustache.tags=["{{","}}"],mustache.Scanner=Scanner,mustache.Context=Context,mustache.Writer=Writer,mustache.parse=parseTemplate,mustache.escape=escapeHtml;var defaultWriter=new Writer;mustache.clearCache=function(){return defaultWriter.clearCache()},mustache.compile=function(template,tags){return defaultWriter.compile(template,tags)},mustache.compilePartial=function(name,template,tags){return defaultWriter.compilePartial(name,template,tags)},mustache.compileTokens=function(tokens,template){return defaultWriter.compileTokens(tokens,template)},mustache.render=function(template,view,partials){return defaultWriter.render(template,view,partials)},mustache.to_html=function(template,view,partials,send){var result=mustache.render(template,view,partials);return isFunction(send)?void send(result):result}})},{}],4:[function(require,module,exports){function cleanUrl(url){"use strict";return/^https?/.test(url.getScheme())?url.toString():/^mailto?/.test(url.getScheme())?url.toString():"data"==url.getScheme()&&/^image/.test(url.getPath())?url.toString():void 0}function cleanId(id){return id}var html_sanitize=require("./sanitizer-bundle.js");module.exports=function(_){return _?html_sanitize(_,cleanUrl,cleanId):""}},{"./sanitizer-bundle.js":5}],5:[function(require,module,exports){var URI=function(){function parse(uriStr){var m=(""+uriStr).match(URI_RE_);return m?new URI(nullIfAbsent(m[1]),nullIfAbsent(m[2]),nullIfAbsent(m[3]),nullIfAbsent(m[4]),nullIfAbsent(m[5]),nullIfAbsent(m[6]),nullIfAbsent(m[7])):null}function create(scheme,credentials,domain,port,path,query,fragment){var uri=new URI(encodeIfExists2(scheme,URI_DISALLOWED_IN_SCHEME_OR_CREDENTIALS_),encodeIfExists2(credentials,URI_DISALLOWED_IN_SCHEME_OR_CREDENTIALS_),encodeIfExists(domain),port>0?port.toString():null,encodeIfExists2(path,URI_DISALLOWED_IN_PATH_),null,encodeIfExists(fragment));return query&&("string"==typeof query?uri.setRawQuery(query.replace(/[^?&=0-9A-Za-z_\-~.%]/g,encodeOne)):uri.setAllParameters(query)),uri}function encodeIfExists(unescapedPart){return"string"==typeof unescapedPart?encodeURIComponent(unescapedPart):null}function encodeIfExists2(unescapedPart,extra){return"string"==typeof unescapedPart?encodeURI(unescapedPart).replace(extra,encodeOne):null}function encodeOne(ch){var n=ch.charCodeAt(0);return"%"+"0123456789ABCDEF".charAt(n>>4&15)+"0123456789ABCDEF".charAt(15&n)}function normPath(path){return path.replace(/(^|\/)\.(?:\/|$)/g,"$1").replace(/\/{2,}/g,"/")}function collapse_dots(path){if(null===path)return null;for(var q,p=normPath(path),r=PARENT_DIRECTORY_HANDLER_RE;(q=p.replace(r,"$1"))!=p;p=q);return p}function resolve(baseUri,relativeUri){var absoluteUri=baseUri.clone(),overridden=relativeUri.hasScheme();overridden?absoluteUri.setRawScheme(relativeUri.getRawScheme()):overridden=relativeUri.hasCredentials(),overridden?absoluteUri.setRawCredentials(relativeUri.getRawCredentials()):overridden=relativeUri.hasDomain(),overridden?absoluteUri.setRawDomain(relativeUri.getRawDomain()):overridden=relativeUri.hasPort();var rawPath=relativeUri.getRawPath(),simplifiedPath=collapse_dots(rawPath);if(overridden)absoluteUri.setPort(relativeUri.getPort()),simplifiedPath=simplifiedPath&&simplifiedPath.replace(EXTRA_PARENT_PATHS_RE,"");else if(overridden=!!rawPath){if(47!==simplifiedPath.charCodeAt(0)){var absRawPath=collapse_dots(absoluteUri.getRawPath()||"").replace(EXTRA_PARENT_PATHS_RE,""),slash=absRawPath.lastIndexOf("/")+1;simplifiedPath=collapse_dots((slash?absRawPath.substring(0,slash):"")+collapse_dots(rawPath)).replace(EXTRA_PARENT_PATHS_RE,"")}}else simplifiedPath=simplifiedPath&&simplifiedPath.replace(EXTRA_PARENT_PATHS_RE,""),simplifiedPath!==rawPath&&absoluteUri.setRawPath(simplifiedPath);return overridden?absoluteUri.setRawPath(simplifiedPath):overridden=relativeUri.hasQuery(),overridden?absoluteUri.setRawQuery(relativeUri.getRawQuery()):overridden=relativeUri.hasFragment(),overridden&&absoluteUri.setRawFragment(relativeUri.getRawFragment()),absoluteUri}function URI(rawScheme,rawCredentials,rawDomain,port,rawPath,rawQuery,rawFragment){this.scheme_=rawScheme,this.credentials_=rawCredentials,this.domain_=rawDomain,this.port_=port,this.path_=rawPath,this.query_=rawQuery,this.fragment_=rawFragment,this.paramCache_=null}function nullIfAbsent(matchPart){return"string"==typeof matchPart&&matchPart.length>0?matchPart:null}var PARENT_DIRECTORY_HANDLER=new RegExp("(/|^)(?:[^./][^/]*|\\.{2,}(?:[^./][^/]*)|\\.{3,}[^/]*)/\\.\\.(?:/|$)"),PARENT_DIRECTORY_HANDLER_RE=new RegExp(PARENT_DIRECTORY_HANDLER),EXTRA_PARENT_PATHS_RE=/^(?:\.\.\/)*(?:\.\.$)?/;URI.prototype.toString=function(){var out=[];return null!==this.scheme_&&out.push(this.scheme_,":"),null!==this.domain_&&(out.push("//"),null!==this.credentials_&&out.push(this.credentials_,"@"),out.push(this.domain_),null!==this.port_&&out.push(":",this.port_.toString())),null!==this.path_&&out.push(this.path_),null!==this.query_&&out.push("?",this.query_),null!==this.fragment_&&out.push("#",this.fragment_),out.join("")},URI.prototype.clone=function(){return new URI(this.scheme_,this.credentials_,this.domain_,this.port_,this.path_,this.query_,this.fragment_)},URI.prototype.getScheme=function(){return this.scheme_&&decodeURIComponent(this.scheme_).toLowerCase()},URI.prototype.getRawScheme=function(){return this.scheme_},URI.prototype.setScheme=function(newScheme){return this.scheme_=encodeIfExists2(newScheme,URI_DISALLOWED_IN_SCHEME_OR_CREDENTIALS_),this},URI.prototype.setRawScheme=function(newScheme){return this.scheme_=newScheme?newScheme:null,this},URI.prototype.hasScheme=function(){return null!==this.scheme_},URI.prototype.getCredentials=function(){return this.credentials_&&decodeURIComponent(this.credentials_)},URI.prototype.getRawCredentials=function(){return this.credentials_},URI.prototype.setCredentials=function(newCredentials){return this.credentials_=encodeIfExists2(newCredentials,URI_DISALLOWED_IN_SCHEME_OR_CREDENTIALS_),this},URI.prototype.setRawCredentials=function(newCredentials){return this.credentials_=newCredentials?newCredentials:null,this},URI.prototype.hasCredentials=function(){return null!==this.credentials_},URI.prototype.getDomain=function(){return this.domain_&&decodeURIComponent(this.domain_)},URI.prototype.getRawDomain=function(){return this.domain_},URI.prototype.setDomain=function(newDomain){return this.setRawDomain(newDomain&&encodeURIComponent(newDomain))},URI.prototype.setRawDomain=function(newDomain){return this.domain_=newDomain?newDomain:null,this.setRawPath(this.path_)},URI.prototype.hasDomain=function(){return null!==this.domain_},URI.prototype.getPort=function(){return this.port_&&decodeURIComponent(this.port_)},URI.prototype.setPort=function(newPort){if(newPort){if(newPort=Number(newPort),newPort!==(65535&newPort))throw new Error("Bad port number "+newPort);this.port_=""+newPort}else this.port_=null;return this},URI.prototype.hasPort=function(){return null!==this.port_},URI.prototype.getPath=function(){return this.path_&&decodeURIComponent(this.path_)},URI.prototype.getRawPath=function(){return this.path_},URI.prototype.setPath=function(newPath){return this.setRawPath(encodeIfExists2(newPath,URI_DISALLOWED_IN_PATH_))},URI.prototype.setRawPath=function(newPath){return newPath?(newPath=String(newPath),this.path_=!this.domain_||/^\//.test(newPath)?newPath:"/"+newPath):this.path_=null,this},URI.prototype.hasPath=function(){return null!==this.path_},URI.prototype.getQuery=function(){return this.query_&&decodeURIComponent(this.query_).replace(/\+/g," ")},URI.prototype.getRawQuery=function(){return this.query_},URI.prototype.setQuery=function(newQuery){return this.paramCache_=null,this.query_=encodeIfExists(newQuery),this},URI.prototype.setRawQuery=function(newQuery){return this.paramCache_=null,this.query_=newQuery?newQuery:null,this},URI.prototype.hasQuery=function(){return null!==this.query_},URI.prototype.setAllParameters=function(params){if("object"==typeof params&&!(params instanceof Array)&&(params instanceof Object||"[object Array]"!==Object.prototype.toString.call(params))){var newParams=[],i=-1;for(var k in params){var v=params[k];"string"==typeof v&&(newParams[++i]=k,newParams[++i]=v)}params=newParams}this.paramCache_=null;for(var queryBuf=[],separator="",j=0;j<params.length;){var k=params[j++],v=params[j++];queryBuf.push(separator,encodeURIComponent(k.toString())),separator="&",v&&queryBuf.push("=",encodeURIComponent(v.toString()))}return this.query_=queryBuf.join(""),this},URI.prototype.checkParameterCache_=function(){if(!this.paramCache_){var q=this.query_;if(q){for(var cgiParams=q.split(/[&\?]/),out=[],k=-1,i=0;i<cgiParams.length;++i){var m=cgiParams[i].match(/^([^=]*)(?:=(.*))?$/);out[++k]=decodeURIComponent(m[1]).replace(/\+/g," "),out[++k]=decodeURIComponent(m[2]||"").replace(/\+/g," ")}this.paramCache_=out}else this.paramCache_=[]}},URI.prototype.setParameterValues=function(key,values){"string"==typeof values&&(values=[values]),this.checkParameterCache_();for(var newValueIndex=0,pc=this.paramCache_,params=[],i=0;i<pc.length;i+=2)key===pc[i]?newValueIndex<values.length&&params.push(key,values[newValueIndex++]):params.push(pc[i],pc[i+1]);for(;newValueIndex<values.length;)params.push(key,values[newValueIndex++]);return this.setAllParameters(params),this},URI.prototype.removeParameter=function(key){return this.setParameterValues(key,[])},URI.prototype.getAllParameters=function(){return this.checkParameterCache_(),this.paramCache_.slice(0,this.paramCache_.length)},URI.prototype.getParameterValues=function(paramNameUnescaped){this.checkParameterCache_();for(var values=[],i=0;i<this.paramCache_.length;i+=2)paramNameUnescaped===this.paramCache_[i]&&values.push(this.paramCache_[i+1]);return values},URI.prototype.getParameterMap=function(paramNameUnescaped){this.checkParameterCache_();for(var paramMap={},i=0;i<this.paramCache_.length;i+=2){var key=this.paramCache_[i++],value=this.paramCache_[i++];key in paramMap?paramMap[key].push(value):paramMap[key]=[value]}return paramMap},URI.prototype.getParameterValue=function(paramNameUnescaped){this.checkParameterCache_();for(var i=0;i<this.paramCache_.length;i+=2)if(paramNameUnescaped===this.paramCache_[i])return this.paramCache_[i+1];return null},URI.prototype.getFragment=function(){return this.fragment_&&decodeURIComponent(this.fragment_)},URI.prototype.getRawFragment=function(){return this.fragment_},URI.prototype.setFragment=function(newFragment){return this.fragment_=newFragment?encodeURIComponent(newFragment):null,this},URI.prototype.setRawFragment=function(newFragment){return this.fragment_=newFragment?newFragment:null,this},URI.prototype.hasFragment=function(){return null!==this.fragment_};var URI_RE_=new RegExp("^(?:([^:/?#]+):)?(?://(?:([^/?#]*)@)?([^/?#:@]*)(?::([0-9]+))?)?([^?#]+)?(?:\\?([^#]*))?(?:#(.*))?$"),URI_DISALLOWED_IN_SCHEME_OR_CREDENTIALS_=/[#\/\?@]/g,URI_DISALLOWED_IN_PATH_=/[\#\?]/g;return URI.parse=parse,URI.create=create,URI.resolve=resolve,URI.collapse_dots=collapse_dots,URI.utils={mimeTypeOf:function(uri){var uriObj=parse(uri);return/\.html$/.test(uriObj.getPath())?"text/html":"application/javascript"},resolve:function(base,uri){return base?resolve(parse(base),parse(uri)).toString():""+uri}},URI}(),html4={};if(html4.atype={NONE:0,URI:1,URI_FRAGMENT:11,SCRIPT:2,STYLE:3,HTML:12,ID:4,IDREF:5,IDREFS:6,GLOBAL_NAME:7,LOCAL_NAME:8,CLASSES:9,FRAME_TARGET:10,MEDIA_QUERY:13},html4.atype=html4.atype,html4.ATTRIBS={"*::class":9,"*::dir":0,"*::draggable":0,"*::hidden":0,"*::id":4,"*::inert":0,"*::itemprop":0,"*::itemref":6,"*::itemscope":0,"*::lang":0,"*::onblur":2,"*::onchange":2,"*::onclick":2,"*::ondblclick":2,"*::onfocus":2,"*::onkeydown":2,"*::onkeypress":2,"*::onkeyup":2,"*::onload":2,"*::onmousedown":2,"*::onmousemove":2,"*::onmouseout":2,"*::onmouseover":2,"*::onmouseup":2,"*::onreset":2,"*::onscroll":2,"*::onselect":2,"*::onsubmit":2,"*::onunload":2,"*::spellcheck":0,"*::style":3,"*::title":0,"*::translate":0,"a::accesskey":0,"a::coords":0,"a::href":1,"a::hreflang":0,"a::name":7,"a::onblur":2,"a::onfocus":2,"a::shape":0,"a::tabindex":0,"a::target":10,"a::type":0,"area::accesskey":0,"area::alt":0,"area::coords":0,"area::href":1,"area::nohref":0,"area::onblur":2,"area::onfocus":2,"area::shape":0,"area::tabindex":0,"area::target":10,"audio::controls":0,"audio::loop":0,"audio::mediagroup":5,"audio::muted":0,"audio::preload":0,"bdo::dir":0,"blockquote::cite":1,"br::clear":0,"button::accesskey":0,"button::disabled":0,"button::name":8,"button::onblur":2,"button::onfocus":2,"button::tabindex":0,"button::type":0,"button::value":0,"canvas::height":0,"canvas::width":0,"caption::align":0,"col::align":0,"col::char":0,"col::charoff":0,"col::span":0,"col::valign":0,"col::width":0,"colgroup::align":0,"colgroup::char":0,"colgroup::charoff":0,"colgroup::span":0,"colgroup::valign":0,"colgroup::width":0,"command::checked":0,"command::command":5,"command::disabled":0,"command::icon":1,"command::label":0,"command::radiogroup":0,"command::type":0,"data::value":0,"del::cite":1,"del::datetime":0,"details::open":0,"dir::compact":0,"div::align":0,"dl::compact":0,"fieldset::disabled":0,"font::color":0,"font::face":0,"font::size":0,"form::accept":0,"form::action":1,"form::autocomplete":0,"form::enctype":0,"form::method":0,"form::name":7,"form::novalidate":0,"form::onreset":2,"form::onsubmit":2,"form::target":10,"h1::align":0,"h2::align":0,"h3::align":0,"h4::align":0,"h5::align":0,"h6::align":0,"hr::align":0,"hr::noshade":0,"hr::size":0,"hr::width":0,"iframe::align":0,"iframe::frameborder":0,"iframe::height":0,"iframe::marginheight":0,"iframe::marginwidth":0,"iframe::width":0,"img::align":0,"img::alt":0,"img::border":0,"img::height":0,"img::hspace":0,"img::ismap":0,"img::name":7,"img::src":1,"img::usemap":11,"img::vspace":0,"img::width":0,"input::accept":0,"input::accesskey":0,"input::align":0,"input::alt":0,"input::autocomplete":0,"input::checked":0,"input::disabled":0,"input::inputmode":0,"input::ismap":0,"input::list":5,"input::max":0,"input::maxlength":0,"input::min":0,"input::multiple":0,"input::name":8,"input::onblur":2,"input::onchange":2,"input::onfocus":2,"input::onselect":2,"input::placeholder":0,"input::readonly":0,"input::required":0,"input::size":0,"input::src":1,"input::step":0,"input::tabindex":0,"input::type":0,"input::usemap":11,"input::value":0,"ins::cite":1,"ins::datetime":0,"label::accesskey":0,"label::for":5,"label::onblur":2,"label::onfocus":2,"legend::accesskey":0,"legend::align":0,"li::type":0,"li::value":0,"map::name":7,"menu::compact":0,"menu::label":0,"menu::type":0,"meter::high":0,"meter::low":0,"meter::max":0,"meter::min":0,"meter::value":0,"ol::compact":0,"ol::reversed":0,"ol::start":0,"ol::type":0,"optgroup::disabled":0,"optgroup::label":0,"option::disabled":0,"option::label":0,"option::selected":0,"option::value":0,"output::for":6,"output::name":8,"p::align":0,"pre::width":0,"progress::max":0,"progress::min":0,"progress::value":0,"q::cite":1,"select::autocomplete":0,"select::disabled":0,"select::multiple":0,"select::name":8,"select::onblur":2,"select::onchange":2,"select::onfocus":2,"select::required":0,"select::size":0,"select::tabindex":0,"source::type":0,"table::align":0,"table::bgcolor":0,"table::border":0,"table::cellpadding":0,"table::cellspacing":0,"table::frame":0,"table::rules":0,"table::summary":0,"table::width":0,"tbody::align":0,"tbody::char":0,"tbody::charoff":0,"tbody::valign":0,"td::abbr":0,"td::align":0,"td::axis":0,"td::bgcolor":0,"td::char":0,"td::charoff":0,"td::colspan":0,"td::headers":6,"td::height":0,"td::nowrap":0,"td::rowspan":0,"td::scope":0,"td::valign":0,"td::width":0,"textarea::accesskey":0,"textarea::autocomplete":0,"textarea::cols":0,"textarea::disabled":0,"textarea::inputmode":0,"textarea::name":8,"textarea::onblur":2,"textarea::onchange":2,"textarea::onfocus":2,"textarea::onselect":2,"textarea::placeholder":0,"textarea::readonly":0,"textarea::required":0,"textarea::rows":0,"textarea::tabindex":0,"textarea::wrap":0,"tfoot::align":0,"tfoot::char":0,"tfoot::charoff":0,"tfoot::valign":0,"th::abbr":0,"th::align":0,"th::axis":0,"th::bgcolor":0,"th::char":0,"th::charoff":0,"th::colspan":0,"th::headers":6,"th::height":0,"th::nowrap":0,"th::rowspan":0,"th::scope":0,"th::valign":0,"th::width":0,"thead::align":0,"thead::char":0,"thead::charoff":0,"thead::valign":0,"tr::align":0,"tr::bgcolor":0,"tr::char":0,"tr::charoff":0,"tr::valign":0,"track::default":0,"track::kind":0,"track::label":0,"track::srclang":0,"ul::compact":0,"ul::type":0,"video::controls":0,"video::height":0,"video::loop":0,"video::mediagroup":5,"video::muted":0,"video::poster":1,"video::preload":0,"video::width":0},html4.ATTRIBS=html4.ATTRIBS,html4.eflags={OPTIONAL_ENDTAG:1,EMPTY:2,CDATA:4,RCDATA:8,UNSAFE:16,FOLDABLE:32,SCRIPT:64,STYLE:128,VIRTUALIZED:256},html4.eflags=html4.eflags,html4.ELEMENTS={a:0,abbr:0,acronym:0,address:0,applet:272,area:2,article:0,aside:0,audio:0,b:0,base:274,basefont:274,bdi:0,bdo:0,big:0,blockquote:0,body:305,br:2,button:0,canvas:0,caption:0,center:0,cite:0,code:0,col:2,colgroup:1,command:2,data:0,datalist:0,dd:1,del:0,details:0,dfn:0,dialog:272,dir:0,div:0,dl:0,dt:1,em:0,fieldset:0,figcaption:0,figure:0,font:0,footer:0,form:0,frame:274,frameset:272,h1:0,h2:0,h3:0,h4:0,h5:0,h6:0,head:305,header:0,hgroup:0,hr:2,html:305,i:0,iframe:16,img:2,input:2,ins:0,isindex:274,kbd:0,keygen:274,label:0,legend:0,li:1,link:274,map:0,mark:0,menu:0,meta:274,meter:0,nav:0,nobr:0,noembed:276,noframes:276,noscript:276,object:272,ol:0,optgroup:0,option:1,output:0,p:1,param:274,pre:0,progress:0,q:0,s:0,samp:0,script:84,section:0,select:0,small:0,source:2,span:0,strike:0,strong:0,style:148,sub:0,summary:0,sup:0,table:0,tbody:1,td:1,textarea:8,tfoot:1,th:1,thead:1,time:0,title:280,tr:1,track:2,tt:0,u:0,ul:0,"var":0,video:0,wbr:2},html4.ELEMENTS=html4.ELEMENTS,html4.ELEMENT_DOM_INTERFACES={a:"HTMLAnchorElement",abbr:"HTMLElement",acronym:"HTMLElement",address:"HTMLElement",applet:"HTMLAppletElement",area:"HTMLAreaElement",article:"HTMLElement",aside:"HTMLElement",audio:"HTMLAudioElement",b:"HTMLElement",base:"HTMLBaseElement",basefont:"HTMLBaseFontElement",bdi:"HTMLElement",bdo:"HTMLElement",big:"HTMLElement",blockquote:"HTMLQuoteElement",body:"HTMLBodyElement",br:"HTMLBRElement",button:"HTMLButtonElement",canvas:"HTMLCanvasElement",caption:"HTMLTableCaptionElement",center:"HTMLElement",cite:"HTMLElement",code:"HTMLElement",col:"HTMLTableColElement",colgroup:"HTMLTableColElement",command:"HTMLCommandElement",data:"HTMLElement",datalist:"HTMLDataListElement",dd:"HTMLElement",del:"HTMLModElement",details:"HTMLDetailsElement",dfn:"HTMLElement",dialog:"HTMLDialogElement",dir:"HTMLDirectoryElement",div:"HTMLDivElement",dl:"HTMLDListElement",dt:"HTMLElement",em:"HTMLElement",fieldset:"HTMLFieldSetElement",figcaption:"HTMLElement",figure:"HTMLElement",font:"HTMLFontElement",footer:"HTMLElement",form:"HTMLFormElement",frame:"HTMLFrameElement",frameset:"HTMLFrameSetElement",h1:"HTMLHeadingElement",h2:"HTMLHeadingElement",h3:"HTMLHeadingElement",h4:"HTMLHeadingElement",h5:"HTMLHeadingElement",h6:"HTMLHeadingElement",head:"HTMLHeadElement",header:"HTMLElement",hgroup:"HTMLElement",hr:"HTMLHRElement",html:"HTMLHtmlElement",i:"HTMLElement",iframe:"HTMLIFrameElement",img:"HTMLImageElement",input:"HTMLInputElement",ins:"HTMLModElement",isindex:"HTMLUnknownElement",kbd:"HTMLElement",keygen:"HTMLKeygenElement",label:"HTMLLabelElement",legend:"HTMLLegendElement",li:"HTMLLIElement",link:"HTMLLinkElement",map:"HTMLMapElement",mark:"HTMLElement",menu:"HTMLMenuElement",meta:"HTMLMetaElement",meter:"HTMLMeterElement",nav:"HTMLElement",nobr:"HTMLElement",noembed:"HTMLElement",noframes:"HTMLElement",noscript:"HTMLElement",object:"HTMLObjectElement",ol:"HTMLOListElement",optgroup:"HTMLOptGroupElement",option:"HTMLOptionElement",output:"HTMLOutputElement",p:"HTMLParagraphElement",param:"HTMLParamElement",pre:"HTMLPreElement",progress:"HTMLProgressElement",q:"HTMLQuoteElement",s:"HTMLElement",samp:"HTMLElement",script:"HTMLScriptElement",section:"HTMLElement",select:"HTMLSelectElement",small:"HTMLElement",source:"HTMLSourceElement",span:"HTMLSpanElement",strike:"HTMLElement",strong:"HTMLElement",style:"HTMLStyleElement",sub:"HTMLElement",summary:"HTMLElement",sup:"HTMLElement",table:"HTMLTableElement",tbody:"HTMLTableSectionElement",td:"HTMLTableDataCellElement",textarea:"HTMLTextAreaElement",tfoot:"HTMLTableSectionElement",th:"HTMLTableHeaderCellElement",thead:"HTMLTableSectionElement",time:"HTMLTimeElement",title:"HTMLTitleElement",tr:"HTMLTableRowElement",track:"HTMLTrackElement",tt:"HTMLElement",u:"HTMLElement",ul:"HTMLUListElement","var":"HTMLElement",video:"HTMLVideoElement",wbr:"HTMLElement"},html4.ELEMENT_DOM_INTERFACES=html4.ELEMENT_DOM_INTERFACES,html4.ueffects={NOT_LOADED:0,SAME_DOCUMENT:1,NEW_DOCUMENT:2},html4.ueffects=html4.ueffects,html4.URIEFFECTS={"a::href":2,"area::href":2,"blockquote::cite":0,"command::icon":1,"del::cite":0,"form::action":2,"img::src":1,"input::src":1,"ins::cite":0,"q::cite":0,"video::poster":1},html4.URIEFFECTS=html4.URIEFFECTS,html4.ltypes={UNSANDBOXED:2,SANDBOXED:1,DATA:0},html4.ltypes=html4.ltypes,html4.LOADERTYPES={"a::href":2,"area::href":2,"blockquote::cite":2,"command::icon":1,"del::cite":2,"form::action":2,"img::src":1,"input::src":1,"ins::cite":2,"q::cite":2,"video::poster":1},html4.LOADERTYPES=html4.LOADERTYPES,"i"!=="I".toLowerCase())throw"I/i problem";var html=function(html4){function lookupEntity(name){if(ENTITIES.hasOwnProperty(name))return ENTITIES[name];var m=name.match(decimalEscapeRe);if(m)return String.fromCharCode(parseInt(m[1],10));if(m=name.match(hexEscapeRe))return String.fromCharCode(parseInt(m[1],16));if(entityLookupElement&&safeEntityNameRe.test(name)){entityLookupElement.innerHTML="&"+name+";";var text=entityLookupElement.textContent;return ENTITIES[name]=text,text}return"&"+name+";"}function decodeOneEntity(_,name){return lookupEntity(name)}function stripNULs(s){return s.replace(nulRe,"")}function unescapeEntities(s){return s.replace(ENTITY_RE_1,decodeOneEntity)}function escapeAttrib(s){return(""+s).replace(ampRe,"&amp;").replace(ltRe,"&lt;").replace(gtRe,"&gt;").replace(quotRe,"&#34;")}function normalizeRCData(rcdata){return rcdata.replace(looseAmpRe,"&amp;$1").replace(ltRe,"&lt;").replace(gtRe,"&gt;")}function makeSaxParser(handler){var hcopy={cdata:handler.cdata||handler.cdata,comment:handler.comment||handler.comment,endDoc:handler.endDoc||handler.endDoc,endTag:handler.endTag||handler.endTag,pcdata:handler.pcdata||handler.pcdata,rcdata:handler.rcdata||handler.rcdata,startDoc:handler.startDoc||handler.startDoc,startTag:handler.startTag||handler.startTag
};return function(htmlText,param){return parse(htmlText,hcopy,param)}}function parse(htmlText,handler,param){var parts=htmlSplit(htmlText),state={noMoreGT:!1,noMoreEndComments:!1};parseCPS(handler,parts,0,state,param)}function continuationMaker(h,parts,initial,state,param){return function(){parseCPS(h,parts,initial,state,param)}}function parseCPS(h,parts,initial,state,param){try{h.startDoc&&0==initial&&h.startDoc(param);for(var m,p,tagName,pos=initial,end=parts.length;end>pos;){var current=parts[pos++],next=parts[pos];switch(current){case"&":ENTITY_RE_2.test(next)?(h.pcdata&&h.pcdata("&"+next,param,continuationMarker,continuationMaker(h,parts,pos,state,param)),pos++):h.pcdata&&h.pcdata("&amp;",param,continuationMarker,continuationMaker(h,parts,pos,state,param));break;case"</":(m=/^([-\w:]+)[^\'\"]*/.exec(next))?m[0].length===next.length&&">"===parts[pos+1]?(pos+=2,tagName=m[1].toLowerCase(),h.endTag&&h.endTag(tagName,param,continuationMarker,continuationMaker(h,parts,pos,state,param))):pos=parseEndTag(parts,pos,h,param,continuationMarker,state):h.pcdata&&h.pcdata("&lt;/",param,continuationMarker,continuationMaker(h,parts,pos,state,param));break;case"<":if(m=/^([-\w:]+)\s*\/?/.exec(next))if(m[0].length===next.length&&">"===parts[pos+1]){pos+=2,tagName=m[1].toLowerCase(),h.startTag&&h.startTag(tagName,[],param,continuationMarker,continuationMaker(h,parts,pos,state,param));var eflags=html4.ELEMENTS[tagName];if(eflags&EFLAGS_TEXT){var tag={name:tagName,next:pos,eflags:eflags};pos=parseText(parts,tag,h,param,continuationMarker,state)}}else pos=parseStartTag(parts,pos,h,param,continuationMarker,state);else h.pcdata&&h.pcdata("&lt;",param,continuationMarker,continuationMaker(h,parts,pos,state,param));break;case"<!--":if(!state.noMoreEndComments){for(p=pos+1;end>p&&(">"!==parts[p]||!/--$/.test(parts[p-1]));p++);if(end>p){if(h.comment){var comment=parts.slice(pos,p).join("");h.comment(comment.substr(0,comment.length-2),param,continuationMarker,continuationMaker(h,parts,p+1,state,param))}pos=p+1}else state.noMoreEndComments=!0}state.noMoreEndComments&&h.pcdata&&h.pcdata("&lt;!--",param,continuationMarker,continuationMaker(h,parts,pos,state,param));break;case"<!":if(/^\w/.test(next)){if(!state.noMoreGT){for(p=pos+1;end>p&&">"!==parts[p];p++);end>p?pos=p+1:state.noMoreGT=!0}state.noMoreGT&&h.pcdata&&h.pcdata("&lt;!",param,continuationMarker,continuationMaker(h,parts,pos,state,param))}else h.pcdata&&h.pcdata("&lt;!",param,continuationMarker,continuationMaker(h,parts,pos,state,param));break;case"<?":if(!state.noMoreGT){for(p=pos+1;end>p&&">"!==parts[p];p++);end>p?pos=p+1:state.noMoreGT=!0}state.noMoreGT&&h.pcdata&&h.pcdata("&lt;?",param,continuationMarker,continuationMaker(h,parts,pos,state,param));break;case">":h.pcdata&&h.pcdata("&gt;",param,continuationMarker,continuationMaker(h,parts,pos,state,param));break;case"":break;default:h.pcdata&&h.pcdata(current,param,continuationMarker,continuationMaker(h,parts,pos,state,param))}}h.endDoc&&h.endDoc(param)}catch(e){if(e!==continuationMarker)throw e}}function htmlSplit(str){var re=/(<\/|<\!--|<[!?]|[&<>])/g;if(str+="",splitWillCapture)return str.split(re);for(var m,parts=[],lastPos=0;null!==(m=re.exec(str));)parts.push(str.substring(lastPos,m.index)),parts.push(m[0]),lastPos=m.index+m[0].length;return parts.push(str.substring(lastPos)),parts}function parseEndTag(parts,pos,h,param,continuationMarker,state){var tag=parseTagAndAttrs(parts,pos);return tag?(h.endTag&&h.endTag(tag.name,param,continuationMarker,continuationMaker(h,parts,pos,state,param)),tag.next):parts.length}function parseStartTag(parts,pos,h,param,continuationMarker,state){var tag=parseTagAndAttrs(parts,pos);return tag?(h.startTag&&h.startTag(tag.name,tag.attrs,param,continuationMarker,continuationMaker(h,parts,tag.next,state,param)),tag.eflags&EFLAGS_TEXT?parseText(parts,tag,h,param,continuationMarker,state):tag.next):parts.length}function parseText(parts,tag,h,param,continuationMarker,state){var end=parts.length;endTagRe.hasOwnProperty(tag.name)||(endTagRe[tag.name]=new RegExp("^"+tag.name+"(?:[\\s\\/]|$)","i"));for(var re=endTagRe[tag.name],first=tag.next,p=tag.next+1;end>p&&("</"!==parts[p-1]||!re.test(parts[p]));p++);end>p&&(p-=1);var buf=parts.slice(first,p).join("");if(tag.eflags&html4.eflags.CDATA)h.cdata&&h.cdata(buf,param,continuationMarker,continuationMaker(h,parts,p,state,param));else{if(!(tag.eflags&html4.eflags.RCDATA))throw new Error("bug");h.rcdata&&h.rcdata(normalizeRCData(buf),param,continuationMarker,continuationMaker(h,parts,p,state,param))}return p}function parseTagAndAttrs(parts,pos){var m=/^([-\w:]+)/.exec(parts[pos]),tag={};tag.name=m[1].toLowerCase(),tag.eflags=html4.ELEMENTS[tag.name];for(var buf=parts[pos].substr(m[0].length),p=pos+1,end=parts.length;end>p&&">"!==parts[p];p++)buf+=parts[p];if(p>=end)return void 0;for(var attrs=[];""!==buf;)if(m=ATTR_RE.exec(buf)){if(m[4]&&!m[5]||m[6]&&!m[7]){for(var quote=m[4]||m[6],sawQuote=!1,abuf=[buf,parts[p++]];end>p;p++){if(sawQuote){if(">"===parts[p])break}else 0<=parts[p].indexOf(quote)&&(sawQuote=!0);abuf.push(parts[p])}if(p>=end)break;buf=abuf.join("");continue}var aName=m[1].toLowerCase(),aValue=m[2]?decodeValue(m[3]):"";attrs.push(aName,aValue),buf=buf.substr(m[0].length)}else buf=buf.replace(/^[\s\S][^a-z\s]*/,"");return tag.attrs=attrs,tag.next=p+1,tag}function decodeValue(v){var q=v.charCodeAt(0);return(34===q||39===q)&&(v=v.substr(1,v.length-2)),unescapeEntities(stripNULs(v))}function makeHtmlSanitizer(tagPolicy){var stack,ignoring,emit=function(text,out){ignoring||out.push(text)};return makeSaxParser({startDoc:function(_){stack=[],ignoring=!1},startTag:function(tagNameOrig,attribs,out){if(!ignoring&&html4.ELEMENTS.hasOwnProperty(tagNameOrig)){var eflagsOrig=html4.ELEMENTS[tagNameOrig];if(!(eflagsOrig&html4.eflags.FOLDABLE)){var decision=tagPolicy(tagNameOrig,attribs);if(!decision)return void(ignoring=!(eflagsOrig&html4.eflags.EMPTY));if("object"!=typeof decision)throw new Error("tagPolicy did not return object (old API?)");if(!("attribs"in decision))throw new Error("tagPolicy gave no attribs");attribs=decision.attribs;var eflagsRep,tagNameRep;if("tagName"in decision?(tagNameRep=decision.tagName,eflagsRep=html4.ELEMENTS[tagNameRep]):(tagNameRep=tagNameOrig,eflagsRep=eflagsOrig),eflagsOrig&html4.eflags.OPTIONAL_ENDTAG){var onStack=stack[stack.length-1];!onStack||onStack.orig!==tagNameOrig||onStack.rep===tagNameRep&&tagNameOrig===tagNameRep||out.push("</",onStack.rep,">")}eflagsOrig&html4.eflags.EMPTY||stack.push({orig:tagNameOrig,rep:tagNameRep}),out.push("<",tagNameRep);for(var i=0,n=attribs.length;n>i;i+=2){var attribName=attribs[i],value=attribs[i+1];null!==value&&void 0!==value&&out.push(" ",attribName,'="',escapeAttrib(value),'"')}out.push(">"),eflagsOrig&html4.eflags.EMPTY&&!(eflagsRep&html4.eflags.EMPTY)&&out.push("</",tagNameRep,">")}}},endTag:function(tagName,out){if(ignoring)return void(ignoring=!1);if(html4.ELEMENTS.hasOwnProperty(tagName)){var eflags=html4.ELEMENTS[tagName];if(!(eflags&(html4.eflags.EMPTY|html4.eflags.FOLDABLE))){var index;if(eflags&html4.eflags.OPTIONAL_ENDTAG)for(index=stack.length;--index>=0;){var stackElOrigTag=stack[index].orig;if(stackElOrigTag===tagName)break;if(!(html4.ELEMENTS[stackElOrigTag]&html4.eflags.OPTIONAL_ENDTAG))return}else for(index=stack.length;--index>=0&&stack[index].orig!==tagName;);if(0>index)return;for(var i=stack.length;--i>index;){var stackElRepTag=stack[i].rep;html4.ELEMENTS[stackElRepTag]&html4.eflags.OPTIONAL_ENDTAG||out.push("</",stackElRepTag,">")}index<stack.length&&(tagName=stack[index].rep),stack.length=index,out.push("</",tagName,">")}}},pcdata:emit,rcdata:emit,cdata:emit,endDoc:function(out){for(;stack.length;stack.length--)out.push("</",stack[stack.length-1].rep,">")}})}function safeUri(uri,effect,ltype,hints,naiveUriRewriter){if(!naiveUriRewriter)return null;try{var parsed=URI.parse(""+uri);if(parsed&&(!parsed.hasScheme()||ALLOWED_URI_SCHEMES.test(parsed.getScheme()))){var safe=naiveUriRewriter(parsed,effect,ltype,hints);return safe?safe.toString():null}}catch(e){return null}return null}function log(logger,tagName,attribName,oldValue,newValue){if(attribName||logger(tagName+" removed",{change:"removed",tagName:tagName}),oldValue!==newValue){var changed="changed";oldValue&&!newValue?changed="removed":!oldValue&&newValue&&(changed="added"),logger(tagName+"."+attribName+" "+changed,{change:changed,tagName:tagName,attribName:attribName,oldValue:oldValue,newValue:newValue})}}function lookupAttribute(map,tagName,attribName){var attribKey;return attribKey=tagName+"::"+attribName,map.hasOwnProperty(attribKey)?map[attribKey]:(attribKey="*::"+attribName,map.hasOwnProperty(attribKey)?map[attribKey]:void 0)}function getLoaderType(tagName,attribName){return lookupAttribute(html4.LOADERTYPES,tagName,attribName)}function getUriEffect(tagName,attribName){return lookupAttribute(html4.URIEFFECTS,tagName,attribName)}function sanitizeAttribs(tagName,attribs,opt_naiveUriRewriter,opt_nmTokenPolicy,opt_logger){for(var i=0;i<attribs.length;i+=2){var attribKey,attribName=attribs[i],value=attribs[i+1],oldValue=value,atype=null;if(attribKey=tagName+"::"+attribName,(html4.ATTRIBS.hasOwnProperty(attribKey)||(attribKey="*::"+attribName,html4.ATTRIBS.hasOwnProperty(attribKey)))&&(atype=html4.ATTRIBS[attribKey]),null!==atype)switch(atype){case html4.atype.NONE:break;case html4.atype.SCRIPT:value=null,opt_logger&&log(opt_logger,tagName,attribName,oldValue,value);break;case html4.atype.STYLE:if("undefined"==typeof parseCssDeclarations){value=null,opt_logger&&log(opt_logger,tagName,attribName,oldValue,value);break}var sanitizedDeclarations=[];parseCssDeclarations(value,{declaration:function(property,tokens){var normProp=property.toLowerCase(),schema=cssSchema[normProp];schema&&(sanitizeCssProperty(normProp,schema,tokens,opt_naiveUriRewriter?function(url){return safeUri(url,html4.ueffects.SAME_DOCUMENT,html4.ltypes.SANDBOXED,{TYPE:"CSS",CSS_PROP:normProp},opt_naiveUriRewriter)}:null),sanitizedDeclarations.push(property+": "+tokens.join(" ")))}}),value=sanitizedDeclarations.length>0?sanitizedDeclarations.join(" ; "):null,opt_logger&&log(opt_logger,tagName,attribName,oldValue,value);break;case html4.atype.ID:case html4.atype.IDREF:case html4.atype.IDREFS:case html4.atype.GLOBAL_NAME:case html4.atype.LOCAL_NAME:case html4.atype.CLASSES:value=opt_nmTokenPolicy?opt_nmTokenPolicy(value):value,opt_logger&&log(opt_logger,tagName,attribName,oldValue,value);break;case html4.atype.URI:value=safeUri(value,getUriEffect(tagName,attribName),getLoaderType(tagName,attribName),{TYPE:"MARKUP",XML_ATTR:attribName,XML_TAG:tagName},opt_naiveUriRewriter),opt_logger&&log(opt_logger,tagName,attribName,oldValue,value);break;case html4.atype.URI_FRAGMENT:value&&"#"===value.charAt(0)?(value=value.substring(1),value=opt_nmTokenPolicy?opt_nmTokenPolicy(value):value,null!==value&&void 0!==value&&(value="#"+value)):value=null,opt_logger&&log(opt_logger,tagName,attribName,oldValue,value);break;default:value=null,opt_logger&&log(opt_logger,tagName,attribName,oldValue,value)}else value=null,opt_logger&&log(opt_logger,tagName,attribName,oldValue,value);attribs[i+1]=value}return attribs}function makeTagPolicy(opt_naiveUriRewriter,opt_nmTokenPolicy,opt_logger){return function(tagName,attribs){return html4.ELEMENTS[tagName]&html4.eflags.UNSAFE?void(opt_logger&&log(opt_logger,tagName,void 0,void 0,void 0)):{attribs:sanitizeAttribs(tagName,attribs,opt_naiveUriRewriter,opt_nmTokenPolicy,opt_logger)}}}function sanitizeWithPolicy(inputHtml,tagPolicy){var outputArray=[];return makeHtmlSanitizer(tagPolicy)(inputHtml,outputArray),outputArray.join("")}function sanitize(inputHtml,opt_naiveUriRewriter,opt_nmTokenPolicy,opt_logger){var tagPolicy=makeTagPolicy(opt_naiveUriRewriter,opt_nmTokenPolicy,opt_logger);return sanitizeWithPolicy(inputHtml,tagPolicy)}var parseCssDeclarations,sanitizeCssProperty,cssSchema;"undefined"!=typeof window&&(parseCssDeclarations=window.parseCssDeclarations,sanitizeCssProperty=window.sanitizeCssProperty,cssSchema=window.cssSchema);var ENTITIES={lt:"<",LT:"<",gt:">",GT:">",amp:"&",AMP:"&",quot:'"',apos:"'",nbsp:""},decimalEscapeRe=/^#(\d+)$/,hexEscapeRe=/^#x([0-9A-Fa-f]+)$/,safeEntityNameRe=/^[A-Za-z][A-za-z0-9]+$/,entityLookupElement="undefined"!=typeof window&&window.document?window.document.createElement("textarea"):null,nulRe=/\0/g,ENTITY_RE_1=/&(#[0-9]+|#[xX][0-9A-Fa-f]+|\w+);/g,ENTITY_RE_2=/^(#[0-9]+|#[xX][0-9A-Fa-f]+|\w+);/,ampRe=/&/g,looseAmpRe=/&([^a-z#]|#(?:[^0-9x]|x(?:[^0-9a-f]|$)|$)|$)/gi,ltRe=/[<]/g,gtRe=/>/g,quotRe=/\"/g,ATTR_RE=new RegExp("^\\s*([-.:\\w]+)(?:\\s*(=)\\s*((\")[^\"]*(\"|$)|(')[^']*('|$)|(?=[a-z][-\\w]*\\s*=)|[^\"'\\s]*))?","i"),splitWillCapture=3==="a,b".split(/(,)/).length,EFLAGS_TEXT=html4.eflags.CDATA|html4.eflags.RCDATA,continuationMarker={},endTagRe={},ALLOWED_URI_SCHEMES=/^(?:https?|mailto|data)$/i,html={};return html.escapeAttrib=html.escapeAttrib=escapeAttrib,html.makeHtmlSanitizer=html.makeHtmlSanitizer=makeHtmlSanitizer,html.makeSaxParser=html.makeSaxParser=makeSaxParser,html.makeTagPolicy=html.makeTagPolicy=makeTagPolicy,html.normalizeRCData=html.normalizeRCData=normalizeRCData,html.sanitize=html.sanitize=sanitize,html.sanitizeAttribs=html.sanitizeAttribs=sanitizeAttribs,html.sanitizeWithPolicy=html.sanitizeWithPolicy=sanitizeWithPolicy,html.unescapeEntities=html.unescapeEntities=unescapeEntities,html}(html4),html_sanitize=html.sanitize;html4.ATTRIBS["*::style"]=0,html4.ELEMENTS.style=0,html4.ATTRIBS["a::target"]=0,html4.ELEMENTS.video=0,html4.ATTRIBS["video::src"]=0,html4.ATTRIBS["video::poster"]=0,html4.ATTRIBS["video::controls"]=0,html4.ELEMENTS.audio=0,html4.ATTRIBS["audio::src"]=0,html4.ATTRIBS["video::autoplay"]=0,html4.ATTRIBS["video::controls"]=0,"undefined"!=typeof module&&(module.exports=html_sanitize)},{}],6:[function(require,module,exports){module.exports={author:"Mapbox",name:"mapbox.js",description:"mapbox javascript api",version:"2.2.2",homepage:"http://mapbox.com/",repository:{type:"git",url:"git://github.com/mapbox/mapbox.js.git"},main:"src/index.js",dependencies:{corslite:"0.0.6",isarray:"0.0.1",leaflet:"0.7.5",mustache:"0.7.3","sanitize-caja":"0.1.3"},scripts:{test:"eslint --no-eslintrc -c .eslintrc src && mocha-phantomjs test/index.html"},devDependencies:{browserify:"^6.3.2","clean-css":"~2.0.7",eslint:"^0.23.0","expect.js":"0.3.1",happen:"0.1.3","leaflet-fullscreen":"0.0.4","leaflet-hash":"0.2.1",marked:"~0.3.0",minifyify:"^6.1.0",minimist:"0.0.5",mocha:"1.17.1","mocha-phantomjs":"3.1.6",sinon:"1.10.2"},optionalDependencies:{},engines:{node:"*"}}},{}],7:[function(require,module,exports){"use strict";module.exports={HTTP_URL:"http://a.tiles.mapbox.com/v4",HTTPS_URL:"https://a.tiles.mapbox.com/v4",FORCE_HTTPS:!1,REQUIRE_ACCESS_TOKEN:!0}},{}],8:[function(require,module,exports){"use strict";var util=require("./util"),urlhelper=require("./url"),request=require("./request"),marker=require("./marker"),simplestyle=require("./simplestyle"),FeatureLayer=L.FeatureGroup.extend({options:{filter:function(){return!0},sanitizer:require("sanitize-caja"),style:simplestyle.style,popupOptions:{closeButton:!1}},initialize:function(_,options){L.setOptions(this,options),this._layers={},"string"==typeof _?util.idUrl(_,this):_&&"object"==typeof _&&this.setGeoJSON(_)},setGeoJSON:function(_){return this._geojson=_,this.clearLayers(),this._initialize(_),this},getGeoJSON:function(){return this._geojson},loadURL:function(url){return this._request&&"abort"in this._request&&this._request.abort(),this._request=request(url,L.bind(function(err,json){this._request=null,err&&"abort"!==err.type?(util.log("could not load features at "+url),this.fire("error",{error:err})):json&&(this.setGeoJSON(json),this.fire("ready"))},this)),this},loadID:function(id){return this.loadURL(urlhelper("/"+id+"/features.json",this.options.accessToken))},setFilter:function(_){return this.options.filter=_,this._geojson&&(this.clearLayers(),this._initialize(this._geojson)),this},getFilter:function(){return this.options.filter},_initialize:function(json){var i,len,features=L.Util.isArray(json)?json:json.features;if(features)for(i=0,len=features.length;len>i;i++)(features[i].geometries||features[i].geometry||features[i].features)&&this._initialize(features[i]);else if(this.options.filter(json)){var opts={accessToken:this.options.accessToken},pointToLayer=this.options.pointToLayer||function(feature,latlon){return marker.style(feature,latlon,opts)},layer=L.GeoJSON.geometryToLayer(json,pointToLayer),popupHtml=marker.createPopup(json,this.options.sanitizer),style=this.options.style,defaultStyle=style===simplestyle.style;!(style&&"setStyle"in layer)||defaultStyle&&(layer instanceof L.Circle||layer instanceof L.CircleMarker)||("function"==typeof style&&(style=style(json)),layer.setStyle(style)),layer.feature=json,popupHtml&&layer.bindPopup(popupHtml,this.options.popupOptions),this.addLayer(layer)}}});module.exports.FeatureLayer=FeatureLayer,module.exports.featureLayer=function(_,options){return new FeatureLayer(_,options)}},{"./marker":21,"./request":22,"./simplestyle":24,"./url":26,"./util":27,"sanitize-caja":4}],9:[function(require,module,exports){"use strict";var Feedback=L.Class.extend({includes:L.Mixin.Events,data:{},record:function(data){L.extend(this.data,data),this.fire("change")}});module.exports=new Feedback},{}],10:[function(require,module,exports){"use strict";var isArray=require("isarray"),util=require("./util"),urlhelper=require("./url"),feedback=require("./feedback"),request=require("./request");module.exports=function(url,options){options||(options={});var geocoder={};return util.strict(url,"string"),-1===url.indexOf("/")&&(url=urlhelper("/geocode/"+url+"/{query}.json",options.accessToken)),geocoder.getURL=function(){return url},geocoder.queryURL=function(_){var isObject=!(isArray(_)||"string"==typeof _),query=isObject?_.query:_;if(isArray(query)){for(var parts=[],i=0;i<query.length;i++)parts[i]=encodeURIComponent(query[i]);query=parts.join(";")}else query=encodeURIComponent(query);feedback.record({geocoding:query});var url=L.Util.template(geocoder.getURL(),{query:query});if(isObject&&_.proximity){var proximity=L.latLng(_.proximity);url+="&proximity="+proximity.lng+","+proximity.lat}return url},geocoder.query=function(_,callback){return util.strict(callback,"function"),request(geocoder.queryURL(_),function(err,json){if(json&&(json.length||json.features)){var res={results:json};json.features&&json.features.length&&(res.latlng=[json.features[0].center[1],json.features[0].center[0]],json.features[0].bbox&&(res.bounds=json.features[0].bbox,res.lbounds=util.lbounds(res.bounds))),callback(null,res)}else callback(err||!0)}),geocoder},geocoder.reverseQuery=function(_,callback){function normalize(x){return void 0!==x.lat&&void 0!==x.lng?x.lng+","+x.lat:void 0!==x.lat&&void 0!==x.lon?x.lon+","+x.lat:x[0]+","+x[1]}var q="";if(_.length&&_[0].length){for(var i=0,pts=[];i<_.length;i++)pts.push(normalize(_[i]));q=pts.join(";")}else q=normalize(_);return request(geocoder.queryURL(q),function(err,json){callback(err,json)}),geocoder},geocoder}},{"./feedback":9,"./request":22,"./url":26,"./util":27,isarray:2}],11:[function(require,module,exports){"use strict";var geocoder=require("./geocoder"),util=require("./util"),GeocoderControl=L.Control.extend({includes:L.Mixin.Events,options:{proximity:!0,position:"topleft",pointZoom:16,keepOpen:!1,autocomplete:!1},initialize:function(_,options){L.Util.setOptions(this,options),this.setURL(_),this._updateSubmit=L.bind(this._updateSubmit,this),this._updateAutocomplete=L.bind(this._updateAutocomplete,this),this._chooseResult=L.bind(this._chooseResult,this)},setURL:function(_){return this.geocoder=geocoder(_,{accessToken:this.options.accessToken}),this},getURL:function(){return this.geocoder.getURL()},setID:function(_){return this.setURL(_)},setTileJSON:function(_){return this.setURL(_.geocoder)},_toggle:function(e){e&&L.DomEvent.stop(e),L.DomUtil.hasClass(this._container,"active")?(L.DomUtil.removeClass(this._container,"active"),this._results.innerHTML="",this._input.blur()):(L.DomUtil.addClass(this._container,"active"),this._input.focus(),this._input.select())},_closeIfOpen:function(){L.DomUtil.hasClass(this._container,"active")&&!this.options.keepOpen&&(L.DomUtil.removeClass(this._container,"active"),this._results.innerHTML="",this._input.blur())},onAdd:function(map){var container=L.DomUtil.create("div","leaflet-control-mapbox-geocoder leaflet-bar leaflet-control"),link=L.DomUtil.create("a","leaflet-control-mapbox-geocoder-toggle mapbox-icon mapbox-icon-geocoder",container),results=L.DomUtil.create("div","leaflet-control-mapbox-geocoder-results",container),wrap=L.DomUtil.create("div","leaflet-control-mapbox-geocoder-wrap",container),form=L.DomUtil.create("form","leaflet-control-mapbox-geocoder-form",wrap),input=L.DomUtil.create("input","",form);return link.href="#",link.innerHTML="&nbsp;",input.type="text",input.setAttribute("placeholder","Search"),L.DomEvent.addListener(form,"submit",this._geocode,this),L.DomEvent.addListener(input,"keyup",this._autocomplete,this),L.DomEvent.disableClickPropagation(container),this._map=map,this._results=results,this._input=input,this._form=form,this.options.keepOpen?L.DomUtil.addClass(container,"active"):(this._map.on("click",this._closeIfOpen,this),L.DomEvent.addListener(link,"click",this._toggle,this)),container},_updateSubmit:function(err,resp){if(L.DomUtil.removeClass(this._container,"searching"),this._results.innerHTML="",err||!resp)this.fire("error",{error:err});else{var features=[];resp.results&&resp.results.features&&(features=resp.results.features),1===features.length?(this.fire("autoselect",{feature:features[0]}),this.fire("found",{results:resp.results}),this._chooseResult(features[0]),this._closeIfOpen()):features.length>1?(this.fire("found",{results:resp.results}),this._displayResults(features)):this._displayResults(features)}},_updateAutocomplete:function(err,resp){if(this._results.innerHTML="",err||!resp)this.fire("error",{error:err});else{var features=[];resp.results&&resp.results.features&&(features=resp.results.features),features.length&&this.fire("found",{results:resp.results}),this._displayResults(features)}},_displayResults:function(features){for(var i=0,l=Math.min(features.length,5);l>i;i++){var feature=features[i],name=feature.place_name;if(name.length){var r=L.DomUtil.create("a","",this._results),text="innerText"in r?"innerText":"textContent";r[text]=name,r.href="#",L.bind(function(feature){L.DomEvent.addListener(r,"click",function(e){this._chooseResult(feature),L.DomEvent.stop(e),this.fire("select",{feature:feature})},this)},this)(feature)}}if(features.length>5){var outof=L.DomUtil.create("span","",this._results);outof.innerHTML="Top 5 of "+features.length+"  results"}},_chooseResult:function(result){result.bbox?this._map.fitBounds(util.lbounds(result.bbox)):result.center&&this._map.setView([result.center[1],result.center[0]],void 0===this._map.getZoom()?this.options.pointZoom:Math.max(this._map.getZoom(),this.options.pointZoom))},_geocode:function(e){return L.DomEvent.preventDefault(e),""===this._input.value?this._updateSubmit():(L.DomUtil.addClass(this._container,"searching"),void this.geocoder.query({query:this._input.value,proximity:this.options.proximity?this._map.getCenter():!1},this._updateSubmit))},_autocomplete:function(){return this.options.autocomplete?""===this._input.value?this._updateAutocomplete():void this.geocoder.query({query:this._input.value,proximity:this.options.proximity?this._map.getCenter():!1},this._updateAutocomplete):void 0}});module.exports.GeocoderControl=GeocoderControl,module.exports.geocoderControl=function(_,options){return new GeocoderControl(_,options)}},{"./geocoder":10,"./util":27}],12:[function(require,module,exports){"use strict";function utfDecode(c){return c>=93&&c--,c>=35&&c--,c-32}module.exports=function(data){return function(x,y){if(data){var idx=utfDecode(data.grid[y].charCodeAt(x)),key=data.keys[idx];return data.data[key]}}}},{}],13:[function(require,module,exports){"use strict";var util=require("./util"),Mustache=require("mustache"),GridControl=L.Control.extend({options:{pinnable:!0,follow:!1,sanitizer:require("sanitize-caja"),touchTeaser:!0,location:!0},_currentContent:"",_pinned:!1,initialize:function(_,options){L.Util.setOptions(this,options),util.strict_instance(_,L.Class,"L.mapbox.gridLayer"),this._layer=_},setTemplate:function(template){return util.strict(template,"string"),this.options.template=template,this},_template:function(format,data){if(data){var template=this.options.template||this._layer.getTileJSON().template;if(template){var d={};return d["__"+format+"__"]=!0,this.options.sanitizer(Mustache.to_html(template,L.extend(d,data)))}}},_show:function(content,o){content!==this._currentContent&&(this._currentContent=content,this.options.follow?(this._popup.setContent(content).setLatLng(o.latLng),this._map._popup!==this._popup&&this._popup.openOn(this._map)):(this._container.style.display="block",this._contentWrapper.innerHTML=content))},hide:function(){return this._pinned=!1,this._currentContent="",this._map.closePopup(),this._container.style.display="none",this._contentWrapper.innerHTML="",L.DomUtil.removeClass(this._container,"closable"),this},_mouseover:function(o){if(o.data?L.DomUtil.addClass(this._map._container,"map-clickable"):L.DomUtil.removeClass(this._map._container,"map-clickable"),!this._pinned){var content=this._template("teaser",o.data);content?this._show(content,o):this.hide()}},_mousemove:function(o){this._pinned||this.options.follow&&this._popup.setLatLng(o.latLng)},_navigateTo:function(url){window.top.location.href=url},_click:function(o){var location_formatted=this._template("location",o.data);if(this.options.location&&location_formatted&&0===location_formatted.search(/^https?:/))return this._navigateTo(this._template("location",o.data));if(this.options.pinnable){var content=this._template("full",o.data);!content&&this.options.touchTeaser&&L.Browser.touch&&(content=this._template("teaser",o.data)),content?(L.DomUtil.addClass(this._container,"closable"),this._pinned=!0,this._show(content,o)):this._pinned&&(L.DomUtil.removeClass(this._container,"closable"),this._pinned=!1,this.hide())}},_onPopupClose:function(){this._currentContent=null,this._pinned=!1},_createClosebutton:function(container,fn){var link=L.DomUtil.create("a","close",container);return link.innerHTML="close",link.href="#",link.title="close",L.DomEvent.on(link,"click",L.DomEvent.stopPropagation).on(link,"mousedown",L.DomEvent.stopPropagation).on(link,"dblclick",L.DomEvent.stopPropagation).on(link,"click",L.DomEvent.preventDefault).on(link,"click",fn,this),link},onAdd:function(map){this._map=map;var className="leaflet-control-grid map-tooltip",container=L.DomUtil.create("div",className),contentWrapper=L.DomUtil.create("div","map-tooltip-content");return container.style.display="none",this._createClosebutton(container,this.hide),container.appendChild(contentWrapper),this._contentWrapper=contentWrapper,this._popup=new L.Popup({autoPan:!1,closeOnClick:!1}),map.on("popupclose",this._onPopupClose,this),L.DomEvent.disableClickPropagation(container).addListener(container,"mousewheel",L.DomEvent.stopPropagation),this._layer.on("mouseover",this._mouseover,this).on("mousemove",this._mousemove,this).on("click",this._click,this),container},onRemove:function(map){map.off("popupclose",this._onPopupClose,this),this._layer.off("mouseover",this._mouseover,this).off("mousemove",this._mousemove,this).off("click",this._click,this)}});module.exports.GridControl=GridControl,module.exports.gridControl=function(_,options){return new GridControl(_,options)}},{"./util":27,mustache:3,"sanitize-caja":4}],14:[function(require,module,exports){"use strict";var util=require("./util"),request=require("./request"),grid=require("./grid"),GridLayer=L.Class.extend({includes:[L.Mixin.Events,require("./load_tilejson")],options:{template:function(){return""}},_mouseOn:null,_tilejson:{},_cache:{},initialize:function(_,options){L.Util.setOptions(this,options),this._loadTileJSON(_)},_setTileJSON:function(json){return util.strict(json,"object"),L.extend(this.options,{grids:json.grids,minZoom:json.minzoom,maxZoom:json.maxzoom,bounds:json.bounds&&util.lbounds(json.bounds)}),this._tilejson=json,this._cache={},this._update(),this},getTileJSON:function(){return this._tilejson},active:function(){return!!(this._map&&this.options.grids&&this.options.grids.length)},addTo:function(map){return map.addLayer(this),this},onAdd:function(map){this._map=map,this._update(),this._map.on("click",this._click,this).on("mousemove",this._move,this).on("moveend",this._update,this)},onRemove:function(){this._map.off("click",this._click,this).off("mousemove",this._move,this).off("moveend",this._update,this)},getData:function(latlng,callback){if(this.active()){var map=this._map,point=map.project(latlng.wrap()),tileSize=256,resolution=4,x=Math.floor(point.x/tileSize),y=Math.floor(point.y/tileSize),max=map.options.crs.scale(map.getZoom())/tileSize;return x=(x+max)%max,y=(y+max)%max,this._getTile(map.getZoom(),x,y,function(grid){var gridX=Math.floor((point.x-x*tileSize)/resolution),gridY=Math.floor((point.y-y*tileSize)/resolution);callback(grid(gridX,gridY))}),this}},_click:function(e){this.getData(e.latlng,L.bind(function(data){this.fire("click",{latLng:e.latlng,data:data})},this))},_move:function(e){this.getData(e.latlng,L.bind(function(data){data!==this._mouseOn?(this._mouseOn&&this.fire("mouseout",{latLng:e.latlng,data:this._mouseOn}),this.fire("mouseover",{latLng:e.latlng,data:data}),this._mouseOn=data):this.fire("mousemove",{latLng:e.latlng,data:data})},this))},_getTileURL:function(tilePoint){var urls=this.options.grids,index=(tilePoint.x+tilePoint.y)%urls.length,url=urls[index];return L.Util.template(url,tilePoint)},_update:function(){if(this.active()){var bounds=this._map.getPixelBounds(),z=this._map.getZoom(),tileSize=256;if(!(z>this.options.maxZoom||z<this.options.minZoom))for(var tileBounds=L.bounds(bounds.min.divideBy(tileSize)._floor(),bounds.max.divideBy(tileSize)._floor()),max=this._map.options.crs.scale(z)/tileSize,x=tileBounds.min.x;x<=tileBounds.max.x;x++)for(var y=tileBounds.min.y;y<=tileBounds.max.y;y++)this._getTile(z,(x%max+max)%max,(y%max+max)%max)}},_getTile:function(z,x,y,callback){var key=z+"_"+x+"_"+y,tilePoint=L.point(x,y);if(tilePoint.z=z,this._tileShouldBeLoaded(tilePoint)){if(key in this._cache){if(!callback)return;return void("function"==typeof this._cache[key]?callback(this._cache[key]):this._cache[key].push(callback))}this._cache[key]=[],callback&&this._cache[key].push(callback),request(this._getTileURL(tilePoint),L.bind(function(err,json){var callbacks=this._cache[key];this._cache[key]=grid(json);for(var i=0;i<callbacks.length;++i)callbacks[i](this._cache[key])},this))}},_tileShouldBeLoaded:function(tilePoint){if(tilePoint.z>this.options.maxZoom||tilePoint.z<this.options.minZoom)return!1;if(this.options.bounds){var tileSize=256,nwPoint=tilePoint.multiplyBy(tileSize),sePoint=nwPoint.add(new L.Point(tileSize,tileSize)),nw=this._map.unproject(nwPoint),se=this._map.unproject(sePoint),bounds=new L.LatLngBounds([nw,se]);if(!this.options.bounds.intersects(bounds))return!1}return!0}});module.exports.GridLayer=GridLayer,module.exports.gridLayer=function(_,options){return new GridLayer(_,options)}},{"./grid":12,"./load_tilejson":17,"./request":22,"./util":27}],15:[function(require,module,exports){"use strict";var InfoControl=L.Control.extend({options:{position:"bottomright",sanitizer:require("sanitize-caja")},initialize:function(options){L.setOptions(this,options),this._info={},console.warn("infoControl has been deprecated and will be removed in mapbox.js v3.0.0. Use the default attribution control instead, which is now responsive.")},onAdd:function(map){this._container=L.DomUtil.create("div","mapbox-control-info mapbox-small"),this._content=L.DomUtil.create("div","map-info-container",this._container);var link=L.DomUtil.create("a","mapbox-info-toggle mapbox-icon mapbox-icon-info",this._container);
link.href="#",L.DomEvent.addListener(link,"click",this._showInfo,this),L.DomEvent.disableClickPropagation(this._container);for(var i in map._layers)map._layers[i].getAttribution&&this.addInfo(map._layers[i].getAttribution());return map.on("layeradd",this._onLayerAdd,this).on("layerremove",this._onLayerRemove,this),this._update(),this._container},onRemove:function(map){map.off("layeradd",this._onLayerAdd,this).off("layerremove",this._onLayerRemove,this)},addInfo:function(text){return text?(this._info[text]||(this._info[text]=0),this._info[text]=!0,this._update()):this},removeInfo:function(text){return text?(this._info[text]&&(this._info[text]=!1),this._update()):this},_showInfo:function(e){return L.DomEvent.preventDefault(e),this._active===!0?this._hidecontent():(L.DomUtil.addClass(this._container,"active"),this._active=!0,void this._update())},_hidecontent:function(){this._content.innerHTML="",this._active=!1,L.DomUtil.removeClass(this._container,"active")},_update:function(){if(!this._map)return this;this._content.innerHTML="";var hide="none",info=[];for(var i in this._info)this._info.hasOwnProperty(i)&&this._info[i]&&(info.push(this.options.sanitizer(i)),hide="block");return this._content.innerHTML+=info.join(" | "),this._container.style.display=hide,this},_onLayerAdd:function(e){e.layer.getAttribution&&e.layer.getAttribution()?this.addInfo(e.layer.getAttribution()):"on"in e.layer&&e.layer.getAttribution&&e.layer.on("ready",L.bind(function(){this.addInfo(e.layer.getAttribution())},this))},_onLayerRemove:function(e){e.layer.getAttribution&&this.removeInfo(e.layer.getAttribution())}});module.exports.InfoControl=InfoControl,module.exports.infoControl=function(options){return new InfoControl(options)}},{"sanitize-caja":4}],16:[function(require,module,exports){"use strict";var LegendControl=L.Control.extend({options:{position:"bottomright",sanitizer:require("sanitize-caja")},initialize:function(options){L.setOptions(this,options),this._legends={}},onAdd:function(){return this._container=L.DomUtil.create("div","map-legends wax-legends"),L.DomEvent.disableClickPropagation(this._container),this._update(),this._container},addLegend:function(text){return text?(this._legends[text]||(this._legends[text]=0),this._legends[text]++,this._update()):this},removeLegend:function(text){return text?(this._legends[text]&&this._legends[text]--,this._update()):this},_update:function(){if(!this._map)return this;this._container.innerHTML="";var hide="none";for(var i in this._legends)if(this._legends.hasOwnProperty(i)&&this._legends[i]){var div=L.DomUtil.create("div","map-legend wax-legend",this._container);div.innerHTML=this.options.sanitizer(i),hide="block"}return this._container.style.display=hide,this}});module.exports.LegendControl=LegendControl,module.exports.legendControl=function(options){return new LegendControl(options)}},{"sanitize-caja":4}],17:[function(require,module,exports){"use strict";var request=require("./request"),url=require("./url"),util=require("./util");module.exports={_loadTileJSON:function(_){"string"==typeof _?(_=url.tileJSON(_,this.options&&this.options.accessToken),request(_,L.bind(function(err,json){err?(util.log("could not load TileJSON at "+_),this.fire("error",{error:err})):json&&(this._setTileJSON(json),this.fire("ready"))},this))):_&&"object"==typeof _&&this._setTileJSON(_)}}},{"./request":22,"./url":26,"./util":27}],18:[function(require,module,exports){"use strict";function withAccessToken(options,accessToken){return!accessToken||options.accessToken?options:L.extend({accessToken:accessToken},options)}var tileLayer=require("./tile_layer").tileLayer,featureLayer=require("./feature_layer").featureLayer,gridLayer=require("./grid_layer").gridLayer,gridControl=require("./grid_control").gridControl,infoControl=require("./info_control").infoControl,shareControl=require("./share_control").shareControl,legendControl=require("./legend_control").legendControl,mapboxLogoControl=require("./mapbox_logo").mapboxLogoControl,feedback=require("./feedback"),LMap=L.Map.extend({includes:[require("./load_tilejson")],options:{tileLayer:{},featureLayer:{},gridLayer:{},legendControl:{},gridControl:{},infoControl:!1,shareControl:!1,sanitizer:require("sanitize-caja")},_tilejson:{},initialize:function(element,_,options){if(L.Map.prototype.initialize.call(this,element,L.extend({},L.Map.prototype.options,options)),this.attributionControl){this.attributionControl.setPrefix("");var compact=this.options.attributionControl.compact;(compact||compact!==!1&&this._container.offsetWidth<=640)&&L.DomUtil.addClass(this.attributionControl._container,"leaflet-compact-attribution"),void 0===compact&&this.on("resize",function(){this._container.offsetWidth>640?L.DomUtil.removeClass(this.attributionControl._container,"leaflet-compact-attribution"):L.DomUtil.addClass(this.attributionControl._container,"leaflet-compact-attribution")})}this.options.tileLayer&&(this.tileLayer=tileLayer(void 0,withAccessToken(this.options.tileLayer,this.options.accessToken)),this.addLayer(this.tileLayer)),this.options.featureLayer&&(this.featureLayer=featureLayer(void 0,withAccessToken(this.options.featureLayer,this.options.accessToken)),this.addLayer(this.featureLayer)),this.options.gridLayer&&(this.gridLayer=gridLayer(void 0,withAccessToken(this.options.gridLayer,this.options.accessToken)),this.addLayer(this.gridLayer)),this.options.gridLayer&&this.options.gridControl&&(this.gridControl=gridControl(this.gridLayer,this.options.gridControl),this.addControl(this.gridControl)),this.options.infoControl&&(this.infoControl=infoControl(this.options.infoControl),this.addControl(this.infoControl)),this.options.legendControl&&(this.legendControl=legendControl(this.options.legendControl),this.addControl(this.legendControl)),this.options.shareControl&&(this.shareControl=shareControl(void 0,withAccessToken(this.options.shareControl,this.options.accessToken)),this.addControl(this.shareControl)),this._mapboxLogoControl=mapboxLogoControl(this.options.mapboxLogoControl),this.addControl(this._mapboxLogoControl),this._loadTileJSON(_),this.on("layeradd",this._onLayerAdd,this).on("layerremove",this._onLayerRemove,this).on("moveend",this._updateMapFeedbackLink,this),this.whenReady(function(){feedback.on("change",this._updateMapFeedbackLink,this)}),this.on("unload",function(){feedback.off("change",this._updateMapFeedbackLink,this)})},_setTileJSON:function(_){return this._tilejson=_,this._initialize(_),this},getTileJSON:function(){return this._tilejson},_initialize:function(json){if(this.tileLayer&&(this.tileLayer._setTileJSON(json),this._updateLayer(this.tileLayer)),this.featureLayer&&!this.featureLayer.getGeoJSON()&&json.data&&json.data[0]&&this.featureLayer.loadURL(json.data[0]),this.gridLayer&&(this.gridLayer._setTileJSON(json),this._updateLayer(this.gridLayer)),this.infoControl&&json.attribution&&(this.infoControl.addInfo(this.options.sanitizer(json.attribution)),this._updateMapFeedbackLink()),this.legendControl&&json.legend&&this.legendControl.addLegend(json.legend),this.shareControl&&this.shareControl._setTileJSON(json),this._mapboxLogoControl._setTileJSON(json),!this._loaded&&json.center){var zoom=void 0!==this.getZoom()?this.getZoom():json.center[2],center=L.latLng(json.center[1],json.center[0]);this.setView(center,zoom)}},_updateMapFeedbackLink:function(){if(this._controlContainer.getElementsByClassName){var link=this._controlContainer.getElementsByClassName("mapbox-improve-map");if(link.length&&this._loaded){var center=this.getCenter().wrap(),tilejson=this._tilejson||{},id=tilejson.id||"",hash="#"+id+"/"+center.lng.toFixed(3)+"/"+center.lat.toFixed(3)+"/"+this.getZoom();for(var key in feedback.data)hash+="/"+key+"="+feedback.data[key];for(var i=0;i<link.length;i++)link[i].hash=hash}}},_onLayerAdd:function(e){"on"in e.layer&&e.layer.on("ready",this._onLayerReady,this),window.setTimeout(L.bind(this._updateMapFeedbackLink,this),0)},_onLayerRemove:function(e){"on"in e.layer&&e.layer.off("ready",this._onLayerReady,this),window.setTimeout(L.bind(this._updateMapFeedbackLink,this),0)},_onLayerReady:function(e){this._updateLayer(e.target)},_updateLayer:function(layer){layer.options&&(this.infoControl&&this._loaded&&this.infoControl.addInfo(layer.options.infoControl),this.attributionControl&&this._loaded&&layer.getAttribution&&this.attributionControl.addAttribution(layer.getAttribution()),L.stamp(layer)in this._zoomBoundLayers||!layer.options.maxZoom&&!layer.options.minZoom||(this._zoomBoundLayers[L.stamp(layer)]=layer),this._updateMapFeedbackLink(),this._updateZoomLevels())}});module.exports.Map=LMap,module.exports.map=function(element,_,options){return new LMap(element,_,options)}},{"./feature_layer":8,"./feedback":9,"./grid_control":13,"./grid_layer":14,"./info_control":15,"./legend_control":16,"./load_tilejson":17,"./mapbox_logo":20,"./share_control":23,"./tile_layer":25,"sanitize-caja":4}],19:[function(require,module,exports){"use strict";var geocoderControl=require("./geocoder_control"),gridControl=require("./grid_control"),featureLayer=require("./feature_layer"),legendControl=require("./legend_control"),shareControl=require("./share_control"),tileLayer=require("./tile_layer"),infoControl=require("./info_control"),map=require("./map"),gridLayer=require("./grid_layer");L.mapbox=module.exports={VERSION:require("../package.json").version,geocoder:require("./geocoder"),marker:require("./marker"),simplestyle:require("./simplestyle"),tileLayer:tileLayer.tileLayer,TileLayer:tileLayer.TileLayer,infoControl:infoControl.infoControl,InfoControl:infoControl.InfoControl,shareControl:shareControl.shareControl,ShareControl:shareControl.ShareControl,legendControl:legendControl.legendControl,LegendControl:legendControl.LegendControl,geocoderControl:geocoderControl.geocoderControl,GeocoderControl:geocoderControl.GeocoderControl,gridControl:gridControl.gridControl,GridControl:gridControl.GridControl,gridLayer:gridLayer.gridLayer,GridLayer:gridLayer.GridLayer,featureLayer:featureLayer.featureLayer,FeatureLayer:featureLayer.FeatureLayer,map:map.map,Map:map.Map,config:require("./config"),sanitize:require("sanitize-caja"),template:require("mustache").to_html,feedback:require("./feedback")},window.L.Icon.Default.imagePath=("https:"===document.location.protocol||"http:"===document.location.protocol?"":"https:")+"//api.tiles.mapbox.com/mapbox.js/v"+require("../package.json").version+"/images"},{"../package.json":6,"./config":7,"./feature_layer":8,"./feedback":9,"./geocoder":10,"./geocoder_control":11,"./grid_control":13,"./grid_layer":14,"./info_control":15,"./legend_control":16,"./map":18,"./marker":21,"./share_control":23,"./simplestyle":24,"./tile_layer":25,mustache:3,"sanitize-caja":4}],20:[function(require,module,exports){"use strict";var MapboxLogoControl=L.Control.extend({options:{position:"bottomleft"},initialize:function(options){L.setOptions(this,options)},onAdd:function(){return this._container=L.DomUtil.create("div","mapbox-logo"),this._container},_setTileJSON:function(json){json.mapbox_logo&&L.DomUtil.addClass(this._container,"mapbox-logo-true")}});module.exports.MapboxLogoControl=MapboxLogoControl,module.exports.mapboxLogoControl=function(options){return new MapboxLogoControl(options)}},{}],21:[function(require,module,exports){"use strict";function icon(fp,options){fp=fp||{};var sizes={small:[20,50],medium:[30,70],large:[35,90]},size=fp["marker-size"]||"medium",symbol="marker-symbol"in fp&&""!==fp["marker-symbol"]?"-"+fp["marker-symbol"]:"",color=(fp["marker-color"]||"7e7e7e").replace("#","");return L.icon({iconUrl:url("/marker/pin-"+size.charAt(0)+symbol+"+"+color+(L.Browser.retina?"@2x":"")+".png",options&&options.accessToken),iconSize:sizes[size],iconAnchor:[sizes[size][0]/2,sizes[size][1]/2],popupAnchor:[0,-sizes[size][1]/2]})}function style(f,latlon,options){return L.marker(latlon,{icon:icon(f.properties,options),title:util.strip_tags(sanitize(f.properties&&f.properties.title||""))})}function createPopup(f,sanitizer){if(!f||!f.properties)return"";var popup="";return f.properties.title&&(popup+='<div class="marker-title">'+f.properties.title+"</div>"),f.properties.description&&(popup+='<div class="marker-description">'+f.properties.description+"</div>"),(sanitizer||sanitize)(popup)}var url=require("./url"),util=require("./util"),sanitize=require("sanitize-caja");module.exports={icon:icon,style:style,createPopup:createPopup}},{"./url":26,"./util":27,"sanitize-caja":4}],22:[function(require,module,exports){"use strict";var corslite=require("corslite"),strict=require("./util").strict,config=require("./config"),protocol=/^(https?:)?(?=\/\/(.|api)\.tiles\.mapbox\.com\/)/;module.exports=function(url,callback){function onload(err,resp){!err&&resp&&(resp=JSON.parse(resp.responseText)),callback(err,resp)}return strict(url,"string"),strict(callback,"function"),url=url.replace(protocol,function(match,protocol){return"withCredentials"in new window.XMLHttpRequest?"https:"===protocol||"https:"===document.location.protocol||config.FORCE_HTTPS?"https:":"http:":document.location.protocol}),corslite(url,onload)}},{"./config":7,"./util":27,corslite:1}],23:[function(require,module,exports){"use strict";var urlhelper=require("./url"),ShareControl=L.Control.extend({includes:[require("./load_tilejson")],options:{position:"topleft",url:""},initialize:function(_,options){L.setOptions(this,options),this._loadTileJSON(_)},_setTileJSON:function(json){this._tilejson=json},onAdd:function(map){this._map=map;var container=L.DomUtil.create("div","leaflet-control-mapbox-share leaflet-bar"),link=L.DomUtil.create("a","mapbox-share mapbox-icon mapbox-icon-share",container);return link.href="#",this._modal=L.DomUtil.create("div","mapbox-modal",this._map._container),this._mask=L.DomUtil.create("div","mapbox-modal-mask",this._modal),this._content=L.DomUtil.create("div","mapbox-modal-content",this._modal),L.DomEvent.addListener(link,"click",this._shareClick,this),L.DomEvent.disableClickPropagation(container),this._map.on("mousedown",this._clickOut,this),container},_clickOut:function(e){return this._sharing?(L.DomEvent.preventDefault(e),L.DomUtil.removeClass(this._modal,"active"),this._content.innerHTML="",void(this._sharing=null)):void 0},_shareClick:function(e){if(L.DomEvent.stop(e),this._sharing)return this._clickOut(e);var tilejson=this._tilejson||this._map._tilejson||{},url=encodeURIComponent(this.options.url||tilejson.webpage||window.location),name=encodeURIComponent(tilejson.name),image=urlhelper("/"+tilejson.id+"/"+this._map.getCenter().lng+","+this._map.getCenter().lat+","+this._map.getZoom()+"/600x600.png",this.options.accessToken),embed=urlhelper("/"+tilejson.id+".html",this.options.accessToken),twitter="//twitter.com/intent/tweet?status="+name+" "+url,facebook="//www.facebook.com/sharer.php?u="+url+"&t="+encodeURIComponent(tilejson.name),pinterest="//www.pinterest.com/pin/create/button/?url="+url+"&media="+image+"&description="+tilejson.name,share='<h3>Share this map</h3><div class="mapbox-share-buttons"><a class="mapbox-button mapbox-button-icon mapbox-icon-facebook" target="_blank" href="{{facebook}}">Facebook</a><a class="mapbox-button mapbox-button-icon mapbox-icon-twitter" target="_blank" href="{{twitter}}">Twitter</a><a class="mapbox-button mapbox-button-icon mapbox-icon-pinterest" target="_blank" href="{{pinterest}}">Pinterest</a></div>'.replace("{{twitter}}",twitter).replace("{{facebook}}",facebook).replace("{{pinterest}}",pinterest),embedValue='<iframe width="100%" height="500px" frameBorder="0" src="{{embed}}"></iframe>'.replace("{{embed}}",embed),embedLabel="Copy and paste this <strong>HTML code</strong> into documents to embed this map on web pages.";L.DomUtil.addClass(this._modal,"active"),this._sharing=L.DomUtil.create("div","mapbox-modal-body",this._content),this._sharing.innerHTML=share;var input=L.DomUtil.create("input","mapbox-embed",this._sharing);input.type="text",input.value=embedValue;var label=L.DomUtil.create("label","mapbox-embed-description",this._sharing);label.innerHTML=embedLabel;var close=L.DomUtil.create("a","leaflet-popup-close-button",this._sharing);close.href="#",L.DomEvent.disableClickPropagation(this._sharing),L.DomEvent.addListener(close,"click",this._clickOut,this),L.DomEvent.addListener(input,"click",function(e){e.target.focus(),e.target.select()})}});module.exports.ShareControl=ShareControl,module.exports.shareControl=function(_,options){return new ShareControl(_,options)}},{"./load_tilejson":17,"./url":26}],24:[function(require,module,exports){"use strict";function fallback(a,b){var c={};for(var k in b)void 0===a[k]?c[k]=b[k]:c[k]=a[k];return c}function remap(a){for(var d={},i=0;i<mapping.length;i++)d[mapping[i][1]]=a[mapping[i][0]];return d}function style(feature){return remap(fallback(feature.properties||{},defaults))}var defaults={stroke:"#555555","stroke-width":2,"stroke-opacity":1,fill:"#555555","fill-opacity":.5},mapping=[["stroke","color"],["stroke-width","weight"],["stroke-opacity","opacity"],["fill","fillColor"],["fill-opacity","fillOpacity"]];module.exports={style:style,defaults:defaults}},{}],25:[function(require,module,exports){"use strict";var util=require("./util"),formatPattern=/\.((?:png|jpg)\d*)(?=$|\?)/,TileLayer=L.TileLayer.extend({includes:[require("./load_tilejson")],options:{sanitizer:require("sanitize-caja")},formats:["png","jpg","png32","png64","png128","png256","jpg70","jpg80","jpg90"],scalePrefix:"@2x.",initialize:function(_,options){L.TileLayer.prototype.initialize.call(this,void 0,options),this._tilejson={},options&&options.format&&util.strict_oneof(options.format,this.formats),this._loadTileJSON(_)},setFormat:function(_){return util.strict(_,"string"),this.options.format=_,this.redraw(),this},setUrl:null,_setTileJSON:function(json){util.strict(json,"object");var format;try{format=json.tiles[0].match(formatPattern)[1]}catch(e){format=json.format||"png"}return this.options.format=this.options.format||format,L.extend(this.options,{tiles:json.tiles,attribution:this.options.sanitizer(json.attribution),minZoom:json.minzoom||0,maxZoom:json.maxzoom||18,tms:"tms"===json.scheme,bounds:json.bounds&&util.lbounds(json.bounds)}),this._tilejson=json,this.redraw(),this},getTileJSON:function(){return this._tilejson},getTileUrl:function(tilePoint){var tiles=this.options.tiles,index=Math.floor(Math.abs(tilePoint.x+tilePoint.y)%tiles.length),url=tiles[index],templated=L.Util.template(url,tilePoint);return templated?templated.replace(formatPattern,(L.Browser.retina?this.scalePrefix:".")+this.options.format):templated},_update:function(){this.options.tiles&&L.TileLayer.prototype._update.call(this)}});module.exports.TileLayer=TileLayer,module.exports.tileLayer=function(_,options){return new TileLayer(_,options)}},{"./load_tilejson":17,"./util":27,"sanitize-caja":4}],26:[function(require,module,exports){"use strict";var config=require("./config"),version=require("../package.json").version;module.exports=function(path,accessToken){if(accessToken=accessToken||L.mapbox.accessToken,!accessToken&&config.REQUIRE_ACCESS_TOKEN)throw new Error("An API access token is required to use Mapbox.js. See https://www.mapbox.com/mapbox.js/api/v"+version+"/api-access-tokens/");var url="https:"===document.location.protocol||config.FORCE_HTTPS?config.HTTPS_URL:config.HTTP_URL;if(url+=path,url+=-1!==url.indexOf("?")?"&access_token=":"?access_token=",config.REQUIRE_ACCESS_TOKEN){if("s"===accessToken[0])throw new Error("Use a public access token (pk.*) with Mapbox.js, not a secret access token (sk.*). See https://www.mapbox.com/mapbox.js/api/v"+version+"/api-access-tokens/");url+=accessToken}return url},module.exports.tileJSON=function(urlOrMapID,accessToken){if(-1!==urlOrMapID.indexOf("/"))return urlOrMapID;var url=module.exports("/"+urlOrMapID+".json",accessToken);return 0===url.indexOf("https")&&(url+="&secure"),url}},{"../package.json":6,"./config":7}],27:[function(require,module,exports){"use strict";function contains(item,list){if(!list||!list.length)return!1;for(var i=0;i<list.length;i++)if(list[i]===item)return!0;return!1}module.exports={idUrl:function(_,t){-1===_.indexOf("/")?t.loadID(_):t.loadURL(_)},log:function(_){"object"==typeof console&&"function"==typeof console.error&&console.error(_)},strict:function(_,type){if(typeof _!==type)throw new Error("Invalid argument: "+type+" expected")},strict_instance:function(_,klass,name){if(!(_ instanceof klass))throw new Error("Invalid argument: "+name+" expected")},strict_oneof:function(_,values){if(!contains(_,values))throw new Error("Invalid argument: "+_+" given, valid values are "+values.join(", "))},strip_tags:function(_){return _.replace(/<[^<]+>/g,"")},lbounds:function(_){return new L.LatLngBounds([[_[1],_[0]],[_[3],_[2]]])}}},{}]},{},[19]),function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){(function(global){var L="undefined"!=typeof window?window.L:"undefined"!=typeof global?global.L:null,Nominatim=require("./geocoders/nominatim")["class"];module.exports={"class":L.Control.extend({options:{showResultIcons:!1,collapsed:!0,expand:"click",position:"topright",placeholder:"Search...",errorMessage:"Nothing found."},_callbackId:0,initialize:function(options){L.Util.setOptions(this,options),this.options.geocoder||(this.options.geocoder=new Nominatim)},onAdd:function(map){var input,className="leaflet-control-geocoder",container=L.DomUtil.create("div",className+" leaflet-bar"),icon=L.DomUtil.create("a","leaflet-control-geocoder-icon",container),form=this._form=L.DomUtil.create("form",className+"-form",container);return icon.innerHTML="&nbsp;",icon.href="javascript:void(0);",this._map=map,this._container=container,input=this._input=L.DomUtil.create("input"),input.type="text",input.placeholder=this.options.placeholder,L.DomEvent.addListener(input,"keydown",this._keydown,this),this._errorElement=document.createElement("div"),this._errorElement.className=className+"-form-no-error",this._errorElement.innerHTML=this.options.errorMessage,this._alts=L.DomUtil.create("ul",className+"-alternatives leaflet-control-geocoder-alternatives-minimized"),form.appendChild(input),this._container.appendChild(this._errorElement),container.appendChild(this._alts),L.DomEvent.addListener(form,"submit",this._geocode,this),this.options.collapsed?"click"===this.options.expand?L.DomEvent.addListener(icon,"click",function(e){0===e.button&&2!==e.detail&&this._toggle()},this):(L.DomEvent.addListener(icon,"mouseover",this._expand,this),L.DomEvent.addListener(icon,"mouseout",this._collapse,this),this._map.on("movestart",this._collapse,this)):(L.DomEvent.addListener(icon,"click",function(e){this._geocode(e)},this),this._expand()),L.DomEvent.disableClickPropagation(container),container},_geocodeResult:function(results){if(L.DomUtil.removeClass(this._container,"leaflet-control-geocoder-throbber"),1===results.length)this._geocodeResultSelected(results[0]);else if(results.length>0){this._alts.innerHTML="",this._results=results,L.DomUtil.removeClass(this._alts,"leaflet-control-geocoder-alternatives-minimized");for(var i=0;i<results.length;i++)this._alts.appendChild(this._createAlt(results[i],i))}else L.DomUtil.addClass(this._errorElement,"leaflet-control-geocoder-error")},markGeocode:function(result){return this._map.fitBounds(result.bbox),this._geocodeMarker&&this._map.removeLayer(this._geocodeMarker),this._geocodeMarker=new L.Marker(result.center).bindPopup(result.html||result.name).addTo(this._map).openPopup(),this},_geocode:function(event){return L.DomEvent.preventDefault(event),L.DomUtil.addClass(this._container,"leaflet-control-geocoder-throbber"),this._clearResults(),this.options.geocoder.geocode(this._input.value+", portugal",this._geocodeResult,this),!1},_geocodeResultSelected:function(result){this.options.collapsed?this._collapse():this._clearResults(),this.markGeocode(result)},_toggle:function(){this._container.className.indexOf("leaflet-control-geocoder-expanded")>=0?this._collapse():this._expand()},_expand:function(){L.DomUtil.addClass(this._container,"leaflet-control-geocoder-expanded"),this._input.select()},_collapse:function(){this._container.className=this._container.className.replace(" leaflet-control-geocoder-expanded",""),L.DomUtil.addClass(this._alts,"leaflet-control-geocoder-alternatives-minimized"),L.DomUtil.removeClass(this._errorElement,"leaflet-control-geocoder-error")},_clearResults:function(){L.DomUtil.addClass(this._alts,"leaflet-control-geocoder-alternatives-minimized"),this._selection=null,L.DomUtil.removeClass(this._errorElement,"leaflet-control-geocoder-error")},_createAlt:function(result,index){var li=L.DomUtil.create("li",""),a=L.DomUtil.create("a","",li),icon=this.options.showResultIcons&&result.icon?L.DomUtil.create("img","",a):null,text=result.html?void 0:document.createTextNode(result.name),clickHandler=function(e){L.DomEvent.preventDefault(e),this._geocodeResultSelected(result)};return icon&&(icon.src=result.icon),li.setAttribute("data-result-index",index),result.html?a.innerHTML=result.html:a.appendChild(text),L.DomEvent.addListener(li,"click",clickHandler,this),li},_keydown:function(e){var _this=this,select=function(dir){_this._selection&&(L.DomUtil.removeClass(_this._selection,"leaflet-control-geocoder-selected"),_this._selection=_this._selection[dir>0?"nextSibling":"previousSibling"]),_this._selection||(_this._selection=_this._alts[dir>0?"firstChild":"lastChild"]),_this._selection&&L.DomUtil.addClass(_this._selection,"leaflet-control-geocoder-selected")};switch(e.keyCode){case 27:this.options.collapsed&&this._collapse();break;case 38:select(-1),L.DomEvent.preventDefault(e);break;case 40:select(1),L.DomEvent.preventDefault(e);break;case 13:if(this._selection){var index=parseInt(this._selection.getAttribute("data-result-index"),10);this._geocodeResultSelected(this._results[index]),this._clearResults(),L.DomEvent.preventDefault(e)}}return!0}}),factory:function(options){return new L.Control.Geocoder(options)}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./geocoders/nominatim":6}],2:[function(require,module,exports){(function(global){var L="undefined"!=typeof window?window.L:"undefined"!=typeof global?global.L:null,Util=require("../util");module.exports={"class":L.Class.extend({initialize:function(key){this.key=key},geocode:function(query,cb,context){Util.jsonp("http://dev.virtualearth.net/REST/v1/Locations",{query:query,key:this.key},function(data){var results=[];if(data.resourceSets.length>0)for(var i=data.resourceSets[0].resources.length-1;i>=0;i--){var resource=data.resourceSets[0].resources[i],bbox=resource.bbox;results[i]={name:resource.name,bbox:L.latLngBounds([bbox[0],bbox[1]],[bbox[2],bbox[3]]),center:L.latLng(resource.point.coordinates)}}cb.call(context,results)},this,"jsonp")},reverse:function(location,scale,cb,context){Util.jsonp("http://dev.virtualearth.net/REST/v1/Locations/"+location.lat+","+location.lng,{key:this.key},function(data){for(var results=[],i=data.resourceSets[0].resources.length-1;i>=0;i--){var resource=data.resourceSets[0].resources[i],bbox=resource.bbox;results[i]={name:resource.name,bbox:L.latLngBounds([bbox[0],bbox[1]],[bbox[2],bbox[3]]),center:L.latLng(resource.point.coordinates)}}cb.call(context,results)},this,"jsonp")}}),factory:function(key){return new L.Control.Geocoder.Bing(key)}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../util":10}],3:[function(require,module,exports){(function(global){var L="undefined"!=typeof window?window.L:"undefined"!=typeof global?global.L:null,Util=require("../util");module.exports={"class":L.Class.extend({options:{serviceUrl:"https://maps.googleapis.com/maps/api/geocode/json",geocodingQueryParams:{},reverseQueryParams:{}},initialize:function(key,options){this._key=key,L.setOptions(this,options),this.options.serviceUrl=this.options.service_url||this.options.serviceUrl},geocode:function(query,cb,context){var params={address:query};this._key&&this._key.length&&(params.key=this._key),params=L.Util.extend(params,this.options.geocodingQueryParams),Util.getJSON(this.options.serviceUrl,params,function(data){var loc,latLng,latLngBounds,results=[];if(data.results&&data.results.length)for(var i=0;i<=data.results.length-1;i++)loc=data.results[i],latLng=L.latLng(loc.geometry.location),latLngBounds=L.latLngBounds(L.latLng(loc.geometry.viewport.northeast),L.latLng(loc.geometry.viewport.southwest)),results[i]={name:loc.formatted_address,bbox:latLngBounds,center:latLng,properties:loc.address_components};cb.call(context,results)})},reverse:function(location,scale,cb,context){var params={latlng:encodeURIComponent(location.lat)+","+encodeURIComponent(location.lng)};params=L.Util.extend(params,this.options.reverseQueryParams),this._key&&this._key.length&&(params.key=this._key),Util.getJSON(this.options.serviceUrl,params,function(data){var loc,latLng,latLngBounds,results=[];if(data.results&&data.results.length)for(var i=0;i<=data.results.length-1;i++)loc=data.results[i],latLng=L.latLng(loc.geometry.location),latLngBounds=L.latLngBounds(L.latLng(loc.geometry.viewport.northeast),L.latLng(loc.geometry.viewport.southwest)),results[i]={name:loc.formatted_address,bbox:latLngBounds,center:latLng,properties:loc.address_components};cb.call(context,results)})}}),factory:function(key,options){return new L.Control.Geocoder.Google(key,options)}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../util":10}],4:[function(require,module,exports){(function(global){var L="undefined"!=typeof window?window.L:"undefined"!=typeof global?global.L:null,Util=require("../util");module.exports={"class":L.Class.extend({options:{serviceUrl:"https://api.tiles.mapbox.com/v4/geocode/mapbox.places-v1/"},initialize:function(accessToken,options){L.setOptions(this,options),this._accessToken=accessToken},geocode:function(query,cb,context){Util.getJSON(this.options.serviceUrl+encodeURIComponent(query)+".json",{access_token:this._accessToken},function(data){var loc,latLng,latLngBounds,results=[];if(data.features&&data.features.length)for(var i=0;i<=data.features.length-1;i++)loc=data.features[i],latLng=L.latLng(loc.center.reverse()),latLngBounds=loc.hasOwnProperty("bbox")?L.latLngBounds(L.latLng(loc.bbox.slice(0,2).reverse()),L.latLng(loc.bbox.slice(2,4).reverse())):L.latLngBounds(latLng,latLng),results[i]={name:loc.place_name,bbox:latLngBounds,center:latLng};cb.call(context,results)})},suggest:function(query,cb,context){return this.geocode(query,cb,context)},reverse:function(location,scale,cb,context){Util.getJSON(this.options.serviceUrl+encodeURIComponent(location.lng)+","+encodeURIComponent(location.lat)+".json",{access_token:this._accessToken},function(data){var loc,latLng,latLngBounds,results=[];if(data.features&&data.features.length)for(var i=0;i<=data.features.length-1;i++)loc=data.features[i],latLng=L.latLng(loc.center.reverse()),latLngBounds=loc.hasOwnProperty("bbox")?L.latLngBounds(L.latLng(loc.bbox.slice(0,2).reverse()),L.latLng(loc.bbox.slice(2,4).reverse())):L.latLngBounds(latLng,latLng),results[i]={name:loc.place_name,bbox:latLngBounds,center:latLng};cb.call(context,results)})}}),factory:function(accessToken,options){return new L.Control.Geocoder.Mapbox(accessToken,options)}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../util":10}],5:[function(require,module,exports){(function(global){var L="undefined"!=typeof window?window.L:"undefined"!=typeof global?global.L:null,Util=require("../util");module.exports={
"class":L.Class.extend({options:{serviceUrl:"http://www.mapquestapi.com/geocoding/v1"},initialize:function(key,options){this._key=decodeURIComponent(key),L.Util.setOptions(this,options)},_formatName:function(){var i,r=[];for(i=0;i<arguments.length;i++)arguments[i]&&r.push(arguments[i]);return r.join(", ")},geocode:function(query,cb,context){Util.jsonp(this.options.serviceUrl+"/address",{key:this._key,location:query,limit:5,outFormat:"json"},function(data){var loc,latLng,results=[];if(data.results&&data.results[0].locations)for(var i=data.results[0].locations.length-1;i>=0;i--)loc=data.results[0].locations[i],latLng=L.latLng(loc.latLng),results[i]={name:this._formatName(loc.street,loc.adminArea4,loc.adminArea3,loc.adminArea1),bbox:L.latLngBounds(latLng,latLng),center:latLng};cb.call(context,results)},this)},reverse:function(location,scale,cb,context){Util.jsonp(this.options.serviceUrl+"/reverse",{key:this._key,location:location.lat+","+location.lng,outputFormat:"json"},function(data){var loc,latLng,results=[];if(data.results&&data.results[0].locations)for(var i=data.results[0].locations.length-1;i>=0;i--)loc=data.results[0].locations[i],latLng=L.latLng(loc.latLng),results[i]={name:this._formatName(loc.street,loc.adminArea4,loc.adminArea3,loc.adminArea1),bbox:L.latLngBounds(latLng,latLng),center:latLng};cb.call(context,results)},this)}}),factory:function(key,options){return new L.Control.Geocoder.MapQuest(key,options)}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../util":10}],6:[function(require,module,exports){(function(global){var L="undefined"!=typeof window?window.L:"undefined"!=typeof global?global.L:null,Util=require("../util");module.exports={"class":L.Class.extend({options:{serviceUrl:"http://nominatim.openstreetmap.org/",geocodingQueryParams:{},reverseQueryParams:{},htmlTemplate:function(r){var a=r.address,parts=[];return(a.road||a.building)&&parts.push("{building} {road} {house_number}"),(a.city||a.town||a.village)&&parts.push('<span class="'+(parts.length>0?"leaflet-control-geocoder-address-detail":"")+'">{postcode} {city} {town} {village}</span>'),(a.state||a.country)&&parts.push('<span class="'+(parts.length>0?"leaflet-control-geocoder-address-context":"")+'">{state} {country}</span>'),Util.template(parts.join("<br/>"),a,!0)}},initialize:function(options){L.Util.setOptions(this,options)},geocode:function(query,cb,context){Util.jsonp(this.options.serviceUrl+"search/",L.extend({q:query,limit:5,format:"json",addressdetails:1},this.options.geocodingQueryParams),function(data){for(var results=[],i=data.length-1;i>=0;i--){for(var bbox=data[i].boundingbox,j=0;4>j;j++)bbox[j]=parseFloat(bbox[j]);results[i]={icon:data[i].icon,name:data[i].display_name,html:this.options.htmlTemplate?this.options.htmlTemplate(data[i]):void 0,bbox:L.latLngBounds([bbox[0],bbox[2]],[bbox[1],bbox[3]]),center:L.latLng(data[i].lat,data[i].lon),properties:data[i]}}cb.call(context,results)},this,"json_callback")},reverse:function(location,scale,cb,context){Util.jsonp(this.options.serviceUrl+"reverse/",L.extend({lat:location.lat,lon:location.lng,zoom:Math.round(Math.log(scale/256)/Math.log(2)),addressdetails:1,format:"json"},this.options.reverseQueryParams),function(data){var loc,result=[];data&&data.lat&&data.lon&&(loc=L.latLng(data.lat,data.lon),result.push({name:data.display_name,html:this.options.htmlTemplate?this.options.htmlTemplate(data):void 0,center:loc,bounds:L.latLngBounds(loc,loc),properties:data})),cb.call(context,result)},this,"json_callback")}}),factory:function(options){return new L.Control.Geocoder.Nominatim(options)}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../util":10}],7:[function(require,module,exports){(function(global){var L="undefined"!=typeof window?window.L:"undefined"!=typeof global?global.L:null,Util=require("../util");module.exports={"class":L.Class.extend({options:{serviceUrl:"http://photon.komoot.de/api/",reverseUrl:"http://photon.komoot.de/reverse/",nameProperties:["name","street","suburb","hamlet","town","city","state","country"]},initialize:function(options){L.setOptions(this,options)},geocode:function(query,cb,context){var params=L.extend({q:query},this.options.geocodingQueryParams);Util.getJSON(this.options.serviceUrl,params,L.bind(function(data){cb.call(context,this._decodeFeatures(data))},this))},suggest:function(query,cb,context){return this.geocode(query,cb,context)},reverse:function(latLng,scale,cb,context){var params=L.extend({lat:latLng.lat,lon:latLng.lng},this.options.geocodingQueryParams);Util.getJSON(this.options.reverseUrl,params,L.bind(function(data){cb.call(context,this._decodeFeatures(data))},this))},_decodeFeatures:function(data){var i,f,c,latLng,extent,bbox,results=[];if(data&&data.features)for(i=0;i<data.features.length;i++)f=data.features[i],c=f.geometry.coordinates,latLng=L.latLng(c[1],c[0]),extent=f.properties.extent,bbox=extent?L.latLngBounds([extent[1],extent[0]],[extent[3],extent[2]]):L.latLngBounds(latLng,latLng),results.push({name:this._deocodeFeatureName(f),center:latLng,bbox:bbox,properties:f.properties});return results},_deocodeFeatureName:function(f){var j,name;for(j=0;!name&&j<this.options.nameProperties.length;j++)name=f.properties[this.options.nameProperties[j]];return name}}),factory:function(options){return new L.Control.Geocoder.Photon(options)}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../util":10}],8:[function(require,module,exports){(function(global){var L="undefined"!=typeof window?window.L:"undefined"!=typeof global?global.L:null,Util=require("../util");module.exports={"class":L.Class.extend({options:{serviceUrl:"http://api.what3words.com/"},initialize:function(accessToken){this._accessToken=accessToken},geocode:function(query,cb,context){Util.getJSON(this.options.serviceUrl+"w3w",{key:this._accessToken,string:query.split(/\s+/).join(".")},function(data){var loc,latLng,latLngBounds,results=[];data.position&&data.position.length&&(loc=data.words,latLng=L.latLng(data.position[0],data.position[1]),latLngBounds=L.latLngBounds(latLng,latLng),results[0]={name:loc.join("."),bbox:latLngBounds,center:latLng}),cb.call(context,results)})},suggest:function(query,cb,context){return this.geocode(query,cb,context)},reverse:function(location,scale,cb,context){Util.getJSON(this.options.serviceUrl+"position",{key:this._accessToken,position:[location.lat,location.lng].join(",")},function(data){var loc,latLng,latLngBounds,results=[];data.position&&data.position.length&&(loc=data.words,latLng=L.latLng(data.position[0],data.position[1]),latLngBounds=L.latLngBounds(latLng,latLng),results[0]={name:loc.join("."),bbox:latLngBounds,center:latLng}),cb.call(context,results)})}}),factory:function(accessToken){return new L.Control.Geocoder.What3Words(accessToken)}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../util":10}],9:[function(require,module,exports){(function(global){var L="undefined"!=typeof window?window.L:"undefined"!=typeof global?global.L:null,Control=require("./control"),Nominatim=require("./geocoders/nominatim"),Bing=require("./geocoders/bing"),MapQuest=require("./geocoders/mapquest"),Mapbox=require("./geocoders/mapbox"),What3Words=require("./geocoders/what3words"),Google=require("./geocoders/google"),Photon=require("./geocoders/photon");module.exports=L.Util.extend(Control["class"],{Nominatim:Nominatim["class"],nominatim:Nominatim.factory,Bing:Bing["class"],bing:Bing.factory,MapQuest:MapQuest["class"],mapQuest:MapQuest.factory,Mapbox:Mapbox["class"],mapbox:Mapbox.factory,What3Words:What3Words["class"],what3words:What3Words.factory,Google:Google["class"],google:Google.factory,Photon:Photon["class"],photon:Photon.factory}),L.Util.extend(L.Control,{Geocoder:module.exports,geocoder:Control.factory})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./control":1,"./geocoders/bing":2,"./geocoders/google":3,"./geocoders/mapbox":4,"./geocoders/mapquest":5,"./geocoders/nominatim":6,"./geocoders/photon":7,"./geocoders/what3words":8}],10:[function(require,module,exports){(function(global){var L="undefined"!=typeof window?window.L:"undefined"!=typeof global?global.L:null,lastCallbackId=0,htmlEscape=function(){function escapeChar(chr){return escape[chr]}var badChars=/[&<>"'`]/g,possible=/[&<>"'`]/,escape={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"};return function(string){return null==string?"":string?(string=""+string,possible.test(string)?string.replace(badChars,escapeChar):string):string+""}}();module.exports={jsonp:function(url,params,callback,context,jsonpParam){var callbackId="_l_geocoder_"+lastCallbackId++;params[jsonpParam||"callback"]=callbackId,window[callbackId]=L.Util.bind(callback,context);var script=document.createElement("script");script.type="text/javascript",script.src=url+L.Util.getParamString(params),script.id=callbackId,document.getElementsByTagName("head")[0].appendChild(script)},getJSON:function(url,params,callback){var xmlHttp=new XMLHttpRequest;xmlHttp.onreadystatechange=function(){return 4===xmlHttp.readyState?200!==xmlHttp.status&&304!==xmlHttp.status?void callback(""):void callback(JSON.parse(xmlHttp.response)):void 0},xmlHttp.open("GET",url+L.Util.getParamString(params),!0),xmlHttp.setRequestHeader("Accept","application/json"),xmlHttp.send(null)},template:function(str,data){return str.replace(/\{ *([\w_]+) *\}/g,function(str,key){var value=data[key];return void 0===value?value="":"function"==typeof value&&(value=value(data)),htmlEscape(value)})},htmlEscape:htmlEscape}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[9]),function(){var root=this,previousUnderscore=root._,breaker={},ArrayProto=Array.prototype,ObjProto=Object.prototype,FuncProto=Function.prototype,push=ArrayProto.push,slice=ArrayProto.slice,concat=ArrayProto.concat,toString=ObjProto.toString,hasOwnProperty=ObjProto.hasOwnProperty,nativeForEach=ArrayProto.forEach,nativeMap=ArrayProto.map,nativeReduce=ArrayProto.reduce,nativeReduceRight=ArrayProto.reduceRight,nativeFilter=ArrayProto.filter,nativeEvery=ArrayProto.every,nativeSome=ArrayProto.some,nativeIndexOf=ArrayProto.indexOf,nativeLastIndexOf=ArrayProto.lastIndexOf,nativeIsArray=Array.isArray,nativeKeys=Object.keys,nativeBind=FuncProto.bind,_=function(obj){return obj instanceof _?obj:this instanceof _?void(this._wrapped=obj):new _(obj)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=_),exports._=_):root._=_,_.VERSION="1.6.0";var each=_.each=_.forEach=function(obj,iterator,context){if(null==obj)return obj;if(nativeForEach&&obj.forEach===nativeForEach)obj.forEach(iterator,context);else if(obj.length===+obj.length){for(var i=0,length=obj.length;length>i;i++)if(iterator.call(context,obj[i],i,obj)===breaker)return}else for(var keys=_.keys(obj),i=0,length=keys.length;length>i;i++)if(iterator.call(context,obj[keys[i]],keys[i],obj)===breaker)return;return obj};_.map=_.collect=function(obj,iterator,context){var results=[];return null==obj?results:nativeMap&&obj.map===nativeMap?obj.map(iterator,context):(each(obj,function(value,index,list){results.push(iterator.call(context,value,index,list))}),results)};var reduceError="Reduce of empty array with no initial value";_.reduce=_.foldl=_.inject=function(obj,iterator,memo,context){var initial=arguments.length>2;if(null==obj&&(obj=[]),nativeReduce&&obj.reduce===nativeReduce)return context&&(iterator=_.bind(iterator,context)),initial?obj.reduce(iterator,memo):obj.reduce(iterator);if(each(obj,function(value,index,list){initial?memo=iterator.call(context,memo,value,index,list):(memo=value,initial=!0)}),!initial)throw new TypeError(reduceError);return memo},_.reduceRight=_.foldr=function(obj,iterator,memo,context){var initial=arguments.length>2;if(null==obj&&(obj=[]),nativeReduceRight&&obj.reduceRight===nativeReduceRight)return context&&(iterator=_.bind(iterator,context)),initial?obj.reduceRight(iterator,memo):obj.reduceRight(iterator);var length=obj.length;if(length!==+length){var keys=_.keys(obj);length=keys.length}if(each(obj,function(value,index,list){index=keys?keys[--length]:--length,initial?memo=iterator.call(context,memo,obj[index],index,list):(memo=obj[index],initial=!0)}),!initial)throw new TypeError(reduceError);return memo},_.find=_.detect=function(obj,predicate,context){var result;return any(obj,function(value,index,list){return predicate.call(context,value,index,list)?(result=value,!0):void 0}),result},_.filter=_.select=function(obj,predicate,context){var results=[];return null==obj?results:nativeFilter&&obj.filter===nativeFilter?obj.filter(predicate,context):(each(obj,function(value,index,list){predicate.call(context,value,index,list)&&results.push(value)}),results)},_.reject=function(obj,predicate,context){return _.filter(obj,function(value,index,list){return!predicate.call(context,value,index,list)},context)},_.every=_.all=function(obj,predicate,context){predicate||(predicate=_.identity);var result=!0;return null==obj?result:nativeEvery&&obj.every===nativeEvery?obj.every(predicate,context):(each(obj,function(value,index,list){return(result=result&&predicate.call(context,value,index,list))?void 0:breaker}),!!result)};var any=_.some=_.any=function(obj,predicate,context){predicate||(predicate=_.identity);var result=!1;return null==obj?result:nativeSome&&obj.some===nativeSome?obj.some(predicate,context):(each(obj,function(value,index,list){return result||(result=predicate.call(context,value,index,list))?breaker:void 0}),!!result)};_.contains=_.include=function(obj,target){return null==obj?!1:nativeIndexOf&&obj.indexOf===nativeIndexOf?-1!=obj.indexOf(target):any(obj,function(value){return value===target})},_.invoke=function(obj,method){var args=slice.call(arguments,2),isFunc=_.isFunction(method);return _.map(obj,function(value){return(isFunc?method:value[method]).apply(value,args)})},_.pluck=function(obj,key){return _.map(obj,_.property(key))},_.where=function(obj,attrs){return _.filter(obj,_.matches(attrs))},_.findWhere=function(obj,attrs){return _.find(obj,_.matches(attrs))},_.max=function(obj,iterator,context){if(!iterator&&_.isArray(obj)&&obj[0]===+obj[0]&&obj.length<65535)return Math.max.apply(Math,obj);var result=-(1/0),lastComputed=-(1/0);return each(obj,function(value,index,list){var computed=iterator?iterator.call(context,value,index,list):value;computed>lastComputed&&(result=value,lastComputed=computed)}),result},_.min=function(obj,iterator,context){if(!iterator&&_.isArray(obj)&&obj[0]===+obj[0]&&obj.length<65535)return Math.min.apply(Math,obj);var result=1/0,lastComputed=1/0;return each(obj,function(value,index,list){var computed=iterator?iterator.call(context,value,index,list):value;lastComputed>computed&&(result=value,lastComputed=computed)}),result},_.shuffle=function(obj){var rand,index=0,shuffled=[];return each(obj,function(value){rand=_.random(index++),shuffled[index-1]=shuffled[rand],shuffled[rand]=value}),shuffled},_.sample=function(obj,n,guard){return null==n||guard?(obj.length!==+obj.length&&(obj=_.values(obj)),obj[_.random(obj.length-1)]):_.shuffle(obj).slice(0,Math.max(0,n))};var lookupIterator=function(value){return null==value?_.identity:_.isFunction(value)?value:_.property(value)};_.sortBy=function(obj,iterator,context){return iterator=lookupIterator(iterator),_.pluck(_.map(obj,function(value,index,list){return{value:value,index:index,criteria:iterator.call(context,value,index,list)}}).sort(function(left,right){var a=left.criteria,b=right.criteria;if(a!==b){if(a>b||void 0===a)return 1;if(b>a||void 0===b)return-1}return left.index-right.index}),"value")};var group=function(behavior){return function(obj,iterator,context){var result={};return iterator=lookupIterator(iterator),each(obj,function(value,index){var key=iterator.call(context,value,index,obj);behavior(result,key,value)}),result}};_.groupBy=group(function(result,key,value){_.has(result,key)?result[key].push(value):result[key]=[value]}),_.indexBy=group(function(result,key,value){result[key]=value}),_.countBy=group(function(result,key){_.has(result,key)?result[key]++:result[key]=1}),_.sortedIndex=function(array,obj,iterator,context){iterator=lookupIterator(iterator);for(var value=iterator.call(context,obj),low=0,high=array.length;high>low;){var mid=low+high>>>1;iterator.call(context,array[mid])<value?low=mid+1:high=mid}return low},_.toArray=function(obj){return obj?_.isArray(obj)?slice.call(obj):obj.length===+obj.length?_.map(obj,_.identity):_.values(obj):[]},_.size=function(obj){return null==obj?0:obj.length===+obj.length?obj.length:_.keys(obj).length},_.first=_.head=_.take=function(array,n,guard){return null==array?void 0:null==n||guard?array[0]:0>n?[]:slice.call(array,0,n)},_.initial=function(array,n,guard){return slice.call(array,0,array.length-(null==n||guard?1:n))},_.last=function(array,n,guard){return null==array?void 0:null==n||guard?array[array.length-1]:slice.call(array,Math.max(array.length-n,0))},_.rest=_.tail=_.drop=function(array,n,guard){return slice.call(array,null==n||guard?1:n)},_.compact=function(array){return _.filter(array,_.identity)};var flatten=function(input,shallow,output){return shallow&&_.every(input,_.isArray)?concat.apply(output,input):(each(input,function(value){_.isArray(value)||_.isArguments(value)?shallow?push.apply(output,value):flatten(value,shallow,output):output.push(value)}),output)};_.flatten=function(array,shallow){return flatten(array,shallow,[])},_.without=function(array){return _.difference(array,slice.call(arguments,1))},_.partition=function(array,predicate){var pass=[],fail=[];return each(array,function(elem){(predicate(elem)?pass:fail).push(elem)}),[pass,fail]},_.uniq=_.unique=function(array,isSorted,iterator,context){_.isFunction(isSorted)&&(context=iterator,iterator=isSorted,isSorted=!1);var initial=iterator?_.map(array,iterator,context):array,results=[],seen=[];return each(initial,function(value,index){(isSorted?index&&seen[seen.length-1]===value:_.contains(seen,value))||(seen.push(value),results.push(array[index]))}),results},_.union=function(){return _.uniq(_.flatten(arguments,!0))},_.intersection=function(array){var rest=slice.call(arguments,1);return _.filter(_.uniq(array),function(item){return _.every(rest,function(other){return _.contains(other,item)})})},_.difference=function(array){var rest=concat.apply(ArrayProto,slice.call(arguments,1));return _.filter(array,function(value){return!_.contains(rest,value)})},_.zip=function(){for(var length=_.max(_.pluck(arguments,"length").concat(0)),results=new Array(length),i=0;length>i;i++)results[i]=_.pluck(arguments,""+i);return results},_.object=function(list,values){if(null==list)return{};for(var result={},i=0,length=list.length;length>i;i++)values?result[list[i]]=values[i]:result[list[i][0]]=list[i][1];return result},_.indexOf=function(array,item,isSorted){if(null==array)return-1;var i=0,length=array.length;if(isSorted){if("number"!=typeof isSorted)return i=_.sortedIndex(array,item),array[i]===item?i:-1;i=0>isSorted?Math.max(0,length+isSorted):isSorted}if(nativeIndexOf&&array.indexOf===nativeIndexOf)return array.indexOf(item,isSorted);for(;length>i;i++)if(array[i]===item)return i;return-1},_.lastIndexOf=function(array,item,from){if(null==array)return-1;var hasIndex=null!=from;if(nativeLastIndexOf&&array.lastIndexOf===nativeLastIndexOf)return hasIndex?array.lastIndexOf(item,from):array.lastIndexOf(item);for(var i=hasIndex?from:array.length;i--;)if(array[i]===item)return i;return-1},_.range=function(start,stop,step){arguments.length<=1&&(stop=start||0,start=0),step=arguments[2]||1;for(var length=Math.max(Math.ceil((stop-start)/step),0),idx=0,range=new Array(length);length>idx;)range[idx++]=start,start+=step;return range};var ctor=function(){};_.bind=function(func,context){var args,bound;if(nativeBind&&func.bind===nativeBind)return nativeBind.apply(func,slice.call(arguments,1));if(!_.isFunction(func))throw new TypeError;return args=slice.call(arguments,2),bound=function(){if(!(this instanceof bound))return func.apply(context,args.concat(slice.call(arguments)));ctor.prototype=func.prototype;var self=new ctor;ctor.prototype=null;var result=func.apply(self,args.concat(slice.call(arguments)));return Object(result)===result?result:self}},_.partial=function(func){var boundArgs=slice.call(arguments,1);return function(){for(var position=0,args=boundArgs.slice(),i=0,length=args.length;length>i;i++)args[i]===_&&(args[i]=arguments[position++]);for(;position<arguments.length;)args.push(arguments[position++]);return func.apply(this,args)}},_.bindAll=function(obj){var funcs=slice.call(arguments,1);if(0===funcs.length)throw new Error("bindAll must be passed function names");return each(funcs,function(f){obj[f]=_.bind(obj[f],obj)}),obj},_.memoize=function(func,hasher){var memo={};return hasher||(hasher=_.identity),function(){var key=hasher.apply(this,arguments);return _.has(memo,key)?memo[key]:memo[key]=func.apply(this,arguments)}},_.delay=function(func,wait){var args=slice.call(arguments,2);return setTimeout(function(){return func.apply(null,args)},wait)},_.defer=function(func){return _.delay.apply(_,[func,1].concat(slice.call(arguments,1)))},_.throttle=function(func,wait,options){var context,args,result,timeout=null,previous=0;options||(options={});var later=function(){previous=options.leading===!1?0:_.now(),timeout=null,result=func.apply(context,args),context=args=null};return function(){var now=_.now();previous||options.leading!==!1||(previous=now);var remaining=wait-(now-previous);return context=this,args=arguments,0>=remaining?(clearTimeout(timeout),timeout=null,previous=now,result=func.apply(context,args),context=args=null):timeout||options.trailing===!1||(timeout=setTimeout(later,remaining)),result}},_.debounce=function(func,wait,immediate){var timeout,args,context,timestamp,result,later=function(){var last=_.now()-timestamp;wait>last?timeout=setTimeout(later,wait-last):(timeout=null,immediate||(result=func.apply(context,args),context=args=null))};return function(){context=this,args=arguments,timestamp=_.now();var callNow=immediate&&!timeout;return timeout||(timeout=setTimeout(later,wait)),callNow&&(result=func.apply(context,args),context=args=null),result}},_.once=function(func){var memo,ran=!1;return function(){return ran?memo:(ran=!0,memo=func.apply(this,arguments),func=null,memo)}},_.wrap=function(func,wrapper){return _.partial(wrapper,func)},_.compose=function(){var funcs=arguments;return function(){for(var args=arguments,i=funcs.length-1;i>=0;i--)args=[funcs[i].apply(this,args)];return args[0]}},_.after=function(times,func){return function(){return--times<1?func.apply(this,arguments):void 0}},_.keys=function(obj){if(!_.isObject(obj))return[];if(nativeKeys)return nativeKeys(obj);var keys=[];for(var key in obj)_.has(obj,key)&&keys.push(key);return keys},_.values=function(obj){for(var keys=_.keys(obj),length=keys.length,values=new Array(length),i=0;length>i;i++)values[i]=obj[keys[i]];return values},_.pairs=function(obj){for(var keys=_.keys(obj),length=keys.length,pairs=new Array(length),i=0;length>i;i++)pairs[i]=[keys[i],obj[keys[i]]];return pairs},_.invert=function(obj){for(var result={},keys=_.keys(obj),i=0,length=keys.length;length>i;i++)result[obj[keys[i]]]=keys[i];return result},_.functions=_.methods=function(obj){var names=[];for(var key in obj)_.isFunction(obj[key])&&names.push(key);return names.sort()},_.extend=function(obj){return each(slice.call(arguments,1),function(source){if(source)for(var prop in source)obj[prop]=source[prop]}),obj},_.pick=function(obj){var copy={},keys=concat.apply(ArrayProto,slice.call(arguments,1));return each(keys,function(key){key in obj&&(copy[key]=obj[key])}),copy},_.omit=function(obj){var copy={},keys=concat.apply(ArrayProto,slice.call(arguments,1));for(var key in obj)_.contains(keys,key)||(copy[key]=obj[key]);return copy},_.defaults=function(obj){return each(slice.call(arguments,1),function(source){if(source)for(var prop in source)void 0===obj[prop]&&(obj[prop]=source[prop])}),obj},_.clone=function(obj){return _.isObject(obj)?_.isArray(obj)?obj.slice():_.extend({},obj):obj},_.tap=function(obj,interceptor){return interceptor(obj),obj};var eq=function(a,b,aStack,bStack){if(a===b)return 0!==a||1/a==1/b;if(null==a||null==b)return a===b;a instanceof _&&(a=a._wrapped),b instanceof _&&(b=b._wrapped);var className=toString.call(a);if(className!=toString.call(b))return!1;switch(className){case"[object String]":return a==String(b);case"[object Number]":return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if("object"!=typeof a||"object"!=typeof b)return!1;for(var length=aStack.length;length--;)if(aStack[length]==a)return bStack[length]==b;var aCtor=a.constructor,bCtor=b.constructor;if(aCtor!==bCtor&&!(_.isFunction(aCtor)&&aCtor instanceof aCtor&&_.isFunction(bCtor)&&bCtor instanceof bCtor)&&"constructor"in a&&"constructor"in b)return!1;aStack.push(a),bStack.push(b);var size=0,result=!0;if("[object Array]"==className){if(size=a.length,result=size==b.length)for(;size--&&(result=eq(a[size],b[size],aStack,bStack)););}else{for(var key in a)if(_.has(a,key)&&(size++,!(result=_.has(b,key)&&eq(a[key],b[key],aStack,bStack))))break;if(result){for(key in b)if(_.has(b,key)&&!size--)break;result=!size}}return aStack.pop(),bStack.pop(),result};_.isEqual=function(a,b){return eq(a,b,[],[])},_.isEmpty=function(obj){if(null==obj)return!0;if(_.isArray(obj)||_.isString(obj))return 0===obj.length;for(var key in obj)if(_.has(obj,key))return!1;return!0},_.isElement=function(obj){return!(!obj||1!==obj.nodeType)},_.isArray=nativeIsArray||function(obj){return"[object Array]"==toString.call(obj)},_.isObject=function(obj){return obj===Object(obj)},each(["Arguments","Function","String","Number","Date","RegExp"],function(name){_["is"+name]=function(obj){return toString.call(obj)=="[object "+name+"]"}}),_.isArguments(arguments)||(_.isArguments=function(obj){return!(!obj||!_.has(obj,"callee"))}),"function"!=typeof/./&&(_.isFunction=function(obj){return"function"==typeof obj}),_.isFinite=function(obj){return isFinite(obj)&&!isNaN(parseFloat(obj))},_.isNaN=function(obj){return _.isNumber(obj)&&obj!=+obj},_.isBoolean=function(obj){return obj===!0||obj===!1||"[object Boolean]"==toString.call(obj)},_.isNull=function(obj){return null===obj},_.isUndefined=function(obj){return void 0===obj},_.has=function(obj,key){return hasOwnProperty.call(obj,key)},_.noConflict=function(){return root._=previousUnderscore,this},_.identity=function(value){return value},_.constant=function(value){return function(){return value}},_.property=function(key){return function(obj){return obj[key]}},_.matches=function(attrs){return function(obj){if(obj===attrs)return!0;for(var key in attrs)if(attrs[key]!==obj[key])return!1;return!0}},_.times=function(n,iterator,context){for(var accum=Array(Math.max(0,n)),i=0;n>i;i++)accum[i]=iterator.call(context,i);return accum},_.random=function(min,max){return null==max&&(max=min,min=0),min+Math.floor(Math.random()*(max-min+1))},_.now=Date.now||function(){return(new Date).getTime()};var entityMap={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};entityMap.unescape=_.invert(entityMap.escape);var entityRegexes={escape:new RegExp("["+_.keys(entityMap.escape).join("")+"]","g"),unescape:new RegExp("("+_.keys(entityMap.unescape).join("|")+")","g")};_.each(["escape","unescape"],function(method){_[method]=function(string){return null==string?"":(""+string).replace(entityRegexes[method],function(match){return entityMap[method][match]})}}),_.result=function(object,property){if(null==object)return void 0;var value=object[property];return _.isFunction(value)?value.call(object):value},_.mixin=function(obj){each(_.functions(obj),function(name){var func=_[name]=obj[name];_.prototype[name]=function(){var args=[this._wrapped];return push.apply(args,arguments),result.call(this,func.apply(_,args))}})};var idCounter=0;_.uniqueId=function(prefix){var id=++idCounter+"";return prefix?prefix+id:id},_.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var noMatch=/(.)^/,escapes={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},escaper=/\\|'|\r|\n|\t|\u2028|\u2029/g;_.template=function(text,data,settings){var render;settings=_.defaults({},settings,_.templateSettings);var matcher=new RegExp([(settings.escape||noMatch).source,(settings.interpolate||noMatch).source,(settings.evaluate||noMatch).source].join("|")+"|$","g"),index=0,source="__p+='";text.replace(matcher,function(match,escape,interpolate,evaluate,offset){return source+=text.slice(index,offset).replace(escaper,function(match){return"\\"+escapes[match]}),escape&&(source+="'+\n((__t=("+escape+"))==null?'':_.escape(__t))+\n'"),interpolate&&(source+="'+\n((__t=("+interpolate+"))==null?'':__t)+\n'"),evaluate&&(source+="';\n"+evaluate+"\n__p+='"),index=offset+match.length,match}),source+="';\n",settings.variable||(source="with(obj||{}){\n"+source+"}\n"),source="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+source+"return __p;\n";try{render=new Function(settings.variable||"obj","_",source)}catch(e){throw e.source=source,e}if(data)return render(data,_);var template=function(data){return render.call(this,data,_)};return template.source="function("+(settings.variable||"obj")+"){\n"+source+"}",template},_.chain=function(obj){return _(obj).chain()};var result=function(obj){return this._chain?_(obj).chain():obj};_.mixin(_),each(["pop","push","reverse","shift","sort","splice","unshift"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){var obj=this._wrapped;return method.apply(obj,arguments),"shift"!=name&&"splice"!=name||0!==obj.length||delete obj[0],result.call(this,obj)}}),each(["concat","join","slice"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){return result.call(this,method.apply(this._wrapped,arguments))}}),_.extend(_.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}}),"function"==typeof define&&define.amd&&define("underscore",[],function(){return _})}.call(this),$.fn.extend({treed:function(o){var openedClass="glyphicon-minus-sign",closedClass="glyphicon-plus-sign";"undefined"!=typeof o&&("undefined"!=typeof o.openedClass&&(openedClass=o.openedClass),"undefined"!=typeof o.closedClass&&(closedClass=o.closedClass));var tree=$(this);tree.addClass("tree"),tree.find("li").has("ul").each(function(){var branch=$(this);branch.prepend("<i class='indicator glyphicon "+closedClass+"'></i>"),branch.addClass("branch"),branch.on("click",function(e){if(this==e.target){var icon=$(this).children("i:first");icon.toggleClass(openedClass+" "+closedClass),$(this).children().children().toggle()}}),branch.children().children().toggle()}),tree.find(".branch .indicator").each(function(){$(this).on("click",function(){$(this).closest("li").click()})}),tree.find(".branch>a").each(function(){$(this).on("click",function(e){$(this).closest("li").click(),e.preventDefault()})}),tree.find(".branch>button").each(function(){$(this).on("click",function(e){$(this).closest("li").click(),e.preventDefault()})})}}),function(){var modules={};!function(){"use strict";function extend(cls,name,props){var F=function(){};F.prototype=cls.prototype;var prototype=new F,fnTest=/xyz/.test(function(){xyz})?/\bparent\b/:/.*/;props=props||{};for(var k in props){var src=props[k],parent=prototype[k];"function"==typeof parent&&"function"==typeof src&&fnTest.test(src)?prototype[k]=function(src,parent){return function(){var tmp=this.parent;
this.parent=parent;var res=src.apply(this,arguments);return this.parent=tmp,res}}(src,parent):prototype[k]=src}prototype.typename=name;var new_cls=function(){prototype.init&&prototype.init.apply(this,arguments)};return new_cls.prototype=prototype,new_cls.prototype.constructor=new_cls,new_cls.extend=function(name,props){return"object"==typeof name&&(props=name,name="anonymous"),extend(new_cls,name,props)},new_cls}modules.object=extend(Object,"Object",{})}(),function(){"use strict";var ArrayProto=Array.prototype,ObjProto=Object.prototype,escapeMap={"&":"&amp;",'"':"&quot;","'":"&#39;","<":"&lt;",">":"&gt;"},escapeRegex=/[&"'<>]/g,lookupEscape=function(ch){return escapeMap[ch]},exports=modules.lib={};exports.withPrettyErrors=function(path,withInternals,func){try{return func()}catch(e){if(e.Update||(e=new exports.TemplateError(e)),e.Update(path),!withInternals){var old=e;e=new Error(old.message),e.name=old.name}throw e}},exports.TemplateError=function(message,lineno,colno){var err=this;return message instanceof Error?(err=message,message=message.name+": "+message.message):Error.captureStackTrace&&Error.captureStackTrace(err),err.name="Template render error",err.message=message,err.lineno=lineno,err.colno=colno,err.firstUpdate=!0,err.Update=function(path){var message="("+(path||"unknown path")+")";return this.firstUpdate&&(this.lineno&&this.colno?message+=" [Line "+this.lineno+", Column "+this.colno+"]":this.lineno&&(message+=" [Line "+this.lineno+"]")),message+="\n ",this.firstUpdate&&(message+=" "),this.message=message+(this.message||""),this.firstUpdate=!1,this},err},exports.TemplateError.prototype=Error.prototype,exports.escape=function(val){return val.replace(escapeRegex,lookupEscape)},exports.isFunction=function(obj){return"[object Function]"===ObjProto.toString.call(obj)},exports.isArray=Array.isArray||function(obj){return"[object Array]"===ObjProto.toString.call(obj)},exports.isString=function(obj){return"[object String]"===ObjProto.toString.call(obj)},exports.isObject=function(obj){return"[object Object]"===ObjProto.toString.call(obj)},exports.groupBy=function(obj,val){for(var result={},iterator=exports.isFunction(val)?val:function(obj){return obj[val]},i=0;i<obj.length;i++){var value=obj[i],key=iterator(value,i);(result[key]||(result[key]=[])).push(value)}return result},exports.toArray=function(obj){return Array.prototype.slice.call(obj)},exports.without=function(array){var result=[];if(!array)return result;for(var index=-1,length=array.length,contains=exports.toArray(arguments).slice(1);++index<length;)-1===exports.indexOf(contains,array[index])&&result.push(array[index]);return result},exports.extend=function(obj,obj2){for(var k in obj2)obj[k]=obj2[k];return obj},exports.repeat=function(char_,n){for(var str="",i=0;n>i;i++)str+=char_;return str},exports.each=function(obj,func,context){if(null!=obj)if(ArrayProto.each&&obj.each===ArrayProto.each)obj.forEach(func,context);else if(obj.length===+obj.length)for(var i=0,l=obj.length;l>i;i++)func.call(context,obj[i],i,obj)},exports.map=function(obj,func){var results=[];if(null==obj)return results;if(ArrayProto.map&&obj.map===ArrayProto.map)return obj.map(func);for(var i=0;i<obj.length;i++)results[results.length]=func(obj[i],i);return obj.length===+obj.length&&(results.length=obj.length),results},exports.asyncIter=function(arr,iter,cb){function next(){i++,i<arr.length?iter(arr[i],i,next,cb):cb()}var i=-1;next()},exports.asyncFor=function(obj,iter,cb){function next(){i++;var k=keys[i];len>i?iter(k,obj[k],i,len,next):cb()}var keys=exports.keys(obj),len=keys.length,i=-1;next()},exports.indexOf=Array.prototype.indexOf?function(arr,searchElement,fromIndex){return Array.prototype.indexOf.call(arr,searchElement,fromIndex)}:function(arr,searchElement,fromIndex){var length=this.length>>>0;for(fromIndex=+fromIndex||0,Math.abs(fromIndex)===1/0&&(fromIndex=0),0>fromIndex&&(fromIndex+=length,0>fromIndex&&(fromIndex=0));length>fromIndex;fromIndex++)if(arr[fromIndex]===searchElement)return fromIndex;return-1},Array.prototype.map||(Array.prototype.map=function(){throw new Error("map is unimplemented for this js engine")}),exports.keys=function(obj){if(Object.prototype.keys)return obj.keys();var keys=[];for(var k in obj)obj.hasOwnProperty(k)&&keys.push(k);return keys}}(),function(){"use strict";function makeMacro(argNames,kwargNames,func){return function(){var args,argCount=numArgs(arguments),kwargs=getKeywordArgs(arguments);if(argCount>argNames.length){args=Array.prototype.slice.call(arguments,0,argNames.length);for(var vals=Array.prototype.slice.call(arguments,args.length,argCount),i=0;i<vals.length;i++)i<kwargNames.length&&(kwargs[kwargNames[i]]=vals[i]);args.push(kwargs)}else if(argCount<argNames.length){args=Array.prototype.slice.call(arguments,0,argCount);for(var i=argCount;i<argNames.length;i++){var arg=argNames[i];args.push(kwargs[arg]),delete kwargs[arg]}args.push(kwargs)}else args=arguments;return func.apply(this,args)}}function makeKeywordArgs(obj){return obj.__keywords=!0,obj}function getKeywordArgs(args){var len=args.length;if(len){var lastArg=args[len-1];if(lastArg&&lastArg.hasOwnProperty("__keywords"))return lastArg}return{}}function numArgs(args){var len=args.length;if(0===len)return 0;var lastArg=args[len-1];return lastArg&&lastArg.hasOwnProperty("__keywords")?len-1:len}function SafeString(val){return"string"!=typeof val?val:void(this.val=val)}function copySafeness(dest,target){return dest instanceof SafeString?new SafeString(target):target.toString()}function markSafe(val){var type=typeof val;return"string"===type?new SafeString(val):"function"!==type?val:function(){var ret=val.apply(this,arguments);return"string"==typeof ret?new SafeString(ret):ret}}function suppressValue(val,autoescape){return val=void 0!==val&&null!==val?val:"",autoescape&&"string"==typeof val&&(val=lib.escape(val)),val}function memberLookup(obj,val){return obj=obj||{},"function"==typeof obj[val]?function(){return obj[val].apply(obj,arguments)}:obj[val]}function callWrap(obj,name,args){if(!obj)throw new Error("Unable to call `"+name+"`, which is undefined or falsey");if("function"!=typeof obj)throw new Error("Unable to call `"+name+"`, which is not a function");return obj.apply(this,args)}function contextOrFrameLookup(context,frame,name){var val=frame.lookup(name);return void 0!==val&&null!==val?val:context.lookup(name)}function handleError(error,lineno,colno){return error.lineno?error:new lib.TemplateError(error,lineno,colno)}function asyncEach(arr,dimen,iter,cb){if(lib.isArray(arr)){var len=arr.length;lib.asyncIter(arr,function(item,i,next){switch(dimen){case 1:iter(item,i,len,next);break;case 2:iter(item[0],item[1],i,len,next);break;case 3:iter(item[0],item[1],item[2],i,len,next);break;default:item.push(i,next),iter.apply(this,item)}},cb)}else lib.asyncFor(arr,function(key,val,i,len,next){iter(key,val,i,len,next)},cb)}function asyncAll(arr,dimen,func,cb){function done(i,output){finished++,outputArr[i]=output,finished===len&&cb(null,outputArr.join(""))}var len,outputArr,finished=0;if(lib.isArray(arr))if(len=arr.length,outputArr=new Array(len),0===len)cb(null,"");else for(var i=0;i<arr.length;i++){var item=arr[i];switch(dimen){case 1:func(item,i,len,done);break;case 2:func(item[0],item[1],i,len,done);break;case 3:func(item[0],item[1],item[2],i,len,done);break;default:item.push(i,done),func.apply(this,item)}}else{var keys=lib.keys(arr);if(len=keys.length,outputArr=new Array(len),0===len)cb(null,"");else for(var i=0;i<keys.length;i++){var k=keys[i];func(k,arr[k],i,len,done)}}}var lib=modules.lib,Obj=modules.object,Frame=Obj.extend({init:function(parent){this.variables={},this.parent=parent},set:function(name,val,resolveUp){var parts=name.split("."),obj=this.variables,frame=this;if(resolveUp){if(frame=this.resolve(parts[0]))return void frame.set(name,val);frame=this}for(var i=0;i<parts.length-1;i++){var id=parts[i];obj[id]||(obj[id]={}),obj=obj[id]}obj[parts[parts.length-1]]=val},get:function(name){var val=this.variables[name];return void 0!==val&&null!==val?val:null},lookup:function(name){var p=this.parent,val=this.variables[name];return void 0!==val&&null!==val?val:p&&p.lookup(name)},resolve:function(name){var p=this.parent,val=this.variables[name];return void 0!==val&&null!==val?this:p&&p.resolve(name)},push:function(){return new Frame(this)},pop:function(){return this.parent}});SafeString.prototype=Object.create(String.prototype),SafeString.prototype.valueOf=function(){return this.val},SafeString.prototype.toString=function(){return this.val},modules.runtime={Frame:Frame,makeMacro:makeMacro,makeKeywordArgs:makeKeywordArgs,numArgs:numArgs,suppressValue:suppressValue,memberLookup:memberLookup,contextOrFrameLookup:contextOrFrameLookup,callWrap:callWrap,handleError:handleError,isArray:lib.isArray,keys:lib.keys,SafeString:SafeString,copySafeness:copySafeness,markSafe:markSafe,asyncEach:asyncEach,asyncAll:asyncAll}}(),function(){"use strict";var path=modules.path,Obj=modules.object,lib=modules.lib,Loader=Obj.extend({on:function(name,func){this.listeners=this.listeners||{},this.listeners[name]=this.listeners[name]||[],this.listeners[name].push(func)},emit:function(name){var args=Array.prototype.slice.call(arguments,1);this.listeners&&this.listeners[name]&&lib.each(this.listeners[name],function(listener){listener.apply(null,args)})},resolve:function(from,to){return path.resolve(path.dirname(from),to)},isRelative:function(filename){return 0===filename.indexOf("./")||0===filename.indexOf("../")}});modules.loader=Loader}(),function(){"use strict";var Loader=modules.loader,WebLoader=Loader.extend({init:function(baseURL,neverUpdate){this.precompiled=window.nunjucksPrecompiled||{},this.baseURL=baseURL||"",this.neverUpdate=neverUpdate},getSource:function(name){if(this.precompiled[name])return{src:{type:"code",obj:this.precompiled[name]},path:name};var src=this.fetch(this.baseURL+"/"+name);return src?{src:src,path:name,noCache:!this.neverUpdate}:null},fetch:function(url,callback){var ajax,src,loading=!0;return window.XMLHttpRequest?ajax=new XMLHttpRequest:window.ActiveXObject&&(ajax=new ActiveXObject("Microsoft.XMLHTTP")),ajax.onreadystatechange=function(){4!==ajax.readyState||0!==ajax.status&&200!==ajax.status||!loading||(loading=!1,src=ajax.responseText)},url+=(-1===url.indexOf("?")?"?":"&")+"s="+(new Date).getTime(),ajax.open("GET",url,!1),ajax.send(),src}});modules["web-loaders"]={WebLoader:WebLoader}}(),function(){"undefined"==typeof window||window!==this?modules.loaders=modules["node-loaders"]:modules.loaders=modules["web-loaders"]}(),function(){"use strict";var lib=modules.lib,r=modules.runtime,filters={abs:function(n){return Math.abs(n)},batch:function(arr,linecount,fill_with){for(var res=[],tmp=[],i=0;i<arr.length;i++)i%linecount===0&&tmp.length&&(res.push(tmp),tmp=[]),tmp.push(arr[i]);if(tmp.length){if(fill_with)for(var i=tmp.length;linecount>i;i++)tmp.push(fill_with);res.push(tmp)}return res},capitalize:function(str){var ret=str.toLowerCase();return r.copySafeness(str,ret.charAt(0).toUpperCase()+ret.slice(1))},center:function(str,width){if(width=width||80,str.length>=width)return str;var spaces=width-str.length,pre=lib.repeat(" ",spaces/2-spaces%2),post=lib.repeat(" ",spaces/2);return r.copySafeness(str,pre+str+post)},"default":function(val,def){return val?val:def},dictsort:function(val,case_sensitive,by){if(!lib.isObject(val))throw new lib.TemplateError("dictsort filter: val must be an object");var array=[];for(var k in val)array.push([k,val[k]]);var si;if(void 0===by||"key"===by)si=0;else{if("value"!==by)throw new lib.TemplateError("dictsort filter: You can only sort by either key or value");si=1}return array.sort(function(t1,t2){var a=t1[si],b=t2[si];return case_sensitive||(lib.isString(a)&&(a=a.toUpperCase()),lib.isString(b)&&(b=b.toUpperCase())),a>b?1:a===b?0:-1}),array},escape:function(str){return"string"==typeof str||str instanceof r.SafeString?lib.escape(str):str},safe:function(str){return r.markSafe(str)},first:function(arr){return arr[0]},groupby:function(arr,attr){return lib.groupBy(arr,attr)},indent:function(str,width,indentfirst){width=width||4;for(var res="",lines=str.split("\n"),sp=lib.repeat(" ",width),i=0;i<lines.length;i++)res+=0!==i||indentfirst?sp+lines[i]+"\n":lines[i]+"\n";return r.copySafeness(str,res)},join:function(arr,del,attr){return del=del||"",attr&&(arr=lib.map(arr,function(v){return v[attr]})),arr.join(del)},last:function(arr){return arr[arr.length-1]},length:function(arr){return void 0!==arr?arr.length:0},list:function(val){if(lib.isString(val))return val.split("");if(lib.isObject(val)){var keys=[];if(Object.keys)keys=Object.keys(val);else for(var k in val)keys.push(k);return lib.map(keys,function(k){return{key:k,value:val[k]}})}if(lib.isArray(val))return val;throw new lib.TemplateError("list filter: type not iterable")},lower:function(str){return str.toLowerCase()},random:function(arr){return arr[Math.floor(Math.random()*arr.length)]},rejectattr:function(arr,attr){return arr.filter(function(item){return!item[attr]})},selectattr:function(arr,attr){return arr.filter(function(item){return!!item[attr]})},replace:function(str,old,new_,maxCount){if(old instanceof RegExp)return str.replace(old,new_);var res=str,last=res,count=1;for(res=res.replace(old,new_);last!==res&&!(count>=maxCount);)last=res,res=res.replace(old,new_),count++;return r.copySafeness(str,res)},reverse:function(val){var arr;return arr=lib.isString(val)?filters.list(val):lib.map(val,function(v){return v}),arr.reverse(),lib.isString(val)?r.copySafeness(val,arr.join("")):arr},round:function(val,precision,method){precision=precision||0;var rounder,factor=Math.pow(10,precision);return rounder="ceil"===method?Math.ceil:"floor"===method?Math.floor:Math.round,rounder(val*factor)/factor},slice:function(arr,slices,fillWith){for(var sliceLength=Math.floor(arr.length/slices),extra=arr.length%slices,offset=0,res=[],i=0;slices>i;i++){var start=offset+i*sliceLength;extra>i&&offset++;var end=offset+(i+1)*sliceLength,slice=arr.slice(start,end);fillWith&&i>=extra&&slice.push(fillWith),res.push(slice)}return res},sort:function(arr,reverse,caseSens,attr){return arr=lib.map(arr,function(v){return v}),arr.sort(function(a,b){var x,y;return attr?(x=a[attr],y=b[attr]):(x=a,y=b),!caseSens&&lib.isString(x)&&lib.isString(y)&&(x=x.toLowerCase(),y=y.toLowerCase()),y>x?reverse?1:-1:x>y?reverse?-1:1:0}),arr},string:function(obj){return r.copySafeness(obj,obj)},title:function(str){for(var words=str.split(" "),i=0;i<words.length;i++)words[i]=filters.capitalize(words[i]);return r.copySafeness(str,words.join(" "))},trim:function(str){return r.copySafeness(str,str.replace(/^\s*|\s*$/g,""))},truncate:function(input,length,killwords,end){var orig=input;if(length=length||255,input.length<=length)return input;if(killwords)input=input.substring(0,length);else{var idx=input.lastIndexOf(" ",length);-1===idx&&(idx=length),input=input.substring(0,idx)}return input+=void 0!==end&&null!==end?end:"...",r.copySafeness(orig,input)},upper:function(str){return str.toUpperCase()},urlencode:function(obj){var enc=encodeURIComponent;if(lib.isString(obj))return enc(obj);var parts;if(lib.isArray(obj))parts=obj.map(function(item){return enc(item[0])+"="+enc(item[1])});else{parts=[];for(var k in obj)obj.hasOwnProperty(k)&&parts.push(enc(k)+"="+enc(obj[k]))}return parts.join("&")},urlize:function(str,length,nofollow){isNaN(length)&&(length=1/0);var noFollowAttr=nofollow===!0?' rel="nofollow"':"",puncRE=/^(?:\(|<|&lt;)?(.*?)(?:\.|,|\)|\n|&gt;)?$/,emailRE=/^[\w.!#$%&'*+\-\/=?\^`{|}~]+@[a-z\d\-]+(\.[a-z\d\-]+)+$/i,httpHttpsRE=/^https?:\/\/.*$/,wwwRE=/^www\./,tldRE=/\.(?:org|net|com)(?:\:|\/|$)/,words=str.split(/\s+/).filter(function(word){return word&&word.length}).map(function(word){var matches=word.match(puncRE),possibleUrl=matches&&matches[1]||word;return httpHttpsRE.test(possibleUrl)?'<a href="'+possibleUrl+'"'+noFollowAttr+">"+possibleUrl.substr(0,length)+"</a>":wwwRE.test(possibleUrl)?'<a href="http://'+possibleUrl+'"'+noFollowAttr+">"+possibleUrl.substr(0,length)+"</a>":emailRE.test(possibleUrl)?'<a href="mailto:'+possibleUrl+'">'+possibleUrl+"</a>":tldRE.test(possibleUrl)?'<a href="http://'+possibleUrl+'"'+noFollowAttr+">"+possibleUrl.substr(0,length)+"</a>":word});return words.join(" ")},wordcount:function(str){var words=str?str.match(/\w+/g):null;return words?words.length:null},"float":function(val,def){var res=parseFloat(val);return isNaN(res)?def:res},"int":function(val,def){var res=parseInt(val,10);return isNaN(res)?def:res}};filters.d=filters["default"],filters.e=filters.escape,modules.filters=filters}(),function(){"use strict";function cycler(items){var index=-1;return{current:null,reset:function(){index=-1,this.current=null},next:function(){return index++,index>=items.length&&(index=0),this.current=items[index],this.current}}}function joiner(sep){sep=sep||",";var first=!0;return function(){var val=first?"":sep;return first=!1,val}}var globals={range:function(start,stop,step){stop?step||(step=1):(stop=start,start=0,step=1);for(var arr=[],i=start;stop>i;i+=step)arr.push(i);return arr},cycler:function(){return cycler(Array.prototype.slice.call(arguments))},joiner:function(sep){return joiner(sep)}};modules.globals=globals}(),function(){"use strict";var path=modules.path,lib=modules.lib,Obj=modules.object,compiler=(modules.lexer,modules.compiler),builtin_filters=modules.filters,builtin_loaders=modules.loaders,runtime=modules.runtime,globals=modules.globals,Frame=runtime.Frame,Environment=Obj.extend({init:function(loaders,opts){var opts=this.opts=opts||{};this.opts.dev=!!opts.dev,this.opts.autoescape=!!opts.autoescape,this.opts.trimBlocks=!!opts.trimBlocks,this.opts.lstripBlocks=!!opts.lstripBlocks,loaders?this.loaders=lib.isArray(loaders)?loaders:[loaders]:builtin_loaders.FileSystemLoader?this.loaders=[new builtin_loaders.FileSystemLoader("views")]:this.loaders=[new builtin_loaders.WebLoader("/views")],this.initCache(),this.filters={},this.asyncFilters=[],this.extensions={},this.extensionsList=[];for(var name in builtin_filters)this.addFilter(name,builtin_filters[name])},initCache:function(){lib.each(this.loaders,function(loader){loader.cache={},"function"==typeof loader.on&&loader.on("update",function(template){loader.cache[template]=null})})},addExtension:function(name,extension){extension._name=name,this.extensions[name]=extension,this.extensionsList.push(extension)},getExtension:function(name){return this.extensions[name]},addGlobal:function(name,value){globals[name]=value},addFilter:function(name,func,async){var wrapped=func;async&&this.asyncFilters.push(name),this.filters[name]=wrapped},getFilter:function(name){if(!this.filters[name])throw new Error("filter not found: "+name);return this.filters[name]},resolveTemplate:function(loader,parentName,filename){var isRelative=loader.isRelative&&parentName?loader.isRelative(filename):!1;return isRelative&&loader.resolve?loader.resolve(parentName,filename):filename},getTemplate:function(name,eagerCompile,parentName,cb){var that=this,tmpl=null;if(name&&name.raw&&(name=name.raw),lib.isFunction(parentName)&&(cb=parentName,parentName=null,eagerCompile=eagerCompile||!1),lib.isFunction(eagerCompile)&&(cb=eagerCompile,eagerCompile=!1),"string"!=typeof name)throw new Error("template names must be a string: "+name);for(var i=0;i<this.loaders.length;i++){var _name=this.resolveTemplate(this.loaders[i],parentName,name);if(tmpl=this.loaders[i].cache[_name])break}if(!tmpl){var syncResult;return lib.asyncIter(this.loaders,function(loader,i,next,done){function handle(src){src?(src.loader=loader,done(src)):next()}name=that.resolveTemplate(loader,parentName,name),loader.async?loader.getSource(name,function(err,src){if(err)throw err;handle(src)}):handle(loader.getSource(name))},function(info){if(info){var tmpl=new Template(info.src,this,info.path,eagerCompile);info.noCache||(info.loader.cache[name]=tmpl),cb?cb(null,tmpl):syncResult=tmpl}else{var err=new Error("template not found: "+name);if(!cb)throw err;cb(err)}}.bind(this)),syncResult}return eagerCompile&&tmpl.compile(),cb?void cb(null,tmpl):tmpl},express:function(app){function NunjucksView(name,opts){if(this.name=name,this.path=name,this.defaultEngine=opts.defaultEngine,this.ext=path.extname(name),!this.ext&&!this.defaultEngine)throw new Error("No default engine was specified and no extension was provided.");this.ext||(this.name+=this.ext=("."!==this.defaultEngine[0]?".":"")+this.defaultEngine)}var env=this;NunjucksView.prototype.render=function(opts,cb){env.render(this.name,opts,cb)},app.set("view",NunjucksView)},render:function(name,ctx,cb){lib.isFunction(ctx)&&(cb=ctx,ctx=null);var syncResult=null;return this.getTemplate(name,function(err,tmpl){if(err&&cb)cb(err);else{if(err)throw err;tmpl.render(ctx,cb||function(err,res){if(err)throw err;syncResult=res})}}),syncResult},renderString:function(src,ctx,opts,cb){lib.isFunction(opts)&&(cb=opts,opts={}),opts=opts||{};var tmpl=new Template(src,this,opts.path);return tmpl.render(ctx,cb)}}),Context=Obj.extend({init:function(ctx,blocks){this.ctx=ctx,this.blocks={},this.exported=[];for(var name in blocks)this.addBlock(name,blocks[name])},lookup:function(name){return name in globals&&!(name in this.ctx)?globals[name]:this.ctx[name]},setVariable:function(name,val){this.ctx[name]=val},getVariables:function(){return this.ctx},addBlock:function(name,block){this.blocks[name]=this.blocks[name]||[],this.blocks[name].push(block)},getBlock:function(name){if(!this.blocks[name])throw new Error('unknown block "'+name+'"');return this.blocks[name][0]},getSuper:function(env,name,block,frame,runtime,cb){var idx=lib.indexOf(this.blocks[name]||[],block),blk=this.blocks[name][idx+1],context=this;if(-1===idx||!blk)throw new Error('no super block available for "'+name+'"');blk(env,context,frame,runtime,cb)},addExport:function(name){this.exported.push(name)},getExported:function(){for(var exported={},i=0;i<this.exported.length;i++){var name=this.exported[i];exported[name]=this.ctx[name]}return exported}}),Template=Obj.extend({init:function(src,env,path,eagerCompile){if(this.env=env||new Environment,lib.isObject(src))switch(src.type){case"code":this.tmplProps=src.obj;break;case"string":this.tmplStr=src.obj}else{if(!lib.isString(src))throw new Error("src must be a string or an object describing the source");this.tmplStr=src}this.path=path,eagerCompile?lib.withPrettyErrors(this.path,this.env.dev,this._compile.bind(this)):this.compiled=!1},render:function(ctx,frame,cb){return"function"==typeof ctx?(cb=ctx,ctx={}):"function"==typeof frame&&(cb=frame,frame=null),lib.withPrettyErrors(this.path,this.env.dev,function(){try{this.compile()}catch(e){if(cb)return cb(e);throw e}var context=new Context(ctx||{},this.blocks),syncResult=null;return this.rootRenderFunc(this.env,context,frame||new Frame,runtime,cb||function(err,res){if(err)throw err;syncResult=res}),syncResult}.bind(this))},getExported:function(ctx,frame,cb){"function"==typeof ctx&&(cb=ctx,ctx={}),"function"==typeof frame&&(cb=frame,frame=null);try{this.compile()}catch(e){if(cb)return cb(e);throw e}var context=new Context(ctx||{},this.blocks);this.rootRenderFunc(this.env,context,frame||new Frame,runtime,function(){cb(null,context.getExported())})},compile:function(){this.compiled||this._compile()},_compile:function(){var props;if(this.tmplProps)props=this.tmplProps;else{var source=compiler.compile(this.tmplStr,this.env.asyncFilters,this.env.extensionsList,this.path,this.env.opts),func=new Function(source);props=func()}this.blocks=this._getBlocks(props),this.rootRenderFunc=props.root,this.compiled=!0},_getBlocks:function(props){var blocks={};for(var k in props)"b_"===k.slice(0,2)&&(blocks[k.slice(2)]=props[k]);return blocks}});modules.environment={Environment:Environment,Template:Template}}();var nunjucks,lib=modules.lib,env=modules.environment,compiler=modules.compiler,parser=modules.parser,lexer=modules.lexer,runtime=modules.runtime,Loader=modules.loader,loaders=modules.loaders,precompile=modules.precompile;nunjucks={},nunjucks.Environment=env.Environment,nunjucks.Template=env.Template,nunjucks.Loader=Loader,nunjucks.FileSystemLoader=loaders.FileSystemLoader,nunjucks.WebLoader=loaders.WebLoader,nunjucks.compiler=compiler,nunjucks.parser=parser,nunjucks.lexer=lexer,nunjucks.runtime=runtime;var e;nunjucks.configure=function(templatesPath,opts){opts=opts||{},lib.isObject(templatesPath)&&(opts=templatesPath,templatesPath=null);var noWatch="watch"in opts?!opts.watch:!1,loader=loaders.FileSystemLoader||loaders.WebLoader;return e=new env.Environment(new loader(templatesPath,noWatch),opts),opts&&opts.express&&e.express(opts.express),e},nunjucks.compile=function(src,env,path,eagerCompile){return e||nunjucks.configure(),new nunjucks.Template(src,env,path,eagerCompile)},nunjucks.render=function(name,ctx,cb){return e||nunjucks.configure(),e.render(name,ctx,cb)},nunjucks.renderString=function(src,ctx,cb){return e||nunjucks.configure(),e.renderString(src,ctx,cb)},precompile&&(nunjucks.precompile=precompile.precompile,nunjucks.precompileString=precompile.precompileString),nunjucks.require=function(name){return modules[name]},"function"==typeof define&&define.amd?define(function(){return nunjucks}):(window.nunjucks=nunjucks,"undefined"!=typeof module&&(module.exports=nunjucks))}(),"object"!=typeof JSON&&(JSON={}),function(){"use strict";function f(n){return 10>n?"0"+n:n}function quote(string){return escapable.lastIndex=0,escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return"string"==typeof c?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,partial,mind=gap,value=holder[key];switch(value&&"object"==typeof value&&"function"==typeof value.toJSON&&(value=value.toJSON(key)),"function"==typeof rep&&(value=rep.call(holder,key,value)),typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value)return"null";if(gap+=indent,partial=[],"[object Array]"===Object.prototype.toString.apply(value)){for(length=value.length,i=0;length>i;i+=1)partial[i]=str(i,value)||"null";return v=0===partial.length?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]",gap=mind,v}if(rep&&"object"==typeof rep)for(length=rep.length,i=0;length>i;i+=1)"string"==typeof rep[i]&&(k=rep[i],v=str(k,value),v&&partial.push(quote(k)+(gap?": ":":")+v));else for(k in value)Object.prototype.hasOwnProperty.call(value,k)&&(v=str(k,value),v&&partial.push(quote(k)+(gap?": ":":")+v));return v=0===partial.length?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}",gap=mind,v}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx,escapable,gap,indent,meta,rep;"function"!=typeof JSON.stringify&&(escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},JSON.stringify=function(value,replacer,space){var i;if(gap="",indent="","number"==typeof space)for(i=0;space>i;i+=1)indent+=" ";else"string"==typeof space&&(indent=space);if(rep=replacer,replacer&&"function"!=typeof replacer&&("object"!=typeof replacer||"number"!=typeof replacer.length))throw new Error("JSON.stringify");return str("",{"":value})}),"function"!=typeof JSON.parse&&(cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,JSON.parse=function(text,reviver){function walk(holder,key){var k,v,value=holder[key];if(value&&"object"==typeof value)for(k in value)Object.prototype.hasOwnProperty.call(value,k)&&(v=walk(value,k),void 0!==v?value[k]=v:delete value[k]);return reviver.call(holder,key,value)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),function(root,factory){if("function"==typeof define&&define.amd)define(["underscore","jquery","exports"],function(_,$,exports){root.Backbone=factory(root,exports,_,$)});else if("undefined"!=typeof exports){var _=require("underscore");factory(root,exports,_)}else root.Backbone=factory(root,{},root._,root.jQuery||root.Zepto||root.ender||root.$)}(this,function(root,Backbone,_,$){var previousBackbone=root.Backbone,array=[],slice=(array.push,array.slice);array.splice;Backbone.VERSION="1.1.2",Backbone.$=$,Backbone.noConflict=function(){return root.Backbone=previousBackbone,this},Backbone.emulateHTTP=!1,Backbone.emulateJSON=!1;var Events=Backbone.Events={on:function(name,callback,context){if(!eventsApi(this,"on",name,[callback,context])||!callback)return this;this._events||(this._events={});var events=this._events[name]||(this._events[name]=[]);return events.push({callback:callback,context:context,ctx:context||this}),this},once:function(name,callback,context){if(!eventsApi(this,"once",name,[callback,context])||!callback)return this;var self=this,once=_.once(function(){self.off(name,once),callback.apply(this,arguments)});return once._callback=callback,this.on(name,once,context)},off:function(name,callback,context){var retain,ev,events,names,i,l,j,k;if(!this._events||!eventsApi(this,"off",name,[callback,context]))return this;if(!name&&!callback&&!context)return this._events=void 0,this;for(names=name?[name]:_.keys(this._events),i=0,l=names.length;l>i;i++)if(name=names[i],events=this._events[name]){if(this._events[name]=retain=[],callback||context)for(j=0,k=events.length;k>j;j++)ev=events[j],(callback&&callback!==ev.callback&&callback!==ev.callback._callback||context&&context!==ev.context)&&retain.push(ev);retain.length||delete this._events[name]}return this},trigger:function(name){if(!this._events)return this;var args=slice.call(arguments,1);if(!eventsApi(this,"trigger",name,args))return this;var events=this._events[name],allEvents=this._events.all;return events&&triggerEvents(events,args),allEvents&&triggerEvents(allEvents,arguments),this},stopListening:function(obj,name,callback){var listeningTo=this._listeningTo;if(!listeningTo)return this;var remove=!name&&!callback;callback||"object"!=typeof name||(callback=this),obj&&((listeningTo={})[obj._listenId]=obj);for(var id in listeningTo)obj=listeningTo[id],obj.off(name,callback,this),(remove||_.isEmpty(obj._events))&&delete this._listeningTo[id];return this}},eventSplitter=/\s+/,eventsApi=function(obj,action,name,rest){if(!name)return!0;if("object"==typeof name){for(var key in name)obj[action].apply(obj,[key,name[key]].concat(rest));return!1}if(eventSplitter.test(name)){for(var names=name.split(eventSplitter),i=0,l=names.length;l>i;i++)obj[action].apply(obj,[names[i]].concat(rest));return!1}return!0},triggerEvents=function(events,args){var ev,i=-1,l=events.length,a1=args[0],a2=args[1],a3=args[2];switch(args.length){case 0:for(;++i<l;)(ev=events[i]).callback.call(ev.ctx);return;case 1:for(;++i<l;)(ev=events[i]).callback.call(ev.ctx,a1);return;case 2:for(;++i<l;)(ev=events[i]).callback.call(ev.ctx,a1,a2);return;case 3:for(;++i<l;)(ev=events[i]).callback.call(ev.ctx,a1,a2,a3);return;default:for(;++i<l;)(ev=events[i]).callback.apply(ev.ctx,args);return}},listenMethods={listenTo:"on",listenToOnce:"once"};_.each(listenMethods,function(implementation,method){Events[method]=function(obj,name,callback){var listeningTo=this._listeningTo||(this._listeningTo={}),id=obj._listenId||(obj._listenId=_.uniqueId("l"));
return listeningTo[id]=obj,callback||"object"!=typeof name||(callback=this),obj[implementation](name,callback,this),this}}),Events.bind=Events.on,Events.unbind=Events.off,_.extend(Backbone,Events);var Model=Backbone.Model=function(attributes,options){var attrs=attributes||{};options||(options={}),this.cid=_.uniqueId("c"),this.attributes={},options.collection&&(this.collection=options.collection),options.parse&&(attrs=this.parse(attrs,options)||{}),attrs=_.defaults({},attrs,_.result(this,"defaults")),this.set(attrs,options),this.changed={},this.initialize.apply(this,arguments)};_.extend(Model.prototype,Events,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(options){return _.clone(this.attributes)},sync:function(){return Backbone.sync.apply(this,arguments)},get:function(attr){return this.attributes[attr]},escape:function(attr){return _.escape(this.get(attr))},has:function(attr){return null!=this.get(attr)},set:function(key,val,options){var attr,attrs,unset,changes,silent,changing,prev,current;if(null==key)return this;if("object"==typeof key?(attrs=key,options=val):(attrs={})[key]=val,options||(options={}),!this._validate(attrs,options))return!1;unset=options.unset,silent=options.silent,changes=[],changing=this._changing,this._changing=!0,changing||(this._previousAttributes=_.clone(this.attributes),this.changed={}),current=this.attributes,prev=this._previousAttributes,this.idAttribute in attrs&&(this.id=attrs[this.idAttribute]);for(attr in attrs)val=attrs[attr],_.isEqual(current[attr],val)||changes.push(attr),_.isEqual(prev[attr],val)?delete this.changed[attr]:this.changed[attr]=val,unset?delete current[attr]:current[attr]=val;if(!silent){changes.length&&(this._pending=options);for(var i=0,l=changes.length;l>i;i++)this.trigger("change:"+changes[i],this,current[changes[i]],options)}if(changing)return this;if(!silent)for(;this._pending;)options=this._pending,this._pending=!1,this.trigger("change",this,options);return this._pending=!1,this._changing=!1,this},unset:function(attr,options){return this.set(attr,void 0,_.extend({},options,{unset:!0}))},clear:function(options){var attrs={};for(var key in this.attributes)attrs[key]=void 0;return this.set(attrs,_.extend({},options,{unset:!0}))},hasChanged:function(attr){return null==attr?!_.isEmpty(this.changed):_.has(this.changed,attr)},changedAttributes:function(diff){if(!diff)return this.hasChanged()?_.clone(this.changed):!1;var val,changed=!1,old=this._changing?this._previousAttributes:this.attributes;for(var attr in diff)_.isEqual(old[attr],val=diff[attr])||((changed||(changed={}))[attr]=val);return changed},previous:function(attr){return null!=attr&&this._previousAttributes?this._previousAttributes[attr]:null},previousAttributes:function(){return _.clone(this._previousAttributes)},fetch:function(options){options=options?_.clone(options):{},void 0===options.parse&&(options.parse=!0);var model=this,success=options.success;return options.success=function(resp){return model.set(model.parse(resp,options),options)?(success&&success(model,resp,options),void model.trigger("sync",model,resp,options)):!1},wrapError(this,options),this.sync("read",this,options)},save:function(key,val,options){var attrs,method,xhr,attributes=this.attributes;if(null==key||"object"==typeof key?(attrs=key,options=val):(attrs={})[key]=val,options=_.extend({validate:!0},options),attrs&&!options.wait){if(!this.set(attrs,options))return!1}else if(!this._validate(attrs,options))return!1;attrs&&options.wait&&(this.attributes=_.extend({},attributes,attrs)),void 0===options.parse&&(options.parse=!0);var model=this,success=options.success;return options.success=function(resp){model.attributes=attributes;var serverAttrs=model.parse(resp,options);return options.wait&&(serverAttrs=_.extend(attrs||{},serverAttrs)),_.isObject(serverAttrs)&&!model.set(serverAttrs,options)?!1:(success&&success(model,resp,options),void model.trigger("sync",model,resp,options))},wrapError(this,options),method=this.isNew()?"create":options.patch?"patch":"update","patch"===method&&(options.attrs=attrs),xhr=this.sync(method,this,options),attrs&&options.wait&&(this.attributes=attributes),xhr},destroy:function(options){options=options?_.clone(options):{};var model=this,success=options.success,destroy=function(){model.trigger("destroy",model,model.collection,options)};if(options.success=function(resp){(options.wait||model.isNew())&&destroy(),success&&success(model,resp,options),model.isNew()||model.trigger("sync",model,resp,options)},this.isNew())return options.success(),!1;wrapError(this,options);var xhr=this.sync("delete",this,options);return options.wait||destroy(),xhr},url:function(){var base=_.result(this,"urlRoot")||_.result(this.collection,"url")||urlError();return this.isNew()?base:base.replace(/([^\/])$/,"$1/")+encodeURIComponent(this.id)},parse:function(resp,options){return resp},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(options){return this._validate({},_.extend(options||{},{validate:!0}))},_validate:function(attrs,options){if(!options.validate||!this.validate)return!0;attrs=_.extend({},this.attributes,attrs);var error=this.validationError=this.validate(attrs,options)||null;return error?(this.trigger("invalid",this,error,_.extend(options,{validationError:error})),!1):!0}});var modelMethods=["keys","values","pairs","invert","pick","omit"];_.each(modelMethods,function(method){Model.prototype[method]=function(){var args=slice.call(arguments);return args.unshift(this.attributes),_[method].apply(_,args)}});var Collection=Backbone.Collection=function(models,options){options||(options={}),options.model&&(this.model=options.model),void 0!==options.comparator&&(this.comparator=options.comparator),this._reset(),this.initialize.apply(this,arguments),models&&this.reset(models,_.extend({silent:!0},options))},setOptions={add:!0,remove:!0,merge:!0},addOptions={add:!0,remove:!1};_.extend(Collection.prototype,Events,{model:Model,initialize:function(){},toJSON:function(options){return this.map(function(model){return model.toJSON(options)})},sync:function(){return Backbone.sync.apply(this,arguments)},add:function(models,options){return this.set(models,_.extend({merge:!1},options,addOptions))},remove:function(models,options){var singular=!_.isArray(models);models=singular?[models]:_.clone(models),options||(options={});var i,l,index,model;for(i=0,l=models.length;l>i;i++)model=models[i]=this.get(models[i]),model&&(delete this._byId[model.id],delete this._byId[model.cid],index=this.indexOf(model),this.models.splice(index,1),this.length--,options.silent||(options.index=index,model.trigger("remove",model,this,options)),this._removeReference(model,options));return singular?models[0]:models},set:function(models,options){options=_.defaults({},options,setOptions),options.parse&&(models=this.parse(models,options));var singular=!_.isArray(models);models=singular?models?[models]:[]:_.clone(models);var i,l,id,model,attrs,existing,sort,at=options.at,targetModel=this.model,sortable=this.comparator&&null==at&&options.sort!==!1,sortAttr=_.isString(this.comparator)?this.comparator:null,toAdd=[],toRemove=[],modelMap={},add=options.add,merge=options.merge,remove=options.remove,order=!sortable&&add&&remove?[]:!1;for(i=0,l=models.length;l>i;i++){if(attrs=models[i]||{},id=attrs instanceof Model?model=attrs:attrs[targetModel.prototype.idAttribute||"id"],existing=this.get(id))remove&&(modelMap[existing.cid]=!0),merge&&(attrs=attrs===model?model.attributes:attrs,options.parse&&(attrs=existing.parse(attrs,options)),existing.set(attrs,options),sortable&&!sort&&existing.hasChanged(sortAttr)&&(sort=!0)),models[i]=existing;else if(add){if(model=models[i]=this._prepareModel(attrs,options),!model)continue;toAdd.push(model),this._addReference(model,options)}model=existing||model,!order||!model.isNew()&&modelMap[model.id]||order.push(model),modelMap[model.id]=!0}if(remove){for(i=0,l=this.length;l>i;++i)modelMap[(model=this.models[i]).cid]||toRemove.push(model);toRemove.length&&this.remove(toRemove,options)}if(toAdd.length||order&&order.length)if(sortable&&(sort=!0),this.length+=toAdd.length,null!=at)for(i=0,l=toAdd.length;l>i;i++)this.models.splice(at+i,0,toAdd[i]);else{order&&(this.models.length=0);var orderedModels=order||toAdd;for(i=0,l=orderedModels.length;l>i;i++)this.models.push(orderedModels[i])}if(sort&&this.sort({silent:!0}),!options.silent){for(i=0,l=toAdd.length;l>i;i++)(model=toAdd[i]).trigger("add",model,this,options);(sort||order&&order.length)&&this.trigger("sort",this,options)}return singular?models[0]:models},reset:function(models,options){options||(options={});for(var i=0,l=this.models.length;l>i;i++)this._removeReference(this.models[i],options);return options.previousModels=this.models,this._reset(),models=this.add(models,_.extend({silent:!0},options)),options.silent||this.trigger("reset",this,options),models},push:function(model,options){return this.add(model,_.extend({at:this.length},options))},pop:function(options){var model=this.at(this.length-1);return this.remove(model,options),model},unshift:function(model,options){return this.add(model,_.extend({at:0},options))},shift:function(options){var model=this.at(0);return this.remove(model,options),model},slice:function(){return slice.apply(this.models,arguments)},get:function(obj){return null==obj?void 0:this._byId[obj]||this._byId[obj.id]||this._byId[obj.cid]},at:function(index){return this.models[index]},where:function(attrs,first){return _.isEmpty(attrs)?first?void 0:[]:this[first?"find":"filter"](function(model){for(var key in attrs)if(attrs[key]!==model.get(key))return!1;return!0})},findWhere:function(attrs){return this.where(attrs,!0)},sort:function(options){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return options||(options={}),_.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(_.bind(this.comparator,this)),options.silent||this.trigger("sort",this,options),this},pluck:function(attr){return _.invoke(this.models,"get",attr)},fetch:function(options){options=options?_.clone(options):{},void 0===options.parse&&(options.parse=!0);var success=options.success,collection=this;return options.success=function(resp){var method=options.reset?"reset":"set";collection[method](resp,options),success&&success(collection,resp,options),collection.trigger("sync",collection,resp,options)},wrapError(this,options),this.sync("read",this,options)},create:function(model,options){if(options=options?_.clone(options):{},!(model=this._prepareModel(model,options)))return!1;options.wait||this.add(model,options);var collection=this,success=options.success;return options.success=function(model,resp){options.wait&&collection.add(model,options),success&&success(model,resp,options)},model.save(null,options),model},parse:function(resp,options){return resp},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(attrs,options){if(attrs instanceof Model)return attrs;options=options?_.clone(options):{},options.collection=this;var model=new this.model(attrs,options);return model.validationError?(this.trigger("invalid",this,model.validationError,options),!1):model},_addReference:function(model,options){this._byId[model.cid]=model,null!=model.id&&(this._byId[model.id]=model),model.collection||(model.collection=this),model.on("all",this._onModelEvent,this)},_removeReference:function(model,options){this===model.collection&&delete model.collection,model.off("all",this._onModelEvent,this)},_onModelEvent:function(event,model,collection,options){("add"!==event&&"remove"!==event||collection===this)&&("destroy"===event&&this.remove(model,options),model&&event==="change:"+model.idAttribute&&(delete this._byId[model.previous(model.idAttribute)],null!=model.id&&(this._byId[model.id]=model)),this.trigger.apply(this,arguments))}});var methods=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain","sample"];_.each(methods,function(method){Collection.prototype[method]=function(){var args=slice.call(arguments);return args.unshift(this.models),_[method].apply(_,args)}});var attributeMethods=["groupBy","countBy","sortBy","indexBy"];_.each(attributeMethods,function(method){Collection.prototype[method]=function(value,context){var iterator=_.isFunction(value)?value:function(model){return model.get(value)};return _[method](this.models,iterator,context)}});var View=Backbone.View=function(options){this.cid=_.uniqueId("view"),options||(options={}),_.extend(this,_.pick(options,viewOptions)),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},delegateEventSplitter=/^(\S+)\s*(.*)$/,viewOptions=["model","collection","el","id","attributes","className","tagName","events"];_.extend(View.prototype,Events,{tagName:"div",$:function(selector){return this.$el.find(selector)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(element,delegate){return this.$el&&this.undelegateEvents(),this.$el=element instanceof Backbone.$?element:Backbone.$(element),this.el=this.$el[0],delegate!==!1&&this.delegateEvents(),this},delegateEvents:function(events){if(!events&&!(events=_.result(this,"events")))return this;this.undelegateEvents();for(var key in events){var method=events[key];if(_.isFunction(method)||(method=this[events[key]]),method){var match=key.match(delegateEventSplitter),eventName=match[1],selector=match[2];method=_.bind(method,this),eventName+=".delegateEvents"+this.cid,""===selector?this.$el.on(eventName,method):this.$el.on(eventName,selector,method)}}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_ensureElement:function(){if(this.el)this.setElement(_.result(this,"el"),!1);else{var attrs=_.extend({},_.result(this,"attributes"));this.id&&(attrs.id=_.result(this,"id")),this.className&&(attrs["class"]=_.result(this,"className"));var $el=Backbone.$("<"+_.result(this,"tagName")+">").attr(attrs);this.setElement($el,!1)}}}),Backbone.sync=function(method,model,options){var type=methodMap[method];_.defaults(options||(options={}),{emulateHTTP:Backbone.emulateHTTP,emulateJSON:Backbone.emulateJSON});var params={type:type,dataType:"json"};if(options.url||(params.url=_.result(model,"url")||urlError()),null!=options.data||!model||"create"!==method&&"update"!==method&&"patch"!==method||(params.contentType="application/json",params.data=JSON.stringify(options.attrs||model.toJSON(options))),options.emulateJSON&&(params.contentType="application/x-www-form-urlencoded",params.data=params.data?{model:params.data}:{}),options.emulateHTTP&&("PUT"===type||"DELETE"===type||"PATCH"===type)){params.type="POST",options.emulateJSON&&(params.data._method=type);var beforeSend=options.beforeSend;options.beforeSend=function(xhr){return xhr.setRequestHeader("X-HTTP-Method-Override",type),beforeSend?beforeSend.apply(this,arguments):void 0}}"GET"===params.type||options.emulateJSON||(params.processData=!1),"PATCH"===params.type&&noXhrPatch&&(params.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var xhr=options.xhr=Backbone.ajax(_.extend(params,options));return model.trigger("request",model,xhr,options),xhr};var noXhrPatch=!("undefined"==typeof window||!window.ActiveXObject||window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent),methodMap={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};Backbone.ajax=function(){return Backbone.$.ajax.apply(Backbone.$,arguments)};var Router=Backbone.Router=function(options){options||(options={}),options.routes&&(this.routes=options.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},optionalParam=/\((.*?)\)/g,namedParam=/(\(\?)?:\w+/g,splatParam=/\*\w+/g,escapeRegExp=/[\-{}\[\]+?.,\\\^$|#\s]/g;_.extend(Router.prototype,Events,{initialize:function(){},route:function(route,name,callback){_.isRegExp(route)||(route=this._routeToRegExp(route)),_.isFunction(name)&&(callback=name,name=""),callback||(callback=this[name]);var router=this;return Backbone.history.route(route,function(fragment){var args=router._extractParameters(route,fragment);router.execute(callback,args),router.trigger.apply(router,["route:"+name].concat(args)),router.trigger("route",name,args),Backbone.history.trigger("route",router,name,args)}),this},execute:function(callback,args){callback&&callback.apply(this,args)},navigate:function(fragment,options){return Backbone.history.navigate(fragment,options),this},_bindRoutes:function(){if(this.routes){this.routes=_.result(this,"routes");for(var route,routes=_.keys(this.routes);null!=(route=routes.pop());)this.route(route,this.routes[route])}},_routeToRegExp:function(route){return route=route.replace(escapeRegExp,"\\$&").replace(optionalParam,"(?:$1)?").replace(namedParam,function(match,optional){return optional?match:"([^/?]+)"}).replace(splatParam,"([^?]*?)"),new RegExp("^"+route+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(route,fragment){var params=route.exec(fragment).slice(1);return _.map(params,function(param,i){return i===params.length-1?param||null:param?decodeURIComponent(param):null})}});var History=Backbone.History=function(){this.handlers=[],_.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},routeStripper=/^[#\/]|\s+$/g,rootStripper=/^\/+|\/+$/g,isExplorer=/msie [\w.]+/,trailingSlash=/\/$/,pathStripper=/#.*$/;History.started=!1,_.extend(History.prototype,Events,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root},getHash:function(window){var match=(window||this).location.href.match(/#(.*)$/);return match?match[1]:""},getFragment:function(fragment,forcePushState){if(null==fragment)if(this._hasPushState||!this._wantsHashChange||forcePushState){fragment=decodeURI(this.location.pathname+this.location.search);var root=this.root.replace(trailingSlash,"");fragment.indexOf(root)||(fragment=fragment.slice(root.length))}else fragment=this.getHash();return fragment.replace(routeStripper,"")},start:function(options){if(History.started)throw new Error("Backbone.history has already been started");History.started=!0,this.options=_.extend({root:"/"},this.options,options),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var fragment=this.getFragment(),docMode=document.documentMode,oldIE=isExplorer.exec(navigator.userAgent.toLowerCase())&&(!docMode||7>=docMode);if(this.root=("/"+this.root+"/").replace(rootStripper,"/"),oldIE&&this._wantsHashChange){var frame=Backbone.$('<iframe src="javascript:0" tabindex="-1">');this.iframe=frame.hide().appendTo("body")[0].contentWindow,this.navigate(fragment)}this._hasPushState?Backbone.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!oldIE?Backbone.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=fragment;var loc=this.location;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot())return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+"#"+this.fragment),!0;this._hasPushState&&this.atRoot()&&loc.hash&&(this.fragment=this.getHash().replace(routeStripper,""),this.history.replaceState({},document.title,this.root+this.fragment))}return this.options.silent?void 0:this.loadUrl()},stop:function(){Backbone.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),History.started=!1},route:function(route,callback){this.handlers.unshift({route:route,callback:callback})},checkUrl:function(e){var current=this.getFragment();return current===this.fragment&&this.iframe&&(current=this.getFragment(this.getHash(this.iframe))),current===this.fragment?!1:(this.iframe&&this.navigate(current),void this.loadUrl())},loadUrl:function(fragment){return fragment=this.fragment=this.getFragment(fragment),_.any(this.handlers,function(handler){return handler.route.test(fragment)?(handler.callback(fragment),!0):void 0})},navigate:function(fragment,options){if(!History.started)return!1;options&&options!==!0||(options={trigger:!!options});var url=this.root+(fragment=this.getFragment(fragment||""));if(fragment=fragment.replace(pathStripper,""),this.fragment!==fragment){if(this.fragment=fragment,""===fragment&&"/"!==url&&(url=url.slice(0,-1)),this._hasPushState)this.history[options.replace?"replaceState":"pushState"]({},document.title,url);else{if(!this._wantsHashChange)return this.location.assign(url);this._updateHash(this.location,fragment,options.replace),this.iframe&&fragment!==this.getFragment(this.getHash(this.iframe))&&(options.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,fragment,options.replace))}return options.trigger?this.loadUrl(fragment):void 0}},_updateHash:function(location,fragment,replace){if(replace){var href=location.href.replace(/(javascript:|#).*$/,"");location.replace(href+"#"+fragment)}else location.hash="#"+fragment}}),Backbone.history=new History;var extend=function(protoProps,staticProps){var child,parent=this;child=protoProps&&_.has(protoProps,"constructor")?protoProps.constructor:function(){return parent.apply(this,arguments)},_.extend(child,parent,staticProps);var Surrogate=function(){this.constructor=child};return Surrogate.prototype=parent.prototype,child.prototype=new Surrogate,protoProps&&_.extend(child.prototype,protoProps),child.__super__=parent.prototype,child};Model.extend=Collection.extend=Router.extend=View.extend=History.extend=extend;var urlError=function(){throw new Error('A "url" property or function must be specified')},wrapError=function(model,options){var error=options.error;options.error=function(resp){error&&error(model,resp,options),model.trigger("error",model,resp,options)}};return Backbone}),function(Backbone,_){"use strict";function onAdd(model,collection){registerCollectionWithModel(model,collection),model.selected&&collection.select(model,{_silentReselect:!0,_externalEvent:"add"})}function onRemove(model,collection,options){releaseModel(model,collection,_.extend({},options,{_externalEvent:"remove"}))}function releaseModel(model,collection,options){model._pickyCollections&&(model._pickyCollections=_.without(model._pickyCollections,collection._pickyCid)),model.selected&&(model._pickyCollections&&0===model._pickyCollections.length?collection.deselect(model,options):collection.deselect(model,_.extend({},options,{_skipModelCall:!0})))}function onResetSingleSelect(collection,options){var selected,excessiveSelections,deselectOnRemove=_.find(options.previousModels,function(model){return model.selected});deselectOnRemove&&releaseModel(deselectOnRemove,collection,{_silentLocally:!0}),_.each(options.previousModels,function(model){model._pickyCollections&&(model._pickyCollections=_.without(model._pickyCollections,collection._pickyCid))}),collection.each(function(model){registerCollectionWithModel(model,collection)}),selected=collection.filter(function(model){return model.selected}),excessiveSelections=_.initial(selected),excessiveSelections.length&&_.each(excessiveSelections,function(model){model.deselect()}),selected.length&&collection.select(_.last(selected),{silent:!0})}function onResetMultiSelect(collection,options){var select,deselect=_.filter(options.previousModels,function(model){return model.selected});deselect&&_.each(deselect,function(model){releaseModel(model,collection,{_silentLocally:!0})}),_.each(options.previousModels,function(model){model._pickyCollections&&(model._pickyCollections=_.without(model._pickyCollections,collection._pickyCid))}),collection.each(function(model){registerCollectionWithModel(model,collection)}),select=collection.filter(function(model){return model.selected}),select.length&&_.each(select,function(model){collection.select(model,{silent:!0})})}function registerCollectionWithModel(model,collection){model._pickyCollections||(model._pickyCollections=[]),model._pickyCollections.push(collection._pickyCid)}function unregisterCollectionWithModels(collection){collection.each(function(model){releaseModel(model,collection,{_silentLocally:!0})})}function stripLocalOptions(options){return _.omit(options,"_silentLocally","_externalEvent")}function stripInternalOptions(options){return _.omit(options,"_silentLocally","_silentReselect","_skipModelCall","_processedBy","_eventQueue","_eventQueueAppendOnly")}function multiSelectionToArray(selectionsHash){function mapper(value,key){selectedArr[key]=value}var selectedArr=[];return _.each(selectionsHash,mapper),selectedArr}function initOptions(options){return options||(options={}),options._processedBy||(options._processedBy={}),options._eventQueue||(options._eventQueue=[]),options}function queueEvent(storage,actor,triggerArgs){var queue=storage._eventQueueAppendOnly||storage._eventQueue;queue.push({actor:actor,triggerArgs:triggerArgs})}function processEventQueue(storage){var resolved,eventData;if(storage._eventQueue.length&&(resolved=_.every(storage._processedBy,function(entry){return entry.done})))for(mergeMultiSelectEvents(storage._eventQueue);storage._eventQueue.length;)eventData=storage._eventQueue.pop(),eventData.actor.trigger.apply(eventData.actor,eventData.triggerArgs)}function mergeMultiSelectEvents(queue){var multiSelectCollections={};_.each(queue,function(event,index){var extractedData,diff,opts,actor=event.actor,eventName=event.triggerArgs[0];"Backbone.Select.Many"===actor._pickyType&&"reselect:any"!==eventName&&(extractedData=multiSelectCollections[actor._pickyCid],extractedData||(extractedData=multiSelectCollections[actor._pickyCid]={actor:actor,indexes:[],merged:{selected:[],deselected:[],options:{}}}),extractedData.indexes.push(index),diff=event.triggerArgs[1],opts=event.triggerArgs[3],extractedData.merged.selected=extractedData.merged.selected.concat(diff.selected),extractedData.merged.deselected=extractedData.merged.deselected.concat(diff.deselected),_.extend(extractedData.merged.options,opts))}),multiSelectCollections=_.filter(multiSelectCollections,function(entry){return entry.indexes.length>1});var removeIndexes=_.flatten(_.pluck(multiSelectCollections,"indexes"));removeIndexes.sort(function(a,b){return a-b}),_.each(removeIndexes,function(position,index){queue.splice(position-index,1)}),_.each(multiSelectCollections,function(extractedData){queue.push({actor:extractedData.actor,triggerArgs:["select:some",{selected:extractedData.merged.selected,deselected:extractedData.merged.deselected},extractedData.actor,extractedData.merged.options]})})}function overloadSelect(oldSelect,context){context.select=function(){var mixinSelect=context.select;return function(model){return model instanceof Backbone.Model?mixinSelect.apply(context,arguments):oldSelect.apply(context,arguments)}}()}function augmentTrigger(context){context.trigger=function(){var origTrigger=context.trigger;return function(event,eventArgs){if(isSelectionEvent(event)){var unifiedEvent=unifyEventNames(event),methodName="on"+unifiedEvent.replace(/(^|:)(\w)/gi,getEventName),method=this[methodName];_.isFunction(method)&&method.apply(this,_.tail(arguments))}return origTrigger.apply(this,arguments),this}}()}function isSelectionEvent(eventName){return/^([rd]e)?select(ed)?($|:)/.test(eventName)}function getEventName(match,prefix,eventName){return eventName.toUpperCase()}function unifyEventNames(eventName){return"ed"===eventName.slice(-2)?eventName=eventName.slice(0,-2):(":one"===eventName.slice(-4)||":any"===eventName.slice(-4))&&(eventName=eventName.slice(0,-4)),eventName}var Mixins={SelectOne:{_pickyType:"Backbone.Select.One",select:function(model,options){var reselected=model&&this.selected===model?model:void 0;options=initOptions(options),options._processedBy[this._pickyCid]||(reselected||(this.deselect(void 0,_.extend(_.omit(options,"_silentLocally","_processedBy","_eventQueue"),{_eventQueueAppendOnly:options._eventQueue})),this.selected=model),options._processedBy[this._pickyCid]={done:!1},options._processedBy[this.selected.cid]||this.selected.select(stripLocalOptions(options)),options.silent||options._silentLocally||(reselected?options._silentReselect||queueEvent(options,this,["reselect:one",model,this,stripInternalOptions(options)]):queueEvent(options,this,["select:one",model,this,stripInternalOptions(options)])),options._processedBy[this._pickyCid].done=!0,processEventQueue(options))},deselect:function(model,options){options=initOptions(options),options._processedBy[this._pickyCid]||this.selected&&(model=model||this.selected,this.selected===model&&(options._processedBy[this._pickyCid]={done:!1},delete this.selected,options._skipModelCall||model.deselect(stripLocalOptions(options)),options.silent||options._silentLocally||queueEvent(options,this,["deselect:one",model,this,stripInternalOptions(options)]),options._processedBy[this._pickyCid].done=!0,processEventQueue(options)))},close:function(){unregisterCollectionWithModels(this),this.stopListening()}},SelectMany:{_pickyType:"Backbone.Select.Many",select:function(model,options){var prevSelected=multiSelectionToArray(this.selected),reselected=this.selected[model.cid]?[model]:[];options=initOptions(options),reselected.length&&options._processedBy[this._pickyCid]||(reselected.length||(this.selected[model.cid]=model,this.selectedLength=_.size(this.selected)),options._processedBy[this._pickyCid]={done:!1},options._processedBy[model.cid]||model.select(stripLocalOptions(options)),triggerMultiSelectEvents(this,prevSelected,options,reselected),options._processedBy[this._pickyCid].done=!0,processEventQueue(options))},deselect:function(model,options){var prevSelected=multiSelectionToArray(this.selected);options=initOptions(options),options._processedBy[this._pickyCid]||this.selected[model.cid]&&(options._processedBy[this._pickyCid]={done:!1},delete this.selected[model.cid],this.selectedLength=_.size(this.selected),options._skipModelCall||model.deselect(stripLocalOptions(options)),triggerMultiSelectEvents(this,prevSelected,options),options._processedBy[this._pickyCid].done=!0,processEventQueue(options))},selectAll:function(options){var prevSelected=multiSelectionToArray(this.selected),reselected=[];options||(options={}),this.each(function(model){this.selected[model.cid]&&reselected.push(model),this.select(model,_.extend({},options,{_silentLocally:!0}))},this),this.selectedLength=_.size(this.selected),options=initOptions(options),triggerMultiSelectEvents(this,prevSelected,options,reselected),options._processedBy[this._pickyCid]?options._processedBy[this._pickyCid].done=!0:options._processedBy[this._pickyCid]={done:!0},processEventQueue(options)},deselectAll:function(options){var prevSelected;0!==this.selectedLength&&(prevSelected=multiSelectionToArray(this.selected),options||(options={}),this.each(function(model){this.deselect(model,_.extend({},options,{_silentLocally:!0}))},this),this.selectedLength=0,options=initOptions(options),triggerMultiSelectEvents(this,prevSelected,options),options._processedBy[this._pickyCid]?options._processedBy[this._pickyCid].done=!0:options._processedBy[this._pickyCid]={done:!0},processEventQueue(options))},selectNone:function(options){this.deselectAll(options)},toggleSelectAll:function(options){this.selectedLength===this.length?this.deselectAll(options):this.selectAll(options)},close:function(){unregisterCollectionWithModels(this),
this.stopListening()}},SelectMe:{_pickyType:"Backbone.Select.Me",select:function(options){var reselected=this.selected;options=initOptions(options),options._processedBy[this.cid]||(options._processedBy[this.cid]={done:!1},this.selected=!0,this._pickyCollections?this.trigger("_selected",this,stripLocalOptions(options)):this.collection&&(options._processedBy[this.collection._pickyCid]||this.collection.select(this,stripLocalOptions(options))),options.silent||options._silentLocally||(reselected?options._silentReselect||queueEvent(options,this,["reselected",this,stripInternalOptions(options)]):queueEvent(options,this,["selected",this,stripInternalOptions(options)])),options._processedBy[this.cid].done=!0,processEventQueue(options))},deselect:function(options){options=initOptions(options),options._processedBy[this.cid]||this.selected&&(options._processedBy[this.cid]={done:!1},this.selected=!1,this._pickyCollections?this.trigger("_deselected",this,stripLocalOptions(options)):this.collection&&this.collection.deselect(this,stripLocalOptions(options)),options.silent||options._silentLocally||queueEvent(options,this,["deselected",this,stripInternalOptions(options)]),options._processedBy[this.cid].done=!0,processEventQueue(options))},toggleSelected:function(options){this.selected?this.deselect(options):this.select(options)}}},Select={Me:{applyTo:function(hostObject){if(!_.isObject(hostObject))throw new Error("The host object is undefined or not an object.");_.extend(hostObject,Mixins.SelectMe),augmentTrigger(hostObject)}},One:{applyTo:function(hostObject,models,options){var oldSelect;if(!_.isObject(hostObject))throw new Error("The host object is undefined or not an object.");if(arguments.length<2)throw new Error("The `models` parameter has not been passed to Select.One.applyTo. Its value can be undefined if no models are passed in during instantiation, but even so, it must be provided.");if(!(_.isArray(models)||_.isUndefined(models)||_.isNull(models)))throw new Error("The `models` parameter is not of the correct type. It must be either an array of models, or be undefined. (Null is acceptable, too).");oldSelect=hostObject.select,_.extend(hostObject,Mixins.SelectOne),hostObject._pickyCid=_.uniqueId("singleSelect"),augmentTrigger(hostObject),overloadSelect(oldSelect,hostObject),options&&options.enableModelSharing&&(_.each(models||[],function(model){registerCollectionWithModel(model,hostObject),model.selected&&(hostObject.selected&&hostObject.selected.deselect(),hostObject.selected=model)}),hostObject.listenTo(hostObject,"_selected",hostObject.select),hostObject.listenTo(hostObject,"_deselected",hostObject.deselect),hostObject.listenTo(hostObject,"reset",onResetSingleSelect),hostObject.listenTo(hostObject,"add",onAdd),hostObject.listenTo(hostObject,"remove",onRemove),hostObject._modelSharingEnabled=!0)}},Many:{applyTo:function(hostObject,models,options){var oldSelect;if(!_.isObject(hostObject))throw new Error("The host object is undefined or not an object.");if(arguments.length<2)throw new Error("The `models` parameter has not been passed to Select.One.applyTo. Its value can be undefined if no models are passed in during instantiation, but even so, it must be provided.");if(!(_.isArray(models)||_.isUndefined(models)||_.isNull(models)))throw new Error("The `models` parameter is not of the correct type. It must be either an array of models, or be undefined. (Null is acceptable, too).");oldSelect=hostObject.select,_.extend(hostObject,Mixins.SelectMany),hostObject._pickyCid=_.uniqueId("multiSelect"),hostObject.selected={},hostObject.selectedLength=0,augmentTrigger(hostObject),overloadSelect(oldSelect,hostObject),options&&options.enableModelSharing&&(_.each(models||[],function(model){registerCollectionWithModel(model,hostObject),model.selected&&(hostObject.selected[model.cid]=model)}),hostObject.listenTo(hostObject,"_selected",hostObject.select),hostObject.listenTo(hostObject,"_deselected",hostObject.deselect),hostObject.listenTo(hostObject,"reset",onResetMultiSelect),hostObject.listenTo(hostObject,"add",onAdd),hostObject.listenTo(hostObject,"remove",onRemove),hostObject._modelSharingEnabled=!0)}}},triggerMultiSelectEvents=function(collection,prevSelected,options,reselected){function mapCidsToModels(cids,collection,previousSelection){function mapper(cid){return collection.get(cid)||previousSelection[cid]}return _.map(cids,mapper)}if(!options.silent&&!options._silentLocally){var diff,selectedLength=collection.selectedLength,length=collection.length,prevSelectedCids=_.keys(prevSelected),selectedCids=_.keys(collection.selected),addedCids=_.difference(selectedCids,prevSelectedCids),removedCids=_.difference(prevSelectedCids,selectedCids),unchanged=selectedLength===prevSelectedCids.length&&0===addedCids.length&&0===removedCids.length;if(reselected&&reselected.length&&!options._silentReselect&&queueEvent(options,collection,["reselect:any",reselected,collection,stripInternalOptions(options)]),!unchanged)return diff={selected:mapCidsToModels(addedCids,collection,prevSelected),deselected:mapCidsToModels(removedCids,collection,prevSelected)},selectedLength===length?void queueEvent(options,collection,["select:all",diff,collection,stripInternalOptions(options)]):0===selectedLength?void queueEvent(options,collection,["select:none",diff,collection,stripInternalOptions(options)]):selectedLength>0&&length>selectedLength?void queueEvent(options,collection,["select:some",diff,collection,stripInternalOptions(options)]):void 0}};Backbone.Select=Select}(Backbone,_),function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory(require("underscore"),require("backbone")):"function"==typeof define&&define.amd?define(["underscore","backbone"],factory):global.Backbone.Radio=factory(global._,global.Backbone)}(this,function(_,Backbone){"use strict";function removeHandler(store,name,callback,context){var event=store[name];return callback&&callback!==event.callback&&callback!==event.callback._callback||context&&context!==event.context?void 0:(delete store[name],!0)}function removeHandlers(store,name,callback,context){store||(store={});for(var names=name?[name]:_.keys(store),matched=!1,i=0,length=names.length;length>i;i++)name=names[i],store[name]&&removeHandler(store,name,callback,context)&&(matched=!0);return matched}function _partial(channelName){return _logs[channelName]||(_logs[channelName]=_.partial(Radio.log,channelName))}function makeCallback(callback){return _.isFunction(callback)?callback:function(){return callback}}var previousRadio=Backbone.Radio,Radio=Backbone.Radio={};Radio.VERSION="1.0.1",Radio.noConflict=function(){return Backbone.Radio=previousRadio,this},Radio.DEBUG=!1,Radio._debugText=function(warning,eventName,channelName){return warning+(channelName?" on the "+channelName+" channel":"")+': "'+eventName+'"'},Radio.debugLog=function(warning,eventName,channelName){Radio.DEBUG&&console&&console.warn&&console.warn(Radio._debugText(warning,eventName,channelName))};var eventSplitter=/\s+/;Radio._eventsApi=function(obj,action,name,rest){if(!name)return!1;var results={};if("object"==typeof name){for(var key in name){var result=obj[action].apply(obj,[key,name[key]].concat(rest));eventSplitter.test(key)?_.extend(results,result):results[key]=result}return results}if(eventSplitter.test(name)){for(var names=name.split(eventSplitter),i=0,l=names.length;l>i;i++)results[names[i]]=obj[action].apply(obj,[names[i]].concat(rest));return results}return!1},Radio._callHandler=function(callback,context,args){var a1=args[0],a2=args[1],a3=args[2];switch(args.length){case 0:return callback.call(context);case 1:return callback.call(context,a1);case 2:return callback.call(context,a1,a2);case 3:return callback.call(context,a1,a2,a3);default:return callback.apply(context,args)}};var _logs={};_.extend(Radio,{log:function(channelName,eventName){var args=_.rest(arguments,2);console.log("["+channelName+'] "'+eventName+'"',args)},tuneIn:function(channelName){var channel=Radio.channel(channelName);return channel._tunedIn=!0,channel.on("all",_partial(channelName)),this},tuneOut:function(channelName){var channel=Radio.channel(channelName);return channel._tunedIn=!1,channel.off("all",_partial(channelName)),delete _logs[channelName],this}}),Radio.Requests={request:function(name){var args=_.rest(arguments),results=Radio._eventsApi(this,"request",name,args);if(results)return results;var channelName=this.channelName,requests=this._requests;if(channelName&&this._tunedIn&&Radio.log.apply(this,[channelName,name].concat(args)),requests&&(requests[name]||requests["default"])){var handler=requests[name]||requests["default"];return args=requests[name]?args:arguments,Radio._callHandler(handler.callback,handler.context,args)}Radio.debugLog("An unhandled request was fired",name,channelName)},reply:function(name,callback,context){return Radio._eventsApi(this,"reply",name,[callback,context])?this:(this._requests||(this._requests={}),this._requests[name]&&Radio.debugLog("A request was overwritten",name,this.channelName),this._requests[name]={callback:makeCallback(callback),context:context||this},this)},replyOnce:function(name,callback,context){if(Radio._eventsApi(this,"replyOnce",name,[callback,context]))return this;var self=this,once=_.once(function(){return self.stopReplying(name),makeCallback(callback).apply(this,arguments)});return this.reply(name,once,context)},stopReplying:function(name,callback,context){return Radio._eventsApi(this,"stopReplying",name)?this:(name||callback||context?removeHandlers(this._requests,name,callback,context)||Radio.debugLog("Attempted to remove the unregistered request",name,this.channelName):delete this._requests,this)}},Radio._channels={},Radio.channel=function(channelName){if(!channelName)throw new Error("You must provide a name for the channel.");return Radio._channels[channelName]?Radio._channels[channelName]:Radio._channels[channelName]=new Radio.Channel(channelName)},Radio.Channel=function(channelName){this.channelName=channelName},_.extend(Radio.Channel.prototype,Backbone.Events,Radio.Requests,{reset:function(){return this.off(),this.stopListening(),this.stopReplying(),this}});var channel,args,systems=[Backbone.Events,Radio.Commands,Radio.Requests];_.each(systems,function(system){_.each(system,function(method,methodName){Radio[methodName]=function(channelName){return args=_.rest(arguments),channel=this.channel(channelName),channel[methodName].apply(channel,args)}})}),Radio.reset=function(channelName){var channels=channelName?[this._channels[channelName]]:this._channels;_.invoke(channels,"reset")};var backbone_radio=Radio;return backbone_radio}),function(root,factory){if("function"==typeof define&&define.amd)define(["backbone","underscore"],function(Backbone,_){return root.Marionette=root.Mn=factory(root,Backbone,_)});else if("undefined"!=typeof exports){var Backbone=require("backbone"),_=require("underscore");module.exports=factory(root,Backbone,_)}else root.Marionette=root.Mn=factory(root,root.Backbone,root._)}(this,function(root,Backbone,_){"use strict";!function(Backbone,_){var previousChildViewContainer=Backbone.ChildViewContainer;return Backbone.ChildViewContainer=function(Backbone,_){var Container=function(views){this._views={},this._indexByModel={},this._indexByCustom={},this._updateLength(),_.each(views,this.add,this)};_.extend(Container.prototype,{add:function(view,customIndex){var viewCid=view.cid;return this._views[viewCid]=view,view.model&&(this._indexByModel[view.model.cid]=viewCid),customIndex&&(this._indexByCustom[customIndex]=viewCid),this._updateLength(),this},findByModel:function(model){return this.findByModelCid(model.cid)},findByModelCid:function(modelCid){var viewCid=this._indexByModel[modelCid];return this.findByCid(viewCid)},findByCustom:function(index){var viewCid=this._indexByCustom[index];return this.findByCid(viewCid)},findByIndex:function(index){return _.values(this._views)[index]},findByCid:function(cid){return this._views[cid]},remove:function(view){var viewCid=view.cid;return view.model&&delete this._indexByModel[view.model.cid],_.any(this._indexByCustom,function(cid,key){return cid===viewCid?(delete this._indexByCustom[key],!0):void 0},this),delete this._views[viewCid],this._updateLength(),this},call:function(method){this.apply(method,_.tail(arguments))},apply:function(method,args){_.each(this._views,function(view){_.isFunction(view[method])&&view[method].apply(view,args||[])})},_updateLength:function(){this.length=_.size(this._views)}});var methods=["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck","reduce"];return _.each(methods,function(method){Container.prototype[method]=function(){var views=_.values(this._views),args=[views].concat(_.toArray(arguments));return _[method].apply(_,args)}}),Container}(Backbone,_),Backbone.ChildViewContainer.VERSION="0.1.6",Backbone.ChildViewContainer.noConflict=function(){return Backbone.ChildViewContainer=previousChildViewContainer,this},Backbone.ChildViewContainer}(Backbone,_),function(Backbone,_){var previousWreqr=Backbone.Wreqr,Wreqr=Backbone.Wreqr={};return Backbone.Wreqr.VERSION="1.3.1",Backbone.Wreqr.noConflict=function(){return Backbone.Wreqr=previousWreqr,this},Wreqr.Handlers=function(Backbone,_){var Handlers=function(options){this.options=options,this._wreqrHandlers={},_.isFunction(this.initialize)&&this.initialize(options)};return Handlers.extend=Backbone.Model.extend,_.extend(Handlers.prototype,Backbone.Events,{setHandlers:function(handlers){_.each(handlers,function(handler,name){var context=null;_.isObject(handler)&&!_.isFunction(handler)&&(context=handler.context,handler=handler.callback),this.setHandler(name,handler,context)},this)},setHandler:function(name,handler,context){var config={callback:handler,context:context};this._wreqrHandlers[name]=config,this.trigger("handler:add",name,handler,context)},hasHandler:function(name){return!!this._wreqrHandlers[name]},getHandler:function(name){var config=this._wreqrHandlers[name];if(config)return function(){var args=Array.prototype.slice.apply(arguments);return config.callback.apply(config.context,args)}},removeHandler:function(name){delete this._wreqrHandlers[name]},removeAllHandlers:function(){this._wreqrHandlers={}}}),Handlers}(Backbone,_),Wreqr.CommandStorage=function(){var CommandStorage=function(options){this.options=options,this._commands={},_.isFunction(this.initialize)&&this.initialize(options)};return _.extend(CommandStorage.prototype,Backbone.Events,{getCommands:function(commandName){var commands=this._commands[commandName];return commands||(commands={command:commandName,instances:[]},this._commands[commandName]=commands),commands},addCommand:function(commandName,args){var command=this.getCommands(commandName);command.instances.push(args)},clearCommands:function(commandName){var command=this.getCommands(commandName);command.instances=[]}}),CommandStorage}(),Wreqr.Commands=function(Wreqr){return Wreqr.Handlers.extend({storageType:Wreqr.CommandStorage,constructor:function(options){this.options=options||{},this._initializeStorage(this.options),this.on("handler:add",this._executeCommands,this);var args=Array.prototype.slice.call(arguments);Wreqr.Handlers.prototype.constructor.apply(this,args)},execute:function(name,args){name=arguments[0],args=Array.prototype.slice.call(arguments,1),this.hasHandler(name)?this.getHandler(name).apply(this,args):this.storage.addCommand(name,args)},_executeCommands:function(name,handler,context){var command=this.storage.getCommands(name);_.each(command.instances,function(args){handler.apply(context,args)}),this.storage.clearCommands(name)},_initializeStorage:function(options){var storage,StorageType=options.storageType||this.storageType;storage=_.isFunction(StorageType)?new StorageType:StorageType,this.storage=storage}})}(Wreqr),Wreqr.RequestResponse=function(Wreqr){return Wreqr.Handlers.extend({request:function(){var name=arguments[0],args=Array.prototype.slice.call(arguments,1);return this.hasHandler(name)?this.getHandler(name).apply(this,args):void 0}})}(Wreqr),Wreqr.EventAggregator=function(Backbone,_){var EA=function(){};return EA.extend=Backbone.Model.extend,_.extend(EA.prototype,Backbone.Events),EA}(Backbone,_),Wreqr.Channel=function(Wreqr){var Channel=function(channelName){this.vent=new Backbone.Wreqr.EventAggregator,this.reqres=new Backbone.Wreqr.RequestResponse,this.commands=new Backbone.Wreqr.Commands,this.channelName=channelName};return _.extend(Channel.prototype,{reset:function(){return this.vent.off(),this.vent.stopListening(),this.reqres.removeAllHandlers(),this.commands.removeAllHandlers(),this},connectEvents:function(hash,context){return this._connect("vent",hash,context),this},connectCommands:function(hash,context){return this._connect("commands",hash,context),this},connectRequests:function(hash,context){return this._connect("reqres",hash,context),this},_connect:function(type,hash,context){if(hash){context=context||this;var method="vent"===type?"on":"setHandler";_.each(hash,function(fn,eventName){this[type][method](eventName,_.bind(fn,context))},this)}}}),Channel}(Wreqr),Wreqr.radio=function(Wreqr){var Radio=function(){this._channels={},this.vent={},this.commands={},this.reqres={},this._proxyMethods()};_.extend(Radio.prototype,{channel:function(channelName){if(!channelName)throw new Error("Channel must receive a name");return this._getChannel(channelName)},_getChannel:function(channelName){var channel=this._channels[channelName];return channel||(channel=new Wreqr.Channel(channelName),this._channels[channelName]=channel),channel},_proxyMethods:function(){_.each(["vent","commands","reqres"],function(system){_.each(messageSystems[system],function(method){this[system][method]=proxyMethod(this,system,method)},this)},this)}});var messageSystems={vent:["on","off","trigger","once","stopListening","listenTo","listenToOnce"],commands:["execute","setHandler","setHandlers","removeHandler","removeAllHandlers"],reqres:["request","setHandler","setHandlers","removeHandler","removeAllHandlers"]},proxyMethod=function(radio,system,method){return function(channelName){var messageSystem=radio._getChannel(channelName)[system],args=Array.prototype.slice.call(arguments,1);return messageSystem[method].apply(messageSystem,args)}};return new Radio}(Wreqr),Backbone.Wreqr}(Backbone,_);var previousMarionette=root.Marionette,previousMn=root.Mn,Marionette=Backbone.Marionette={};Marionette.VERSION="2.4.1",Marionette.noConflict=function(){return root.Marionette=previousMarionette,root.Mn=previousMn,this},Backbone.Marionette=Marionette,Marionette.Deferred=Backbone.$.Deferred,Marionette.extend=Backbone.Model.extend,Marionette.isNodeAttached=function(el){return Backbone.$.contains(document.documentElement,el)},Marionette.mergeOptions=function(options,keys){options&&_.extend(this,_.pick(options,keys))},Marionette.getOption=function(target,optionName){return target&&optionName?target.options&&void 0!==target.options[optionName]?target.options[optionName]:target[optionName]:void 0},Marionette.proxyGetOption=function(optionName){return Marionette.getOption(this,optionName)},Marionette._getValue=function(value,context,params){return _.isFunction(value)&&(value=params?value.apply(context,params):value.call(context)),value},Marionette.normalizeMethods=function(hash){return _.reduce(hash,function(normalizedHash,method,name){return _.isFunction(method)||(method=this[method]),method&&(normalizedHash[name]=method),normalizedHash},{},this)},Marionette.normalizeUIString=function(uiString,ui){return uiString.replace(/@ui\.[a-zA-Z_$0-9]*/g,function(r){return ui[r.slice(4)]})},Marionette.normalizeUIKeys=function(hash,ui){return _.reduce(hash,function(memo,val,key){var normalizedKey=Marionette.normalizeUIString(key,ui);return memo[normalizedKey]=val,memo},{})},Marionette.normalizeUIValues=function(hash,ui,properties){return _.each(hash,function(val,key){_.isString(val)?hash[key]=Marionette.normalizeUIString(val,ui):_.isObject(val)&&_.isArray(properties)&&(_.extend(val,Marionette.normalizeUIValues(_.pick(val,properties),ui)),_.each(properties,function(property){var propertyVal=val[property];_.isString(propertyVal)&&(val[property]=Marionette.normalizeUIString(propertyVal,ui))}))}),hash},Marionette.actAsCollection=function(object,listProperty){var methods=["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck"];_.each(methods,function(method){object[method]=function(){var list=_.values(_.result(this,listProperty)),args=[list].concat(_.toArray(arguments));return _[method].apply(_,args)}})};var deprecate=Marionette.deprecate=function(message,test){_.isObject(message)&&(message=message.prev+" is going to be removed in the future. Please use "+message.next+" instead."+(message.url?" See: "+message.url:"")),void 0!==test&&test||deprecate._cache[message]||(deprecate._warn("Deprecation warning: "+message),deprecate._cache[message]=!0)};deprecate._warn="undefined"!=typeof console&&(console.warn||console.log)||function(){},deprecate._cache={},Marionette._triggerMethod=function(){function getEventName(match,prefix,eventName){return eventName.toUpperCase()}var splitter=/(^|:)(\w)/gi;return function(context,event,args){var noEventArg=arguments.length<3;noEventArg&&(args=event,event=args[0]);var result,methodName="on"+event.replace(splitter,getEventName),method=context[methodName];return _.isFunction(method)&&(result=method.apply(context,noEventArg?_.rest(args):args)),_.isFunction(context.trigger)&&(noEventArg+args.length>1?context.trigger.apply(context,noEventArg?args:[event].concat(_.drop(args,0))):context.trigger(event)),result}}(),Marionette.triggerMethod=function(event){return Marionette._triggerMethod(this,arguments)},Marionette.triggerMethodOn=function(context){var fnc=_.isFunction(context.triggerMethod)?context.triggerMethod:Marionette.triggerMethod;return fnc.apply(context,_.rest(arguments))},Marionette.MonitorDOMRefresh=function(view){function handleShow(){view._isShown=!0,triggerDOMRefresh()}function handleRender(){view._isRendered=!0,triggerDOMRefresh()}function triggerDOMRefresh(){view._isShown&&view._isRendered&&Marionette.isNodeAttached(view.el)&&_.isFunction(view.triggerMethod)&&view.triggerMethod("dom:refresh")}view.on({show:handleShow,render:handleRender})},function(Marionette){function bindFromStrings(target,entity,evt,methods){var methodNames=methods.split(/\s+/);_.each(methodNames,function(methodName){var method=target[methodName];if(!method)throw new Marionette.Error('Method "'+methodName+'" was configured as an event handler, but does not exist.');target.listenTo(entity,evt,method)})}function bindToFunction(target,entity,evt,method){target.listenTo(entity,evt,method)}function unbindFromStrings(target,entity,evt,methods){var methodNames=methods.split(/\s+/);_.each(methodNames,function(methodName){var method=target[methodName];target.stopListening(entity,evt,method)})}function unbindToFunction(target,entity,evt,method){target.stopListening(entity,evt,method)}function iterateEvents(target,entity,bindings,functionCallback,stringCallback){if(entity&&bindings){if(!_.isObject(bindings))throw new Marionette.Error({message:"Bindings must be an object or function.",url:"marionette.functions.html#marionettebindentityevents"});bindings=Marionette._getValue(bindings,target),_.each(bindings,function(methods,evt){_.isFunction(methods)?functionCallback(target,entity,evt,methods):stringCallback(target,entity,evt,methods)})}}Marionette.bindEntityEvents=function(target,entity,bindings){iterateEvents(target,entity,bindings,bindToFunction,bindFromStrings)},Marionette.unbindEntityEvents=function(target,entity,bindings){iterateEvents(target,entity,bindings,unbindToFunction,unbindFromStrings)},Marionette.proxyBindEntityEvents=function(entity,bindings){return Marionette.bindEntityEvents(this,entity,bindings)},Marionette.proxyUnbindEntityEvents=function(entity,bindings){return Marionette.unbindEntityEvents(this,entity,bindings)}}(Marionette);var errorProps=["description","fileName","lineNumber","name","message","number"];return Marionette.Error=Marionette.extend.call(Error,{urlRoot:"http://marionettejs.com/docs/v"+Marionette.VERSION+"/",constructor:function(message,options){_.isObject(message)?(options=message,message=options.message):options||(options={});var error=Error.call(this,message);_.extend(this,_.pick(error,errorProps),_.pick(options,errorProps)),this.captureStackTrace(),options.url&&(this.url=this.urlRoot+options.url)},captureStackTrace:function(){Error.captureStackTrace&&Error.captureStackTrace(this,Marionette.Error)},toString:function(){return this.name+": "+this.message+(this.url?" See: "+this.url:"")}}),Marionette.Error.extend=Marionette.extend,Marionette.Callbacks=function(){this._deferred=Marionette.Deferred(),this._callbacks=[]},_.extend(Marionette.Callbacks.prototype,{add:function(callback,contextOverride){var promise=_.result(this._deferred,"promise");this._callbacks.push({cb:callback,ctx:contextOverride}),promise.then(function(args){contextOverride&&(args.context=contextOverride),callback.call(args.context,args.options)})},run:function(options,context){this._deferred.resolve({options:options,context:context})},reset:function(){var callbacks=this._callbacks;this._deferred=Marionette.Deferred(),this._callbacks=[],_.each(callbacks,function(cb){this.add(cb.cb,cb.ctx)},this)}}),Marionette.Controller=function(options){this.options=options||{},_.isFunction(this.initialize)&&this.initialize(this.options)},Marionette.Controller.extend=Marionette.extend,_.extend(Marionette.Controller.prototype,Backbone.Events,{destroy:function(){return Marionette._triggerMethod(this,"before:destroy",arguments),Marionette._triggerMethod(this,"destroy",arguments),this.stopListening(),this.off(),this},triggerMethod:Marionette.triggerMethod,mergeOptions:Marionette.mergeOptions,getOption:Marionette.proxyGetOption}),Marionette.Object=function(options){this.options=_.extend({},_.result(this,"options"),options),this.initialize.apply(this,arguments)},Marionette.Object.extend=Marionette.extend,_.extend(Marionette.Object.prototype,Backbone.Events,{initialize:function(){},destroy:function(){return this.triggerMethod("before:destroy"),this.triggerMethod("destroy"),this.stopListening(),this},triggerMethod:Marionette.triggerMethod,mergeOptions:Marionette.mergeOptions,getOption:Marionette.proxyGetOption,bindEntityEvents:Marionette.proxyBindEntityEvents,unbindEntityEvents:Marionette.proxyUnbindEntityEvents}),Marionette.Region=Marionette.Object.extend({constructor:function(options){if(this.options=options||{},this.el=this.getOption("el"),this.el=this.el instanceof Backbone.$?this.el[0]:this.el,!this.el)throw new Marionette.Error({name:"NoElError",message:'An "el" must be specified for a region.'});this.$el=this.getEl(this.el),Marionette.Object.call(this,options)},show:function(view,options){if(this._ensureElement()){this._ensureViewIsIntact(view);var showOptions=options||{},isDifferentView=view!==this.currentView,preventDestroy=!!showOptions.preventDestroy,forceShow=!!showOptions.forceShow,isChangingView=!!this.currentView,_shouldDestroyView=isDifferentView&&!preventDestroy,_shouldShowView=isDifferentView||forceShow;if(isChangingView&&this.triggerMethod("before:swapOut",this.currentView,this,options),this.currentView&&delete this.currentView._parent,_shouldDestroyView?this.empty():isChangingView&&_shouldShowView&&this.currentView.off("destroy",this.empty,this),_shouldShowView){view.once("destroy",this.empty,this),view.render(),view._parent=this,isChangingView&&this.triggerMethod("before:swap",view,this,options),this.triggerMethod("before:show",view,this,options),Marionette.triggerMethodOn(view,"before:show",view,this,options),isChangingView&&this.triggerMethod("swapOut",this.currentView,this,options);var attachedRegion=Marionette.isNodeAttached(this.el),displayedViews=[],triggerBeforeAttach=showOptions.triggerBeforeAttach||this.triggerBeforeAttach,triggerAttach=showOptions.triggerAttach||this.triggerAttach;return attachedRegion&&triggerBeforeAttach&&(displayedViews=this._displayedViews(view),this._triggerAttach(displayedViews,"before:")),this.attachHtml(view),this.currentView=view,attachedRegion&&triggerAttach&&(displayedViews=this._displayedViews(view),this._triggerAttach(displayedViews)),isChangingView&&this.triggerMethod("swap",view,this,options),this.triggerMethod("show",view,this,options),Marionette.triggerMethodOn(view,"show",view,this,options),this}return this}},triggerBeforeAttach:!0,triggerAttach:!0,_triggerAttach:function(views,prefix){var eventName=(prefix||"")+"attach";_.each(views,function(view){Marionette.triggerMethodOn(view,eventName,view,this)},this)},_displayedViews:function(view){return _.union([view],_.result(view,"_getNestedViews")||[])},_ensureElement:function(){if(_.isObject(this.el)||(this.$el=this.getEl(this.el),this.el=this.$el[0]),!this.$el||0===this.$el.length){if(this.getOption("allowMissingEl"))return!1;throw new Marionette.Error('An "el" '+this.$el.selector+" must exist in DOM")}return!0},_ensureViewIsIntact:function(view){if(!view)throw new Marionette.Error({name:"ViewNotValid",message:"The view passed is undefined and therefore invalid. You must pass a view instance to show."});if(view.isDestroyed)throw new Marionette.Error({name:"ViewDestroyedError",message:'View (cid: "'+view.cid+'") has already been destroyed and cannot be used.'})},getEl:function(el){return Backbone.$(el,Marionette._getValue(this.options.parentEl,this))},attachHtml:function(view){this.$el.contents().detach(),this.el.appendChild(view.el)},empty:function(options){var view=this.currentView,preventDestroy=Marionette._getValue(options,"preventDestroy",this);return view?(view.off("destroy",this.empty,this),this.triggerMethod("before:empty",view),preventDestroy||this._destroyView(),this.triggerMethod("empty",view),delete this.currentView,preventDestroy&&this.$el.contents().detach(),this):void 0},_destroyView:function(){var view=this.currentView;view.destroy&&!view.isDestroyed?view.destroy():view.remove&&(view.remove(),view.isDestroyed=!0)},attachView:function(view){return this.currentView=view,this},hasView:function(){return!!this.currentView},reset:function(){return this.empty(),this.$el&&(this.el=this.$el.selector),delete this.$el,this}},{buildRegion:function(regionConfig,DefaultRegionClass){if(_.isString(regionConfig))return this._buildRegionFromSelector(regionConfig,DefaultRegionClass);if(regionConfig.selector||regionConfig.el||regionConfig.regionClass)return this._buildRegionFromObject(regionConfig,DefaultRegionClass);if(_.isFunction(regionConfig))return this._buildRegionFromRegionClass(regionConfig);throw new Marionette.Error({message:"Improper region configuration type.",url:"marionette.region.html#region-configuration-types"})},_buildRegionFromSelector:function(selector,DefaultRegionClass){return new DefaultRegionClass({el:selector})},_buildRegionFromObject:function(regionConfig,DefaultRegionClass){var RegionClass=regionConfig.regionClass||DefaultRegionClass,options=_.omit(regionConfig,"selector","regionClass");return regionConfig.selector&&!options.el&&(options.el=regionConfig.selector),new RegionClass(options)},_buildRegionFromRegionClass:function(RegionClass){return new RegionClass}}),Marionette.RegionManager=Marionette.Controller.extend({constructor:function(options){this._regions={},this.length=0,Marionette.Controller.call(this,options),this.addRegions(this.getOption("regions"))},addRegions:function(regionDefinitions,defaults){return regionDefinitions=Marionette._getValue(regionDefinitions,this,arguments),_.reduce(regionDefinitions,function(regions,definition,name){return _.isString(definition)&&(definition={selector:definition}),definition.selector&&(definition=_.defaults({},definition,defaults)),regions[name]=this.addRegion(name,definition),
regions},{},this)},addRegion:function(name,definition){var region;return region=definition instanceof Marionette.Region?definition:Marionette.Region.buildRegion(definition,Marionette.Region),this.triggerMethod("before:add:region",name,region),region._parent=this,this._store(name,region),this.triggerMethod("add:region",name,region),region},get:function(name){return this._regions[name]},getRegions:function(){return _.clone(this._regions)},removeRegion:function(name){var region=this._regions[name];return this._remove(name,region),region},removeRegions:function(){var regions=this.getRegions();return _.each(this._regions,function(region,name){this._remove(name,region)},this),regions},emptyRegions:function(){var regions=this.getRegions();return _.invoke(regions,"empty"),regions},destroy:function(){return this.removeRegions(),Marionette.Controller.prototype.destroy.apply(this,arguments)},_store:function(name,region){this._regions[name]||this.length++,this._regions[name]=region},_remove:function(name,region){this.triggerMethod("before:remove:region",name,region),region.empty(),region.stopListening(),delete region._parent,delete this._regions[name],this.length--,this.triggerMethod("remove:region",name,region)}}),Marionette.actAsCollection(Marionette.RegionManager.prototype,"_regions"),Marionette.TemplateCache=function(templateId){this.templateId=templateId},_.extend(Marionette.TemplateCache,{templateCaches:{},get:function(templateId,options){var cachedTemplate=this.templateCaches[templateId];return cachedTemplate||(cachedTemplate=new Marionette.TemplateCache(templateId),this.templateCaches[templateId]=cachedTemplate),cachedTemplate.load(options)},clear:function(){var i,args=_.toArray(arguments),length=args.length;if(length>0)for(i=0;length>i;i++)delete this.templateCaches[args[i]];else this.templateCaches={}}}),_.extend(Marionette.TemplateCache.prototype,{load:function(options){if(this.compiledTemplate)return this.compiledTemplate;var template=this.loadTemplate(this.templateId,options);return this.compiledTemplate=this.compileTemplate(template,options),this.compiledTemplate},loadTemplate:function(templateId,options){var template=Backbone.$(templateId).html();if(!template||0===template.length)throw new Marionette.Error({name:"NoTemplateError",message:'Could not find template: "'+templateId+'"'});return template},compileTemplate:function(rawTemplate,options){return _.template(rawTemplate,options)}}),Marionette.Renderer={render:function(template,data){if(!template)throw new Marionette.Error({name:"TemplateNotFoundError",message:"Cannot render the template since its false, null or undefined."});var templateFunc=_.isFunction(template)?template:Marionette.TemplateCache.get(template);return templateFunc(data)}},Marionette.View=Backbone.View.extend({isDestroyed:!1,constructor:function(options){_.bindAll(this,"render"),options=Marionette._getValue(options,this),this.options=_.extend({},_.result(this,"options"),options),this._behaviors=Marionette.Behaviors(this),Backbone.View.call(this,this.options),Marionette.MonitorDOMRefresh(this)},getTemplate:function(){return this.getOption("template")},serializeModel:function(model){return model.toJSON.apply(model,_.rest(arguments))},mixinTemplateHelpers:function(target){target=target||{};var templateHelpers=this.getOption("templateHelpers");return templateHelpers=Marionette._getValue(templateHelpers,this),_.extend(target,templateHelpers)},normalizeUIKeys:function(hash){var uiBindings=_.result(this,"_uiBindings");return Marionette.normalizeUIKeys(hash,uiBindings||_.result(this,"ui"))},normalizeUIValues:function(hash,properties){var ui=_.result(this,"ui"),uiBindings=_.result(this,"_uiBindings");return Marionette.normalizeUIValues(hash,uiBindings||ui,properties)},configureTriggers:function(){if(this.triggers){var triggers=this.normalizeUIKeys(_.result(this,"triggers"));return _.reduce(triggers,function(events,value,key){return events[key]=this._buildViewTrigger(value),events},{},this)}},delegateEvents:function(events){return this._delegateDOMEvents(events),this.bindEntityEvents(this.model,this.getOption("modelEvents")),this.bindEntityEvents(this.collection,this.getOption("collectionEvents")),_.each(this._behaviors,function(behavior){behavior.bindEntityEvents(this.model,behavior.getOption("modelEvents")),behavior.bindEntityEvents(this.collection,behavior.getOption("collectionEvents"))},this),this},_delegateDOMEvents:function(eventsArg){var events=Marionette._getValue(eventsArg||this.events,this);events=this.normalizeUIKeys(events),_.isUndefined(eventsArg)&&(this.events=events);var combinedEvents={},behaviorEvents=_.result(this,"behaviorEvents")||{},triggers=this.configureTriggers(),behaviorTriggers=_.result(this,"behaviorTriggers")||{};_.extend(combinedEvents,behaviorEvents,events,triggers,behaviorTriggers),Backbone.View.prototype.delegateEvents.call(this,combinedEvents)},undelegateEvents:function(){return Backbone.View.prototype.undelegateEvents.apply(this,arguments),this.unbindEntityEvents(this.model,this.getOption("modelEvents")),this.unbindEntityEvents(this.collection,this.getOption("collectionEvents")),_.each(this._behaviors,function(behavior){behavior.unbindEntityEvents(this.model,behavior.getOption("modelEvents")),behavior.unbindEntityEvents(this.collection,behavior.getOption("collectionEvents"))},this),this},_ensureViewIsIntact:function(){if(this.isDestroyed)throw new Marionette.Error({name:"ViewDestroyedError",message:'View (cid: "'+this.cid+'") has already been destroyed and cannot be used.'})},destroy:function(){if(this.isDestroyed)return this;var args=_.toArray(arguments);return this.triggerMethod.apply(this,["before:destroy"].concat(args)),this.isDestroyed=!0,this.triggerMethod.apply(this,["destroy"].concat(args)),this.unbindUIElements(),this.isRendered=!1,this.remove(),_.invoke(this._behaviors,"destroy",args),this},bindUIElements:function(){this._bindUIElements(),_.invoke(this._behaviors,this._bindUIElements)},_bindUIElements:function(){if(this.ui){this._uiBindings||(this._uiBindings=this.ui);var bindings=_.result(this,"_uiBindings");this.ui={},_.each(bindings,function(selector,key){this.ui[key]=this.$(selector)},this)}},unbindUIElements:function(){this._unbindUIElements(),_.invoke(this._behaviors,this._unbindUIElements)},_unbindUIElements:function(){this.ui&&this._uiBindings&&(_.each(this.ui,function($el,name){delete this.ui[name]},this),this.ui=this._uiBindings,delete this._uiBindings)},_buildViewTrigger:function(triggerDef){var hasOptions=_.isObject(triggerDef),options=_.defaults({},hasOptions?triggerDef:{},{preventDefault:!0,stopPropagation:!0}),eventName=hasOptions?options.event:triggerDef;return function(e){e&&(e.preventDefault&&options.preventDefault&&e.preventDefault(),e.stopPropagation&&options.stopPropagation&&e.stopPropagation());var args={view:this,model:this.model,collection:this.collection};this.triggerMethod(eventName,args)}},setElement:function(){var ret=Backbone.View.prototype.setElement.apply(this,arguments);return _.invoke(this._behaviors,"proxyViewProperties",this),ret},triggerMethod:function(){var ret=Marionette._triggerMethod(this,arguments);return this._triggerEventOnBehaviors(arguments),this._triggerEventOnParentLayout(arguments[0],_.rest(arguments)),ret},_triggerEventOnBehaviors:function(args){for(var triggerMethod=Marionette._triggerMethod,behaviors=this._behaviors,i=0,length=behaviors&&behaviors.length;length>i;i++)triggerMethod(behaviors[i],args)},_triggerEventOnParentLayout:function(eventName,args){var layoutView=this._parentLayoutView();if(layoutView){var eventPrefix=Marionette.getOption(layoutView,"childViewEventPrefix"),prefixedEventName=eventPrefix+":"+eventName;Marionette._triggerMethod(layoutView,[prefixedEventName,this].concat(args));var childEvents=Marionette.getOption(layoutView,"childEvents"),normalizedChildEvents=layoutView.normalizeMethods(childEvents);normalizedChildEvents&&_.isFunction(normalizedChildEvents[eventName])&&normalizedChildEvents[eventName].apply(layoutView,[this].concat(args))}},_getImmediateChildren:function(){return[]},_getNestedViews:function(){var children=this._getImmediateChildren();return children.length?_.reduce(children,function(memo,view){return view._getNestedViews?memo.concat(view._getNestedViews()):memo},children):children},_getAncestors:function(){for(var ancestors=[],parent=this._parent;parent;)ancestors.push(parent),parent=parent._parent;return ancestors},_parentLayoutView:function(){var ancestors=this._getAncestors();return _.find(ancestors,function(parent){return parent instanceof Marionette.LayoutView})},normalizeMethods:Marionette.normalizeMethods,mergeOptions:Marionette.mergeOptions,getOption:Marionette.proxyGetOption,bindEntityEvents:Marionette.proxyBindEntityEvents,unbindEntityEvents:Marionette.proxyUnbindEntityEvents}),Marionette.ItemView=Marionette.View.extend({constructor:function(){Marionette.View.apply(this,arguments)},serializeData:function(){if(!this.model&&!this.collection)return{};var args=[this.model||this.collection];return arguments.length&&args.push.apply(args,arguments),this.model?this.serializeModel.apply(this,args):{items:this.serializeCollection.apply(this,args)}},serializeCollection:function(collection){return collection.toJSON.apply(collection,_.rest(arguments))},render:function(){return this._ensureViewIsIntact(),this.triggerMethod("before:render",this),this._renderTemplate(),this.isRendered=!0,this.bindUIElements(),this.triggerMethod("render",this),this},_renderTemplate:function(){var template=this.getTemplate();if(template!==!1){if(!template)throw new Marionette.Error({name:"UndefinedTemplateError",message:"Cannot render the template since it is null or undefined."});var data=this.mixinTemplateHelpers(this.serializeData()),html=Marionette.Renderer.render(template,data,this);return this.attachElContent(html),this}},attachElContent:function(html){return this.$el.html(html),this}}),Marionette.CollectionView=Marionette.View.extend({childViewEventPrefix:"childview",sort:!0,constructor:function(options){this.once("render",this._initialEvents),this._initChildViewStorage(),Marionette.View.apply(this,arguments),this.on("show",this._onShowCalled),this.initRenderBuffer()},initRenderBuffer:function(){this._bufferedChildren=[]},startBuffering:function(){this.initRenderBuffer(),this.isBuffering=!0},endBuffering:function(){this.isBuffering=!1,this._triggerBeforeShowBufferedChildren(),this.attachBuffer(this),this._triggerShowBufferedChildren(),this.initRenderBuffer()},_triggerBeforeShowBufferedChildren:function(){this._isShown&&_.each(this._bufferedChildren,_.partial(this._triggerMethodOnChild,"before:show"))},_triggerShowBufferedChildren:function(){this._isShown&&(_.each(this._bufferedChildren,_.partial(this._triggerMethodOnChild,"show")),this._bufferedChildren=[])},_triggerMethodOnChild:function(event,childView){Marionette.triggerMethodOn(childView,event)},_initialEvents:function(){this.collection&&(this.listenTo(this.collection,"add",this._onCollectionAdd),this.listenTo(this.collection,"remove",this._onCollectionRemove),this.listenTo(this.collection,"reset",this.render),this.getOption("sort")&&this.listenTo(this.collection,"sort",this._sortViews))},_onCollectionAdd:function(child,collection,opts){var index;if(index=void 0!==opts.at?opts.at:_.indexOf(this._filteredSortedModels(),child),this._shouldAddChild(child,index)){this.destroyEmptyView();var ChildView=this.getChildView(child);this.addChild(child,ChildView,index)}},_onCollectionRemove:function(model){var view=this.children.findByModel(model);this.removeChildView(view),this.checkEmpty()},_onShowCalled:function(){this.children.each(_.partial(this._triggerMethodOnChild,"show"))},render:function(){return this._ensureViewIsIntact(),this.triggerMethod("before:render",this),this._renderChildren(),this.isRendered=!0,this.triggerMethod("render",this),this},reorder:function(){var children=this.children,models=this._filteredSortedModels(),modelsChanged=_.find(models,function(model){return!children.findByModel(model)});if(modelsChanged)this.render();else{var els=_.map(models,function(model){return children.findByModel(model).el});this.triggerMethod("before:reorder"),this._appendReorderedChildren(els),this.triggerMethod("reorder")}},resortView:function(){Marionette.getOption(this,"reorderOnSort")?this.reorder():this.render()},_sortViews:function(){var models=this._filteredSortedModels(),orderChanged=_.find(models,function(item,index){var view=this.children.findByModel(item);return!view||view._index!==index},this);orderChanged&&this.resortView()},_emptyViewIndex:-1,_appendReorderedChildren:function(children){this.$el.append(children)},_renderChildren:function(){this.destroyEmptyView(),this.destroyChildren(),this.isEmpty(this.collection)?this.showEmptyView():(this.triggerMethod("before:render:collection",this),this.startBuffering(),this.showCollection(),this.endBuffering(),this.triggerMethod("render:collection",this),this.children.isEmpty()&&this.showEmptyView())},showCollection:function(){var ChildView,models=this._filteredSortedModels();_.each(models,function(child,index){ChildView=this.getChildView(child),this.addChild(child,ChildView,index)},this)},_filteredSortedModels:function(){var models,viewComparator=this.getViewComparator();return models=viewComparator?_.isString(viewComparator)||1===viewComparator.length?this.collection.sortBy(viewComparator,this):_.clone(this.collection.models).sort(_.bind(viewComparator,this)):this.collection.models,this.getOption("filter")&&(models=_.filter(models,function(model,index){return this._shouldAddChild(model,index)},this)),models},showEmptyView:function(){var EmptyView=this.getEmptyView();if(EmptyView&&!this._showingEmptyView){this.triggerMethod("before:render:empty"),this._showingEmptyView=!0;var model=new Backbone.Model;this.addEmptyView(model,EmptyView),this.triggerMethod("render:empty")}},destroyEmptyView:function(){this._showingEmptyView&&(this.triggerMethod("before:remove:empty"),this.destroyChildren(),delete this._showingEmptyView,this.triggerMethod("remove:empty"))},getEmptyView:function(){return this.getOption("emptyView")},addEmptyView:function(child,EmptyView){var emptyViewOptions=this.getOption("emptyViewOptions")||this.getOption("childViewOptions");_.isFunction(emptyViewOptions)&&(emptyViewOptions=emptyViewOptions.call(this,child,this._emptyViewIndex));var view=this.buildChildView(child,EmptyView,emptyViewOptions);view._parent=this,this.proxyChildEvents(view),this._isShown&&Marionette.triggerMethodOn(view,"before:show"),this.children.add(view),this.renderChildView(view,this._emptyViewIndex),this._isShown&&Marionette.triggerMethodOn(view,"show")},getChildView:function(child){var childView=this.getOption("childView");if(!childView)throw new Marionette.Error({name:"NoChildViewError",message:'A "childView" must be specified'});return childView},addChild:function(child,ChildView,index){var childViewOptions=this.getOption("childViewOptions");childViewOptions=Marionette._getValue(childViewOptions,this,[child,index]);var view=this.buildChildView(child,ChildView,childViewOptions);return this._updateIndices(view,!0,index),this._addChildView(view,index),view._parent=this,view},_updateIndices:function(view,increment,index){this.getOption("sort")&&(increment&&(view._index=index),this.children.each(function(laterView){laterView._index>=view._index&&(laterView._index+=increment?1:-1)}))},_addChildView:function(view,index){this.proxyChildEvents(view),this.triggerMethod("before:add:child",view),this._isShown&&!this.isBuffering&&Marionette.triggerMethodOn(view,"before:show"),this.children.add(view),this.renderChildView(view,index),this._isShown&&!this.isBuffering&&Marionette.triggerMethodOn(view,"show"),this.triggerMethod("add:child",view)},renderChildView:function(view,index){return view.render(),this.attachHtml(this,view,index),view},buildChildView:function(child,ChildViewClass,childViewOptions){var options=_.extend({model:child},childViewOptions);return new ChildViewClass(options)},removeChildView:function(view){return view&&(this.triggerMethod("before:remove:child",view),view.destroy?view.destroy():view.remove&&view.remove(),delete view._parent,this.stopListening(view),this.children.remove(view),this.triggerMethod("remove:child",view),this._updateIndices(view,!1)),view},isEmpty:function(){return!this.collection||0===this.collection.length},checkEmpty:function(){this.isEmpty(this.collection)&&this.showEmptyView()},attachBuffer:function(collectionView){collectionView.$el.append(this._createBuffer(collectionView))},_createBuffer:function(collectionView){var elBuffer=document.createDocumentFragment();return _.each(collectionView._bufferedChildren,function(b){elBuffer.appendChild(b.el)}),elBuffer},attachHtml:function(collectionView,childView,index){collectionView.isBuffering?collectionView._bufferedChildren.splice(index,0,childView):collectionView._insertBefore(childView,index)||collectionView._insertAfter(childView)},_insertBefore:function(childView,index){var currentView,findPosition=this.getOption("sort")&&index<this.children.length-1;return findPosition&&(currentView=this.children.find(function(view){return view._index===index+1})),currentView?(currentView.$el.before(childView.el),!0):!1},_insertAfter:function(childView){this.$el.append(childView.el)},_initChildViewStorage:function(){this.children=new Backbone.ChildViewContainer},destroy:function(){return this.isDestroyed?this:(this.triggerMethod("before:destroy:collection"),this.destroyChildren(),this.triggerMethod("destroy:collection"),Marionette.View.prototype.destroy.apply(this,arguments))},destroyChildren:function(){var childViews=this.children.map(_.identity);return this.children.each(this.removeChildView,this),this.checkEmpty(),childViews},_shouldAddChild:function(child,index){var filter=this.getOption("filter");return!_.isFunction(filter)||filter.call(this,child,index,this.collection)},proxyChildEvents:function(view){var prefix=this.getOption("childViewEventPrefix");this.listenTo(view,"all",function(){var args=_.toArray(arguments),rootEvent=args[0],childEvents=this.normalizeMethods(_.result(this,"childEvents"));args[0]=prefix+":"+rootEvent,args.splice(1,0,view),"undefined"!=typeof childEvents&&_.isFunction(childEvents[rootEvent])&&childEvents[rootEvent].apply(this,args.slice(1)),this.triggerMethod.apply(this,args)})},_getImmediateChildren:function(){return _.values(this.children._views)},getViewComparator:function(){return this.getOption("viewComparator")}}),Marionette.CompositeView=Marionette.CollectionView.extend({constructor:function(){Marionette.CollectionView.apply(this,arguments)},_initialEvents:function(){this.collection&&(this.listenTo(this.collection,"add",this._onCollectionAdd),this.listenTo(this.collection,"remove",this._onCollectionRemove),this.listenTo(this.collection,"reset",this._renderChildren),this.getOption("sort")&&this.listenTo(this.collection,"sort",this._sortViews))},getChildView:function(child){var childView=this.getOption("childView")||this.constructor;return childView},serializeData:function(){var data={};return this.model&&(data=_.partial(this.serializeModel,this.model).apply(this,arguments)),data},render:function(){return this._ensureViewIsIntact(),this._isRendering=!0,this.resetChildViewContainer(),this.triggerMethod("before:render",this),this._renderTemplate(),this._renderChildren(),this._isRendering=!1,this.isRendered=!0,this.triggerMethod("render",this),this},_renderChildren:function(){(this.isRendered||this._isRendering)&&Marionette.CollectionView.prototype._renderChildren.call(this)},_renderTemplate:function(){var data={};data=this.serializeData(),data=this.mixinTemplateHelpers(data),this.triggerMethod("before:render:template");var template=this.getTemplate(),html=Marionette.Renderer.render(template,data,this);this.attachElContent(html),this.bindUIElements(),this.triggerMethod("render:template")},attachElContent:function(html){return this.$el.html(html),this},attachBuffer:function(compositeView){var $container=this.getChildViewContainer(compositeView);$container.append(this._createBuffer(compositeView))},_insertAfter:function(childView){var $container=this.getChildViewContainer(this,childView);$container.append(childView.el)},_appendReorderedChildren:function(children){var $container=this.getChildViewContainer(this);$container.append(children)},getChildViewContainer:function(containerView,childView){if("$childViewContainer"in containerView)return containerView.$childViewContainer;var container,childViewContainer=Marionette.getOption(containerView,"childViewContainer");if(childViewContainer){var selector=Marionette._getValue(childViewContainer,containerView);if(container="@"===selector.charAt(0)&&containerView.ui?containerView.ui[selector.substr(4)]:containerView.$(selector),container.length<=0)throw new Marionette.Error({name:"ChildViewContainerMissingError",message:'The specified "childViewContainer" was not found: '+containerView.childViewContainer})}else container=containerView.$el;return containerView.$childViewContainer=container,container},resetChildViewContainer:function(){this.$childViewContainer&&delete this.$childViewContainer}}),Marionette.LayoutView=Marionette.ItemView.extend({regionClass:Marionette.Region,options:{destroyImmediate:!1},childViewEventPrefix:"childview",constructor:function(options){options=options||{},this._firstRender=!0,this._initializeRegions(options),Marionette.ItemView.call(this,options)},render:function(){return this._ensureViewIsIntact(),this._firstRender?this._firstRender=!1:this._reInitializeRegions(),Marionette.ItemView.prototype.render.apply(this,arguments)},destroy:function(){return this.isDestroyed?this:(this.getOption("destroyImmediate")===!0&&this.$el.remove(),this.regionManager.destroy(),Marionette.ItemView.prototype.destroy.apply(this,arguments))},showChildView:function(regionName,view){return this.getRegion(regionName).show(view)},getChildView:function(regionName){return this.getRegion(regionName).currentView},addRegion:function(name,definition){var regions={};return regions[name]=definition,this._buildRegions(regions)[name]},addRegions:function(regions){return this.regions=_.extend({},this.regions,regions),this._buildRegions(regions)},removeRegion:function(name){return delete this.regions[name],this.regionManager.removeRegion(name)},getRegion:function(region){return this.regionManager.get(region)},getRegions:function(){return this.regionManager.getRegions()},_buildRegions:function(regions){var defaults={regionClass:this.getOption("regionClass"),parentEl:_.partial(_.result,this,"el")};return this.regionManager.addRegions(regions,defaults)},_initializeRegions:function(options){var regions;this._initRegionManager(),regions=Marionette._getValue(this.regions,this,[options])||{};var regionOptions=this.getOption.call(options,"regions");regionOptions=Marionette._getValue(regionOptions,this,[options]),_.extend(regions,regionOptions),regions=this.normalizeUIValues(regions,["selector","el"]),this.addRegions(regions)},_reInitializeRegions:function(){this.regionManager.invoke("reset")},getRegionManager:function(){return new Marionette.RegionManager},_initRegionManager:function(){this.regionManager=this.getRegionManager(),this.regionManager._parent=this,this.listenTo(this.regionManager,"before:add:region",function(name){this.triggerMethod("before:add:region",name)}),this.listenTo(this.regionManager,"add:region",function(name,region){this[name]=region,this.triggerMethod("add:region",name,region)}),this.listenTo(this.regionManager,"before:remove:region",function(name){this.triggerMethod("before:remove:region",name)}),this.listenTo(this.regionManager,"remove:region",function(name,region){delete this[name],this.triggerMethod("remove:region",name,region)})},_getImmediateChildren:function(){return _.chain(this.regionManager.getRegions()).pluck("currentView").compact().value()}}),Marionette.Behavior=Marionette.Object.extend({constructor:function(options,view){this.view=view,this.defaults=_.result(this,"defaults")||{},this.options=_.extend({},this.defaults,options),this.ui=_.extend({},_.result(view,"ui"),_.result(this,"ui")),Marionette.Object.apply(this,arguments)},$:function(){return this.view.$.apply(this.view,arguments)},destroy:function(){return this.stopListening(),this},proxyViewProperties:function(view){this.$el=view.$el,this.el=view.el}}),Marionette.Behaviors=function(Marionette,_){function Behaviors(view,behaviors){return _.isObject(view.behaviors)?(behaviors=Behaviors.parseBehaviors(view,behaviors||_.result(view,"behaviors")),Behaviors.wrap(view,behaviors,_.keys(methods)),behaviors):{}}function BehaviorTriggersBuilder(view,behaviors){this._view=view,this._behaviors=behaviors,this._triggers={}}function getBehaviorsUI(behavior){return behavior._uiBindings||behavior.ui}var delegateEventSplitter=/^(\S+)\s*(.*)$/,methods={behaviorTriggers:function(behaviorTriggers,behaviors){var triggerBuilder=new BehaviorTriggersBuilder(this,behaviors);return triggerBuilder.buildBehaviorTriggers()},behaviorEvents:function(behaviorEvents,behaviors){var _behaviorsEvents={};return _.each(behaviors,function(b,i){var _events={},behaviorEvents=_.clone(_.result(b,"events"))||{};behaviorEvents=Marionette.normalizeUIKeys(behaviorEvents,getBehaviorsUI(b));var j=0;_.each(behaviorEvents,function(behaviour,key){var match=key.match(delegateEventSplitter),eventName=match[1]+"."+[this.cid,i,j++," "].join(""),selector=match[2],eventKey=eventName+selector,handler=_.isFunction(behaviour)?behaviour:b[behaviour];_events[eventKey]=_.bind(handler,b)},this),_behaviorsEvents=_.extend(_behaviorsEvents,_events)},this),_behaviorsEvents}};return _.extend(Behaviors,{behaviorsLookup:function(){throw new Marionette.Error({message:"You must define where your behaviors are stored.",url:"marionette.behaviors.html#behaviorslookup"})},getBehaviorClass:function(options,key){return options.behaviorClass?options.behaviorClass:Marionette._getValue(Behaviors.behaviorsLookup,this,[options,key])[key]},parseBehaviors:function(view,behaviors){return _.chain(behaviors).map(function(options,key){var BehaviorClass=Behaviors.getBehaviorClass(options,key),behavior=new BehaviorClass(options,view),nestedBehaviors=Behaviors.parseBehaviors(view,_.result(behavior,"behaviors"));return[behavior].concat(nestedBehaviors)}).flatten().value()},wrap:function(view,behaviors,methodNames){_.each(methodNames,function(methodName){view[methodName]=_.partial(methods[methodName],view[methodName],behaviors)})}}),_.extend(BehaviorTriggersBuilder.prototype,{buildBehaviorTriggers:function(){return _.each(this._behaviors,this._buildTriggerHandlersForBehavior,this),this._triggers},_buildTriggerHandlersForBehavior:function(behavior,i){var triggersHash=_.clone(_.result(behavior,"triggers"))||{};triggersHash=Marionette.normalizeUIKeys(triggersHash,getBehaviorsUI(behavior)),_.each(triggersHash,_.bind(this._setHandlerForBehavior,this,behavior,i))},_setHandlerForBehavior:function(behavior,i,eventName,trigger){var triggerKey=trigger.replace(/^\S+/,function(triggerName){return triggerName+".behaviortriggers"+i});this._triggers[triggerKey]=this._view._buildViewTrigger(eventName)}}),Behaviors}(Marionette,_),Marionette.AppRouter=Backbone.Router.extend({constructor:function(options){this.options=options||{},Backbone.Router.apply(this,arguments);var appRoutes=this.getOption("appRoutes"),controller=this._getController();this.processAppRoutes(controller,appRoutes),this.on("route",this._processOnRoute,this)},appRoute:function(route,methodName){var controller=this._getController();this._addAppRoute(controller,route,methodName)},_processOnRoute:function(routeName,routeArgs){if(_.isFunction(this.onRoute)){var routePath=_.invert(this.getOption("appRoutes"))[routeName];this.onRoute(routeName,routePath,routeArgs)}},processAppRoutes:function(controller,appRoutes){if(appRoutes){var routeNames=_.keys(appRoutes).reverse();_.each(routeNames,function(route){this._addAppRoute(controller,route,appRoutes[route])},this)}},_getController:function(){return this.getOption("controller")},_addAppRoute:function(controller,route,methodName){var method=controller[methodName];if(!method)throw new Marionette.Error('Method "'+methodName+'" was not found on the controller');this.route(route,methodName,_.bind(method,controller))},mergeOptions:Marionette.mergeOptions,getOption:Marionette.proxyGetOption,triggerMethod:Marionette.triggerMethod,bindEntityEvents:Marionette.proxyBindEntityEvents,unbindEntityEvents:Marionette.proxyUnbindEntityEvents}),Marionette.Application=Marionette.Object.extend({constructor:function(options){this._initializeRegions(options),this._initCallbacks=new Marionette.Callbacks,this.submodules={},_.extend(this,options),this._initChannel(),Marionette.Object.call(this,options)},execute:function(){this.commands.execute.apply(this.commands,arguments)},request:function(){return this.reqres.request.apply(this.reqres,arguments)},addInitializer:function(initializer){this._initCallbacks.add(initializer)},start:function(options){this.triggerMethod("before:start",options),this._initCallbacks.run(options,this),this.triggerMethod("start",options)},addRegions:function(regions){return this._regionManager.addRegions(regions)},emptyRegions:function(){return this._regionManager.emptyRegions()},removeRegion:function(region){return this._regionManager.removeRegion(region)},getRegion:function(region){return this._regionManager.get(region)},getRegions:function(){return this._regionManager.getRegions()},module:function(moduleNames,moduleDefinition){var ModuleClass=Marionette.Module.getClass(moduleDefinition),args=_.toArray(arguments);return args.unshift(this),ModuleClass.create.apply(ModuleClass,args)},getRegionManager:function(){return new Marionette.RegionManager},_initializeRegions:function(options){var regions=_.isFunction(this.regions)?this.regions(options):this.regions||{};this._initRegionManager();var optionRegions=Marionette.getOption(options,"regions");return _.isFunction(optionRegions)&&(optionRegions=optionRegions.call(this,options)),_.extend(regions,optionRegions),this.addRegions(regions),this},_initRegionManager:function(){this._regionManager=this.getRegionManager(),this._regionManager._parent=this,this.listenTo(this._regionManager,"before:add:region",function(){Marionette._triggerMethod(this,"before:add:region",arguments)}),this.listenTo(this._regionManager,"add:region",function(name,region){this[name]=region,Marionette._triggerMethod(this,"add:region",arguments)}),this.listenTo(this._regionManager,"before:remove:region",function(){Marionette._triggerMethod(this,"before:remove:region",arguments)}),this.listenTo(this._regionManager,"remove:region",function(name){delete this[name],Marionette._triggerMethod(this,"remove:region",arguments)})},_initChannel:function(){this.channelName=_.result(this,"channelName")||"global",this.channel=_.result(this,"channel")||Backbone.Wreqr.radio.channel(this.channelName),this.vent=_.result(this,"vent")||this.channel.vent,this.commands=_.result(this,"commands")||this.channel.commands,this.reqres=_.result(this,"reqres")||this.channel.reqres}}),Marionette.Module=function(moduleName,app,options){this.moduleName=moduleName,this.options=_.extend({},this.options,options),this.initialize=options.initialize||this.initialize,this.submodules={},this._setupInitializersAndFinalizers(),this.app=app,_.isFunction(this.initialize)&&this.initialize(moduleName,app,this.options)},Marionette.Module.extend=Marionette.extend,_.extend(Marionette.Module.prototype,Backbone.Events,{startWithParent:!0,initialize:function(){},addInitializer:function(callback){this._initializerCallbacks.add(callback)},addFinalizer:function(callback){this._finalizerCallbacks.add(callback)},start:function(options){this._isInitialized||(_.each(this.submodules,function(mod){mod.startWithParent&&mod.start(options)}),this.triggerMethod("before:start",options),this._initializerCallbacks.run(options,this),this._isInitialized=!0,this.triggerMethod("start",options))},stop:function(){this._isInitialized&&(this._isInitialized=!1,
this.triggerMethod("before:stop"),_.invoke(this.submodules,"stop"),this._finalizerCallbacks.run(void 0,this),this._initializerCallbacks.reset(),this._finalizerCallbacks.reset(),this.triggerMethod("stop"))},addDefinition:function(moduleDefinition,customArgs){this._runModuleDefinition(moduleDefinition,customArgs)},_runModuleDefinition:function(definition,customArgs){if(definition){var args=_.flatten([this,this.app,Backbone,Marionette,Backbone.$,_,customArgs]);definition.apply(this,args)}},_setupInitializersAndFinalizers:function(){this._initializerCallbacks=new Marionette.Callbacks,this._finalizerCallbacks=new Marionette.Callbacks},triggerMethod:Marionette.triggerMethod}),_.extend(Marionette.Module,{create:function(app,moduleNames,moduleDefinition){var module=app,customArgs=_.drop(arguments,3);moduleNames=moduleNames.split(".");var length=moduleNames.length,moduleDefinitions=[];return moduleDefinitions[length-1]=moduleDefinition,_.each(moduleNames,function(moduleName,i){var parentModule=module;module=this._getModule(parentModule,moduleName,app,moduleDefinition),this._addModuleDefinition(parentModule,module,moduleDefinitions[i],customArgs)},this),module},_getModule:function(parentModule,moduleName,app,def,args){var options=_.extend({},def),ModuleClass=this.getClass(def),module=parentModule[moduleName];return module||(module=new ModuleClass(moduleName,app,options),parentModule[moduleName]=module,parentModule.submodules[moduleName]=module),module},getClass:function(moduleDefinition){var ModuleClass=Marionette.Module;return moduleDefinition?moduleDefinition.prototype instanceof ModuleClass?moduleDefinition:moduleDefinition.moduleClass||ModuleClass:ModuleClass},_addModuleDefinition:function(parentModule,module,def,args){var fn=this._getDefine(def),startWithParent=this._getStartWithParent(def,module);fn&&module.addDefinition(fn,args),this._addStartWithParent(parentModule,module,startWithParent)},_getStartWithParent:function(def,module){var swp;return _.isFunction(def)&&def.prototype instanceof Marionette.Module?(swp=module.constructor.prototype.startWithParent,_.isUndefined(swp)?!0:swp):_.isObject(def)?(swp=def.startWithParent,_.isUndefined(swp)?!0:swp):!0},_getDefine:function(def){return!_.isFunction(def)||def.prototype instanceof Marionette.Module?_.isObject(def)?def.define:null:def},_addStartWithParent:function(parentModule,module,startWithParent){module.startWithParent=module.startWithParent&&startWithParent,module.startWithParent&&!module.startWithParentIsConfigured&&(module.startWithParentIsConfigured=!0,parentModule.addInitializer(function(options){module.startWithParent&&module.start(options)}))}}),Marionette}),Marionette.Renderer={render:function(template,data){if(!template)throw new Marionette.Error({name:"TemplateNotFoundError",message:"Cannot render the template since its false, null or undefined."});var output="";try{return output=nunjucks.render(template,data)}catch(err){throw new Marionette.Error({name:"NunjucksError",message:err.message})}}};