{% extends (commonTemplatesPath + "/layouts/index_paper_kit.html")                           %}

{% from (commonTemplatesPath + "/includes/navbar.html")             import navbar            %}
{% from (commonTemplatesPath + "/includes/footer.html")             import footer            %}


{% block head %}

{# call super to common css #}
{{ super() }}

<link href="/public/lib/leaflet/leaflet-1.0beta2/leaflet.css" rel="stylesheet" />
<link href="/public/lib/leaflet/leaflet-label-9c431d/leaflet.label.css" rel="stylesheet" />
<link href="/public/lib/leaflet/leaflet-awesome-markers-af0bfc/leaflet.awesome-markers.css" rel="stylesheet" />
<link href="/public/lib/leaflet/leaflet-panel-layers-97f018/leaflet-panel-layers.src.css" rel="stylesheet" />


<style>
    #map {
        height: 1200px;
    }

    .legend-strip {
        min-width: 25px !important;
        border-radius: 3px;
    }

    .leaflet-panel-layers-item > span.legend-strip {
        height: 16px;
        margin-bottom: 3px;
    }

    .leaflet-panel-layers-item > span.legend-title {
/*        padding-bottom: 1px;*/
        font-size: 13px;
    }

    .icon-marker-lg {
        font-size: 17px !important;
    }


    /* colors from the awesome markers plugin */
    .leaflet-panel-layers-red {
        background-color: #d63e2a;
    }

    .leaflet-panel-layers-orange {
        background-color: #f69730;
    }

    .leaflet-panel-layers-green {
        background-color: #72b026;
    }

    .leaflet-panel-layers-blue {
        background-color: #38aadd;
    }

    .leaflet-panel-layers-purple {
        background-color: #d252b9;
    }

    .leaflet-panel-layers-darkred {
        background-color: #a23336;
    }

    .leaflet-panel-layers-darkblue {
        background-color: #0067a3;
    }

    .leaflet-panel-layers-darkgreen {
        background-color: #728224;
    }

    .leaflet-panel-layers-darkpurple {
        background-color: #5b396b;
    }

    .leaflet-panel-layers-lightgray {
        background-color: #a3a3a3;
    }


.leaflet-panel-layers-base .leaflet-panel-layers-item,
.leaflet-panel-layers-overlays .leaflet-panel-layers-item {
    height: 24px;
}

.leaflet-panel-layers-item {
    padding-left: 6px;
}


</style>
{% endblock %}


{% block body %}

{{ navbar(ctx) }}


<div class="wrapper" style="padding-bottom: 50px;">
    <div class="container" >
        <div style="margin-top: 25px;" class="row">

            {# LEFT COLUMN #}
            <div style="xborder: solid 1px;"  class="col-sm-5">

                <div style="border: 1px solid #bdbdbd; border-radius: 5px;" >
                    <img  class="img-responsive center-block" src="/public/images/logos_catalise/logo-catalise_.jpg" alt="">
                </div>
                <h3>CATALISE - Capacitação da Transição Local e Inovação Social</h3>

                <p>
                São já reconhecidos os efeitos do impacto do paradigma de desenvolvimento dominante, baseado
                na ideia de crescimento ilimitado (o aumento das desigualdades sociais, das situações de pobreza 
                e de exclusão social), o reconhecimento da não perenidade dos recursos energéticos e os 
                impactos adversos das alterações climáticas sobre os sistemas ecológicos, sociais e económicos. 
                </p>

                <div class="collapse" id="read-more">

                    <p>
                    Coloca-se, hoje, o desafio de construir soluções criativas e efectivas, que respondam de forma 
                    integral às necessidades locais e que promovam a liberdade e bem-estar do ser humano, sem 
                    colocar em causa o meio ambiente. A incerteza associada a estes problemas, a dispersão e 
                    insuficiência de conhecimento integrado e lacunas na investigação sobre respostas humanas às 
                    alterações climáticas, políticas de adaptação e outros problemas dificulta a tomada de decisão 
                    política e condiciona o sucesso das medidas preconizadas.
                    </p>

                    <p>

                    Em Portugal, existem diversas iniciativas que propõem valores e soluções alternativas ou 
                    complementares ao paradigma vigente. Porém, existe ainda pouco conhecimento sobre as 
                    mesmas, nomeadamente acerca das suas propostas axiológicas e das suas práticas, dos 
                    impactos alcançados nos contextos locais onde operam e dos processos de interacção que 
                    estabelecem com outros actores sociais. A viabilidade a curto e médio prazo destas iniciativas 
                    está fortemente relacionada com a sua sustentabilidade e capacidade emancipatória, e na sua 
                    capacidade em propor e concretizar soluções que permitam a Transição para uma cultura em 
                    alternativa à vigorante, nomeadmente, mais integral, ecológica e respeitadora da liberdade 
                    humana.
                    </p>

                </div>

                <a style="" class="btn btn-warning btn-catalise" role="button" data-toggle="collapse" data-is-open="false" href="#read-more">
                    Ler mais <i style="font-size: 115%; margin-left: 5px;" class="fa fa-arrow-circle-down"></i>
                </a>

                <hr>

                <div>
                    <h4>Publicações <span style="font-weight: normal; font-size: 18px;"></span></h4> 
                    <ul style="padding-left: 30px;">
<!--                         <li><a href="#">Guia de boas práticas</a></li>
                        <li><a href="">Caderno de recomendações políticas</a></li>
                        <li><a href="">Relatório</a></li> -->
                        <li><a href="https://drive.google.com/file/d/0B7Ayz3ikln3vZlRQOUZJbEJNRDg/view">Síntese sobre o Projecto CATALISE</a></li>
                        <li>
                            <a data-download="true" target="_blank" href="/public/catalise-guia-praticas-web.pdf">Guia de boas práticas (pdf)</a> 
                            
                            <span style="margin-left: 3px;" class="badge" title="{{ ctx.downloadCount['catalise-guia-praticas-web.pdf'] }} downloads">
                                {{ ctx.downloadCount['catalise-guia-praticas-web.pdf'] }}
                            </span>
                        </li>
                        <li>
                            <a data-download="true" target="_blank" href="/public/catalise-caderno-recomendacoes-web.pdf">Caderno de recomendações políticas (pdf)</a>

                            <span style="margin-left: 3px;" class="badge" title="{{ ctx.downloadCount['catalise-caderno-recomendacoes-web.pdf'] }} downloads">
                                {{ ctx.downloadCount['catalise-caderno-recomendacoes-web.pdf'] }}
                            </span>
                        </li>
                        <li>
                            <a data-download="true" target="_blank" href="/public/catalise-relatorio-cientifico.pdf">Relatório Científico (pdf)</a>

                            <span style="margin-left: 3px;" class="badge" title="{{ ctx.downloadCount['catalise-relatorio-cientifico.pdf'] }} downloads">
                                {{ ctx.downloadCount['catalise-relatorio-cientifico.pdf'] }}
                            </span>
                        </li>
                        <li>Relatório</li>
                    </ul>
                </div>

                <hr>

                <div>
                    <h4>Filme documentário</h4>
                    <div style="border: 1px solid #bdbdbd; border-radius: 5px; padding: 10px 10px 5px 10px;">
                        <iframe width="100%" height="315" src="https://www.youtube.com/embed/NuKcPGxmFJo" frameborder="0" allowfullscreen></iframe>
                    </div>
                </div>

                <hr>

<!--                 <div class="row" style="margin-bottom: 30px;">
                    <div class="col-sm-12">
                    Coordenado por:
                    <img  class="img-responsive" src="/rc-app/_logos_catalise/logos_todos.png" alt="">
                    </div>
                </div> -->
                
                <div class="row">
                    <div class="col-sm-12">
                    Coordenado por:
                    </div>

                    <div class="col-sm-12">
                        <a href="http://www.cics.nova.fcsh.unl.pt/"><img  class="img-responsive" src="/public/images/logos_catalise/cics_nova.jpg" alt=""></a>
                    </div>
                    <div class="col-sm-12" style="margin-top: 15px;">
                        <a href="http://ce3c.ciencias.ulisboa.pt/"><img  class="img-responsive" src="/public/images/logos_catalise/ce3c_fcul.jpg" alt=""></a>
                    </div>
                </div>

<!--
                 <div class="row" style="margin-top: 10px;">

                    <div class="col-sm-6">
                        <a href="#"><img  class="img-responsive" src="/rc-app/_logos_catalise/Ciencias_UL_Azul_H.png" alt=""></a>
                    </div>
                     <div class="col-sm-6">
                        <a href="#"><img  class="img-responsive" src="/rc-app/_logos_catalise/ce3c-logo.png" alt=""></a>
                    </div> 

                </div>
 -->

                <div class="row" style="margin-top: 30px;">
                    <div style="margin-bottom: 10px;" class="col-sm-12">
                    Apoio de:
                    </div>

                    <div class="col-sm-6">
                        <a href="https://www.fccn.pt/"><img  class="img-responsive" src="/public/images/logos_catalise/fct_fccn_2.jpg" alt=""></a>
                    </div>
                </div>

                <div class="row" style="margin-top: 30px;">
                    <div class="col-sm-12">
                    Financiado por:
                    </div>

                    <div class="col-sm-6">
                        <a href="http://www.gulbenkian.pt/"><img  class="img-responsive" src="/public/images/logos_catalise/logo_fcg_novo.jpg" alt=""></a>
                    </div>
                </div>


            </div>

            {# RIGHT COLUMN #}
            <div style="border: 1px solid #bdbdbd; border-radius: 5px; padding: 10px;" class="col-sm-7">

                <div style="" id="map"></div>

            </div>
        </div>

    </div>
</div>



{{ footer() }}

{{ super() }}

<script src="/public/lib/underscore/underscore-1.6.0.js"></script>
<script src="/public/lib/leaflet/leaflet-1.0beta2/leaflet-src.js"></script>
<script src="/public/lib/leaflet/leaflet-label-9c431d/leaflet.label-src.js"></script>
<script src="/public/lib/leaflet/leaflet-awesome-markers-af0bfc/leaflet.awesome-markers.js"></script>
<script src="/public/lib/leaflet/leaflet-panel-layers-97f018/leaflet-panel-layers.src.js"></script>
<script src="/public/lib/leaflet/leaflet-mq-r8cRGv.js"></script>



<script>

var Catalise = {};

Catalise.downloadCount = {{ ctx.downloadCount | stringify }};

Catalise.$readMoreBtn = $("a[href='#read-more']");
Catalise.$readMoreBtn.on("click", function(){

    var isOpen = Catalise.$readMoreBtn.data("isOpen");
    var html = "";
    if(isOpen){
        html = 'Ler mais <i style="font-size: 115%; margin-left: 5px;" class="fa fa-arrow-circle-down"></i>'
    }
    else{
        html = 'Recolher  <i style="font-size: 115%; margin-left: 5px;" class="fa fa-arrow-circle-up"></i>';
    }

    Catalise.$readMoreBtn.data("isOpen", !isOpen);

    setTimeout(function(){
        Catalise.$readMoreBtn.html(html);
    }, 500);
   
});

Catalise.data = [
    {
        "projectName": "1000Lides Associação Cultural",
        "network": "Rede Convergir",
        "url": "/iniciativas/1000lides-associacao-cultural",
        "studyCase": true,
        "lat": "38.1470314",
        "lng": "-8.7286323"
    },
    {
        "projectName": "Academia Cidadã",
        "network": "Rede Convergir",
        "url": "/iniciativas/academia-cidada",
        "lat": "38.7311266",
        "lng": "-9.1344953"
    },
    {
        "projectName": "Associação Viver Telheiras - Centro de Convergência de Telheiras - Iniciativa de Transição em Telheiras",
        "network": "Rede Convergir",
        "url": "/iniciativas/iniciativa-de-transicao-em-telheiras",
        "studyCase": true,
        "lat": "38.7618914",
        "lng": "-9.1686549"
    },
    {
        "projectName": "Biovilla",
        "network": "Rede Convergir",
        "url": "/iniciativas/biovilla",
        "lat": "38.539539",
        "lng": "-8.937882"
    },
    {
        "projectName": "Casa da Floresta Verdes Anos",
        "network": "Rede Convergir",
        "url": "/iniciativas/casa-da-floresta-verdes-anos",
        "studyCase": true,
        "lat": "38.7405333",
        "lng": "-9.1807221"
    },
    {
        "projectName": "Centro de Convergência em Permacultura na Raia",
        "network": "Rede Convergir",
        "url": "/iniciativas/centro-de-convergencia-em-permacultura-na-raia",
        "lat": "39.9174463",
        "lng": "-7.2295734"
    },
    {
        "projectName": "Círculos de Sementes - WAKESEED",
        "network": "Rede Convergir",
        "url": "/iniciativas/wakeseed-30",
        "studyCase": true,
        "lat": "38.752412",
        "lng": "-9.28054"
    },
    {
        "projectName": "Coopérnico – Cooperativa de desenvolvimento sustentável C.R.L",
        "network": "Rede Convergir",
        "url": "/iniciativas/coopernico-cooperativa-de-desenvolvimento-sustentavel-c-r-l",
        "studyCase": true,
        "lat": "38.70664687",
        "lng": "-9.142962701"
    },
    {
        "projectName": "Ecoaldeia de Janas",
        "network": "Rede Convergir",
        "url": "/iniciativas/ecoaldeia-de-janas",
        "lat": "38.825527",
        "lng": "-9.4355162"
    },
    {
        "projectName": "Escola L.A.R.A. - Morgado, Monte da Luz",
        "network": "Rede Convergir",
        "url": "/iniciativas/escola-l-a-r-a-morgado-monte-da-luz",
        "lat": "37.8760582",
        "lng": "-8.1649833"
    },
    {
        "projectName": "Espaço Musas e Quinta Musas da Fontinha - Quinta Musas da Fontinha",
        "network": "Rede Convergir",
        "url": "/iniciativas/quinta-musas-da-fontinha",
        "lat": "41.1567445",
        "lng": "-8.6076121"
    },
    {
        "projectName": "Gaia in Harmonia - Iniciativas (Criativas) de Transição",
        "network": "Rede Convergir",
        "url": "/iniciativas/gaia-in-harmonia-iniciativas-criativas-de-transicao",
        "lat": "38.3330035",
        "lng": "-8.0030628"
    },
    {
        "projectName": "Há Festa no Campo",
        "network": "Rede Convergir",
        "url": "/iniciativas/ha-festa-no-campo",
        "lat": "39.913691",
        "lng": "-7.5671515"
    },
    {
        "projectName": "ITLaV - Iniciativa de Transição de Linda-a-Velha",
        "network": "Rede Convergir",
        "url": "/iniciativas/iniciativa-de-transicao-de-linda-a-velha",
        "lat": "38.70752723",
        "lng": "-9.240665903"
    },
    {
        "projectName": "Portalegre em Transição",
        "network": "Rede Convergir",
        "url": "/iniciativas/portalegre-em-transicao",
        "lat": "39.29336055",
        "lng": "-7.431370615"
    },
    {
        "projectName": "projecto270",
        "network": "Rede Convergir",
        "url": "/iniciativas/projecto270",
        "studyCase": true,
        "lat": "38.6446842",
        "lng": "-9.233385"
    },
    {
        "projectName": "PROUTugal - Movimento PROUTugal",
        "network": "Rede Convergir",
        "url": "/iniciativas/movimento-proutugal",
        "lat": "38.7368843",
        "lng": "-9.1373136"
    },
    {
        "projectName": "Quinta do Alecrim",
        "network": "Rede Convergir",
        "url": "/iniciativas/quinta-do-alecrim",
        "lat": "39.4127645",
        "lng": "-8.595509264"
    },
    {
        "projectName": "Quinta do Vale da Lama",
        "network": "Rede Convergir",
        "url": "/iniciativas/quinta-do-vale-da-lama",
        "lat": "37.14062743",
        "lng": "-8.630510642"
    },
    {
        "projectName": "Quinta Ecológica da Moita - Quinta das Moitas",
        "network": "Rede Convergir",
        "url": "/iniciativas/quinta-das-moitas",
        "lat": "40.5671596",
        "lng": "-7.5145715"
    },
    {
        "projectName": "Quinta Pedagógica do Mitra - Associação Movimento Terra Solta",
        "network": "Rede Convergir",
        "url": "/iniciativas/associacao-movimento-terra-solta",
        "lat": "41.1683484",
        "lng": "-8.6265377"
    },
    {
        "projectName": "Soalheira - Projecto Soalheira",
        "network": "Rede Convergir",
        "url": "/iniciativas/soalheira",
        "lat": "39.7360906",
        "lng": "-8.4913272"
    },
    {
        "projectName": "Tamera",
        "network": "Rede Convergir",
        "url": "/iniciativas/tamera",
        "studyCase": true,
        "lat": "37.71876",
        "lng": "-8.51999"
    },
    {
        "projectName": "Vale da Sarvinda",
        "network": "Rede Convergir",
        "url": "/iniciativas/vale-da-sarvinda-131",
        "studyCase": true,
        "lat": "39.71338754",
        "lng": "-7.496421424"
    },
    {
        "projectName": "VITAMIMOS- Saúde, Ambiente e Bem-Estar ",
        "network": "Social Lab EDP Solidária",
        "url": "http://www.vitamimos.pt/",
        "lat": "38.6897329",
        "lng": "-9.3413843"
    },
    {
        "projectName": "2º oportunidade - Envio 24 - Cooperativa de Distribuição Porta a Porta, CRL (2ª oportunidade)",
        "network": "Zoom CASES",
        "url": "http://www.centrojovemtabor.com/noticia_semear_solidariedade.php?pag=1",
        "lat": "38.6975709",
        "lng": "-8.9572806"
    },
    {
        "projectName": "AJHA - Associação Jovem \"Habi(li)tar Alentejo\"",
        "network": "Zoom CASES",
        "url": "http://www.ajha.pt/",
        "lat": "38.0182779",
        "lng": "-7.8726033"
    },
    {
        "projectName": "Associação Mais Cidadania ",
        "network": "Zoom CASES",
        "url": "http://www.maiscidadania.pt/",
        "lat": "38.7147553",
        "lng": "-9.1471122"
    },
    {
        "projectName": "Boa - Comunidade Colaborativa",
        "network": "Zoom CASES",
        "url": "http://boacolaborativa.org/",
        "lat": "38.7257823",
        "lng": "-9.1734061"
    },
    {
        "projectName": "Equipa d'África",
        "network": "Zoom CASES",
        "url": "http://www.equipadafrica.com/",
        "lat": "38.7143477",
        "lng": "-9.1638306"
    },
    {
        "projectName": "Mentes Empreendedoras",
        "network": "Zoom CASES",
        "url": "https://www.facebook.com/SomosMentes/",
        "lat": "38.6893497",
        "lng": "-9.3133236"
    },
    {
        "projectName": "Ameixoeira Criativa ",
        "network": "Bip Zip",
        "url": "http://lisboasolidaria.cm-lisboa.pt/documentos/1395908896U3pUR1ck2Zw52OZ3.pdf",
        "lat": "38.7861282",
        "lng": "-9.1589106"
    },
    {
        "projectName": "Projecto remix ",
        "network": "Bip Zip",
        "url": "https://www.facebook.com/ProjectoreMix",
        "studyCase": true,
        "lat": "38.7469352",
        "lng": "-9.1201641"
    },
    {
        "projectName": "Aveiro em Transição",
        "network": "Bola-de-neve",
        "url": "https://aveiroemtransicao.wordpress.com/",
        "lat": "40.6377",
        "lng": "-8.6561861"
    },
    {
        "projectName": "GASTagus",
        "network": "Bola-de-neve",
        "url": "http://www.gastagus.org/",
        "lat": "38.7373408",
        "lng": "-9.3053126"
    },
    {
        "projectName": "João Sem Medo",
        "network": "Bola-de-neve",
        "url": "http://www.joaosemmedo.org/",
        "lat": "38.7039573",
        "lng": "-9.1778972"
    },
    {
        "projectName": "Projecto SABI (NAVEGAR, IPSS) ",
        "network": "Bola-de-neve",
        "url": "http://www.navegar.pt/",
        "lat": "38.7841585",
        "lng": "-9.0973525"
    },
    {
        "projectName": "Academia Ubuntu",
        "network": "Cidadania Activa",
        "url": "http://www.academiaubuntu.org",
        "lat": "38.7104825",
        "lng": "-9.1356409"
    },
    {
        "projectName": "Operação Nariz Vermelho - Associação de Apoio à Criança",
        "network": "Cidadania Activa",
        "url": "http://www.narizvermelho.pt/",
        "lat": "38.7062004",
        "lng": "-9.1687885"
    },
    {
        "projectName": "Agricultura Social para a inclusão ",
        "network": "EDP Hortas Solidárias",
        "url": "http://www.cercica.pt/noticias.php?ArticleID=370",
        "lat": "38.7160287",
        "lng": "-9.3730688"
    },
    {
        "projectName": "Associação QE, Uma Nova Linguagem para a Incapacidade, IPSS",
        "network": "EDP Hortas Solidárias",
        "url": "http://quintaessencia.pt/quem-somos",
        "lat": "38.7672387",
        "lng": "-9.3631369"
    },
    {
        "projectName": "horta dos sonhos",
        "network": "EDP Hortas Solidárias",
        "url": "http://hortadosonhos.blogs.sapo.pt/",
        "lat": "38.6886347",
        "lng": "-7.7739398"
    },
    {
        "projectName": "SEMEAR MAIS SOLIDARIEDADE",
        "network": "EDP Hortas Solidárias",
        "url": "http://www.coopenvio24.com/html/quem-somos-coop-envio24.php#",
        "studyCase": true,
        "lat": "38.5556879",
        "lng": "-8.8541942"
    },
    {
        "projectName": "Associação Tempo de Mudar para o Desenvolvimento do Bairro dos Lóios ",
        "network": "Rede Animar",
        "url": "http://atm.org.pt/",
        "lat": "38.741024",
        "lng": "-9.1039537"
    },
    {
        "projectName": "Cabaz do Hortelão ",
        "network": "Rede Animar",
        "url": "http://www.monte-ace.pt/site/servicos_cabazdohortelao.html",
        "lat": "38.722089",
        "lng": "-7.9856204"
    }

];



Catalise.baseLayers = [
    {
        active: true,
        name: "Estradas",
        //layer: L.tileLayer('http://otile1.mqcdn.com/tiles/1.0.0/map/{z}/{x}/{y}.jpg', {})
        layer: MQ.mapLayer()
    },
    {
        name: "Satélite",
//        layer: L.tileLayer("http://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}.jpg"),
        layer: L.featureGroup([
            L.tileLayer("http://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}.jpg"),
            L.tileLayer('http://{s}.tile.openstreetmap.se/hydda/roads_and_labels/{z}/{x}/{y}.png'),
        ])
    }



];

//Catalise.tileLayer = L.tileLayer('http://otile1.mqcdn.com/tiles/1.0.0/map/{z}/{x}/{y}.jpg', {});



(function(){

    Catalise.markersBook = {};
    Catalise.markersSimple = {};



    var network = ["Rede Convergir", "Social Lab EDP Solidária", "Zoom CASES", "Bip Zip", "Cidadania Activa", "EDP Hortas Solidárias", "Rede Animar", "Bola-de-neve"];
    var color = ["green", "orange", "red", "blue", "purple", "darkblue", "darkpurple", "lightgray"];

    for(var i=0; i<color.length; i++){
        Catalise.markersBook[color[i]] = L.AwesomeMarkers.icon({
            icon: "book",
            iconColor: "black",
            extraClasses: "icon-marker-lg",
            prefix: "fa",
            markerColor: color[i]
        });    

        Catalise.markersSimple[color[i]] = L.AwesomeMarkers.icon({
            icon: "",
            prefix: "fa",
            markerColor: color[i]
        });


    }

    Catalise.colorMapping = _.object(network, color);
    Catalise.networkLayers = {};
    Catalise.panelConfig = [];

    var layer;
    for(i=0; i<network.length; i++){
        Catalise.networkLayers[network[i]] = L.layerGroup();


        Catalise.panelConfig.push({
            active: true,
            name: "" + network[i],
            layer: Catalise.networkLayers[network[i]],

            // custom properties - the plugin was changed to support these properties
            legend: true,
            className: "legend-strip leaflet-panel-layers-" + Catalise.colorMapping[network[i]], 
            
        });
    }


})();

Catalise.awesomeMarkersColors = {
    red: "#d63e2a",
    orange: "#f69730",
    green: "#72b026",
    blue: "#38aadd",
    purple: "#d252b9",
    darkred: "#a23336",
    darkblue: "#0067a3",
    darkgreen: "#728224",
    darkpurple: "#5b396b",
    cadetblue: "#436978",
    lightred: "#ff8e7f",
    beige: "#ff8e7f",
    lightgreen: "#ff8e7f",
    lightblue: "#8adaff",
    pink: "#ff91ea",
    white: "#fbfbfb",
    lightgray: "#a3a3a3",
    gray: "#575757",
    black: "#303030"
};

 



Catalise.popupTemplate = _.template("<h4><a href='<%= url %>' target='_blank' title='Abrir numa nova tab'><%= projectName %> <i class='fa fa-link'></i></a></h4> <span style='font-weight: bold;'>Caso de estudo:</span> <% if(studyCase){ %> sim <% }else{ %> não <% } %><br><span style='font-weight: bold;'>Rede de origem</span> <%= network %>");



var counter = 0;
_.each(Catalise.data, function(obj){

    obj.studyCase = !!obj.studyCase;

    var latLng = [Number(obj.lat), Number(obj.lng)];
    var popupMsg = Catalise.popupTemplate(obj);
    var color = Catalise.colorMapping[obj.network];
    var icon = obj.studyCase ? Catalise.markersBook[color] : Catalise.markersSimple[color];

    var marker = L.marker(latLng, {
            icon: icon
        })
        .bindPopup(popupMsg);

    Catalise.networkLayers[obj.network].addLayer(marker);

counter++;
});

Catalise.map = L.map('map', {
    center: [39.4, -8],
    zoom: 8,
});



Catalise.map.addControl( new L.Control.PanelLayers(Catalise.baseLayers, Catalise.panelConfig) );

// hack directly the dom with jquery to make it look right

$(".leaflet-panel-layers-list").append("<div class='leaflet-panel-layers-overlays' style='border: 1px solid rgb(147, 144, 140); padding: 1px; border-radius: 4px;'>  <label class='leaflet-panel-layers-item' style='cursor: default; border: none; margin: 0px; background-color: rgba(255, 255, 255, 0.8); font-size: 13px;'> <i class='fa fa-book' style='font-size: 16px;'></i>  Caso de estudo </div>")


$(".leaflet-panel-layers-overlays").first().prepend("<div style='font-size: 15px; font-weight: bold; margin: 0px 0px 0px 0px; padding: 0px 0px 0px 4px; background-color: rgba(255, 255, 255, 0.8);'>Redes de origem:</div>")

$(".leaflet-panel-layers-item").css({
    "border": "none",
    "margin": 0,
    "background-color": "rgba(255, 255, 255, 0.9)"
});

$(".leaflet-panel-layers-overlays, .leaflet-panel-layers-base").css({
    "border": "1px solid #93908c",
    "padding": "1px 1px 1px 1px",
    "border-radius": "4px",
    "margin-bottom": "8px"
});

$(".leaflet-panel-layers-separator").remove();

$(".leaflet-panel-layers").css({
    "height": "", 
    "padding": "8px 8px 3px 8px",
    "border-radius": "6px",
    "top": "10px",
    "right": "10px"
});

$('a[data-download="true"]').on("click", function(e){
    
    var $target = $(e.target);
    var file = $target.prop("href").split("/").pop();
    $.ajax({
        url: "/api/v1/log-download",
        method: "PUT",
        data: JSON.stringify({ resource: file }),
        contentType: "application/json",
    });
});

</script>

{% endblock %}
